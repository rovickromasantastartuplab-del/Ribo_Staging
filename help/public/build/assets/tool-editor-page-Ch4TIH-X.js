const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-editor-B7vDiNsP.js","./client-DtfdVV77.js"])))=>i.map(i=>d[i]);
import{r as x,j as e,b$ as te,b_ as ae,bg as ne,T as l,av as q,B as g,ac as B,d as ie,al as re,am as oe,an as le,ap as ce,aP as de,az as j,F as O,m as v,aq as ue,aj as y,p as M,a as R,i as D,ct as me,s as U,q as C,cC as Q,k as A,t as F,a_ as pe,b3 as xe,aa as V,aD as je,X as he,y as ge,P as ve,bd as fe,h as be}from"./client-DtfdVV77.js";import{g as f}from"./main-BGmGAxtx.js";import{T as N}from"./tiptap-text-field-DefhwkAZ.js";import{T as W}from"./table-CynOKbaN.js";import{F as ye,S as J}from"./select-D9niWe2H.js";import{A as X}from"./Add-B1HfWgJf.js";import{D as I}from"./Delete-DWP7kvj0.js";import{E as Ae}from"./Edit-BaEHOLuK.js";import{C as Te}from"./check-circle-filled-B4oRGH_i.js";import{a as K,b as Se,A as Ce}from"./variable-extension-BUEoymSX.js";import{a as w,A as Ve}from"./accordion-Dmxnze9z.js";import{R as L}from"./radio-DP8xYP6t.js";import{R as Re}from"./radio-group-C_T7jNq6.js";import{A as De}from"./admin-config-DXsixO44.js";import{D as Ne}from"./settings-links-CRsxvJIZ.js";import{D as Ie}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{B as we,a as $}from"./breadcrumb-CaNBY_Ut.js";import{P as ke}from"./Pause-nmM_0UY8.js";import{C as Pe}from"./confirmation-dialog-BzXs9ksK.js";import"./custom-menu-Dvq-fOnC.js";import"./emoji-picker-button-Cm_kBrZ5.js";import"./tiptap-editor-context-CeN7pXcf.js";import"./index-Y7xUBCAo.js";import"./index-uUjpwT6n.js";import"./with-selector-DPNnjGhI.js";import"./DataObject-3cjjRxnv.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./skeleton-D178v0-U.js";import"./ArrowDownward-DHtsWMyK.js";import"./useEffectEvent-Offmqu_S.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./useGlobalListeners-BGMP113F.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DZmli5NZ.js";import"./Event-DDJ424UR.js";import"./ToggleOn-DbVFGpQu.js";import"./TextFields-CM1xUWDR.js";import"./accordtion-animation-BGCK95Hj.js";import"./dashboard-icons-BJ4c3Z5i.js";import"./library-icon-h4d3s9Ef.js";import"./messages-square-icon-D_3IR-rK.js";import"./Home-iO0iebLw.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./Translate-DPB2wdvD.js";import"./external-link-Cxcw6nc_.js";import"./book-open-D91H26Dq.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./ChevronRight-C5OrfRtB.js";import"./MoreHoriz-Df3_bV9s.js";var r=(s=>(s.General="general",s.ApiConnection="api-connection",s.TestResponse="test-response",s.AttributeMapping="attribute-mapping",s))(r||{});const T={[r.General]:s=>!!s.name&&!!s.description,[r.ApiConnection]:s=>!!s.url&&!!s.method&&!!s.bodyType,[r.TestResponse]:s=>!!s.selectedResponseType&&(!!s.exampleResponse||!!s.liveResponse),[r.AttributeMapping]:s=>!0},Ee=s=>{const t={name:(s==null?void 0:s.name)??"",description:(s==null?void 0:s.description)??"",allow_direct_use:(s==null?void 0:s.allow_direct_use)??!1};return{isValid:T[r.General](t),values:t,isDirty:!1,errors:{}}},qe=s=>{var i,a,o,n,d,m,u,p,h,b,S,G;const t={url:((a=(i=s==null?void 0:s.config)==null?void 0:i.apiRequest)==null?void 0:a.url)??"",method:((n=(o=s==null?void 0:s.config)==null?void 0:o.apiRequest)==null?void 0:n.method)??"GET",bodyType:((m=(d=s==null?void 0:s.config)==null?void 0:d.apiRequest)==null?void 0:m.bodyType)??"json",body:((p=(u=s==null?void 0:s.config)==null?void 0:u.apiRequest)==null?void 0:p.body)??"",headers:((b=(h=s==null?void 0:s.config)==null?void 0:h.apiRequest)==null?void 0:b.headers)??[],collectedData:((G=(S=s==null?void 0:s.config)==null?void 0:S.apiRequest)==null?void 0:G.collectedData)??[]};return{isValid:T[r.ApiConnection](t),values:t,isDirty:!1,errors:{}}},Me=s=>{var i,a,o;const t={selectedResponseType:((i=s==null?void 0:s.config)==null?void 0:i.selectedResponseType)??"live",exampleResponse:(s==null?void 0:s.example_response)??"",liveResponse:(s==null?void 0:s.live_response)??"",attributesUsed:((o=(a=s==null?void 0:s.config)==null?void 0:a.apiRequest)==null?void 0:o.attributesUsed)??[]};return{isValid:T[r.TestResponse](t),values:t,isDirty:!1,errors:{}}},Fe=s=>{const t={responseSchema:(s==null?void 0:s.response_schema)??{}};return{isValid:T[r.AttributeMapping](t),values:t,isDirty:!1,errors:{}}},H=s=>({[r.General]:Ee(s),[r.ApiConnection]:qe(s),[r.TestResponse]:Me(s),[r.AttributeMapping]:Fe(s)}),ze=s=>te((t,i)=>({getState:()=>i(),activeStep:r.General,setActiveStep:a=>t({activeStep:a}),...H(s),getValues:a=>i()[a].values,setValues:a=>{const o=i()[a.step],n={...o.values,...a},d=T[a.step](n),m={};for(const u in o.errors)Object.keys(a).some(p=>u.startsWith(p))||(m[u]=o.errors[u]);t({[a.step]:{...o,values:n,isValid:d,isDirty:!0,errors:m}})},setIsDirty:(a,o)=>{const n=i()[a];t({[a]:{...n,isDirty:o}})},setErrors:(a,o)=>{const n=i()[a];t({[a]:{...n,isValid:Object.keys(o).length?!1:n.isValid,errors:o}})},syncWithTool:(a,o)=>{t(H(o))}})),Y=x.createContext(null);function _e({children:s,initialTool:t}){const[i]=x.useState(()=>ze(t));return e.jsx(Y.Provider,{value:i,children:s})}function c(s){const t=x.useContext(Y);return ae(t,s)}function Ge(){const s=c(o=>o[r.ApiConnection].values.collectedData),t=x.useMemo(()=>s.map(o=>({...o,id:ne()})),[s]),i=c(o=>o.setValues),a=o=>{i({step:r.ApiConnection,collectedData:[...s,o]})};return e.jsxs("div",{className:"mb-34",children:[e.jsxs("div",{className:"mb-16 text-sm",children:[e.jsx("div",{className:"mb-4 font-semibold",children:e.jsx(l,{message:"Collect data inputs (optional)"})}),e.jsx("div",{children:e.jsx(l,{message:"Specify the data AI agent should collect from the customer before using this tool. AI agent will collect them from conversation history or by asking the customer."})})]}),!!s.length&&e.jsx("div",{className:"mb-12 max-h-400 overflow-y-auto",children:e.jsx(W,{className:"table-fixed",tableStyle:"html",columns:Oe,data:t,enableSelection:!1})}),e.jsxs(q,{type:"modal",onClose:o=>{o&&a(o)},children:[e.jsx(g,{startIcon:e.jsx(X,{}),children:e.jsx(l,{message:"Add"})}),e.jsx(Z,{})]})]})}const Oe=[{key:"name",header:()=>e.jsx(l,{message:"Name"}),body:s=>s.name},{key:"format",header:()=>e.jsx(l,{message:"Format"}),width:"w-124",body:s=>{switch(s.format){case"string":return e.jsx(l,{message:"Text"});case"number":return e.jsx(l,{message:"Number"});case"boolean":return e.jsx(l,{message:"True of false"})}}},{key:"description",header:()=>e.jsx(l,{message:"Description"}),body:s=>s.description},{key:"actions",header:()=>e.jsx(l,{message:"Actions"}),hideHeader:!0,width:"w-124",body:(s,t)=>e.jsx(Ke,{item:s,index:t.index})}];function Ke({item:s,index:t}){const i=c(d=>d.getValues),a=c(d=>d.setValues),o=d=>{const m=[...i(r.ApiConnection).collectedData??[]];m[t]=d,a({step:r.ApiConnection,collectedData:m})},n=()=>{const d=i(r.ApiConnection).collectedData??[];a({step:r.ApiConnection,collectedData:d.filter((m,u)=>u!==t)})};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{type:"modal",onClose:d=>{d&&o(d)},children:[e.jsx(y,{variant:"flat",size:"sm",children:e.jsx(Ae,{})}),e.jsx(Z,{item:s})]}),e.jsx(y,{variant:"flat",size:"sm",onClick:()=>n(),children:e.jsx(I,{})})]})}function Z({item:s}){const{trans:t}=B(),i=ie({defaultValues:{format:(s==null?void 0:s.format)??"string",name:(s==null?void 0:s.name)??"",description:(s==null?void 0:s.description)??""}}),{close:a,formId:o}=re();return e.jsxs(oe,{size:"lg",children:[e.jsx(le,{children:e.jsx(l,{message:"Collect data"})}),e.jsx(ce,{children:e.jsxs(de,{id:o,form:i,onSubmit:n=>a(n),children:[e.jsxs(ye,{name:"format",label:e.jsx(l,{message:"Format"}),className:"mb-24",required:!0,children:[e.jsx(j,{value:"string",children:e.jsx(l,{message:"Text"})}),e.jsx(j,{value:"number",children:e.jsx(l,{message:"Number"})}),e.jsx(j,{value:"boolean",children:e.jsx(l,{message:"True of false"})})]}),e.jsx(O,{required:!0,name:"name",label:e.jsx(l,{message:"Name"}),placeholder:t(v("Example: Purchase ID")),className:"mb-24"}),e.jsx(O,{required:!0,name:"description",label:e.jsx(l,{message:"Description"}),description:e.jsx(l,{message:"Definition of data required so AI agent knows how to collect it"}),descriptionPosition:"top",inputElementType:"textarea",placeholder:t(v("Example: 8 digit identifier of the purchase. A customer can find this identifier in their purchase history")),rows:2})]})}),e.jsxs(ue,{children:[e.jsx(g,{onClick:()=>a(),children:e.jsx(l,{message:"Cancel"})}),e.jsx(g,{form:o,type:"submit",variant:"flat",color:"primary",children:e.jsx(l,{message:"Save"})})]})]})}function k({isDisabled:s,showDivider:t,children:i}){return e.jsx("div",{className:M("mt-24 pt-24",t&&"border-t"),children:e.jsx(g,{variant:"flat",color:"primary",size:"sm",type:"submit",disabled:s,children:i??e.jsx(l,{message:"Save and continue"})})})}function P({isValid:s}){return s?e.jsx(Te,{size:"sm"}):e.jsx("div",{className:M("size-20 p-2"),children:e.jsx("div",{className:"size-full rounded-full bg-chip"})})}function z(s){return c(t=>{const i=Object.values(r),a=i.indexOf(s);return i.slice(0,a).every(n=>t[n].isValid&&!t[n].isDirty)})}function E(s){const{toolId:t}=R(),i=c(n=>n.getValues),a=c(n=>n.syncWithTool),o=c(n=>n.setErrors);return D({onMutate:()=>{o(s,{})},mutationFn:()=>{const n={...i(s),step:s};return(t?A.put(`lc/ai-agent/tools/${t}`,n):A.post("lc/ai-agent/tools",n)).then(d=>d.data)},onSuccess:async n=>{const d=f.tools.get(n.tool.id,"editor").queryKey;C.setQueryData(d,{tool:n.tool}),await C.invalidateQueries({queryKey:f.tools.invalidateKey,predicate:m=>!Q(m.queryKey,d)}),a(s,n.tool)},onError:n=>{if(me.isAxiosError(n)&&n.response){const d=n.response.data.errors||{};if(!d||Object.keys(d).length===0)U(n);else{const m={};for(const[u,p]of Object.entries(d))m[u]=Array.isArray(p)?p[0]:p;o(s,m)}}}})}function Le(s){const t=c(n=>n[r.ApiConnection].isValid),i=c(n=>n.setActiveStep),a=E(r.ApiConnection),o=!z(r.ApiConnection);return e.jsx(w,{...s,label:e.jsx(l,{message:"API connection"}),startIcon:e.jsx(P,{isValid:t}),value:r.ApiConnection,disabled:o,children:e.jsxs("form",{onSubmit:n=>{n.preventDefault(),a.mutate(void 0,{onSuccess:()=>{i(r.TestResponse)}})},children:[e.jsx(Ge,{}),e.jsx($e,{}),e.jsx(k,{isDisabled:a.isPending})]})})}function $e(){const s=c(i=>i[r.ApiConnection].values.collectedData),t=x.useMemo(()=>(s==null?void 0:s.map(i=>{const a=i.name.replaceAll(" ","_").toLowerCase();return{name:a,displayName:i.name,type:K.CollectedData,key:`${K.CollectedData}.${a}`,isReadonly:!0}}))??[],[s]);return e.jsxs(Se,{value:t,children:[e.jsxs("div",{className:"mb-16 text-sm",children:[e.jsx("div",{className:"mb-4 font-semibold",children:e.jsx(l,{message:"API request"})}),e.jsx("div",{children:e.jsx(l,{message:"Endpoint that should be called by AI Agent to retrieve data or send updates. You can use attributes or data collected by AI Agent in the URL, headers or request body."})})]}),e.jsxs("div",{className:"mb-24 flex items-start gap-12",children:[e.jsx(He,{}),e.jsx(Be,{})]}),e.jsx(Ue,{}),e.jsx(Je,{})]})}function He(){const s=c(a=>a[r.ApiConnection].values.method),t=c(a=>a.setValues),i=c(a=>a[r.ApiConnection].errors.method);return e.jsxs(J,{name:"method",label:e.jsx(l,{message:"Method"}),required:!0,invalid:!!i,errorMessage:i,selectionMode:"single",selectedValue:s,onSelectionChange:a=>{t({step:r.ApiConnection,method:a,bodyType:"json",body:""})},children:[e.jsx(j,{value:"GET",children:e.jsx(l,{message:"GET"})}),e.jsx(j,{value:"POST",children:e.jsx(l,{message:"POST"})}),e.jsx(j,{value:"PUT",children:e.jsx(l,{message:"PUT"})}),e.jsx(j,{value:"DELETE",children:e.jsx(l,{message:"DELETE"})})]})}function Be(){const s=c(a=>a[r.ApiConnection].values.url),t=c(a=>a.setValues),i=c(a=>a[r.ApiConnection].errors.url);return e.jsx(N,{required:!0,errorMessage:i,invalid:!!i,name:"url",label:e.jsx(l,{message:"HTTPS URL"}),className:"flex-auto",hideEmojiPicker:!0,value:s,onChange:a=>{t({step:r.ApiConnection,url:a})}})}function Ue(){const s=c(o=>o[r.ApiConnection].values.headers),t=c(o=>o.setValues),i=o=>{t({step:r.ApiConnection,headers:s.filter((n,d)=>d!==o)})},a=()=>{t({step:r.ApiConnection,headers:[...s,{key:"",value:""}]})};return e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:"mb-12 text-sm font-semibold",children:e.jsx(l,{message:"HTTP Headers"})}),e.jsx("div",{className:"space-y-12",children:s.map((o,n)=>e.jsxs("div",{className:"flex items-start gap-12",children:[e.jsx(Qe,{index:n}),e.jsx(We,{index:n}),e.jsx(y,{className:"mt-24",onClick:()=>i(n),children:e.jsx(I,{})})]},n))}),e.jsx(g,{startIcon:e.jsx(X,{}),onClick:()=>a(),className:"-ml-14 mt-8",children:e.jsx(l,{message:"Add key value pair"})})]})}function Qe({index:s}){const t=c(n=>n[r.ApiConnection].values.headers[s].key),i=c(n=>n.setValues),a=c(n=>n.getValues),o=c(n=>n[r.ApiConnection].errors[`headers.${s}.key`]);return e.jsx(N,{label:s===0?e.jsx(l,{message:"Key"}):null,required:!0,name:`headers.${s}.key`,className:"flex-1",hideEmojiPicker:!0,value:t,onChange:n=>{i({step:r.ApiConnection,headers:a(r.ApiConnection).headers.map((d,m)=>m===s?{...d,key:n}:d)})},invalid:!!o,errorMessage:o})}function We({index:s}){const t=c(n=>n[r.ApiConnection].values.headers[s].value),i=c(n=>n.setValues),a=c(n=>n.getValues),o=c(n=>n[r.ApiConnection].errors[`headers.${s}.value`]);return e.jsx(N,{label:s===0?e.jsx(l,{message:"Value"}):null,required:!0,name:`headers.${s}.value`,className:"flex-1",hideEmojiPicker:!0,value:t,onChange:n=>{i({step:r.ApiConnection,headers:a(r.ApiConnection).headers.map((d,m)=>m===s?{...d,value:n}:d)})},invalid:!!o,errorMessage:o})}function Je(){const{trans:s}=B(),t=c(n=>n[r.ApiConnection].values.method),i=c(n=>n[r.ApiConnection].values.body),a=c(n=>n[r.ApiConnection].values.bodyType),o=c(n=>n.setValues);return t!=="POST"&&t!=="PUT"?null:e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:"mb-12 text-sm font-semibold",children:e.jsx(l,{message:"Request body"})}),e.jsxs(J,{name:"bodyType",className:"mb-12 max-w-124",required:!0,selectionMode:"single",selectedValue:a,onSelectionChange:n=>{o({step:r.ApiConnection,bodyType:n})},children:[e.jsx(j,{value:"json",children:e.jsx(l,{message:"JSON"})}),e.jsx(j,{value:"text",children:e.jsx(l,{message:"Text"})})]}),e.jsx(N,{size:"lg",multiline:!0,placeholder:s(v("Enter request body")),value:i,onChange:n=>{o({step:r.ApiConnection,body:n})}})]})}function Xe(s){const t=c(o=>o[r.AttributeMapping].isValid),i=E(r.AttributeMapping),a=!z(r.AttributeMapping);return e.jsx(w,{...s,label:e.jsx(l,{message:"Attribute mapping"}),startIcon:e.jsx(P,{isValid:t}),value:r.AttributeMapping,disabled:a,children:e.jsxs("form",{onSubmit:o=>{o.preventDefault(),i.mutate(void 0,{onSuccess:()=>{F(v("Attribute mapping updated"))}})},children:[e.jsx(Ye,{}),e.jsx(k,{isDisabled:i.isPending,showDivider:!1,children:e.jsx(l,{message:"Save"})})]})})}function Ye(){const s=c(t=>t[r.AttributeMapping].values.responseSchema);return e.jsxs("div",{children:[e.jsx("div",{className:"mb-16 text-sm",children:e.jsx("div",{children:e.jsx(l,{message:"Map any response data you want to use in custom flows. AI agent can use all data automatically, without manual mapping."})})}),e.jsx("div",{className:"max-h-400 overflow-y-auto",children:e.jsx(W,{tableStyle:"html",columns:Ze,data:s.properties??[],enableSelection:!1})})]})}const Ze=[{key:"path",visibleInMode:"all",header:()=>e.jsx(l,{message:"Data"}),className:"capitalize",body:s=>s.path.split(".").filter(t=>t!=="[root]").join(" â€º ")},{key:"value",header:()=>e.jsx(l,{message:"Example value"}),body:s=>e.jsx("div",{className:"max-w-224 truncate",children:`${s.value}`})},{key:"format",className:"capitalize",header:()=>e.jsx(l,{message:"Format"}),width:"w-100",body:s=>!s.format||s.format==="null"?e.jsx(l,{message:"Unkown"}):s.format},{key:"actions",header:()=>e.jsx(l,{message:"Attribute mapping"}),align:"end",visibleInMode:"all",body:(s,t)=>e.jsx(es,{index:t.index})}];function es({index:s}){const t=c(n=>n.setValues),i=c(n=>n.getValues),a=c(n=>n[r.AttributeMapping].values.responseSchema.properties[s].attribute),o=n=>{const d=i(r.AttributeMapping).responseSchema;t({step:r.AttributeMapping,responseSchema:{...d,properties:d.properties.map((m,u)=>u===s?{...m,attribute:n}:m)}})};return e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(Ce,{className:"flex-auto",floatingWidth:"auto",size:"xs",value:a,onChange:n=>o(n)}),!!a&&e.jsx(pe,{label:e.jsx(l,{message:"Remove mapping"}),children:e.jsx(y,{size:"xs",variant:"outline",onClick:()=>o(void 0),children:e.jsx(I,{})})})]})}function ss(s){const{toolId:t}=R(),i=xe(),a=c(d=>d[r.General].isValid),o=c(d=>d.setActiveStep),n=E(r.General);return e.jsx(w,{...s,label:e.jsx(l,{message:"General"}),startIcon:e.jsx(P,{isValid:a}),value:r.General,children:e.jsxs("form",{onSubmit:d=>{d.preventDefault(),n.mutate(void 0,{onSuccess:async m=>{t||await i(`../${m.tool.id}/edit`,{relative:"path",replace:!0}),o(r.ApiConnection)}})},children:[e.jsx(ts,{}),e.jsx(as,{}),e.jsx(ns,{}),e.jsx(k,{isDisabled:n.isPending})]})})}function ts(){const s=c(a=>a[r.General].values.name),t=c(a=>a.setValues),i=c(a=>a[r.General].errors.name);return e.jsx(V,{name:"name",required:!0,minLength:5,maxLength:100,label:e.jsx(l,{message:"Name"}),className:"mb-24",value:s,onChange:a=>t({step:r.General,name:a.target.value}),errorMessage:i,invalid:!!i})}function as(){const s=c(a=>a[r.General].values.description),t=c(a=>a.setValues),i=c(a=>a[r.General].errors.description);return e.jsx(V,{required:!0,name:"description",label:e.jsx(l,{message:"Description"}),descriptionPosition:"top",description:e.jsx(l,{message:"Explain when the AI agent should use this tool. Include a description of what this tool does, data it provides or actions it can perform."}),inputElementType:"textarea",rows:10,className:"mb-24",value:s,onChange:a=>t({step:r.General,description:a.target.value}),errorMessage:i,invalid:!!i})}function ns(){const s=c(i=>i[r.General].values.allow_direct_use),t=c(i=>i.setValues);return e.jsx(je,{name:"allow_direct_use",description:e.jsx(l,{message:"AI Agent will use the name and description of the tool to determine when to trigger it"}),checked:s,onChange:i=>t({step:r.General,allow_direct_use:i.target.checked}),children:e.jsx(l,{message:"Allow AI Agent to use this tool directly without adding it to a flow"})})}function _(){const{toolId:s}=R(),{data:t}=he({...f.tools.get(s,"editor"),enabled:!!s});return(t==null?void 0:t.tool)??null}const ee=ge(e.jsx("path",{d:"M8 19V5l11 7Z"}),"PlayArrowFilled"),is=x.lazy(()=>fe(()=>import("./ace-editor-B7vDiNsP.js"),__vite__mapDeps([0,1]),import.meta.url));function rs(s){const t=c(n=>n[r.TestResponse].isValid),i=c(n=>n.setActiveStep),a=E(r.TestResponse),o=!z(r.TestResponse);return e.jsx(w,{...s,label:e.jsx(l,{message:"Test response"}),startIcon:e.jsx(P,{isValid:t}),value:r.TestResponse,disabled:o,children:e.jsxs("form",{onSubmit:n=>{n.preventDefault(),a.mutate(void 0,{onSuccess:()=>{i(r.AttributeMapping)}})},children:[e.jsx(os,{}),e.jsx(k,{isDisabled:a.isPending})]})})}function os(){const s=c(t=>t[r.TestResponse].values.selectedResponseType);return e.jsxs(x.Fragment,{children:[e.jsx(ls,{}),s==="example"&&e.jsx(us,{}),s==="live"&&e.jsx(cs,{})]})}function ls(){const s=c(i=>i[r.TestResponse].values.selectedResponseType),t=c(i=>i.setValues);return e.jsxs(Re,{name:"selectedResponseType",size:"sm",orientation:"vertical",value:s,onChange:i=>{t({step:r.TestResponse,selectedResponseType:i})},children:[e.jsx(L,{name:"selectedResponseType",size:"sm",checked:s==="live",value:"live",description:e.jsx(l,{message:"Test with live response data from the API to make sure it is configured correctly"}),children:e.jsx(l,{message:"Live response"})}),e.jsx(L,{name:"selectedResponseType",size:"sm",checked:s==="example",value:"example",description:e.jsx(l,{message:"Provide example JSON data if the API is not ready yet"}),children:e.jsx(l,{message:"Example response"})})]})}function cs(){const s=_(),t=c(u=>u[r.TestResponse].values.attributesUsed),i=c(u=>u.setValues),[a,o]=x.useState([]),n=D({onMutate:()=>{o([])},mutationFn:()=>A.post("lc/ai-agent/tools/test-request",{apiRequest:s.config.apiRequest,attributes:t.map(u=>({name:u.name,type:u.type,value:u.testValue}))}).then(u=>u.data),onError:u=>U(u),onSuccess:u=>{i({step:r.TestResponse,liveResponse:JSON.stringify(u.response,null,2)}),F(v("Response is valid"))}}),d=()=>{if(t!=null&&t.some(u=>!u.testValue)){o((t==null?void 0:t.filter(u=>!u.testValue||!u.name))??[]);return}n.mutate()},m=(u,p,h)=>{i({step:r.TestResponse,attributesUsed:t==null?void 0:t.map((b,S)=>S===u?{...b,[p]:h}:b)})};return e.jsxs("div",{className:"mt-24",children:[t!=null&&t.length?e.jsxs(x.Fragment,{children:[e.jsx("div",{className:"mb-12 text-sm",children:e.jsx(l,{message:"Enter values for attributes configured in the request."})}),e.jsx("div",{className:"space-y-12",children:t==null?void 0:t.map((u,p)=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(V,{className:"flex-1",size:"sm",name:`attributesUsed.${p}.name`,label:p===0?e.jsx(l,{message:"Attribute"}):null,readOnly:!0,value:u.name,onChange:h=>m(p,"name",h.target.value)}),e.jsx(V,{required:!0,className:"flex-1",size:"sm",name:`attributesUsed.${p}.testValue`,label:p===0?e.jsx(l,{message:"Value"}):null,value:u.testValue,onChange:h=>m(p,"testValue",h.target.value)})]},p))})]}):null,a.length>0&&e.jsx("div",{className:"mt-12 text-sm text-danger",children:e.jsx(l,{message:"Provide a value for all attributes."})}),e.jsx(ds,{}),e.jsx(g,{variant:"outline",size:"sm",className:"mt-24",startIcon:e.jsx(ee,{}),onClick:()=>d(),disabled:n.isPending,children:e.jsx(l,{message:"Test request"})})]})}function ds(){const s=c(i=>i[r.TestResponse].values.liveResponse),t=c(i=>i[r.TestResponse].errors.liveResponse);return e.jsxs("div",{children:[s?e.jsx(se,{value:s,invalid:!!t,readOnly:!0}):null,t?e.jsx("div",{className:"mt-12 text-sm text-danger",children:t}):null]})}function us(){const s=c(a=>a[r.TestResponse].values.exampleResponse),t=c(a=>a.setValues),i=c(a=>a[r.TestResponse].errors.exampleResponse);return e.jsxs("div",{children:[e.jsx(se,{defaultValue:s,onChange:a=>t({step:r.TestResponse,exampleResponse:a}),invalid:!!i}),i&&e.jsx("div",{className:"mt-12 text-sm text-danger",children:i})]})}function se({defaultValue:s,value:t,readOnly:i,onChange:a,onBlur:o,ref:n,invalid:d}){const m=x.useRef(!1);return e.jsx("div",{className:M("relative mt-24 h-240 overflow-hidden rounded-panel border",d&&"border-danger"),children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(ve,{"aria-label":"Loading editor...",isIndeterminate:!0,size:"md"})}),children:e.jsx(is,{beautify:!0,mode:"json",readOnly:i,defaultValue:s,value:t,onFocus:()=>{m.current=!0},onChange:u=>{m.current&&(a==null||a(u))},onBlur:o,editorRef:n})})})}function pt(){const s=_();return e.jsx(_e,{initialTool:s,children:e.jsx(ms,{})})}function ms(){const s=c(a=>a.activeStep),t=c(a=>a.setActiveStep),i=x.useMemo(()=>s?[s]:[],[s]);return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(ps,{}),e.jsx("div",{className:"flex-auto overflow-y-auto stable-scrollbar",children:e.jsx("div",{className:"container mx-auto px-24 py-56",children:e.jsxs(Ve,{variant:"outline",mode:"single",size:"lg",expandedValues:i,onExpandedChange:a=>t(a[0]),children:[e.jsx(ss,{}),e.jsx(Le,{}),e.jsx(rs,{}),e.jsx(Xe,{})]})})})]})}function ps(){const s=_(),t=(s==null?void 0:s.active)??!1,i=c(o=>Object.values(r).every(d=>o[d].isValid)),a=D({mutationFn:()=>A.put(`lc/ai-agent/tools/${s==null?void 0:s.id}`,{active:!t}),onSuccess:()=>C.invalidateQueries({queryKey:f.tools.invalidateKey})});return e.jsx(Ie,{showSidebarToggleButton:!0,rightContent:e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:"xs",variant:"button",link:De.pages.tools,children:e.jsx(l,{message:"Learn"})}),e.jsx(g,{type:"button",variant:"flat",color:t?"chip":"positive",size:"xs",disabled:!s||!i||a.isPending,onClick:()=>a.mutate(),startIcon:t?e.jsx(ke,{}):e.jsx(ee,{}),children:t?e.jsx(l,{message:"Pause"}):e.jsx(l,{message:"Set live"})}),!!s&&e.jsxs(q,{type:"modal",children:[e.jsx(y,{size:"xs",variant:"outline",children:e.jsx(I,{})}),e.jsx(xs,{})]})]}),children:e.jsxs(we,{size:"xl",children:[e.jsx($,{to:"../tools",children:e.jsx(l,{message:"Tools"})}),e.jsx($,{children:(s==null?void 0:s.name)??e.jsx(l,{message:"Untitled"})})]})})}function xs(){const s=be(),{toolId:t}=R(),i=D({mutationFn:()=>A.delete(`lc/ai-agent/tools/${t}`),onSuccess:async()=>{await C.invalidateQueries({queryKey:f.tools.invalidateKey,predicate:a=>!Q(a.queryKey,f.tools.get(t,"editor").queryKey)}),F(v("Tool deleted")),s("../..",{relative:"path"})}});return e.jsx(Pe,{isDanger:!0,title:e.jsx(l,{message:"Delete tool"}),body:e.jsx(l,{message:"This action is permanent and can't be undone. Configuration relating to this tool will no longer be available."}),confirm:e.jsx(l,{message:"Delete"}),onConfirm:()=>i.mutate(),isLoading:i.isPending})}export{pt as Component};
