import{r as m,cy as ce,j as x,ac as ue,p as A,A as de,z as fe,cz as Q,cA as be,b as ge,g as _,ai as N,aA as X,_ as he,$ as xe}from"./client-DtfdVV77.js";import{C as J}from"./checkbox-CS7ILu6P.js";import{S as me}from"./skeleton-D178v0-U.js";import{A as pe}from"./ArrowDownward-DHtsWMyK.js";import{$ as Y}from"./useEffectEvent-Offmqu_S.js";import{i as F}from"./is-ctrl-key-pressed-CaS-AM38.js";import{$ as we}from"./useGlobalListeners-BGMP113F.js";function ye(e){let{ref:t,onInteractOutside:s,isDisabled:i,onInteractOutsideStart:r}=e,c=m.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),u=Y(o=>{s&&q(o,t)&&(r&&r(o),c.current.isPointerDown=!0)}),a=Y(o=>{s&&s(o)});m.useEffect(()=>{let o=c.current;if(i)return;const f=t.current,n=ce(f);if(typeof PointerEvent<"u"){let d=y=>{o.isPointerDown&&q(y,t)&&a(y),o.isPointerDown=!1};return n.addEventListener("pointerdown",u,!0),n.addEventListener("click",d,!0),()=>{n.removeEventListener("pointerdown",u,!0),n.removeEventListener("click",d,!0)}}},[t,i,u,a])}function q(e,t){if(e.button>0)return!1;if(e.target){const s=e.target.ownerDocument;if(!s||!s.documentElement.contains(e.target)||e.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!e.composedPath().includes(t.current):!1}const j=m.createContext(null),ve={key:"checkbox",header:()=>x.jsx(Ce,{}),align:"center",width:"w-24 flex-shrink-0",body:(e,t)=>t.isPlaceholder?x.jsx(me,{size:"w-24 h-24",variant:"rect"}):x.jsx(ke,{item:e})};function ke({item:e}){const{selectedRows:t,toggleRow:s}=m.useContext(j);return x.jsx(J,{checked:t.includes(e.id),onChange:()=>s(e)})}function Ce(){const{trans:e}=ue(),{data:t,selectedRows:s,onSelectionChange:i}=m.useContext(j),r=!!t.length&&t.length===s.length,c=!r&&!!s.length;return x.jsx(J,{"aria-label":e({message:"Select all"}),isIndeterminate:c,checked:r,onChange:()=>{i(r?[]:t.map(u=>u.id))}})}function Z({index:e,isHeader:t}){const{columns:s,cellHeight:i="h-50",headerCellHeight:r="h-46",tableStyle:c}=m.useContext(j),u=e===0,a=s.length-1===e,o=s[e],f=t?r:i;return c==="flex"?De(o,f):Pe(o,u,a,f)}function Pe(e,t,s,i){let r=e==null?void 0:e.padding;return r||(t?r="pl-16 pr-12":s?r="pr-16 pl-12":r="px-12"),A("overflow-hidden whitespace-nowrap outline-none focus-visible:outline focus-visible:outline-offset-2 text-left",i,e==null?void 0:e.maxWidth,e==null?void 0:e.width,r,e==null?void 0:e.className)}function De(e,t){let s="justify-start";(e==null?void 0:e.align)==="center"?s="justify-center":(e==null?void 0:e.align)==="end"&&(s="justify-end");const i=e==null?void 0:e.padding;return A("flex items-center overflow-hidden whitespace-nowrap overflow-ellipsis outline-none focus-visible:outline focus-visible:outline-offset-2",t,(e==null?void 0:e.width)??"flex-1",e==null?void 0:e.maxWidth,e==null?void 0:e.minWidth,s,i,e==null?void 0:e.className)}function $e({index:e}){const{columns:t,sortDescriptor:s,onSortChange:i,enableSorting:r,tableStyle:c}=m.useContext(j),u=t[e],a=Z({index:e,isHeader:!0}),[o,f]=m.useState(!1),n=u.sortingKey||u.key,d=u.allowsSorting&&r,{orderBy:y,orderDir:D}=s||{},k=d&&y===n;let g;k&&D==="asc"?g="ascending":k&&D==="desc"?g="descending":d&&(g="none");const v=()=>{if(!d)return;let P;k&&D==="desc"?P={orderDir:"asc",orderBy:n}:k&&D==="asc"?P={orderBy:void 0,orderDir:void 0}:P={orderDir:"desc",orderBy:n},i==null||i(P)},l=k||o,p={visible:{opacity:1,y:0},hidden:{opacity:0,y:"-25%"}},C=c==="html"?"th":"div";return x.jsxs(C,{role:"columnheader",tabIndex:-1,"aria-colindex":e+1,"aria-sort":g,className:A(a,"text-xs font-medium text-muted",d&&"cursor-pointer"),onMouseEnter:()=>{f(!0)},onMouseLeave:()=>{f(!1)},onKeyDown:P=>{(P.key===" "||P.key==="Enter")&&(P.preventDefault(),v())},onClick:v,children:[u.hideHeader?x.jsx("div",{className:"opacity-0",children:u.header()}):u.header(),x.jsx(de,{children:d&&x.jsx(fe.span,{variants:p,animate:l?"visible":"hidden",initial:!1,transition:{type:"tween"},className:"-mt-2 ml-6 inline-block","data-testid":"table-sort-button","aria-hidden":!l,children:x.jsx(pe,{size:"xs",className:A("text-muted",D==="asc"&&y===n&&"rotate-180 transition-transform")})},"sort-icon")})]})}function Ee(){const{columns:e,tableStyle:t,headerRowBg:s}=m.useContext(j),i=t==="html"?"thead":m.Fragment,r=t==="html"?"tr":"div";return x.jsx(i,{children:x.jsx(r,{role:"row","aria-rowindex":1,tabIndex:-1,className:A(t==="flex"&&"flex gap-x-16 px-16",s),children:e.map((c,u)=>x.jsx($e,{index:u},c.key))})})}function je(e){const{cellCount:t,rowCount:s}=e;return{onKeyDown:r=>{switch(r.key){case"ArrowLeft":E(r,{cell:{op:"decrement"}},e);break;case"ArrowRight":E(r,{cell:{op:"increment"}},e);break;case"ArrowUp":E(r,{row:{op:"decrement"}},e);break;case"ArrowDown":E(r,{row:{op:"increment"}},e);break;case"PageUp":E(r,{row:{op:"decrement",count:5}},e);break;case"PageDown":E(r,{row:{op:"increment",count:5}},e);break;case"Tab":Te(r);break;case"Home":F(r)?E(r,{row:{op:"decrement",count:s},cell:{op:"decrement",count:t}},e):E(r,{cell:{op:"decrement",count:t}},e);break;case"End":F(r)?E(r,{row:{op:"increment",count:s},cell:{op:"increment",count:t}},e):E(r,{cell:{op:"increment",count:t}},e);break}}}}function E(e,t,{cellCount:s,rowCount:i}){var k,g,v,l,p,C,P;if(((k=document.activeElement)==null?void 0:k.tagName)==="input")return;e.preventDefault();const r=e.currentTarget,c=e.target.closest("[aria-colindex]");if(!c||!r)return;const u=c.closest("[aria-rowindex]");if(!u)return;let a=parseInt(u.getAttribute("aria-rowindex")),o=parseInt(c.getAttribute("aria-colindex"));if(Number.isNaN(a)||Number.isNaN(o))return;const f=((g=t.row)==null?void 0:g.count)??1;((v=t.row)==null?void 0:v.op)==="increment"?a=Math.min(i,a+f):((l=t.row)==null?void 0:l.op)==="decrement"&&(a=Math.max(1,a-f));const n=((p=t.cell)==null?void 0:p.count)??1;((C=t.cell)==null?void 0:C.op)==="increment"?o=Math.min(s,o+n):((P=t.cell)==null?void 0:P.op)==="decrement"&&(o=Math.max(1,o-n));const d=r.querySelector(`[aria-rowindex="${a}"] [aria-colindex="${o}"]`);if(!d)return;const D=Q(d).nextNode()||d;c.setAttribute("tabindex","-1"),D.setAttribute("tabindex","0"),D.focus()}function Te(e){const t=e.currentTarget;if(e.shiftKey)t.focus();else{const s=Q(t,{tabbable:!0});let i,r;do r=s.lastChild(),r&&(i=r);while(r);i&&!i.contains(document.activeElement)&&be(i)}}function Se({index:e,isSelected:t,isHeader:s}){const i=ge(),r=_(),{hideBorder:c,enableSelection:u,collapseOnMobile:a,onAction:o,isCollapsedMode:f,tableStyle:n}=m.useContext(j);return A(n==="flex"&&"flex gap-x-16","break-inside-avoid outline-none border border-transparent",f&&"rounded-panel",o&&"cursor-pointer",r&&a&&c?"mb-8 pl-8 pr-0 rounded":"px-16",!c&&"border-b-divider",!c&&e===0&&"border-t-divider",t&&!i&&"bg-primary/selected hover:bg-primary/focus focus-visible:bg-primary/focus",t&&i&&"bg-selected hover:bg-focus focus-visible:bg-focus",!t&&!s&&(u||o)&&"focus-visible:bg-focus hover:bg-hover")}function Ie({rowIndex:e,rowIsHovered:t,index:s,item:i,id:r}){const{columns:c,tableStyle:u}=m.useContext(j),a=c[s],o=m.useMemo(()=>({index:e,isHovered:t,isPlaceholder:i.isPlaceholder}),[e,t,i.isPlaceholder]),f=Z({index:s,isHeader:!1}),n=u==="html"?"td":"div";let d=a.body(i,o);return o.isPlaceholder||(d=x.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis",children:d})),x.jsx(n,{tabIndex:-1,role:"gridcell","aria-colindex":s+1,id:r,className:f,children:d})}function Ae({onMoveStart:e,onMove:t,onMoveEnd:s,minimumMovement:i=0,preventDefault:r,stopPropagation:c=!0,onPress:u,onLongPress:a,...o}){const n=m.useRef({lastPosition:{x:0,y:0},started:!1,longPressTriggered:!1}).current,{addGlobalListener:d,removeGlobalListener:y}=we(),D=l=>{!n.el||(e==null?void 0:e(l,n.el))===!1||(n.originalTouchAction=n.el.style.touchAction,n.el.style.touchAction="none",n.originalUserSelect=document.documentElement.style.userSelect,document.documentElement.style.userSelect="none",n.started=!0)},k=l=>{var p;if(l.button===0&&n.id==null){if(n.started=!1,((p=o.onPointerDown)==null?void 0:p.call(o,l))===!1)return;c&&l.stopPropagation(),r&&l.preventDefault(),n.id=l.pointerId,n.el=l.currentTarget,n.lastPosition={x:l.clientX,y:l.clientY},a&&(n.longPressTimer=setTimeout(()=>{a(l,n.el),n.longPressTriggered=!0},400)),(e||t)&&d(window,"pointermove",g,!1),d(window,"pointerup",v,!1),d(window,"pointercancel",v,!1)}},g=l=>{if(l.pointerId===n.id){const p=l.clientX-n.lastPosition.x,C=l.clientY-n.lastPosition.y;(Math.abs(p)>=i||Math.abs(C)>=i)&&!n.started&&D(l),n.started&&(t==null||t(l,p,C),n.lastPosition={x:l.clientX,y:l.clientY})}},v=l=>{var p;if(l.pointerId===n.id){n.longPressTimer&&clearTimeout(n.longPressTimer);const C=n.longPressTriggered;n.longPressTriggered=!1,n.started&&(s==null||s(l)),n.el&&(l.type!=="pointercancel"&&((p=o.onPointerUp)==null||p.call(o,l,n.el),l.target&&n.el.contains(l.target)&&(C?a==null||a(l,n.el):u==null||u(l,n.el))),document.documentElement.style.userSelect=n.originalUserSelect||"",n.el.style.touchAction=n.originalTouchAction||""),n.id=void 0,n.started=!1,y(window,"pointermove",g,!1),y(window,"pointerup",v,!1),y(window,"pointercancel",v,!1)}};return{domProps:{onPointerDown:N(k)}}}function Re(e){return e.shiftKey||F(e)}const Ne=["button","a","input","select","textarea"];function He({item:e,index:t,renderAs:s,className:i,style:r}){const{selectedRows:c,columns:u,toggleRow:a,selectRow:o,onAction:f,selectRowOnContextMenu:n,enableSelection:d,selectionStyle:y,hideHeaderRow:D,tableStyle:k}=m.useContext(j),g=m.useRef(!1),v=c.includes(e.id),[l,p]=m.useState(!1),C=h=>h.target.closest(Ne.join(",")),P=h=>{y==="highlight"&&f&&!g.current&&!C(h)&&(h.preventDefault(),h.stopPropagation(),f(e,t))},S=!!c.length,U=h=>{C(h)||(y==="checkbox"?d&&(S||!f)?a(e):f&&f(e,t):y==="highlight"&&(g.current?d&&S?a(e):f==null||f(e,t):d&&o(e,Re(h))))},{domProps:V}=Ae({onPointerDown:h=>{g.current=h.pointerType==="touch"},onPress:U,onLongPress:d?()=>{g.current&&a(e)}:void 0}),B=h=>{d&&h.key===" "?(h.preventDefault(),h.stopPropagation(),y==="checkbox"?a(e):o(e)):h.key==="Enter"&&!c.length&&f&&(h.preventDefault(),h.stopPropagation(),f(e,t))},L=h=>{n&&d&&(c.includes(e.id)||o(e)),g.current&&(h.preventDefault(),h.stopPropagation())},z=Se({index:t,isSelected:v}),H=s||(k==="html"?"tr":"div");return x.jsx(H,{role:"row","aria-rowindex":t+1+(D?0:1),"aria-selected":v,tabIndex:-1,className:A(i,z),item:typeof H=="string"?void 0:e,onDoubleClick:N(P),onKeyDown:N(B),onContextMenu:N(L),onPointerEnter:N(()=>p(!0)),onPointerLeave:N(()=>p(!1)),style:r,...V,children:u.map((h,O)=>x.jsx(Ie,{rowIndex:t,rowIsHovered:l,index:O,item:e},`${e.id}-${h.key}`))})}function ze({className:e,columns:t,activeColumns:s,collapseOnMobile:i=!0,hideHeaderRow:r=!1,headerRowBg:c,hideBorder:u=!1,data:a,selectedRows:o,defaultSelectedRows:f,onSelectionChange:n,sortDescriptor:d,onSortChange:y,enableSorting:D=!0,onDelete:k,enableSelection:g=!0,selectionStyle:v="checkbox",ariaLabelledBy:l,selectRowOnContextMenu:p,onAction:C,renderRowAs:P,tableBody:S,meta:U,tableRef:V,closeOnInteractOutside:B=!1,cellHeight:L,headerCellHeight:z,tableStyle:H="flex",...h}){const O=_(),K=!!O&&i;K&&(r=!0,u=!0);const[w,I]=X(o,f||[],n),[ee,te]=X(d,void 0,y),ne=m.useCallback(b=>{const $=[...w];if(!$.includes(b.id))$.push(b.id);else{const T=$.indexOf(b.id);$.splice(T,1)}I($)},[w,I]),re=m.useCallback((b,$)=>{let T=[];b&&(T=$?[...w==null?void 0:w.filter(R=>R!==b.id),b.id]:[b.id]),I(T)},[w,I]),M=m.useMemo(()=>{const b=t.filter(T=>{if(s&&!s.includes(T.key))return!1;const R=T.visibleInMode||"regular";if(R==="all"||R==="compact"&&K||R==="regular"&&!K)return!0});return s&&b.sort((T,R)=>{const le=s.indexOf(T.key),ae=s.indexOf(R.key);return le-ae}),g&&v!=="highlight"&&!O&&b.unshift(ve),b},[O,t,g,v,K,s]),se={isCollapsedMode:K,cellHeight:L,headerCellHeight:z,headerRowBg:c,hideBorder:u,hideHeaderRow:r,selectedRows:w,onSelectionChange:I,enableSorting:D,enableSelection:g,selectionStyle:v,data:a,columns:M,sortDescriptor:ee,onSortChange:te,toggleRow:ne,selectRow:re,onAction:C,selectRowOnContextMenu:p,meta:U,collapseOnMobile:i,tableStyle:H},ie=je({cellCount:g?M.length+1:M.length,rowCount:a.length+1}),G={renderRowAs:P};S?S=m.cloneElement(S,G):S=x.jsx(Oe,{...G});const W=he(V);ye({ref:W,onInteractOutside:b=>{B&&g&&(w!=null&&w.length)&&!b.target.closest('[role="dialog"]')&&I([])}});const oe=H==="html"?"table":"div";return x.jsx(j.Provider,{value:se,children:x.jsxs(oe,{...xe(h,ie,{onKeyDown:b=>{b.key==="Escape"?(b.preventDefault(),b.stopPropagation(),w!=null&&w.length&&I([])):b.key==="Delete"?(b.preventDefault(),b.stopPropagation(),w!=null&&w.length&&(k==null||k(a.filter($=>w==null?void 0:w.includes($.id))))):F(b)&&b.key==="a"&&(b.preventDefault(),b.stopPropagation(),g&&I(a.map($=>$.id)))}}),tabIndex:0,role:"grid","aria-rowcount":a.length+1,"aria-colcount":M.length+1,ref:W,"aria-multiselectable":g?!0:void 0,"aria-labelledby":l,className:A(e,"isolate w-full select-none text-sm outline-none focus-visible:ring-2"),children:[!r&&x.jsx(Ee,{}),S]})})}function Oe({renderRowAs:e}){const{data:t,tableStyle:s}=m.useContext(j),i=s==="html"?"tbody":m.Fragment;return x.jsx(i,{children:t.map((r,c)=>x.jsx(He,{item:r,index:c,renderAs:e},r.id))})}export{ze as T,j as a};
