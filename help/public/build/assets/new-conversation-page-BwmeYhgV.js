import{b4 as F,f as g,aG as j,j as t,aR as I,a1 as N,az as x,T as i,F as T,B as R,l as d,r as b,h as D,aL as k,d as B,i as w,k as A,q as E,t as P,m as M,b5 as Q,aj as V}from"./client-DtfdVV77.js";import{A as z}from"./attribute-input-renderer-BEkqCl5D.js";import{g as U}from"./get-default-values-for-form-with-attributes-htMbgWW2.js";import{A as L}from"./use-create-canned-reply-wkbM3An4.js";import{I as _}from"./insert-canned-reply-button-BwRqwF5h.js";import{R as q}from"./emoji-picker-button-Cm_kBrZ5.js";import{E as W}from"./enhance-text-with-ai-button-D92qi4Qc.js";import{R as K,U as G,I as H,a as $}from"./upload-attachments-button-y2TJXF13.js";import J from"./reply-composer-container-Bpt_j9aL.js";import{F as O,R as X}from"./floating-toolbar-CKeOgwrE.js";import{u as Y}from"./tiptap-editor-context-CeN7pXcf.js";import{F as Z}from"./file-upload-provider-B4w-VsYu.js";import{S as tt}from"./get-status-color-DZZVbbOS.js";import{u as et}from"./use-is-module-installed-CDjratdW.js";import{F as st}from"./normalized-model-field-D3Ui05eZ.js";import{u as c}from"./useSuspenseQuery-Bmt2-NKx.js";import{F as f}from"./select-D9niWe2H.js";import{I as ot}from"./inbox-views-sidebar-CzlQ26Xo.js";import{D as y}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{o as rt}from"./custom-menu-Dvq-fOnC.js";import{D as v}from"./main-BGmGAxtx.js";import{D as at}from"./dashboard-sidenav-q-Yy9ZLk.js";import{T as it}from"./toggle-right-sidebar-icon-DuD5EnU1.js";import"./button-group-DAgYjIi8.js";import"./date-picker-BGiTN72q.js";import"./radio-DP8xYP6t.js";import"./radio-group-C_T7jNq6.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./ThumbDown-BB-li-Gi.js";import"./ThumbUp-CTCneb2T.js";import"./variable-extension-BUEoymSX.js";import"./campaign-conditions-config-DZmli5NZ.js";import"./Event-DDJ424UR.js";import"./ToggleOn-DbVFGpQu.js";import"./TextFields-CM1xUWDR.js";import"./Add-B1HfWgJf.js";import"./index-uUjpwT6n.js";import"./with-selector-DPNnjGhI.js";import"./DataObject-3cjjRxnv.js";import"./action-menu-dialog-CHnxQQPs.js";import"./combobox-CFh39yI7.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./article-link-kVBPNf7I.js";import"./slugify-string-CGmMIJK7.js";import"./article-path-CQn_uF_m.js";import"./category-link-DefoIvjU.js";import"./list-buttons-CxLBLRRO.js";import"./FormatListNumbered-BcAdH5KM.js";import"./Link-WHWZ7SV6.js";import"./library-icon-h4d3s9Ef.js";import"./use-keybind-DRgaCeX0.js";import"./useGlobalListeners-BGMP113F.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./form-chip-field-C7l8nGPv.js";import"./chip-list-DHXDGW6X.js";import"./PushPin-DEBAXBqb.js";import"./use-filter-XfxMyUPQ.js";import"./OpenInFull-mOMLBQ1Z.js";import"./Spellcheck-Bj2fiFlW.js";import"./progress-bar-BMzArYUQ.js";import"./image-button-DUyjpM_5.js";import"./image-up-hBoBC5iJ.js";import"./use-active-upload-CGOT7g6R.js";import"./open-upload-window-DE9Q8gNs.js";import"./uploaded-file-DOXWsty7.js";import"./shallow-BH2jDtXM.js";import"./file-preview-dialog-BrkfZ0k6.js";import"./file-thumbnail-DlIWt16b.js";import"./file-type-icon-CNIGAaMG.js";import"./ChevronLeft-IHWIEiah.js";import"./ChevronRight-C5OrfRtB.js";import"./FileDownload-DjsfzW8M.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CFeeP1Iy.js";import"./pretty-bytes-bO14ePu9.js";import"./use-upload-attachments-CRLnN22_.js";import"./use-droppable-CpvjuNXE.js";import"./paperclip-1tb_aUIl.js";import"./formatted-message-body-N3ejX0-V.js";import"./index-BCY5Ekxi.js";import"./core-l5OAWFa0.js";import"./index-Y7xUBCAo.js";import"./Edit-BaEHOLuK.js";import"./skeleton-D178v0-U.js";import"./dashboard-icons-BJ4c3Z5i.js";import"./messages-square-icon-D_3IR-rK.js";import"./Delete-DWP7kvj0.js";import"./Home-iO0iebLw.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./formatted-number-CIAFur2S.js";import"./Tune-B3kaKuXY.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";function mt({errorMessage:s}){const{hasPermission:o}=F(),e=!o("files.create"),m=g(),n=j({name:"message.attachments"}),l=r=>{m.setValue("message.attachments",[r,...n],{shouldDirty:!0})};return t.jsxs(Z,{children:[t.jsx(K,{isDisabled:e,onUpload:l,children:t.jsxs(J,{autoFocus:!0,submitToClosestForm:!0,onChange:r=>m.setValue("message.body",r,{shouldDirty:!0}),children:[t.jsx(O,{}),t.jsxs(X,{children:[t.jsx(nt,{}),t.jsx(L,{}),t.jsx(q,{}),!e&&t.jsx(G,{onUpload:l}),!e&&t.jsx(H,{uploadType:I.conversationImages}),t.jsx(W,{})]})]})}),s,t.jsx($,{className:"mt-12",attachments:n,onRemove:r=>{m.setValue("message.attachments",n.filter(p=>p.id!==r.id),{shouldDirty:!0})}})]})}function nt(){const s=Y(),o=g();return t.jsx(_,{onSelected:e=>{s==null||s.commands.insertContent(e.body),e.attachments.length&&o.setValue("message.attachments",e.attachments,{shouldDirty:!0})}})}function lt({onSubmit:s,isPending:o}){var r,p,u;const e=g(),m=et("livechat"),n=(u=(p=(r=e.formState.errors)==null?void 0:r.message)==null?void 0:p.body)==null?void 0:u.message,l=N();return t.jsxs("form",{onSubmit:a=>{e.clearErrors(),e.handleSubmit(s)(a)},children:[m&&t.jsxs(f,{name:"type",label:t.jsx(i,{message:"Type"}),selectionMode:"single",className:"mb-24",children:[t.jsx(x,{value:"ticket",children:t.jsx(i,{message:"Ticket"})}),t.jsx(x,{value:"chat",children:t.jsx(i,{message:"Chat"})})]}),t.jsx(st,{name:"user_id",endpoint:"helpdesk/normalized-models/customer",label:t.jsx(i,{message:"Customer"}),className:"mb-24"}),t.jsx(pt,{}),e.watch("type")==="ticket"&&t.jsx(T,{name:"subject",label:t.jsx(i,{message:"Subject"}),className:"mb-24",required:!0}),t.jsxs("div",{className:"mb-24",children:[t.jsx("div",{className:l.label,children:t.jsx(i,{message:"Message"})}),t.jsx(mt,{errorMessage:n&&t.jsx("div",{className:l.error,children:n})})]}),t.jsx(R,{variant:"flat",color:"primary",type:"submit",disabled:o,children:t.jsx(i,{message:"Create"})})]})}function pt(){const s=c(d.statuses.dropdownList("agent"));return j({name:"type"})==="chat"?null:t.jsx(f,{name:"status_id",label:t.jsx(i,{message:"Status"}),selectionMode:"single",className:"mb-24",children:s.data.statuses.map(e=>t.jsx(x,{value:e.id,startIcon:t.jsx(tt,{category:e.category}),children:e.label},e.id))})}function Ye(){const{rightSidenavStatus:s}=b.useContext(v),o=D(),[e]=k(),m=e.get("customer_id"),n=c(d.statuses.dropdownList("agent")),l=c(d.attributes.normalizedList({type:"conversation",for:"agent"})),r=B({defaultValues:{status_id:n.data.statuses[0].id,user_id:m?parseInt(m):void 0,type:"ticket",message:{body:"",attachments:[]},attributes:U(l.data.attributes.filter(a=>!C.includes(a.key)))}}),p=w({mutationFn:a=>A.post("helpdesk/agent/conversations",{...a,message:{...a.message,attachments:a.message.attachments.map(h=>h.id)}}).then(h=>h.data),onSuccess:async()=>{await E.invalidateQueries({queryKey:d.conversations.invalidateKey}),P(M("Conversation created"))},onError:a=>rt(a,r)}),u=()=>{p.mutate(r.getValues(),{onSuccess:a=>o(`/dashboard/conversations/${a.conversation.id}?viewId=mine`)})};return t.jsxs(Q,{...r,children:[t.jsx(ot,{location:"conversationsTable"}),t.jsxs("div",{className:"dashboard-rounded-panel dashboard-grid-content flex flex-col lg:ml-8",children:[t.jsx(y,{title:t.jsx(i,{message:"New conversation"}),showSidebarToggleButton:!0,rightContent:s==="closed"?t.jsx(S,{}):null}),t.jsx("div",{className:"overflow-y-auto p-24",children:t.jsx(lt,{onSubmit:()=>u(),isPending:p.isPending})})]}),t.jsx(at,{position:"right",size:"w-400",className:"dashboard-rounded-panel flex-shrink-0 flex-col lg:ml-8",children:t.jsx(dt,{})})]})}const C=["subject","description","rating"];function dt(){const s=c(d.attributes.normalizedList({type:"conversation",for:"agent"}));return t.jsxs("aside",{className:"w-full",children:[t.jsx(y,{title:t.jsx(i,{message:"Attributes"}),showSidebarToggleButton:!1,rightContent:t.jsx(S,{})}),t.jsx("div",{className:"p-24",children:s.data.attributes.map(o=>C.includes(o.key)?null:t.jsx(z,{formPrefix:"attributes",attribute:o,className:"mb-24"},o.id))})]})}function S(){const{rightSidenavStatus:s,setRightSidenavStatus:o}=b.useContext(v);return t.jsx(V,{size:"xs",onClick:()=>o(s==="open"?"closed":"open"),children:t.jsx(it,{})})}export{Ye as Component};
