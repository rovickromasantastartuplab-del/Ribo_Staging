import{j as e,bx as M,r as x,a as F,ac as Q,aa as ae,aj as A,aK as P,B as S,i as $,s as ie,q as H,k as V,u as f,x as D,T as c,X as I,p as C,c as re,c0 as U,L as g,aJ as K,bZ as Me,av as Fe,am as De,an as _e,ap as He,bf as ne,aw as Be,ax as qe,az as B,bF as Re,as as O,aD as Qe,al as $e,b3 as oe,t as q,m as R,Q as le,A as z,z as h,C as v,P as ce,b7 as me,aT as de,N as Ve,aV as ue,aL as Ue,b9 as xe,b as G,ab as pe,h as je,R as Ke,bB as Oe,cd as Ge,ak as Ze,aP as Je,F as he,b4 as Xe,f as Ye,aR as We,cD as es,bL as ss,cE as ts,cF as as,cG as is,cH as y}from"./client-DtfdVV77.js";import{A as rs}from"./agent-avatar-zWPNofnN.js";import{M as ns,c as fe,A as os,b as ge}from"./reverse-conversation-messages-D589XwPM.js";import{i as ls}from"./feed-attachments-Dbj_-UUy.js";import{T as cs}from"./ticket-details-CyooeAxc.js";import{c as Z,d as w,e as ve,s as ms,W as ds,f as us,g as xs,h as ps,i as js,j as hs,w as T,k as fs,a as be,m as gs,b as vs}from"./widget-entry-D_Ec2L-P.js";import{F as ye,u as bs,r as ys}from"./file-upload-provider-B4w-VsYu.js";import{a as we,b as ws}from"./use-compact-agents-BbfR0BTv.js";import{E as Ns}from"./Edit-BaEHOLuK.js";import{E as ks}from"./Email-DbuUu46B.js";import{H as ee}from"./HourglassEmpty-T3VQEBmq.js";import{C as Ss}from"./ConfirmationNumber-CY9CjtLz.js";import{D as Is}from"./Download-44KjkU3h.js";import{M as Cs}from"./MoreHoriz-Df3_bV9s.js";import{S as As}from"./Schedule-BAyUsflh.js";import{V as Ts,a as zs,F as Ps,b as Es}from"./FullscreenExit-DqIV63hh.js";import{C as Ls}from"./confirmation-dialog-BzXs9ksK.js";import{d as Ms}from"./download-file-from-url-hJ3EUwXO.js";import{M as Ne}from"./message-author-name-Bk8LQSvQ.js";import{U as ke}from"./unseen-messages-badge-CODRuz4h.js";import{I as Fs}from"./infinite-scroll-sentinel-Dx_uGmDU.js";import{B as Se}from"./bullet-seprated-items-ClWbAIQG.js";import{u as Ds}from"./useInfiniteQuery-CRfa2XSO.js";import{M as _s}from"./messages-square-icon-D_3IR-rK.js";import{S as Ie}from"./Send-BbKd9OAw.js";import{I as Ce,h as J,S as Hs,a as Bs,o as qs}from"./custom-menu-Dvq-fOnC.js";import{A as Ae}from"./ArrowBack-DIhVch2U.js";import{S as u}from"./skeleton-D178v0-U.js";import{s as Rs}from"./search-D3bB1V5N.js";import{g as Te,A as Qs}from"./article-link-kVBPNf7I.js";import{A as $s,a as Vs}from"./article-page-feedback-BwJoJxrd.js";import{u as Us}from"./use-required-params-BhaT_-q3.js";import{O as ze}from"./OpenInNew-C06CZDpe.js";import{c as Ks}from"./css-props-from-bg-config-CgypBlFP.js";import{A as Os}from"./avatar-group-BIYHgzHR.js";import{A as Gs}from"./attribute-input-renderer-BEkqCl5D.js";import{u as Zs,C as Js,S as Xs}from"./use-customer-new-ticket-form-BHe-zvou.js";import{u as Ys}from"./use-upload-attachments-CRLnN22_.js";import{u as Ws,C as et}from"./use-captcha-BCeBTZMW.js";import{u as st}from"./useSuspenseQuery-Bmt2-NKx.js";import{P as tt}from"./paperclip-1tb_aUIl.js";import{P as at}from"./progress-bar-BMzArYUQ.js";import{o as it}from"./open-upload-window-DE9Q8gNs.js";import{W as rt}from"./widget-navigation-CQEGuGCg.js";import"./online-status-circle-Nb704kAK.js";import"./isScrollable-BSEN4xi5.js";import"./customer-avatar-ul3Z1Bt5.js";import"./animating-messages-DuT2CR0j.js";import"./file-thumbnail-DlIWt16b.js";import"./file-type-icon-CNIGAaMG.js";import"./formatted-bytes-CFeeP1Iy.js";import"./pretty-bytes-bO14ePu9.js";import"./AttachFile-D1Gtc63k.js";import"./attribute-renderer-C6KvryoI.js";import"./ThumbDown-BB-li-Gi.js";import"./ThumbUp-CTCneb2T.js";import"./conversation-priority-CeA32zhn.js";import"./preview-messages-B_u8VttT.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./HelpOutline-DkAeNvPf.js";import"./stream-BOYAfkJs.js";import"./useMutationState-Bmyxea6H.js";import"./formatted-message-body-N3ejX0-V.js";import"./emoji-picker-button-Cm_kBrZ5.js";import"./tiptap-editor-context-CeN7pXcf.js";import"./check-circle-filled-B4oRGH_i.js";import"./Add-B1HfWgJf.js";import"./play-conversation-sound-OdSdmIQ4.js";import"./websocket-updates-notifier-3Xk6dITh.js";import"./helpdesk-channel-CQKSbeKg.js";import"./ChatBubbleOutline-D_zVnkWb.js";import"./index.module-BtHqevI0.js";import"./uploaded-file-DOXWsty7.js";import"./with-selector-DPNnjGhI.js";import"./infiniteQueryObserver-JD1WF4OJ.js";import"./slugify-string-CGmMIJK7.js";import"./button-group-DAgYjIi8.js";import"./date-picker-BGiTN72q.js";import"./radio-DP8xYP6t.js";import"./radio-group-C_T7jNq6.js";import"./select-D9niWe2H.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./accordtion-animation-BGCK95Hj.js";import"./Chat-C94dcr0C.js";import"./Help-DMvOY11L.js";import"./Home-iO0iebLw.js";function nt({header:s,feed:t,editor:a,fixedHeader:i}){return e.jsxs("div",{className:"flex h-full min-h-0 flex-col",children:[i&&e.jsx("div",{className:"mb-20 px-20",children:i}),e.jsxs("div",{className:"compact-scrollbar min-h-0 flex-auto overflow-auto overscroll-contain px-20 stable-scrollbar",children:[s,t]}),e.jsx(ye,{children:e.jsx("div",{className:"mt-20 px-20 pb-16",children:a})})]})}function ot(){const{agents:s,isLoading:t}=we(),{isInsideSettingsPreview:a}=M(),i=Z(),[r,n]=x.useState(!(i!=null&&i.email));return(t||s.some(o=>o.wasActiveRecently))&&!a?null:e.jsx("div",{className:"mt-6 h-36",children:a||r||!(i!=null&&i.email)?e.jsx(lt,{onSaved:()=>n(!1)}):e.jsx(ct,{email:i.email,onEdit:()=>n(!0)})})}function lt({onSaved:s}){const{isInsideSettingsPreview:t}=M(),a=mt(),i=Z(),{chatId:r}=F(),{trans:n}=Q();return e.jsx("form",{onSubmit:o=>{if(o.preventDefault(),t||!i)return;const l=new FormData(o.target).get("email");l&&(l===i.email?s():a.mutate({email:l,userId:i.id,conversationId:r},{onSuccess:()=>s()}))},children:e.jsx(ae,{required:!0,type:"email",name:"email",size:"sm",background:"bg",defaultValue:i==null?void 0:i.email,startAdornment:e.jsx(ks,{}),placeholder:n({message:"Email"}),endAppend:e.jsx(A,{variant:"flat",color:"primary",type:"submit",className:"max-w-36",disabled:a.isPending,children:e.jsx(P,{})})})})}function ct({email:s,onEdit:t}){return e.jsx(S,{size:"xs",variant:"outline",startIcon:e.jsx(Ns,{}),className:"my-3",onClick:()=>t(),children:s})}function mt(){return $({mutationFn:({email:s,conversationId:t})=>V.put("lc/widget/customers/email",{email:s,conversationId:t}).then(a=>a.data),onSuccess:()=>Promise.allSettled([H.invalidateQueries({queryKey:w.conversations.invalidateKey}),H.invalidateQueries({queryKey:w.customers.invalidateKey})]),onError:s=>ie(s)})}function dt({data:s}){var j,b;const t=s==null?void 0:s.conversation,a=ws(),{chatWidget:i,aiAgent:r}=f(),{isInsideSettingsPreview:n,settingsEditorParams:o}=M(),l=t&&t.status_category<=D.closed,m=t&&t.type==="ticket",p=t?t.assigned_to==="bot":!!(r!=null&&r.enabled);return(l||m||p)&&!n||o!=null&&o.form?null:(!(a!=null&&a.length)||n)&&(i!=null&&i.agentsAwayMessage)?e.jsxs(se,{children:[e.jsx(ee,{size:"sm",className:"mr-4"}),e.jsx(c,{message:i.agentsAwayMessage}),e.jsx(ot,{})]}):t&&!t.assignee&&(i!=null&&i.inQueueMessage)?e.jsxs(se,{children:[e.jsx(ee,{size:"sm",className:"mr-4"}),e.jsx(c,{message:i.inQueueMessage,values:{number:(j=s.queuedChatInfo)==null?void 0:j.positionInQueue,minutes:(b=s.queuedChatInfo)==null?void 0:b.estimatedWaitTime}})]}):null}function se({children:s}){return e.jsx("div",{className:"sticky top-0 z-10 mb-20 overflow-hidden rounded-panel border bg-elevated px-10 py-8 text-sm shadow-md",children:s})}function ut(){var l,m;const{isInsideSettingsPreview:s}=M(),{chatWidget:t}=f(),a=(l=t==null?void 0:t.forms)==null?void 0:l.postChat,{conversationId:i}=F(),r=I(w.conversations.get(s?void 0:i)),n=ve(s?void 0:i),o=r.data&&!r.data.hasPostChatForm&&!!((m=a==null?void 0:a.attributes)!=null&&m.length)&&r.data.conversation.status_category<=D.closed&&!(a!=null&&a.disabled);return{conversationQuery:r,messagesQuery:n,postChatFormIsVisible:o}}function E({label:s,children:t,start:a,end:i,className:r}){return e.jsxs("div",{className:C("flex flex-shrink-0 flex-col items-center justify-center overflow-hidden rounded-t-panel border-b bg px-8 py-10 text-main",r),children:[e.jsxs("div",{className:"flex w-full items-center justify-between gap-8",children:[e.jsx("div",{className:"mr-auto flex-1",children:a}),e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden text-ellipsis whitespace-nowrap text-center text-lg font-semibold leading-[42px]",children:s}),e.jsx("div",{className:"ml-auto flex flex-1 justify-end",children:i})]}),t&&e.jsx("div",{className:"mt-8 w-full",children:t})]})}function te(){var l,m,p,k;const{state:s}=re(),{conversationQuery:t,messagesQuery:a,postChatFormIsVisible:i}=ut(),r=(l=t.data)==null?void 0:l.conversation;let n=null;!ms((m=a.data)==null?void 0:m.items)&&!i&&(!r||r.status_category>D.closed)&&(n=e.jsx(ft,{chatId:r==null?void 0:r.id}));const o=t.isLoading?e.jsx(U,{}):e.jsx(nt,{fixedHeader:t.data&&t.data.conversation.type==="ticket"&&e.jsx(ht,{data:t.data}),header:e.jsx(dt,{data:t.data}),feed:e.jsxs(ns,{query:a,children:[e.jsx(ds,{}),(p=a.data)==null?void 0:p.items.map((j,b)=>e.jsx(us,{message:j,...ls(b,j,a.data.items)},j.uuid)),i&&r&&e.jsx(xs,{chatId:r.id})]}),editor:e.jsxs("div",{children:[((k=t.data)==null?void 0:k.conversation.type)==="ticket"&&e.jsx(jt,{data:t.data}),n]})});return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(E,{className:"mb-20",start:e.jsx(A,{elementType:g,to:(s==null?void 0:s.prevPath)??"/",children:e.jsx(K,{})}),label:e.jsx(pt,{conversation:r}),end:e.jsx(xt,{conversation:r})}),o]})}function xt({conversation:s}){const{base_url:t}=f(),a=()=>{s&&Ms(`${t}/api/v1/lc/widget/chats/${s.id}/download-transcript`)},[i,r]=ne("widget-chatSoundsDisabled",!1);return e.jsxs(Be,{children:[e.jsx(A,{children:e.jsx(Cs,{})}),e.jsxs(qe,{children:[e.jsx(B,{value:"closeConversation",startIcon:e.jsx(O,{}),onSelected:()=>Re(gt,{conversation:s}),children:e.jsx(c,{message:"Close conversation"})}),s&&s.type!=="ticket"&&e.jsx(B,{value:"downloadTranscript",startIcon:e.jsx(Is,{}),onSelected:()=>a(),children:e.jsx(c,{message:"Download transcript"})}),e.jsx(B,{value:"sounds",startIcon:i?e.jsx(Ts,{}):e.jsx(zs,{}),onSelected:()=>{r(!i)},children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(c,{message:"Sounds"}),e.jsx(Qe,{checked:!i,readOnly:!0})]})})]})]})}function pt({conversation:s}){var l;const t=fe(),{branding:a,aiAgent:i}=f(),{newChatGreeting:r}=hs();let n=t?e.jsx(le,{src:t,circle:!1,size:"w-30 h-30"}):null,o=a.site_name;return s!=null&&s.assignee?(n=e.jsx(rs,{showAwayIcon:!0,user:s.assignee,size:"w-30 h-30"}),o=s.assignee.name):((s==null?void 0:s.assigned_to)==="bot"||((l=r==null?void 0:r.parts[0])==null?void 0:l.author)==="bot")&&(n=e.jsx(os,{size:"w-30 h-30"}),o=(i==null?void 0:i.name)||"AI Agent"),e.jsxs("div",{className:"ml-auto mr-auto flex w-max items-center gap-10",children:[n,e.jsx("div",{children:o})]})}function jt({data:s}){const t=s.conversation,a=t.status_category>D.closed?e.jsx(As,{size:"xs"}):e.jsx(Me,{size:"xs"});return e.jsxs("div",{className:"mb-8 flex items-center gap-4 text-xs text-muted justify-center-safe",children:[a,t.status]})}function ht({data:s}){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(Fe,{type:"modal",mobileType:"modal",position:"absolute",underlayTransparent:!0,underlayBlurred:!1,children:[e.jsx(S,{variant:"outline",color:"primary",size:"sm",startIcon:e.jsx(Ss,{}),className:"max-w-full",shadow:"shadow dark:shadow-none",justify:"justify-center-safe",children:e.jsx("span",{className:"overflow-hidden overflow-ellipsis",children:s.conversation.subject?s.conversation.subject:e.jsx(c,{message:"Ticket details"})})}),e.jsxs(De,{children:[e.jsx(_e,{children:e.jsx(c,{message:"Ticket details"})}),e.jsx(He,{children:e.jsx(cs,{data:s,className:"px-20 py-10"})})]})]})})}function ft({chatId:s}){var l;const{createChat:t,submitMessage:a,isPending:i}=ps(),{chatWidget:r}=f(),{settingsEditorParams:n}=M(),o=(l=r==null?void 0:r.forms)==null?void 0:l.preChat;return n.form==="preChat"||!s&&!(o!=null&&o.disabled)&&(o!=null&&o.attributes.length)?null:e.jsx(js,{isPending:i,onSubmit:m=>{s?a({message:m,conversationId:s}):t({message:m,startWithGreeting:!0})}})}function gt({conversation:s}){const{close:t}=$e(),a=oe(),i=$({mutationFn:()=>V.post(`helpdesk/customer/conversations/${s.id}/mark-as-solved`),onSuccess:()=>{q(R("Conversation closed")),H.invalidateQueries({queryKey:w.conversations.invalidateKey}),T().activeConversationId===s.id&&T().setActiveConversationId(null),t(),a("/")},onError:r=>ie(r)});return e.jsx(Ls,{title:s.type==="ticket"?e.jsx(c,{message:"Close ticket"}):e.jsx(c,{message:"Close chat"}),body:e.jsx(c,{message:"Are you sure you want to close this conversation?"}),confirm:e.jsx(c,{message:"Close"}),isLoading:i.isPending,onConfirm:()=>{i.mutate()}})}function vt(){const s=Ds(w.conversations.index());return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(E,{label:e.jsx(c,{message:"Conversations"})}),e.jsx(z,{initial:!1,mode:"wait",children:s.data?e.jsx(bt,{query:s}):e.jsx(wt,{})}),e.jsx(S,{variant:"flat",color:"primary",elementType:g,to:"/conversations/new",state:{prevPath:"/conversations"},endIcon:e.jsx(Ie,{}),className:"absolute bottom-12 left-0 right-0 mx-auto max-w-max",children:e.jsx(c,{message:"New conversation"})})]})}function bt({query:s}){var a;const t=((a=s.data)==null?void 0:a.pages.flatMap(i=>i.pagination.data))||[];return t.length===0?e.jsx(h.div,{...v,className:"flex h-full w-full items-center justify-center",children:e.jsx(Ce,{size:"sm",image:e.jsx(_s,{size:"md"}),imageHeight:"h-auto",imageMargin:"mb-12",title:e.jsx(c,{message:"No conversations yet"}),description:e.jsx(c,{message:"All your conversations will be shown here"})})},"no-conversations"):x.createElement(h.div,{...v,key:"coversations",className:"compact-scrollbar flex-auto overflow-y-auto"},t.map(i=>e.jsx(yt,{conversation:i},i.id)),e.jsx(Fs,{query:s},"sentinel"))}function yt({conversation:s}){const t=s.latest_message;return t?e.jsxs(g,{to:`/conversations/${s.id}`,state:{prevPath:"/conversations"},className:C("flex items-center gap-8 border-b border-divider-lighter px-20 py-16 transition-button hover:bg-hover",s.status_category<=D.closed&&"bg-alt"),children:[e.jsx(ge,{size:"lg",message:t}),e.jsxs("div",{className:"flex-auto text-sm",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs(Se,{className:"text-muted",children:[e.jsx("div",{children:e.jsx(Ne,{message:t,personalize:!0})}),e.jsx("div",{children:e.jsx(me,{style:"narrow",date:(t==null?void 0:t.created_at)??de().toAbsoluteString()})}),s.type==="ticket"&&e.jsx(c,{message:"Ticket"})]}),e.jsx(ke,{conversationId:s.id})]}),e.jsx("div",{className:"line-clamp-2",children:t.body})]}),e.jsx(P,{className:"text-primary",size:"sm"})]},s.id):null}function wt(){return e.jsx(h.div,{...v,className:"flex flex-auto items-center justify-center",children:e.jsx(ce,{isIndeterminate:!0})},"loading")}function Nt(){const{state:s}=re();return s.embedUrl?e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(E,{start:e.jsx(S,{elementType:g,to:(s==null?void 0:s.prevPath)??"/",startIcon:e.jsx(Ae,{}),children:e.jsx(c,{message:"Back"})})}),e.jsx("div",{className:"m-8 flex grow overflow-hidden rounded-panel",children:e.jsx("div",{className:"grow overflow-auto",children:e.jsx("iframe",{src:s.embedUrl,className:"h-full w-full border-none bg-none p-0",sandbox:"allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-storage-access-by-user-activation"})})}),e.jsx("div",{className:"mb-8 text-center text-xs text-muted",children:kt(s.embedUrl)})]}):e.jsx(Ve,{to:"/"})}function kt(s){return new URL(s).hostname}function X({name:s,description:t,information:a}){return e.jsxs("div",{className:"border-b-lighter border-b px-20 py-16",children:[e.jsx("div",{className:"text-base font-semibold",children:s}),t&&e.jsx("div",{className:"mt-4 text-sm",children:t}),a&&e.jsx("div",{className:"mt-4 text-sm text-muted",children:a})]})}function Pe(){return e.jsx(X,{name:e.jsx(u,{size:"w-240"}),information:e.jsx(u,{size:"w-68"})})}function St(){var i;const{categoryId:s}=F(),a=(i=I(w.articles.hcData()).data)==null?void 0:i.categories.find(r=>`${r.id}`===s);return e.jsx(z,{initial:!1,mode:"wait",children:a?x.createElement(h.div,{...v,key:"category-screen"},e.jsx(Ee,{category:a})):x.createElement(h.div,{...v,key:"category-skeleton"},e.jsx(Pe,{},"skeleton-header"),e.jsx(Y,{},"skeleton-list"))})}function Ee({category:s}){var t;return e.jsxs(e.Fragment,{children:[s.hide_from_structure?null:e.jsx(X,{name:s.name,description:s.description,information:e.jsx(c,{message:":count articles",values:{count:s.sections.reduce((a,i)=>a+i.articles_count,0)}})},"header"),(t=s.sections)==null?void 0:t.map(a=>e.jsx(L,{name:a.name,description:a.description,to:`/hc/categories/${s.id}/${a.id}`,information:e.jsx(c,{message:":count articles",values:{count:a.articles_count}})},a.id))]})}function It(){const s=I(w.articles.hcData());return e.jsx(z,{initial:!1,mode:"wait",children:s.data?e.jsx(Ct,{data:s.data}):x.createElement(h.div,{...v,key:"list-skeleton"},e.jsx(Y,{}))})}function Ct({data:s}){return s.categories.length===1&&s.categories[0].hide_from_structure?e.jsx(Ee,{category:s.categories[0]}):x.createElement(h.div,{...v,key:"category-list"},s.categories.map(t=>e.jsx(L,{name:t.name,description:t.description,to:`/hc/categories/${t.id}`,information:e.jsx(c,{message:":count articles",values:{count:t.sections.reduce((a,i)=>a+i.articles_count,0)}})},t.id)))}function L({to:s,name:t,description:a,information:i,className:r}){const n=s?g:"div";return e.jsx(n,{to:s,className:C("block transition-all",s&&"hover:bg-hover",r),children:e.jsxs("div",{className:"relative ml-20 mr-14 flex items-center gap-8 border-b border-b-lighter py-16 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t}),a&&e.jsx("div",{className:"mt-4",children:a}),i&&e.jsx("div",{className:"mt-4 text-muted",children:i})]}),s?e.jsx(P,{size:"sm",className:"ml-auto"}):null]})})}function Y({hideInformation:s}){return e.jsxs(x.Fragment,{children:[e.jsx(L,{name:e.jsx(u,{size:"w-264"}),description:e.jsx(u,{size:"w-160"}),information:s?null:e.jsx(u,{size:"w-68"})},"skeleton-1"),e.jsx(L,{name:e.jsx(u,{size:"w-160"}),description:e.jsx(u,{size:"w-288"}),information:s?null:e.jsx(u,{size:"w-68"})},"skeleton-2"),e.jsx(L,{name:e.jsx(u,{size:"w-224"}),description:e.jsx(u,{size:"w-124"}),information:s?null:e.jsx(u,{size:"w-68"})},"skeleton-3")]})}function At(){var n,o,l;const{categoryId:s,sectionId:t}=F(),i=(n=I(w.articles.hcData()).data)==null?void 0:n.categories.find(m=>`${m.id}`===s),r=(o=i==null?void 0:i.sections)==null?void 0:o.find(m=>`${m.id}`===t);return e.jsx(z,{initial:!1,mode:"wait",children:r?x.createElement(h.div,{...v,key:"section"},e.jsx(X,{name:r.name,description:r.description,information:e.jsx(c,{message:":count articles",values:{count:r.articles_count}})},"header"),(l=r.articles)==null?void 0:l.map(m=>e.jsx(Le,{article:m,section:r},m.id))):x.createElement(h.div,{...v,key:"section-skeleton"},e.jsx(Pe,{},"skeleton-header"),e.jsx(Y,{hideInformation:!0},"skeleton-list"))})}function Le({article:s,section:t,onClick:a}){return e.jsx(g,{to:Te(s,{section:t}),className:"block transition-all hover:bg-hover",onClick:a,children:e.jsxs("div",{className:"relative ml-20 mr-14 flex items-center gap-8 border-b border-b-lighter py-16 text-sm",children:[e.jsx("div",{children:s.title}),e.jsx(P,{size:"sm",className:"ml-auto"})]})},s.id)}function Tt(){var d;const s=ue(),[t,a]=Ue(),i=t.get("query")||"",r=N=>{a({query:N},{replace:!0})},n=fs().scopedHcCategoryId,{categoryId:o,sectionId:l}=F(),m=[];n&&o!==`${n}`&&m.push(n),o&&m.push(o);const p=I(J.articles.search({query:i,categoryIds:m.length?m:void 0},N=>{var W;s.log({term:N.query,results:N.pagination.data,categoryId:(W=N.categoryIds)==null?void 0:W[0]})})),j=(d=I(w.articles.hcData()).data)==null?void 0:d.categories.find(N=>`${N.id}`===o);let b;return l&&!(j!=null&&j.hide_from_structure)?b=`/hc/categories/${o}`:o?b="/hc":t.get("prevRoute")==="home"&&(b="/"),e.jsxs(h.div,{...v,className:"flex min-h-0 flex-auto flex-col",children:[e.jsx(E,{label:e.jsx(c,{message:"Help"}),start:b&&e.jsx(A,{elementType:g,to:b,onClick:()=>{r("")},children:e.jsx(K,{})}),children:e.jsx(zt,{value:i,onChange:r,isLoading:p.isFetching})}),e.jsx("div",{className:"compact-scrollbar flex-auto overflow-auto",children:i?e.jsx(Pt,{query:p}):e.jsx(xe,{})})]},"help-screen")}function zt({value:s,onChange:t,isLoading:a}){const{trans:i}=Q(),r=G();let n;return a?n=e.jsx(ce,{isIndeterminate:!0,size:"sm"}):s?n=e.jsx(A,{onClick:()=>t(""),children:e.jsx(O,{})}):n=e.jsx(pe,{}),e.jsx(ae,{autoFocus:!0,value:s,onChange:o=>t(o.target.value),size:"sm",placeholder:i({message:"Search for answers"}),background:r?"bg-alt":"bg",endAdornment:n,className:"mx-8 mb-2"})}function Pt({query:s}){var i;const t=ue();if(s.isLoading)return e.jsx(U,{});const a=((i=s.data)==null?void 0:i.pagination.data)||[];return a.length?e.jsx("div",{children:a.map(r=>e.jsx(Le,{article:r,onClick:()=>t.updateLastSearch({clickedArticle:!0})},r.id))}):e.jsx(Ce,{className:"mt-48",size:"sm",image:e.jsx(Hs,{src:Rs}),title:e.jsx(c,{message:"No articles match your search query"})})}function Et(){const{categoryId:s,sectionId:t,articleId:a}=Us(["categoryId","sectionId","articleId"]),i=I(J.articles.getForArticlePage({articleId:a,categoryId:s,sectionId:t})),r=je(),[n,o]=ne("articleSize");return x.useEffect(()=>(T().setWidgetState(n==="maximized"?"articleMaximized":"open"),()=>{T().widgetState==="articleMaximized"&&T().setWidgetState("open")}),[n]),e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(E,{start:e.jsx(S,{relative:"path",startIcon:e.jsx(Ae,{}),onClick:()=>r(-1),children:e.jsx(c,{message:"Back"})}),end:e.jsx(A,{size:"sm",iconSize:"md",onClick:()=>{o(n==="maximized"?"minimized":"maximized")},children:n==="minimized"?e.jsx(Ps,{}):e.jsx(Es,{})})}),e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto px-20 pb-20 stable-scrollbar",children:e.jsx(z,{initial:!1,mode:"wait",children:i.data?e.jsx(Lt,{article:i.data.article}):e.jsx(Mt,{})})})]})}function Lt({article:s}){const t=x.useRef(null),a=be(i=>i.widgetState);return x.useEffect(()=>{t.current&&Ke(t.current)},[]),x.createElement(h.div,{...v,key:"widget-article-body"},e.jsxs("article",{children:[e.jsx("h1",{className:"font-display text-slate-900 text-2xl tracking-tight",children:s.title}),e.jsx("div",{className:C("prose-pre:bg-slate-900 prose dark:prose-invert prose-headings:font-normal prose-a:font-normal prose-a:text-primary prose-pre:rounded-xl prose-pre:shadow-lg dark:prose-pre:shadow-none dark:prose-pre:ring-1 dark:prose-pre:ring-divider",a!=="articleMaximized"&&"text-sm"),children:e.jsx("div",{ref:t,className:"article-body whitespace-pre-wrap break-words leading-6",dangerouslySetInnerHTML:{__html:s.body}})})]},"article"),e.jsx($s,{articleId:s.id,attachments:s.attachments},"attachments"),e.jsx("div",{className:"mt-20 flex justify-center border-t pt-20",children:e.jsx(Vs,{articleId:s.id})},"feedback"),e.jsxs("div",{className:"mt-30 flex items-center justify-center gap-4 text-sm text-muted",children:[e.jsx(ze,{size:"sm"}),e.jsx(Qs,{article:s,target:"_blank",children:e.jsx(c,{message:"Open in help center"})})]},"article-link"))}function Mt(){return e.jsxs(h.div,{...v,children:[e.jsx(u,{variant:"rect",size:"h-20 max-w-580"}),e.jsx(u,{variant:"rect",size:"h-34 max-w-440",className:"mb-30 mt-10"}),e.jsx(u,{size:"w-full max-w-[95%]"}),e.jsx(u,{}),e.jsx(u,{size:"w-full max-w-[70%]",className:"mb-30"}),e.jsx(u,{size:"w-full max-w-[90%]"}),e.jsx(u,{size:"w-full max-w-[80%]"}),e.jsx(u,{size:"w-full max-w-[30%]"})]},"skeletons")}function _({children:s,className:t}){return e.jsx("div",{className:C("overflow-hidden rounded-panel border bg-elevated text-sm shadow-[0_2px_8px_rgba(0,0,0,.06)]",t),children:s})}function Ft(){var r;const s=G(),{chatWidget:t}=f(),a=!(t!=null&&t.hideHomeArticles),i=I(w.articles.homeArticleList());return e.jsxs(_,{className:C(a&&"p-8"),children:[e.jsx(S,{elementType:g,to:"/hc?prevRoute=home",justify:"justify-between",variant:"flat",color:a||s?"chip":"white",endIcon:e.jsx(pe,{}),className:C("w-full",a?"min-h-40":"min-h-54"),children:e.jsx(c,{message:"Search for help"})}),a&&e.jsx("div",{className:"mt-10 text-sm",children:e.jsx(z,{initial:!1,mode:"wait",children:i.data?e.jsx(h.div,{...v,children:(r=i.data)==null?void 0:r.articles.map(n=>e.jsxs(Oe,{justify:"justify-between",className:"w-full rounded-panel px-12 py-8 hover:bg-hover",elementType:g,to:Te(n),children:[n.title,e.jsx(P,{size:"sm"})]},n.id))},"article-list"):e.jsx(Dt,{})})})]})}function Dt(){return e.jsx(h.div,{...v,children:[1,2,3,4].map(s=>e.jsx("div",{className:"px-12 py-8",children:e.jsx(u,{})},s))},"article-skeletons")}function _t(s){return s==null?void 0:s.replace(/<\/?[^>]+(>|$)/g,"")}const Ht=Ge(_t);function Bt({chatId:s}){var p,k,j;const t=I(w.conversations.get(s)),a=ve(s),{chatWidget:i}=f(),{trans:r}=Q();if(!((p=t.data)!=null&&p.conversation)||!((k=t.data)!=null&&k.items))return null;const{conversation:n}=t.data,o=(j=a.data)==null?void 0:j.items.at(-1);if(!o)return null;const l=(o==null?void 0:o.type)==="message"?Ht(o.body):r({message:(i==null?void 0:i.defaultMessage)??""}),m=(o==null?void 0:o.created_at)??de().toAbsoluteString();return e.jsx(_,{children:e.jsx("div",{className:"bg-elevated px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(g,{to:`/conversations/${n.id}`,className:"block",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between gap-8",children:[e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:"Recent message"})}),e.jsx(ke,{conversationId:n.id,className:"ml-auto"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(ge,{message:o,size:"lg",agentWithIndicator:!0}),e.jsxs("div",{className:"min-w-0 flex-auto overflow-hidden",children:[e.jsxs(Se,{className:"text-xs text-muted",children:[e.jsx(Ne,{message:o}),e.jsx("div",{children:e.jsx(me,{date:m,style:"narrow"})})]}),e.jsx("div",{className:"line-clamp-2 text-sm",dangerouslySetInnerHTML:{__html:l}})]}),e.jsx(P,{className:"text-primary",size:"sm"})]})]})})})}const qt=x.forwardRef((s,t)=>e.jsxs(Ze,{...s,ref:t,children:[e.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),e.jsx("path",{d:"M9 12h6"}),e.jsx("path",{d:"M12 9v6"})]}));function Rt(){const{chatWidget:s}=f(),t=be(a=>a.activeConversationId);return e.jsx("div",{className:"compact-scrollbar h-full min-h-0 overflow-y-auto overflow-x-hidden rounded-t-panel",children:e.jsxs("div",{className:"relative isolate",children:[e.jsx(Qt,{}),e.jsxs("div",{className:"relative z-20",children:[e.jsx(Vt,{}),e.jsxs("div",{className:"space-y-16 px-20 pb-20",children:[t?e.jsx(Bt,{chatId:t}):e.jsx(Ut,{}),(s==null?void 0:s.homeShowTickets)&&e.jsx(Kt,{}),e.jsx(Ot,{}),(s==null?void 0:s.showHcCard)&&e.jsx(Ft,{})]})]})]})})}function Qt(){const{chatWidget:s}=f(),t=G(),a=x.useMemo(()=>Ks(s==null?void 0:s.background),[s]);return t?null:e.jsxs("div",{className:"absolute left-0 right-0 top-0 z-10 h-[320px]",children:[e.jsx("div",{className:"absolute h-full w-full",style:a}),(s==null?void 0:s.fadeBg)&&e.jsx("div",{className:"widget-header-fade-gradient absolute h-full w-full"})]})}function $t(){const{agents:s}=we(),{chatWidget:t}=f(),a=fe();return e.jsxs("div",{className:"mb-100 flex items-center justify-between gap-12",children:[a&&e.jsx("img",{className:"max-h-36 max-w-full object-cover",src:a,alt:"logo"}),(t==null?void 0:t.showAvatars)&&e.jsx(Os,{showMore:!1,children:s.slice(0,4).map(i=>e.jsx(le,{src:i.image,label:i.name,fallback:"initials"},i.id))})]})}function Vt(){var i;const{chatWidget:s}=f(),t=Z(),a=t!=null&&t.name&&(s!=null&&s.greeting)?s.greeting:s==null?void 0:s.greetingAnonymous;return e.jsxs("div",{className:"px-40 py-30",children:[e.jsx($t,{}),e.jsxs("div",{className:"leanding break-words text-[32px] font-bold leading-10",style:{color:s!=null&&s.fadeBg||(i=s==null?void 0:s.background)==null?void 0:i.color},children:[a&&e.jsx("h1",{children:e.jsx(c,{message:a,values:{name:t==null?void 0:t.name}})}),(s==null?void 0:s.introduction)&&e.jsx("h2",{children:e.jsx(c,{message:s.introduction})})]})]})}function Ut(){const{chatWidget:s}=f();return e.jsx(_,{children:e.jsx("div",{className:"bg-elevated px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(g,{to:"/conversations/new",className:"flex items-center justify-between gap-8",children:[e.jsxs("div",{children:[(s==null?void 0:s.homeNewChatTitle)&&e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:s.homeNewChatTitle})}),(s==null?void 0:s.homeNewChatSubtitle)&&e.jsx("div",{children:e.jsx(c,{message:s.homeNewChatSubtitle})})]}),e.jsx(Ie,{className:"text-primary"})]})})})}function Kt(){const{chatWidget:s}=f();return e.jsx(_,{children:e.jsx("div",{className:"px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(g,{to:"/tickets/new",className:"flex items-center justify-between gap-8",children:[e.jsxs("div",{children:[(s==null?void 0:s.homeNewTicketTitle)&&e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:s.homeNewTicketTitle})}),(s==null?void 0:s.homeNewTicketSubtitle)&&e.jsx("div",{children:e.jsx(c,{message:s.homeNewTicketSubtitle})})]}),e.jsx(qt,{className:"text-primary",size:"sm"})]})})})}function Ot(){var t;const{chatWidget:s}=f();return e.jsx("div",{className:"space-y-16 text-sm",children:(t=s==null?void 0:s.homeLinks)==null?void 0:t.map(a=>e.jsxs(_,{className:"flex cursor-pointer items-center justify-between gap-8 px-20 py-16 hover:bg-hover",children:[e.jsx(Bs,{item:a}),e.jsx(ze,{className:"text-muted",size:"sm"})]},a.id))})}function Gt(){const s=st(J.customerConversations.newTicketPageData());return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(E,{start:e.jsx(A,{elementType:g,to:"/",children:e.jsx(K,{})}),label:e.jsx(c,{message:"New ticket"})}),e.jsx("div",{className:"compact-scrollbar h-full overflow-y-auto p-20",children:s.data?e.jsx(Zt,{data:s.data}):e.jsx(U,{})})]})}function Zt({data:s}){const t=oe(),{captchaToken:a,captchaEnabled:i,resetCaptcha:r}=Ws("new_ticket"),{form:n,attachments:o,searchQuery:l,searchTermLogger:m,attributes:p,hcCategoryIds:k}=Zs(s),j=$({mutationFn:d=>V.post("lc/widget/tickets",{...d,message:{...d.message,attachments:d.message.attachments.map(N=>N.id)},captcha_token:a}).then(N=>N.data),onSuccess:async d=>{m.updateLastSearch({createdTicket:!0}),await H.invalidateQueries({queryKey:w.conversations.invalidateKey}),T().activeConversationId||T().setActiveConversationId(d.conversation.id),q(R("Ticket created")),t(`/conversations/${d.conversation.id}`)},onError:d=>(r(),qs(d,n))}),b=async()=>{if(i&&!a){q.danger(R("Please solve the captcha challenge."));return}j.mutate(n.getValues())};return e.jsxs(Je,{form:n,onSubmit:b,children:[!s.customerHasVerifiedEmail&&e.jsx(he,{name:"email",type:"email",label:e.jsx(c,{message:"Your email address"}),className:"mb-24",required:!0}),p.map(d=>d?d.key==="category"?e.jsx(Js,{attribute:d},d.id):d.key==="subject"?e.jsx(Xs,{searchQuery:l,hcCategoryIds:k,attribute:d},d.id):d.key==="description"?e.jsx(ye,{children:e.jsx(Jt,{attribute:d,attachments:o})},d.id):e.jsx(Gs,{formPrefix:"attributes",attribute:d,className:"mb-24"},d.id):null),i&&e.jsx(et,{className:"mb-24"}),e.jsxs("div",{className:"flex flex-col items-center gap-8",children:[e.jsx(S,{variant:"flat",color:"primary",type:"submit",disabled:j.isPending,className:"min-w-140",children:e.jsx(c,{message:s.config.submitButtonText})}),e.jsx(S,{elementType:g,to:"/",children:e.jsx(c,{message:"Cancel"})})]})]})}function Jt({attribute:s,attachments:t}){const{hasPermission:a}=Xe(),i=!a("files.create"),r=bs(l=>[...l.fileUploads.entries()].filter(([m,p])=>p.status==="inProgress").map(([m,p])=>p.percentage).reduce((m,p)=>m+p,0)/100),n=Ye(),o=Ys({onSuccess:l=>{n.setValue("message.attachments",[l,...n.getValues("message.attachments")],{shouldDirty:!0})}});return e.jsxs("div",{className:"mb-24",children:[e.jsx(he,{name:"message.body",inputElementType:"textarea",label:e.jsx(c,{message:s.name}),rows:3}),r?e.jsx(at,{value:r,size:"xs"}):null,i?null:e.jsx(S,{size:"2xs",variant:"outline",className:"mt-10",startIcon:e.jsx(tt,{}),onClick:async()=>{const l=ys({uploadType:We.conversationAttachments}),m=await it({multiple:!0,types:l==null?void 0:l.allowedFileTypes});m.length&&o(m)},children:e.jsx(c,{message:"Attach files"})}),e.jsx("div",{className:"mt-12 flex flex-wrap items-center gap-8",children:t.map(l=>e.jsx(Xt,{name:l.name,onRemove:()=>{n.setValue("message.attachments",t.filter(m=>m.id!==l.id),{shouldDirty:!0})}},l.id))})]})}const Xt=({name:s,onRemove:t})=>e.jsxs("div",{className:C("flex min-h-30 w-max flex-shrink-0 items-center gap-6 rounded-button border pl-8"),children:[e.jsx("div",{className:"max-w-124 overflow-hidden overflow-ellipsis whitespace-nowrap text-xs font-bold text-muted",children:s}),e.jsx(A,{onClick:()=>t(),size:"xs",className:"text-muted",children:e.jsx(O,{})})]});function Ei(){const s=x.useRef(null),{isInline:t}=gs(),{chatWidget:a}=f(),i=je(),r=(a==null?void 0:a.defaultScreen)??"/",n=x.useRef(!1),o=r==="/"||r==="",{paddingSide:l}=vs();return x.useLayoutEffect(()=>{es(s.current)},[]),x.useLayoutEffect(()=>{!o&&!n.current&&(i(r,{replace:!0}),n.current=!0)},[r,o,i]),!o&&!n.current?null:e.jsx(h.div,{...t?{}:ss,style:{paddingLeft:l,paddingRight:l,paddingTop:l},className:"ml-auto min-h-0 w-full flex-auto pb-16",children:e.jsxs("div",{className:"livechat-popup-inner relative flex h-full min-h-0 w-full flex-col overflow-hidden rounded-panel bg text shadow-widget-popup",ref:s,children:[e.jsx(ts,{toastPosition:"absolute",toastPlacement:"top-center"}),e.jsx(as,{}),e.jsxs(is,{children:[e.jsxs(y,{path:"",element:e.jsxs(x.Fragment,{children:[e.jsx(z,{initial:!1,children:e.jsx(xe,{})}),!(a!=null&&a.hideNavigation)&&e.jsx(rt,{})]}),children:[e.jsx(y,{index:!0,element:e.jsx(Rt,{})}),e.jsx(y,{path:"conversations",element:e.jsx(vt,{})}),e.jsxs(y,{path:"hc",element:e.jsx(Tt,{}),children:[e.jsx(y,{index:!0,element:e.jsx(It,{})}),e.jsx(y,{path:"categories/:categoryId",element:e.jsx(St,{})}),e.jsx(y,{path:"categories/:categoryId/:sectionId",element:e.jsx(At,{})})]})]}),e.jsx(y,{path:"tickets/new",element:e.jsx(Gt,{})}),e.jsx(y,{path:"conversations/new",element:e.jsx(te,{})}),e.jsx(y,{path:"conversations/:conversationId",element:e.jsx(te,{})}),e.jsx(y,{path:"hc/articles/:categoryId/:sectionId/:articleId/:articleSlug",element:e.jsx(Et,{})}),e.jsx(y,{path:"embed",element:e.jsx(Nt,{})})]})]})},"livechat-popup")}export{Ei as default};
