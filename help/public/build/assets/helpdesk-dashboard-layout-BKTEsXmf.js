var T=Object.defineProperty;var M=(s,a,t)=>a in s?T(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var C=(s,a,t)=>M(s,typeof a!="symbol"?a+"":a,t);import{r as m,j as e,bh as A,L as h,T as u,b4 as b,av as k,bc as y,bB as L,p as U,aU as w,q as g,l as p,X as B,bi as Q,aY as _,b9 as I}from"./client-DtfdVV77.js";import{A as K,a as q}from"./agent-avatar-zWPNofnN.js";import{d,I as E,D}from"./dashboard-icons-BJ4c3Z5i.js";import{u as R,W}from"./websocket-updates-notifier-3Xk6dITh.js";import{D as V,a as N,b as z}from"./admin-sidebar-DLPrkN7M.js";import{a as P}from"./custom-menu-Dvq-fOnC.js";import{b as $,p as F,q as O}from"./main-BGmGAxtx.js";import{p as S}from"./play-conversation-sound-OdSdmIQ4.js";import{a as H}from"./animating-messages-DuT2CR0j.js";import{h as c}from"./helpdesk-channel-CQKSbeKg.js";import{e as G,u as X}from"./online-status-circle-Nb704kAK.js";import{c as f}from"./index.module-BtHqevI0.js";import{D as Y}from"./dashboard-layout-lBpQk7BD.js";import{D as J}from"./dashboard-sidenav-q-Yy9ZLk.js";import"./use-compact-agents-BbfR0BTv.js";import"./library-icon-h4d3s9Ef.js";import"./messages-square-icon-D_3IR-rK.js";import"./Delete-DWP7kvj0.js";import"./Home-iO0iebLw.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./admin-config-DXsixO44.js";import"./Translate-DPB2wdvD.js";import"./TextFields-CM1xUWDR.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./KeyboardArrowUp-B9BC5Sar.js";import"./HourglassEmpty-T3VQEBmq.js";import"./use-previous-BLaxBq_s.js";const Z={"/dashboard/conversations":d.inbox,"/dashboard/campaigns":d.campaigns,"/dashboard/ai-agent":d.aiAgent,"/dashboard/archive":d.archive,"/dashboard/team":d.team,"/dashboard/reports":d.reports,"/dashboard/hc/arrange":d.library,"/dashboard/customers":d.users,"/dashboard/saved-replies":d.saveReplies};function ee(s){const{isCompactMode:a=!1}=s,t=m.useCallback((n,i)=>e.jsx(P,{...i,defaultIcons:Z,position:"relative",extraContent:n.action.startsWith("/dashboard/conversations")?e.jsx(te,{}):null},n.id),[]),o=e.jsxs(m.Fragment,{children:[e.jsxs(N,{elementType:h,target:"_blank",to:"/admin/settings/general",isCompact:a,children:[e.jsx($,{}),e.jsx(u,{message:"Settings"})]}),e.jsx(se,{isCompact:a}),e.jsx(z,{isCompact:a,avatar:K,accountSettingsLink:"/dashboard/team/members/me/details"})]});return e.jsx(V,{...s,variant:"withoutNavbar",matchDescendants:n=>n==="/agent",menuName:"dashboard-sidebar",customMenuRender:t,bottomContent:o,showToggleSidebarButton:!1})}function se({isCompact:s}){const{user:a}=b(),t=!!(a!=null&&a.unread_notifications_count);return e.jsxs(k,{type:"popover",placement:"top",children:[e.jsxs(N,{isCompact:s,className:"relative",children:[e.jsx(F,{}),e.jsx(u,{message:"Notifications"}),t?e.jsx(A,{children:a==null?void 0:a.unread_notifications_count}):void 0]}),e.jsx(O,{settingsLink:"/dashboard/notifications"})]})}function te(){const s=R(a=>a.unseenConversations);return s.length?e.jsx(A,{top:"top-2",right:"right-2",children:s.length}):null}function ae(){const{user:s}=b();return s?e.jsxs("div",{className:"dashboard-grid-footer flex items-center border-t",children:[e.jsxs(v,{elementType:h,to:"/dashboard/conversations",children:[e.jsx(E,{size:"sm"}),e.jsx(u,{message:"Inbox"})]}),e.jsxs(v,{elementType:h,to:"/dashboard/customers",children:[e.jsx(D,{name:"users"}),e.jsx(u,{message:"Customers"})]}),e.jsxs(v,{elementType:h,to:"/dashboard/team",children:[e.jsx(D,{name:"team"}),e.jsx(u,{message:"Team"})]}),e.jsxs(v,{elementType:h,to:`/dashboard/team/members/${s.id}/details`,exactMatch:!0,children:[e.jsx(q,{user:s,size:"w-20 h-20"}),e.jsx(u,{message:"Profile"})]})]}):null}function v({children:s,exactMatch:a=!1,...t}){const{user:o}=b(),n=y("/dashboard/team/members/:id/details"),i=(n==null?void 0:n.params.id)===`${o.id}`,r=y(`${t.to}/*`),l=i?n.pathname===t.to:!!r;return e.jsxs(L,{className:U("h-64 flex-1 items-center p-10",l&&"bg-primary/8 font-semibold text-primary"),display:"flex flex-col",...t,children:[s[0],e.jsx("div",{className:"mt-4 text-xs",children:s[1]})]})}class ne extends W{constructor(){super(...arguments);C(this,"groupIds",[])}init(t){this.groupIds=t.groups.map(o=>o.id),this.initNotifier()}playSound(t){S(t,"dashboard")}conversationBelongsToUser(t){var o;return t.assignee_id===((o=w.user)==null?void 0:o.id)||!t.assignee_id&&this.groupIds.includes(t.group_id)}appIsVisible(){return document.visibilityState==="visible"}addCountToTitle(t){if(!this.isCountInTitle()){const o=`(${t}) `;document.title=o+document.title}}isCountInTitle(){return/^\(\d+\)\s/.test(document.title)}removeCountFromTitle(){document.title=document.title.replace(/^\(\d+\)\s/,"")}}const j=new ne;function oe(){const{user:s}=b(),a=(s==null?void 0:s.id)??null,t=f(()=>{g.invalidateQueries({queryKey:p.conversations.invalidateKey})},3e3,{leading:!0}),o=f(()=>{g.invalidateQueries({queryKey:p.agents.invalidateKey})},3e3,{leading:!0}),n=f(()=>{g.invalidateQueries({queryKey:p.customers.invalidateKey}),S("newVisitor","dashboard")},1e4,{leading:!0}),i=f(r=>{g.invalidateQueries({queryKey:p.pageVisits.invalidateKey})},500);x([c.events.conversations.created,c.events.conversations.updated,c.events.conversations.newMessage],async r=>{r.messageUuid&&H(r.messageUuid),!r.conversations.every(l=>l.assigned_to==="bot")&&((r.event!==c.events.conversations.newMessage||r.conversations.every(l=>l.assignee_id===a))&&t(),j.handleEvent(r))}),x([c.events.agents.updated],o),x([c.events.users.created],n),x([c.events.users.pageVisitCreated],i)}function x(s,a){const t=m.useRef(a);t.current=a,m.useEffect(()=>G().listen({channel:c.name,events:s,type:"presence",callback:o=>{t.current(o)}}),[])}function ie(){const{data:s,isLoading:a}=B(p.agents.compact),t=X(n=>n.presence);return{agents:m.useMemo(()=>{const n=(t[c.name]??[]).filter(i=>i.isAgent).map(i=>i.modelId);return((s==null?void 0:s.agents)??[]).map(i=>{const r=n.includes(i.id);return{...i,wasActiveRecently:i.wasActiveRecently||r,isOnline:r}})},[t,s]),isLoading:a}}function _e(){const s=Q("(max-width: 1024px)"),t=_().some(o=>{var n;return(n=o.handle)==null?void 0:n.customDashboardLayout});return e.jsxs(m.Fragment,{children:[e.jsx(re,{}),e.jsxs(Y,{name:"dashboard",leftSidenavCanBeCompact:!0,compactByDefault:!0,className:"dashboard-layout-with-spacing",children:[e.jsx(J,{position:"left",size:"sm",children:e.jsx(ee,{})}),t?e.jsx(I,{}):e.jsx("div",{className:"dashboard-grid-content dashboard-rounded-panel",children:e.jsx(I,{})}),s&&e.jsx(ae,{})]})]})}function re(){const{user:s}=b();oe();const a=ie();if(!j.isInitialized&&a.agents){const i=a.agents.find(r=>r.id===(s==null?void 0:s.id));i&&j.init(i)}const t=y("dashboard/conversations/*"),o=!!t,n=t==null?void 0:t.params["*"];return m.useEffect(()=>{j.setPageStatus({activeConversationId:n?+n:null,isInboxOpen:o})},[o,n]),null}export{_e as Component};
