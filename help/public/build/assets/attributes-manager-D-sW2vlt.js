import{X as g,r as d,j as e,z as h,C as y,A as v,aj as f,T as p,as as A,aw as S,B as w,ax as N,ay as R,az as k}from"./client-DtfdVV77.js";import{P as B}from"./pretty-attribute-type-DnpvguCK.js";import{A as M}from"./Add-B1HfWgJf.js";import{D as b}from"./DragIndicator-CvftiD3i.js";import{L}from"./Lock-Dv_tThfr.js";import{m as z,u as P}from"./use-sortable-CsHM4tcn.js";import{S as T}from"./skeleton-D178v0-U.js";import{g as D}from"./group-array-by-5IjT7qk6.js";function G({selectedAttributeIds:s=[],nonDeletableAttributeKeys:m=[],onChange:n,queryOptions:l,size:c="md",addButtonLabel:r}){var u;s=Array.isArray(s)?s:Object.values(s);const i=g(l),a=d.useMemo(()=>s.map(t=>{var o;return(o=i.data)==null?void 0:o.attributes.find(j=>j.id===t)}).filter(t=>!!t),[i.data,s]),x=a?e.jsx(h.div,{className:"space-y-12",...y,children:a.map(t=>e.jsx(E,{size:c,attribute:t,attributes:a,canDelete:!m.includes(t.key),onRemove:()=>{n(a.map(o=>o.id).filter(o=>o!==t.id))},onSortEnd:(o,j)=>{n(z(s,o,j))}},t.id))},"selected-attributes"):null;return e.jsxs(d.Fragment,{children:[e.jsx(v,{initial:!1,mode:"wait",children:e.jsx("div",{className:"mb-24",children:i.isLoading?e.jsx(I,{count:s.length}):x})}),e.jsx("div",{className:"flex items-center justify-between gap-8",children:e.jsx(F,{label:r,attributes:(u=i.data)==null?void 0:u.attributes,selectedIds:s,onSelected:t=>{n([...s,t])}})})]})}function E({attribute:s,attributes:m,canDelete:n,onRemove:l,onSortEnd:c,size:r}){const i=d.useRef(null),a=d.useRef(null),{sortableProps:x,dragHandleRef:u}=P({ref:i,preview:a,item:s,items:m,type:"chatWidgetFormsSort",onSortEnd:c});return e.jsxs("div",{className:"flex items-center rounded-input border p-2 text-sm",ref:i,...x,children:[e.jsx(f,{size:r==="md"?"sm":"xs",ref:u,className:"mr-8",children:e.jsx(b,{})}),e.jsx(p,{message:s.name}),m.length>1&&n&&e.jsx(f,{size:r==="md"?"sm":"xs",onClick:()=>l(),className:"ml-auto",children:e.jsx(A,{})}),!n&&e.jsx(L,{className:"ml-auto mr-6 text-muted",size:r})]})}function F({attributes:s,selectedIds:m,onSelected:n,label:l}){const c=d.useMemo(()=>s?D(s,r=>r.type):{},[s]);return e.jsxs(S,{showSearchField:!0,floatingMinWidth:"min-w-280",children:[e.jsx(w,{variant:"outline",startIcon:e.jsx(M,{}),size:"xs",disabled:!s,children:l??e.jsx(p,{message:"Add attribute"})}),e.jsx(N,{children:Object.entries(c).map(([r,i])=>e.jsx(R,{label:e.jsx(B,{type:r}),children:i.map(a=>e.jsx(k,{isDisabled:m.includes(a.id),value:a.name,onSelected:()=>n(a.id),children:e.jsx(p,{message:a.name})},a.name))},r))})]})}function I({count:s}){return e.jsx(h.div,{...y,className:"space-y-12",children:Array.from({length:s}).map((m,n)=>e.jsx(T,{variant:"rect",className:"rounded-panel",size:"h-46 w-full"},n))},"attributes-skeleton")}export{G as A};
