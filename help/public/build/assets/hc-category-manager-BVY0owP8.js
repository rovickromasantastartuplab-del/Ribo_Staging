import{X as q,j as e,aP as U,F as f,T as o,az as z,e as R,aG as k,f as Q,av as v,bB as A,al as d,am as u,an as g,ap as p,aj as K,aR as V,ac as _,h as I,i as x,k as j,q as h,t as y,m,a as F,d as S,aq as w,B as l,s as $,bF as C,bU as L}from"./client-DtfdVV77.js";import{g as W}from"./category-link-DefoIvjU.js";import{H as D,h as G}from"./hc-category-icons-BggqgViG.js";import{h as c,o as N}from"./custom-menu-Dvq-fOnC.js";import{M as O}from"./managed-by-field-CVvllq11.js";import{V as X}from"./visible-to-field-gdyusxCr.js";import{I as Y}from"./image-selector-fVyS7PG4.js";import{F as J}from"./file-upload-provider-B4w-VsYu.js";import{F as Z}from"./select-D9niWe2H.js";import{A as ee}from"./AddPhotoAlternate-BrU6uUCh.js";import{H as se,a as te,d as ae,u as oe,b as re,c as b}from"./hc-manager-title-DcnbfhCp.js";import{u as ie}from"./use-required-params-BhaT_-q3.js";import{B as ne}from"./bullet-seprated-items-ClWbAIQG.js";import{u as B}from"./useSuspenseQuery-Bmt2-NKx.js";import{C as ce}from"./confirmation-dialog-BzXs9ksK.js";import"./slugify-string-CGmMIJK7.js";import"./dashboard-icons-BJ4c3Z5i.js";import"./library-icon-h4d3s9Ef.js";import"./messages-square-icon-D_3IR-rK.js";import"./main-BGmGAxtx.js";import"./Delete-DWP7kvj0.js";import"./Home-iO0iebLw.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./book-open-D91H26Dq.js";import"./Translate-DPB2wdvD.js";import"./FileUpload-C6VaMBta.js";import"./Article-CQpfLMan.js";import"./Email-DbuUu46B.js";import"./Event-DDJ424UR.js";import"./Info-maeeGW26.js";import"./Schedule-BAyUsflh.js";import"./TextFields-CM1xUWDR.js";import"./Tune-B3kaKuXY.js";import"./use-active-upload-CGOT7g6R.js";import"./open-upload-window-DE9Q8gNs.js";import"./uploaded-file-DOXWsty7.js";import"./shallow-BH2jDtXM.js";import"./AddAPhoto-Bl3FQpaJ.js";import"./progress-bar-BMzArYUQ.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./with-selector-DPNnjGhI.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./breadcrumb-CaNBY_Ut.js";import"./useEffectEvent-Offmqu_S.js";import"./ChevronRight-C5OrfRtB.js";import"./MoreHoriz-Df3_bV9s.js";import"./admin-config-DXsixO44.js";import"./settings-links-CRsxvJIZ.js";import"./external-link-Cxcw6nc_.js";import"./datatable-page-with-header-layout-xcCtlWaX.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./use-sortable-CsHM4tcn.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-CpvjuNXE.js";import"./useGlobalListeners-BGMP113F.js";import"./DragIndicator-CvftiD3i.js";import"./MoreVert-BVDYtk4z.js";import"./is-touch-device-vJjKU1l2.js";import"./OpenInNew-C06CZDpe.js";function M({form:s,onSubmit:r,formId:t,hideParentId:a}){const{data:i}=q(c.categories.normalizedList());return e.jsxs(U,{id:t,form:s,onSubmit:r,children:[e.jsxs("div",{className:"mb-24 flex items-center gap-12",children:[e.jsx(me,{}),e.jsx(f,{name:"name",label:e.jsx(o,{message:"Name"}),className:"flex-auto",required:!0,autoFocus:!0})]}),e.jsx(f,{name:"description",label:e.jsx(o,{message:"Description"}),inputElementType:"textarea",rows:4,className:"mb-24"}),a&&e.jsx(Z,{name:"parent_id",selectionMode:"single",label:"Parent category",className:"mb-24",children:i==null?void 0:i.categories.map(n=>e.jsx(z,{value:n.id,children:e.jsx(o,{message:n.name})},n.id))}),e.jsx(X,{className:"mb-24",description:e.jsx(o,{message:"Control who can see this category in help center"})}),e.jsx(O,{description:e.jsx(o,{message:"Control who can edit this category"}),className:"mb-24"}),e.jsx(R,{name:"hide_from_structure",description:e.jsx(o,{message:"Will hide this category name in the help center and only show it's contents."}),children:e.jsx(o,{message:"Hide from structure"})})]})}function me(){const s=k({name:"image"}),{setValue:r}=Q(),t=s?e.jsx(D,{iconSize:"h-28 w-28",src:s}):e.jsx(ee,{});return e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 text-sm",children:e.jsx(o,{message:"Image"})}),e.jsxs(v,{type:"popover",onClose:a=>{a&&r("image",a,{shouldDirty:!0})},children:[e.jsx(A,{className:"flex h-42 w-42 items-center justify-center rounded-input border hover:bg-hover",children:t}),e.jsx(le,{selectedImage:s})]})]})}function le({selectedImage:s}){const{close:r}=d();return e.jsxs(u,{size:"sm",children:[e.jsx(g,{children:e.jsx(o,{message:"Category icon"})}),e.jsxs(p,{children:[e.jsx("section",{className:"mb-44",children:e.jsx("div",{className:"-mx-8 grid grid-cols-8 gap-8",children:Object.entries(G).map(([t,a])=>e.jsx(K,{color:s===t?"primary":void 0,size:"md",onClick:()=>r(t),children:e.jsx(a,{})},t))})}),e.jsxs("section",{children:[e.jsx("div",{className:"mb-12 text-sm font-semibold",children:e.jsx(o,{message:"Upload custom icon"})}),e.jsx(J,{children:e.jsx(Y,{uploadType:V.brandingImages,className:"mb-24",showRemoveButton:!0,onChange:t=>r(t)})})]})]})]})}function de(s){const{trans:r}=_(),t=I();return x({mutationFn:a=>j.post("hc/categories",a).then(i=>i.data),onSuccess:async a=>{await h.invalidateQueries({queryKey:c.manager.invalidateKey}),t(a.category.is_section?`../../sections/${a.category.id}`:`categories/${a.category.id}`,{relative:"path"}),y(r(a.category.is_section?m("Category created"):m("Section created")))},onError:a=>N(a,s)})}function ue(){const{categoryId:s}=F(),{close:r,formId:t}=d(),a=S({defaultValues:{parent_id:s?parseInt(s):void 0,hide_from_structure:!1,visible_to_role:"",managed_by_role:""}}),i=de(a);return e.jsxs(u,{size:"lg",children:[e.jsx(g,{children:s?e.jsx(o,{message:"Add new section"}):e.jsx(o,{message:"Add new category"})}),e.jsx(p,{children:e.jsx(M,{hideParentId:!!s,formId:t,form:a,onSubmit:n=>{i.mutate(n,{onSuccess:()=>r()})}})}),e.jsxs(w,{children:[e.jsx(l,{onClick:()=>r(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(l,{form:t,disabled:i.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(o,{message:"Create"})})]})]})}function ge(s){const{trans:r}=_();return x({mutationFn:t=>j.put(`hc/categories/${t.id}`,t).then(a=>a.data),onSuccess:async t=>{await h.invalidateQueries({queryKey:c.manager.invalidateKey}),y(r(t.category.is_section?m("Category updated"):m("Section updated")))},onError:t=>N(t,s)})}function pe({item:s}){const{close:r,formId:t}=d(),a=S({defaultValues:{name:s.name,parent_id:s.parent_id,description:s.description,image:s.image,visible_to_role:s.visible_to_role||"",managed_by_role:s.managed_by_role||"",hide_from_structure:s.hide_from_structure}}),i=ge(a);return e.jsxs(u,{size:"lg",children:[e.jsx(g,{children:s.is_section?e.jsx(o,{message:"Update section"}):e.jsx(o,{message:"Update category"})}),e.jsx(p,{children:e.jsx(M,{hideParentId:s.is_section,formId:t,form:a,onSubmit:n=>{i.mutate({...n,id:s.id},{onSuccess:()=>r()})}})}),e.jsxs(w,{children:[e.jsx(l,{onClick:()=>{r()},children:e.jsx(o,{message:"Cancel"})}),e.jsx(l,{form:t,disabled:i.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(o,{message:"Update"})})]})]})}function xe(){return x({mutationFn:({id:s})=>j.delete(`hc/categories/${s}`).then(r=>r.data),onSuccess:async()=>{await h.invalidateQueries({queryKey:c.manager.invalidateKey}),y(m("Category deleted"))},onError:s=>$(s)})}function Fs(){const s=B(c.manager.categories());return e.jsx(T,{type:"categories",data:s.data})}function Ss(){const{categoryId:s}=ie(["categoryId"]),r=B(c.manager.sections(s));return e.jsx(T,{type:"sections",data:r.data})}function T({type:s,data:r}){const t=r.categories,a=t.length;return e.jsxs(se,{breadcrumb:e.jsx(ae,{category:r.category}),actionButton:e.jsxs(v,{type:"modal",children:[e.jsx(l,{variant:"flat",color:"primary",size:"xs",className:"max-md:mt-12",children:s==="categories"?e.jsx(o,{message:"New category"}):e.jsx(o,{message:"New section"})}),e.jsx(ue,{})]}),children:[a?e.jsx(te,{children:s==="categories"?e.jsx(o,{message:"Categories (:count)",values:{count:a}}):e.jsx(o,{message:"Sections (:count)",values:{count:a}})}):null,t.map(i=>e.jsx(je,{category:i,data:r},i.id)),!t.length&&e.jsx(he,{})]})}function je({category:s,data:{categories:r,category:t}}){const a=I(),i=xe(),n=oe(),E=()=>{s.is_section?a(`../sections/${s.id}`):a(`categories/${s.id}`)};return e.jsx(re,{item:s,items:r,onSortEnd:(H,P)=>{n.mutate({oldIndex:H,newIndex:P,parentId:t==null?void 0:t.id})},onClick:()=>E(),onView:()=>a(W(s)),onEdit:()=>C(pe,{item:s}),onDelete:()=>{C(ce,{title:e.jsx(o,{message:"Delete category"}),body:e.jsx(o,{message:"Are you sure you want to delete this category?"}),confirm:e.jsx(o,{message:"Delete"}),isDanger:!0,isLoading:i.isPending,onConfirm:()=>i.mutate({id:s.id},{onSuccess:()=>L()})})},description:e.jsxs(ne,{children:[s.is_section?null:e.jsx(o,{message:"[one 1 section|other :count sections]",values:{count:s.sections_count}}),e.jsx(o,{message:"[one 1 article|other :count articles]",values:{count:s.articles_count}})]}),icon:s.image?e.jsx(D,{className:"h-40 w-40 border border-divider-lighter p-4",src:s.image}):null,children:s.name})}function he(){const{categoryId:s}=F();return s?e.jsx(b,{title:e.jsx(o,{message:"This category is empty"}),description:e.jsx(o,{message:"Empty categories aren't visible in the Help Center. You can make them visible by adding a section."})}):e.jsx(b,{title:e.jsx(o,{message:"There are no categories yet"})})}export{Fs as CategoriesManager,Ss as SectionsManager};
