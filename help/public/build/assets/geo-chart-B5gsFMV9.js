import{ac as I,u as z,bG as L,r as t,m as d,by as w,j as s,p as b,B as A,T as u}from"./client-DtfdVV77.js";import{C}from"./chart-layout-bzO7gkty.js";import{a as E}from"./line-chart-BnZuJz4K.js";import{F as B}from"./formatted-country-name-D5NqMtcP.js";import{A as R}from"./ArrowBack-DIhVch2U.js";import{I as F}from"./info-dialog-trigger-CbHS2ZcI.js";import{t as k}from"./theme-value-to-hex-rRzfvjBj.js";const N="https://www.gstatic.com/charts/loader.js";function K({placeholderRef:l,data:n,country:a,onCountrySelected:e}){const{trans:c}=I(),{analytics:p}=z(),f=p==null?void 0:p.gchart_api_key,{selectedTheme:m}=L(),r=t.useRef(null),g=!!e&&!a,o=t.useCallback(()=>{var h,v;if(typeof google>"u")return;const i=n.map(j=>[j.label,j.value]);i.unshift([c(a?d("City"):d("Country")),c(d("Clicks"))]);const T=`${k(m.values["--be-bg-elevated"])}`,G={colorAxis:{colors:[`${k(m.values["--be-primary"])}`]},backgroundColor:T,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:g};!r.current&&l.current&&((h=google==null?void 0:google.visualization)!=null&&h.GeoChart)&&(r.current=new google.visualization.GeoChart(l.current)),(v=r.current)==null||v.draw(google.visualization.arrayToDataTable(i),G)},[m,n,l,c,a,g]),x=t.useCallback(async()=>{w.isLoadingOrLoaded(N)||(await w.loadAsset(N,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:f}),o())},[f,o]);return t.useEffect(()=>(r.current&&e&&google.visualization.events.addListener(r.current,"regionClick",i=>e==null?void 0:e(i.region)),()=>{r.current&&google.visualization.events.removeAllListeners(r.current)}),[e,r.current]),t.useEffect(()=>{x()},[x]),t.useEffect(()=>{o()},[m,o,n]),{drawGoogleChart:o}}function D({data:l,isLoading:n,onCountrySelected:a,country:e,className:c,colSpan:p="col-span-7",rowSpan:f="row-span-11",...m}){const r=t.useRef(null),g=!!a,o=l==null?void 0:l.datasets[0].data,x=t.useMemo(()=>o||[],[o]);return K({placeholderRef:r,data:x,country:e,onCountrySelected:a}),s.jsxs(C,{...m,className:b(c,p,f,"compact-scrollbar overflow-x-auto overflow-y-hidden"),title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(u,{message:"Top Locations"}),e?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(B,{code:e}),")"]}):null,g&&s.jsx(M,{})]}),contentIsFlex:n,children:[n&&s.jsx(E,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:r,className:"min-h-[340px] w-[480px] flex-auto"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"max-h-[340px] w-full flex-initial overflow-y-auto text-sm",children:x.map(i=>s.jsxs("div",{className:b("mb-4 flex items-center gap-4",g&&"cursor-pointer hover:underline"),role:g?"button":void 0,onClick:()=>{a==null||a(i.code)},children:[s.jsx("div",{className:"max-w-110 overflow-hidden overflow-ellipsis whitespace-nowrap",children:i.label}),s.jsxs("div",{children:["(",i.percentage,")%"]})]},i.label))}),e&&s.jsx(A,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(R,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(u,{message:"Back to countries"})})]})]})]})}function M(){return s.jsx(F,{title:s.jsx(u,{message:"Zooming in"}),body:s.jsx(u,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}export{D as G};
