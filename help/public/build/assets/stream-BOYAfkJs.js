import{af as E,bM as $,bN as I}from"./client-DtfdVV77.js";function O(t,c,i){const n={...$(),Accept:"text/event-stream","Content-Type":"application/json","X-CSRF-TOKEN":E().csrf_token},a=I();return typeof a=="string"&&(n["X-Socket-ID"]=a),fetch(`${E().settings.base_url}/api/v1/${t}`,{method:"POST",headers:n,body:c?JSON.stringify(c):void 0,signal:i})}class b extends Error{constructor(c,i){super(c),this.name="ParseError",this.type=i.type,this.field=i.field,this.value=i.value,this.line=i.line}}function h(t){}function k(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:c=h,onError:i=h,onRetry:n=h,onComment:a}=t;let o="",r=!0,d,f="",u="";function v(e){const s=r?e.replace(/^\xEF\xBB\xBF/,""):e,[p,l]=w(`${o}${s}`);for(const m of p)y(m);o=l,r=!1}function y(e){if(e===""){g();return}if(e.startsWith(":")){a&&a(e.slice(e.startsWith(": ")?2:1));return}const s=e.indexOf(":");if(s!==-1){const p=e.slice(0,s),l=e[s+1]===" "?2:1,m=e.slice(s+l);x(p,m,e);return}x(e,"",e)}function x(e,s,p){switch(e){case"event":u=s;break;case"data":f=`${f}${s}
`;break;case"id":d=s.includes("\0")?void 0:s;break;case"retry":/^\d+$/.test(s)?n(parseInt(s,10)):i(new b(`Invalid \`retry\` value: "${s}"`,{type:"invalid-retry",value:s,line:p}));break;default:i(new b(`Unknown field "${e.length>20?`${e.slice(0,20)}â€¦`:e}"`,{type:"unknown-field",field:e,value:s,line:p}));break}}function g(){f.length>0&&c({id:d,event:u||void 0,data:f.endsWith(`
`)?f.slice(0,-1):f}),d=void 0,f="",u=""}function S(e={}){o&&e.consume&&y(o),r=!0,d=void 0,f="",u="",o=""}return{feed:v,reset:S}}function w(t){const c=[];let i="",n=0;for(;n<t.length;){const a=t.indexOf("\r",n),o=t.indexOf(`
`,n);let r=-1;if(a!==-1&&o!==-1?r=Math.min(a,o):a!==-1?a===t.length-1?r=-1:r=a:o!==-1&&(r=o),r===-1){i=t.slice(n);break}else{const d=t.slice(n,r);c.push(d),n=r+1,t[n-1]==="\r"&&t[n]===`
`&&n++}}return[c,i]}class T extends TransformStream{constructor({onError:c,onRetry:i,onComment:n}={}){let a;super({start(o){a=k({onEvent:r=>{o.enqueue(r)},onError(r){c==="terminate"?o.error(r):typeof c=="function"&&c(r)},onRetry:i,onComment:n})},transform(o){a.feed(o)}})}}export{T as E,O as m};
