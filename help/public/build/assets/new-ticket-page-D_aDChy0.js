import{b4 as v,f as w,j as e,aR as E,b3 as P,a1 as R,i as B,q as C,l as I,t as f,m as y,k as D,aP as A,F as Q,T as o,B as U,bx as q,h as V,r as M,bS as H}from"./client-DtfdVV77.js";import{o as K,h as b}from"./custom-menu-Dvq-fOnC.js";import{H as L}from"./hc-search-bar-Bi18-IXo.js";import{A as z}from"./attribute-input-renderer-BEkqCl5D.js";import{u as _,C as Y,S as $}from"./use-customer-new-ticket-form-BHe-zvou.js";import{R as G}from"./emoji-picker-button-Cm_kBrZ5.js";import{R as J,U as O,I as W,a as X}from"./upload-attachments-button-y2TJXF13.js";import Z from"./reply-composer-container-Bpt_j9aL.js";import{F as ee,R as se}from"./floating-toolbar-CKeOgwrE.js";import{F as te}from"./file-upload-provider-B4w-VsYu.js";import{u as re,C as ae}from"./use-captcha-BCeBTZMW.js";import{N as ie}from"./main-BGmGAxtx.js";import{u as oe}from"./useSuspenseQuery-Bmt2-NKx.js";import{B as me,a as u}from"./breadcrumb-CaNBY_Ut.js";import"./article-link-kVBPNf7I.js";import"./slugify-string-CGmMIJK7.js";import"./article-path-CQn_uF_m.js";import"./category-link-DefoIvjU.js";import"./use-keybind-DRgaCeX0.js";import"./useGlobalListeners-BGMP113F.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./combobox-CFh39yI7.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./button-group-DAgYjIi8.js";import"./date-picker-BGiTN72q.js";import"./radio-DP8xYP6t.js";import"./radio-group-C_T7jNq6.js";import"./select-D9niWe2H.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./ThumbDown-BB-li-Gi.js";import"./ThumbUp-CTCneb2T.js";import"./accordtion-animation-BGCK95Hj.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./tiptap-editor-context-CeN7pXcf.js";import"./image-button-DUyjpM_5.js";import"./image-up-hBoBC5iJ.js";import"./use-active-upload-CGOT7g6R.js";import"./open-upload-window-DE9Q8gNs.js";import"./uploaded-file-DOXWsty7.js";import"./shallow-BH2jDtXM.js";import"./file-preview-dialog-BrkfZ0k6.js";import"./file-thumbnail-DlIWt16b.js";import"./file-type-icon-CNIGAaMG.js";import"./ChevronLeft-IHWIEiah.js";import"./ChevronRight-C5OrfRtB.js";import"./FileDownload-DjsfzW8M.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CFeeP1Iy.js";import"./pretty-bytes-bO14ePu9.js";import"./progress-bar-BMzArYUQ.js";import"./use-upload-attachments-CRLnN22_.js";import"./use-droppable-CpvjuNXE.js";import"./paperclip-1tb_aUIl.js";import"./formatted-message-body-N3ejX0-V.js";import"./variable-extension-BUEoymSX.js";import"./campaign-conditions-config-DZmli5NZ.js";import"./Event-DDJ424UR.js";import"./ToggleOn-DbVFGpQu.js";import"./TextFields-CM1xUWDR.js";import"./Add-B1HfWgJf.js";import"./index-uUjpwT6n.js";import"./with-selector-DPNnjGhI.js";import"./DataObject-3cjjRxnv.js";import"./index-BCY5Ekxi.js";import"./core-l5OAWFa0.js";import"./index-Y7xUBCAo.js";import"./list-buttons-CxLBLRRO.js";import"./FormatListNumbered-BcAdH5KM.js";import"./Link-WHWZ7SV6.js";import"./useEffectEvent-Offmqu_S.js";import"./MoreHoriz-Df3_bV9s.js";function ne({attachments:t,errorMessage:m}){const{hasPermission:r}=v(),n=!r("files.create"),c=w(),p=a=>{c.setValue("message.attachments",[a,...t],{shouldDirty:!0})};return e.jsxs(te,{children:[e.jsx(J,{isDisabled:n,onUpload:p,children:e.jsxs(Z,{submitToClosestForm:!0,autoFocus:!1,onChange:a=>c.setValue("message.body",a,{shouldDirty:!0}),children:[e.jsx(ee,{}),e.jsxs(se,{children:[e.jsx(G,{}),!n&&e.jsx(O,{onUpload:p}),!n&&e.jsx(W,{uploadType:E.conversationImages})]})]})}),m,e.jsx(X,{className:"mt-12",attachments:t,onRemove:a=>{c.setValue("message.attachments",t.filter(i=>i.id!==a.id),{shouldDirty:!0})}})]})}function ce({data:t}){var g,j;const{isLoggedIn:m}=v(),r=P(),n=R(),{captchaToken:c,captchaEnabled:p,resetCaptcha:a}=re("new_ticket"),{form:i,attachments:l,searchQuery:N,searchTermLogger:k,hcCategoryIds:T,attributes:F}=_(t),h=(j=(g=i.formState.errors.message)==null?void 0:g.body)==null?void 0:j.message,x=B({mutationFn:async s=>D.post("helpdesk/customer/tickets",{...s,message:{...s.message,attachments:s.message.attachments.map(d=>d.id)},captcha_token:c}).then(d=>d.data),onSuccess:async()=>{await C.invalidateQueries({queryKey:I.conversations.invalidateKey}),f(y("Ticket created")),k.updateLastSearch({createdTicket:!0}),r(m?"/hc/tickets":"/hc")},onError:s=>(a(),K(s,i))}),S=async()=>{if(p&&!c){f.danger(y("Please solve the captcha challenge."));return}x.mutate(i.getValues())};return e.jsxs(A,{form:i,onSubmit:()=>S(),onBeforeSubmit:()=>i.clearErrors(),className:"overflow-x-hidden",children:[!t.customerEmail&&e.jsx(Q,{name:"email",type:"email",label:e.jsx(o,{message:"Your email address"}),className:"mb-24",required:!0}),F.map(s=>s?s.key==="category"?e.jsx(Y,{attribute:s},s.id):s.key==="subject"?e.jsx($,{searchQuery:N,hcCategoryIds:T,attribute:s},s.id):s.key==="description"?e.jsxs("div",{className:"mb-24",children:[e.jsx("div",{className:n.label,children:e.jsx(o,{message:s.name})}),e.jsx(ne,{attachments:l,errorMessage:h&&e.jsx("div",{className:n.error,children:h})})]},s.id):e.jsx(z,{formPrefix:"attributes",attribute:s,className:"mb-24"},s.id):null),p&&e.jsx(ae,{className:"mb-24"}),e.jsx(U,{variant:"flat",color:"primary",type:"submit",disabled:x.isPending,children:e.jsx(o,{message:t.config.submitButtonText})})]})}function Es(){const{isInsideSettingsPreview:t}=q(),m=V(),r=oe(b.customerConversations.newTicketPageData());return M.useEffect(()=>t?H(c=>{c.type==="setValues"&&C.setQueryData(b.customerConversations.newTicketPageData().queryKey,p=>{var a,i,l;return p&&{...p,config:(l=(i=(a=c.values.client)==null?void 0:a.hc)==null?void 0:i.newTicket)==null?void 0:l.appearance}})}):void 0,[t]),e.jsxs("div",{children:[e.jsx(ie,{color:"bg",menuPosition:"header",className:"sticky top-0 z-10",children:e.jsx(L,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(me,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(u,{onSelected:()=>m("/hc"),children:e.jsx(o,{message:"Help center"})}),e.jsx(u,{onSelected:()=>m("/hc/tickets"),children:e.jsx(o,{message:"Tickets"})}),e.jsx(u,{children:e.jsx(o,{message:"New ticket"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"min-w-0 grow basis-3/4",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(o,{message:r.data.config.title})}),e.jsx(ce,{data:r.data})]}),e.jsx(pe,{data:r.data})]})]})]})}function pe({data:t}){var m;return e.jsxs("aside",{className:"min-w-320 basis-2/4 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(o,{message:t.config.sidebarTitle})}),(m=t.config.sidebarTips)==null?void 0:m.map((r,n)=>e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:e.jsx(o,{message:r.title})}),e.jsx("p",{children:e.jsx(o,{message:r.content})})]},n))]})}export{Es as Component};
