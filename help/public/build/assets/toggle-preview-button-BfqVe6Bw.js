import{u as p,r as n,j as e,T as r,a_ as x,aj as m,as as w,P as b,z as C,C as I,i as P,s as R,k as T,g as y,B as k}from"./client-DtfdVV77.js";import{a as f}from"./preview-messages-B_u8VttT.js";import{D as A}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{R as N}from"./RestartAlt-DTi82oFC.js";import{u as B}from"./use-is-module-installed-CDjratdW.js";import{C as E}from"./dashboard-icons-BJ4c3Z5i.js";function $({flowId:s,resetConversationMessage:t,onClose:a}){const{base_url:i}=p(),o=n.useRef(null),[l,h]=n.useState(null),[g,c]=n.useState(!0),v=L();n.useEffect(()=>f.listen(window,{onPreviewLoaded:()=>{c(!1)},onConversationIdChanged:j=>{h(j)}}),[]);let d=`${i}/lc/widget/ai-agent-preview-mode`;s&&(d+=`?flowId=${s}`);const u=()=>{if(o.current)return l||c(!0),v.mutateAsync({conversationId:l,iframe:o.current})};return e.jsxs(n.Fragment,{children:[e.jsxs("div",{className:"dashboard-rounded-panel dashboard-grid-sidenav-right relative flex w-[400px] flex-shrink-0 flex-col overflow-hidden max-xl:fixed max-xl:bottom-8 max-xl:right-8 max-xl:top-8 max-xl:max-h-[calc(100%-16px)] max-xl:shadow-lg xl:ml-8",children:[e.jsx(A,{rightContent:e.jsxs(n.Fragment,{children:[e.jsx(x,{label:e.jsx(r,{message:"Reset preview"}),children:e.jsx(m,{onClick:()=>u(),children:e.jsx(N,{})})}),e.jsx(x,{label:e.jsx(r,{message:"Close preview"}),children:e.jsx(m,{onClick:()=>a(),children:e.jsx(w,{})})})]}),children:e.jsx(r,{message:"Preview"})}),e.jsxs("div",{className:"relative flex-auto",children:[e.jsx("iframe",{ref:o,src:d,className:"h-full w-full"}),t?e.jsx("div",{className:"absolute bottom-86 left-0 right-0 mx-20 bg",children:t(u)}):null,g&&e.jsx("div",{className:"absolute inset-0 m-auto flex h-full w-full items-center justify-center bg",children:e.jsx(b,{isIndeterminate:!0})})]})]}),e.jsx(C.div,{...I,className:"fixed inset-0 z-[1] bg-[rgba(34,48,74,.4)] xl:hidden",onClick:()=>a()},"preview-underlay")]})}function L(){return P({mutationFn:async({conversationId:s,iframe:t})=>{var a;return s?T.delete(`lc/ai-agent-preview/conversations/${s}`).then(i=>i.data):Promise.resolve((a=t.contentWindow)==null?void 0:a.location.reload())},onSuccess:(s,{iframe:t})=>{t.contentWindow&&f.postConversationReset(t.contentWindow)},onError:s=>R(s)})}function D({previewIsVisible:s,onTogglePreview:t}){const a=y();return B("livechat")?e.jsx(k,{startIcon:e.jsx(E,{}),size:"xs",variant:"outline",color:s?"primary":void 0,onClick:()=>{t()},children:a?e.jsx(r,{message:"Test"}):e.jsx(r,{message:"Test AI Agent"})}):null}export{$ as P,D as T};
