import{i as f,t as g,m as w,k as l,d as P,r as m,j as e,aP as N,F as j,T as o,B as d,s as v,X as T,al as Q,am as K,an as U,ap as R,aq as B,q as b,bF as O,P as z,b7 as Y,u as G,p as E,A as H,z as M,C as V}from"./client-DtfdVV77.js";import{A as S,a as C}from"./account-settings-sidenav-DNNZzcwO.js";import{o as k}from"./custom-menu-Dvq-fOnC.js";import{C as W,T as X,S as $}from"./Tablet-DFnu-M6b.js";import{u as J}from"./use-all-social-logins-disabled-aPb5okc5.js";import{E as Z}from"./envato-DSHUfLey.js";import{s as ee,t as se}from"./main-BGmGAxtx.js";import{G as te}from"./google-4IXOtUqo.js";import{u as oe}from"./use-social-login-BVUj2tXy.js";import{S as q}from"./skeleton-D178v0-U.js";function ae(s){return f({mutationFn:t=>ne(t),onSuccess:()=>{g(w("Password changed"))},onError:t=>k(t,s)})}function ne(s){return l.put("auth/user/password",s).then(t=>t.data)}function Ge(){const s=P(),t=m.useId(),a=ae(s);return e.jsx(S,{id:C.Password,title:e.jsx(o,{message:"Update password"}),actions:e.jsx(d,{type:"submit",form:t,variant:"flat",color:"primary",disabled:!s.formState.isValid||a.isPending,children:e.jsx(o,{message:"Update password"})}),children:e.jsxs(N,{form:s,id:t,onSubmit:n=>{a.mutate(n,{onSuccess:()=>{s.reset()}})},children:[e.jsx(j,{className:"mb-24",name:"current_password",label:e.jsx(o,{message:"Current password"}),type:"password",autoComplete:"current-password",required:!0}),e.jsx(j,{className:"mb-24",name:"password",label:e.jsx(o,{message:"New password"}),type:"password",autoComplete:"new-password",required:!0}),e.jsx(j,{name:"password_confirmation",label:e.jsx(o,{message:"Confirm password"}),type:"password",autoComplete:"new-password",required:!0})]})})}function re(){return f({mutationFn:s=>ie(s),onError:s=>v(s)})}function ie(s){return l.post("user-sessions/logout-other",s).then(t=>t.data)}function ce(){return T({queryKey:["user-sessions"],queryFn:()=>ue()})}function ue(){return l.get("user-sessions").then(s=>s.data)}function de(s){return f({mutationFn:t=>le(t),onError:t=>k(t,s)})}function le(s){return l.post("auth/user/confirm-password",s).then(t=>t.data)}function me(){const{close:s,formId:t}=Q(),a=P(),n=de(a);return e.jsxs(K,{children:[e.jsx(U,{children:e.jsx(o,{message:"Confirm password"})}),e.jsxs(R,{children:[e.jsx("p",{className:"mb-16 text-sm",children:e.jsx(o,{message:"For your security, please confirm your password to continue."})}),e.jsx(N,{id:t,form:a,onSubmit:r=>n.mutate(r,{onSuccess:()=>s(r.password)}),children:e.jsx(j,{name:"password",label:e.jsx(o,{message:"Password"}),type:"password",required:!0,autoFocus:!0})})]}),e.jsxs(B,{children:[e.jsx(d,{onClick:()=>s(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(d,{type:"submit",variant:"flat",color:"primary",form:t,disabled:n.isPending,children:e.jsx(o,{message:"Confirm"})})]})]})}function xe(){return T({queryKey:["password-confirmation-status"],queryFn:()=>fe()})}function fe(){return l.get("auth/user/confirmed-password-status",{params:{seconds:9e3}}).then(s=>s.data)}function he(s){b.setQueryData(["password-confirmation-status"],{confirmed:s})}function F({needsPassword:s}={}){const{data:t,isLoading:a}=xe(),n=m.useRef(null),r=m.useCallback(async u=>{if(t!=null&&t.confirmed&&(n.current||!s))u(n.current);else{const c=await O(me);c&&(n.current=c,he(!0),u(n.current))}},[t==null?void 0:t.confirmed,s]);return{isLoading:a,withConfirmedPassword:r}}function He(){var c;const{data:s,isLoading:t}=ce(),a=re(),{withConfirmedPassword:n,isLoading:r}=F({needsPassword:!0}),u=e.jsx("div",{className:"max-h-400 overflow-y-auto",children:(c=s==null?void 0:s.sessions)==null?void 0:c.map(i=>e.jsx(pe,{session:i},i.id))});return e.jsxs(S,{id:C.Sessions,title:e.jsx(o,{message:"Sessions"}),children:[e.jsx("p",{className:"text-sm",children:e.jsx(o,{message:"If necessary, you may log out of all of your other browser sessions across all of your devices. Your recent sessions are listed below. If you feel your account has been compromised, you should also update your password."})}),e.jsx("div",{className:"my-30",children:t?e.jsx("div",{className:"min-h-60",children:e.jsx(z,{isIndeterminate:!0})}):u}),e.jsx(d,{variant:"outline",color:"primary",disabled:r||a.isPending,onClick:()=>{n(i=>{a.mutate({password:i},{onSuccess:()=>{g(w("Logged out other sessions."))}})})},children:e.jsx(o,{message:"Logout other sessions"})})]})}function pe({session:s}){return e.jsxs("div",{className:"mb-14 flex items-start gap-14 text-sm",children:[e.jsx("div",{className:"flex-shrink-0 text-muted",children:e.jsx(je,{device:s.device,size:"lg"})}),e.jsxs("div",{className:"flex-auto",children:[e.jsxs("div",{children:[e.jsx(_,{children:s.platform})," -"," ",e.jsx(_,{children:s.browser})]}),e.jsxs("div",{className:"my-4 text-xs",children:[s.city,", ",s.country]}),e.jsxs("div",{className:"text-xs",children:[e.jsx(we,{session:s})," - ",e.jsx(ge,{session:s})]})]})]})}function je({device:s,size:t}){switch(s){case"mobile":return e.jsx($,{size:t});case"tablet":return e.jsx(X,{size:t});default:return e.jsx(W,{size:t})}}function ge({session:s}){return s.is_current_device?e.jsx("span",{className:"text-positive",children:e.jsx(o,{message:"This device"})}):e.jsx(Y,{date:s.updated_at})}function we({session:s}){return s.ip_address?e.jsx("span",{children:s.ip_address}):s.token?e.jsx(o,{message:"API Token"}):e.jsx(o,{message:"Unknown IP"})}function _({children:s}){return s?e.jsx(m.Fragment,{children:s}):e.jsx(o,{message:"Unknown"})}function Me({user:s}){return J()?null:e.jsxs(S,{id:C.SocialLogin,title:e.jsx(o,{message:"Manage social login"}),children:[e.jsx(y,{icon:e.jsx(Z,{viewBox:"0 0 50 50",className:"border-envato bg-envato text-white"}),service:"envato",user:s}),e.jsx(y,{icon:e.jsx(te,{viewBox:"0 0 48 48"}),service:"google",user:s}),e.jsx(y,{icon:e.jsx(ee,{className:"text-facebook"}),service:"facebook",user:s}),e.jsx(y,{icon:e.jsx(se,{className:"text-twitter"}),service:"twitter",user:s}),e.jsx("div",{className:"pb-6 pt-16 text-sm text-muted",children:e.jsx(o,{message:"If you disable social logins, you'll still be able to log in using your email and password."})})]})}function y({service:s,user:t,className:a,icon:n}){var x,h,I;const{social:r}=G(),{connectSocial:u,disconnectSocial:c}=oe(),i=(h=(x=t==null?void 0:t.social_profiles)==null?void 0:x.find(p=>p.service_name===s))==null?void 0:h.username;return(I=r==null?void 0:r[s])!=null&&I.enable?e.jsxs("div",{className:E("flex items-center gap-14 border-b px-10 py-20",a),children:[m.cloneElement(n,{size:"xl",className:E(n.props.className,"border p-8 rounded")}),e.jsxs("div",{className:"mr-auto overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis text-sm font-bold first-letter:capitalize",children:e.jsx(o,{message:":service account",values:{service:s}})}),e.jsx("div",{className:"mt-2 text-xs",children:i||e.jsx(o,{message:"Disabled"})})]}),e.jsx(d,{disabled:c.isPending,size:"xs",variant:"outline",color:i?"danger":"primary",onClick:async()=>{if(i)c.mutate({service:s},{onSuccess:()=>{b.invalidateQueries({queryKey:["users"]}),g(w("Disabled :service account",{values:{service:s}}))}});else{const p=await u(s);(p==null?void 0:p.status)==="SUCCESS"&&(b.invalidateQueries({queryKey:["users"]}),g(w("Enabled :service account",{values:{service:s}})))}},children:i?e.jsx(o,{message:"Disable"}):e.jsx(o,{message:"Enable"})})]}):null}function be(){return f({mutationFn:ye,onError:s=>v(s)})}function ye(){return l.post("auth/user/two-factor-authentication").then(s=>s.data)}function L({title:s,subtitle:t,description:a,actions:n,children:r}){return t||(t=e.jsx(o,{message:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application."})),e.jsxs(m.Fragment,{children:[e.jsx("div",{className:"mb-16 text-base font-medium",children:s}),e.jsx("div",{className:"mb-24 text-sm",children:t}),e.jsx("p",{className:"my-16 text-sm font-medium",children:a}),r,e.jsx("div",{className:"flex items-center gap-12",children:n})]})}function ve({onEnabled:s}){const t=be(),{withConfirmedPassword:a,isLoading:n}=F(),r=t.isPending||n;return e.jsx(L,{title:e.jsx(o,{message:"You have not enabled two factor authentication."}),actions:e.jsx(d,{variant:"flat",color:"primary",disabled:r,onClick:()=>{a(()=>{t.mutate(void 0,{onSuccess:s})})},children:e.jsx(o,{message:"Enable"})})})}function Se(){return T({queryKey:["two-factor-qr-code"],queryFn:()=>Ce()})}function Ce(){return l.get("auth/user/two-factor/qr-code").then(s=>s.data)}function Fe(s){return f({mutationFn:t=>Pe(t),onError:t=>k(t,s)})}function Pe(s){return l.post("auth/user/confirmed-two-factor-authentication",s).then(t=>t.data)}function A(){return f({mutationFn:Ne,onError:s=>v(s)})}function Ne(){return l.delete("auth/user/two-factor-authentication").then(s=>s.data)}function Te(s){const{data:t}=Se();return e.jsxs(L,{title:e.jsx(o,{message:"Finish enabling two factor authentication."}),description:e.jsx(o,{message:"To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code."}),children:[e.jsx(H,{initial:!1,children:t?e.jsx(D,{animationKey:"real-svg",svg:e.jsx("div",{dangerouslySetInnerHTML:{__html:t.svg}}),secret:e.jsx(o,{message:"Setup key: :key",values:{key:t.secret}})}):e.jsx(D,{animationKey:"svg-skeleton",svg:e.jsx(q,{variant:"rect",size:"w-full h-full"}),secret:e.jsx(q,{variant:"text",className:"max-w-224"})})}),e.jsx(ke,{...s})]})}function ke({onCancel:s,onConfirmed:t}){const a=P(),n=Fe(a),r=A(),{withConfirmedPassword:u,isLoading:c}=F(),i=n.isPending||r.isPending||c;return e.jsxs(N,{form:a,onSubmit:x=>u(()=>{n.mutate(x,{onSuccess:()=>{b.invalidateQueries({queryKey:["users"]}),t()}})}),children:[e.jsx(j,{required:!0,name:"code",label:e.jsx(o,{message:"Code"}),autoFocus:!0}),e.jsxs("div",{className:"mt-24 flex items-center gap-12",children:[e.jsx(d,{type:"button",variant:"outline",disabled:i,onClick:()=>{u(()=>{r.mutate(void 0,{onSuccess:s})})},children:e.jsx(o,{message:"Cancel"})}),e.jsx(d,{type:"submit",variant:"flat",color:"primary",disabled:i,children:e.jsx(o,{message:"Confirm"})})]})]})}function D({animationKey:s,svg:t,secret:a}){return e.jsxs(M.div,{...V,children:[e.jsx("div",{className:"mb-16 h-192 w-192",children:t}),e.jsx("div",{className:"mb-16 text-sm font-medium",children:a})]},s)}function Le(){return f({mutationFn:()=>Ie(),onError:s=>v(s)})}function Ie(){return l.post("auth/user/two-factor-recovery-codes").then(s=>s.data)}function Ee({user:s,onDisabled:t}){var x;const a=A(),n=Le(),{withConfirmedPassword:r,isLoading:u}=F(),c=a.isPending||n.isPending||u,i=e.jsxs(m.Fragment,{children:[e.jsx(d,{type:"button",onClick:()=>r(()=>{n.mutate(void 0,{onSuccess:()=>{b.invalidateQueries({queryKey:["users"]})}})}),variant:"outline",disabled:c,className:"mr-12",children:e.jsx(o,{message:"Regenerate recovery codes"})}),e.jsx(d,{type:"submit",variant:"flat",color:"danger",disabled:c,onClick:()=>{r(()=>{a.mutate(void 0,{onSuccess:()=>{g(w("Two factor authentication has been disabled.")),t()}})})},children:e.jsx(o,{message:"Disable"})})]});return e.jsx(L,{title:e.jsx(o,{message:"You have enabled two factor authentication."}),description:e.jsx(o,{message:"Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost."}),actions:i,children:e.jsx("div",{className:"mb-16 rounded bg-alt p-14 font-mono text-sm",children:(x=s.two_factor_recovery_codes)==null?void 0:x.map(h=>e.jsx("div",{className:"mb-4",children:h},h))})})}function qe({user:s}){const[t,a]=m.useState(_e(s));switch(t){case 0:return e.jsx(ve,{onEnabled:()=>a(1)});case 1:return e.jsx(Te,{onCancel:()=>{a(0)},onConfirmed:()=>{a(2)}});case 2:return e.jsx(Ee,{user:s,onDisabled:()=>a(0)})}}function _e(s){return s.two_factor_confirmed_at?2:s.two_factor_recovery_codes?1:0}function Ve({user:s}){return e.jsx(S,{id:C.TwoFactor,title:e.jsx(o,{message:"Two factor authentication"}),children:e.jsx("div",{className:"max-w-580",children:e.jsx(qe,{user:s})})})}export{Ge as C,Me as S,Ve as T,He as a,F as u};
