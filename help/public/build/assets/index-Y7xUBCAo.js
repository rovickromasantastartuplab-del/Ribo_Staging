import{j as K,r as P}from"./client-DtfdVV77.js";import{E as ee,c as E,d as te,N as H,m as ne,P as b,e as re,k as ie,F as j,S as U,T as X,f as Y,D as k,g as V,h as z,j as S,M as se,l as oe,n as le,o as ae,i as de}from"./index-uUjpwT6n.js";import{u as ue,T as ce}from"./tiptap-editor-context-CeN7pXcf.js";function Re({className:n="contents"}){const e=ue();return K.jsx(ee,{editor:e,className:n})}function pe({extensions:n,autoFocus:e,initialContent:t,contentClassName:r,onChange:i,onBlur:s,onFocus:o,changesAsText:l,onSubmit:a,onCreate:u,submitToClosestForm:p,preventNewLine:d}){const c=P.useRef(a);c.current=a??p?fe:void 0;const f=P.useRef(i);f.current=i;const g=P.useMemo(()=>{const O=[...n],C={};if(c.current&&(C["Cmd-Enter"]=w=>{var A;return(A=c.current)==null||A.call(c,w),!0},C["Ctrl-Enter"]=w=>{var A;return(A=c.current)==null||A.call(c,w),!0}),d&&(C.Enter=w=>(c.current&&c.current(w),!0)),Object.keys(C).length>0){const w=E.create({addKeyboardShortcuts:()=>C});O.push(w)}return O},[n]),M=P.useMemo(()=>({attributes:{class:r||""}}),[r]),T=P.useCallback(O=>{var w;let C=l?O.editor.getText():O.editor.getHTML();C==="<p></p>"&&(C=""),(w=f.current)==null||w.call(f,C)},[]);return te({extensions:g,autofocus:e,content:t,shouldRerenderOnTransaction:!1,editorProps:M,onUpdate:T,onBlur:s,onFocus:o,onCreate:u})}function fe({editor:n}){const e=n.$doc.element.closest("form");let t=e==null?void 0:e.querySelector('button[type="submit"]');!t&&(e!=null&&e.id)&&(t=document.querySelector(`button[type="submit"][form="${e.id}"]`)),e&&t&&!t.disabled&&e.requestSubmit(t)}function He({children:n,ref:e,...t}){const r=pe(t),i=P.useMemo(()=>({editor:r}),[r]);return P.useImperativeHandle(e,()=>({clearContents:()=>r==null?void 0:r.commands.clearContent(),getEditor:()=>r})),K.jsx(ce.Provider,{value:i,children:n})}var he=H.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`

`):""}),_e=he,me=H.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",ne(this.options.HTMLAttributes,n),0]},parseMarkdown:(n,e)=>{const t=n.tokens||[];return t.length===1&&t[0].type==="image"?e.parseChildren([t[0]]):e.createNode("paragraph",void 0,e.parseInline(t))},renderMarkdown:(n,e)=>!n||!Array.isArray(n.content)?"":e.renderChildren(n.content),addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),je=me,ge=H.create({name:"text",group:"inline",parseMarkdown:n=>({type:"text",text:n.text||""}),renderMarkdown:n=>n.text||""}),Be=ge;function ve(n={}){return new b({view(e){return new we(e,n)}})}class we{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,l=s.height/i.offsetHeight;if(t){let d=e.nodeBefore,c=e.nodeAfter;if(d||c){let f=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(f){let g=f.getBoundingClientRect(),M=d?g.bottom:g.top;d&&c&&(M=(M+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let T=this.width/2*l;r={left:g.left,right:g.right,top:M-T,bottom:M+T}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),c=this.width/2*o;r={left:d.left-c,right:d.left+c,top:d.top,bottom:d.bottom}}let a=this.editorView.dom.offsetParent;this.element||(this.element=a.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let u,p;if(!a||a==document.body&&getComputedStyle(a).position=="static")u=-pageXOffset,p=-pageYOffset;else{let d=a.getBoundingClientRect(),c=d.width/a.offsetWidth,f=d.height/a.offsetHeight;u=d.left-a.scrollLeft*c,p=d.top-a.scrollTop*f}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-p)/l+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/l+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,t,e):i;if(t&&!s){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=re(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class h extends z{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return h.valid(r)?new h(r):z.near(r)}content(){return U.empty}eq(e){return e instanceof h&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new h(e.resolve(t.pos))}getBookmark(){return new _(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!ye(e)||!Ce(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&h.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let l=e.node(o);if(t>0?e.indexAfter(o)<l.childCount:e.index(o)>0){s=l.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=t;let a=e.doc.resolve(i);if(h.valid(a))return a}for(;;){let o=t>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!Y.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*t),r=!1;continue e}break}s=o,i+=t;let l=e.doc.resolve(i);if(h.valid(l))return l}return null}}}h.prototype.visible=!1;h.findFrom=h.findGapCursorFrom;z.jsonID("gapcursor",h);class _{constructor(e){this.pos=e}map(e){return new _(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return h.valid(t)?new h(t):z.near(t)}}function J(n){return n.isAtom||n.spec.isolating||n.spec.createGapCursor}function ye(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||J(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Ce(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||J(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Ee(){return new b({props:{decorations:Te,createSelectionBetween(n,e,t){return e.pos==t.pos&&h.valid(t)?new h(t):null},handleClick:xe,handleKeyDown:Me,handleDOMEvents:{beforeinput:be}}})}const Me=ie({ArrowLeft:N("horiz",-1),ArrowRight:N("horiz",1),ArrowUp:N("vert",-1),ArrowDown:N("vert",1)});function N(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,l=e>0?o.$to:o.$from,a=o.empty;if(o instanceof X){if(!s.endOfTextblock(t)||l.depth==0)return!1;a=!1,l=r.doc.resolve(e>0?l.after():l.before())}let u=h.findGapCursorFrom(l,e,a);return u?(i&&i(r.tr.setSelection(new h(u))),!0):!1}}function xe(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!h.valid(r))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&Y.isSelectable(n.state.doc.nodeAt(i.inside))?!1:(n.dispatch(n.state.tr.setSelection(new h(r))),!0)}function be(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof h))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let i=j.empty;for(let o=r.length-1;o>=0;o--)i=j.from(r[o].createAndFill(null,i));let s=n.state.tr.replace(t.pos,t.pos,new U(i,0,0));return s.setSelection(X.near(s.doc.resolve(t.pos+1))),n.dispatch(s),!1}function Te(n){if(!(n.selection instanceof h))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",k.create(n.doc,[V.widget(n.selection.head,e,{key:"gapcursor"})])}var L=200,m=function(){};m.prototype.append=function(e){return e.length?(e=m.from(e),!this.length&&e||e.length<L&&this.leafAppend(e)||this.length<L&&e.leafPrepend(this)||this.appendInner(e)):this};m.prototype.prepend=function(e){return e.length?m.from(e).append(this):this};m.prototype.appendInner=function(e){return new Pe(this,e)};m.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?m.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};m.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};m.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)};m.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},t,r),i};m.from=function(e){return e instanceof m?e:e&&e.length?new q(e):m.empty};var q=(function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,l){for(var a=s;a<o;a++)if(i(this.values[a],l+a)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,l){for(var a=s-1;a>=o;a--)if(i(this.values[a],l+a)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=L)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=L)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(m);m.empty=new q([]);var Pe=(function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var l=this.left.length;if(i<l&&this.left.forEachInner(r,i,Math.min(s,l),o)===!1||s>l&&this.right.forEachInner(r,Math.max(i-l,0),Math.min(this.length,s)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(r,i-l,Math.max(s,l)-l,o+l)===!1||s<l&&this.left.forEachInvertedInner(r,Math.min(i,l),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(m);const Ie=500;class v{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;t&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,l,a,u=[],p=[];return this.items.forEach((d,c)=>{if(!d.step){i||(i=this.remapping(r,c+1),s=i.maps.length),s--,p.push(d);return}if(i){p.push(new y(d.map));let f=d.step.map(i.slice(s)),g;f&&o.maybeStep(f).doc&&(g=o.mapping.maps[o.mapping.maps.length-1],u.push(new y(g,void 0,void 0,u.length+p.length))),s--,g&&i.appendMap(g,s)}else o.maybeStep(d.step);if(d.selection)return l=i?d.selection.map(i.slice(s)):d.selection,a=new v(this.items.slice(0,r).append(p.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:o,selection:l}}addTransform(e,t,r,i){let s=[],o=this.eventCount,l=this.items,a=!i&&l.length?l.get(l.length-1):null;for(let p=0;p<e.steps.length;p++){let d=e.steps[p].invert(e.docs[p]),c=new y(e.mapping.maps[p],d,t),f;(f=a&&a.merge(c))&&(c=f,p?s.pop():l=l.slice(0,l.length-1)),s.push(c),t&&(o++,t=void 0),i||(a=c)}let u=o-r.depth;return u>Oe&&(l=Se(l,u),o-=u),new v(l.append(s),o)}remapping(e,t){let r=new se;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,t),r}addMaps(e){return this.eventCount==0?this:new v(this.items.append(e.map(t=>new y(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-t),s=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(c=>{c.selection&&l--},i);let a=t;this.items.forEach(c=>{let f=s.getMirror(--a);if(f==null)return;o=Math.min(o,f);let g=s.maps[f];if(c.step){let M=e.steps[f].invert(e.docs[f]),T=c.selection&&c.selection.map(s.slice(a+1,f));T&&l++,r.push(new y(g,M,T))}else r.push(new y(g))},i);let u=[];for(let c=t;c<o;c++)u.push(new y(s.maps[c]));let p=this.items.slice(0,i).append(u).append(r),d=new v(p,l);return d.emptyItemCount()>Ie&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,i=[],s=0;return this.items.forEach((o,l)=>{if(l>=e)i.push(o),o.selection&&s++;else if(o.step){let a=o.step.map(t.slice(r)),u=a&&a.getMap();if(r--,u&&t.appendMap(u,r),a){let p=o.selection&&o.selection.map(t.slice(r));p&&s++;let d=new y(u.invert(),a,p),c,f=i.length-1;(c=i.length&&i[f].merge(d))?i[f]=c:i.push(d)}}else o.map&&r--},this.items.length,0),new v(m.from(i.reverse()),s)}}v.empty=new v(m.empty,0);function Se(n,e){let t;return n.forEach((r,i)=>{if(r.selection&&e--==0)return t=i,!1}),n.slice(t)}class y{constructor(e,t,r,i){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new y(t.getMap().invert(),t,this.selection)}}}class x{constructor(e,t,r,i,s){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Oe=20;function Ae(n,e,t,r){let i=t.getMeta(I),s;if(i)return i.historyState;t.getMeta(De)&&(n=new x(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(I))return o.getMeta(I).redo?new x(n.done.addTransform(t,void 0,r,D(e)),n.undone,B(t.mapping.maps),n.prevTime,n.prevComposition):new x(n.done,n.undone.addTransform(t,void 0,r,D(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),a=n.prevTime==0||!o&&n.prevComposition!=l&&(n.prevTime<(t.time||0)-r.newGroupDelay||!ke(t,n.prevRanges)),u=o?F(n.prevRanges,t.mapping):B(t.mapping.maps);return new x(n.done.addTransform(t,a?e.selection.getBookmark():void 0,r,D(e)),v.empty,u,t.time,l??n.prevComposition)}else return(s=t.getMeta("rebased"))?new x(n.done.rebased(t,s),n.undone.rebased(t,s),F(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new x(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),F(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function ke(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(t=!0)}),t}function B(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((r,i,s,o)=>e.push(s,o));return e}function F(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let i=e.map(n[r],1),s=e.map(n[r+1],-1);i<=s&&t.push(i,s)}return t}function Ne(n,e,t){let r=D(e),i=I.get(e).spec.config,s=(t?n.undone:n.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),l=(t?n.done:n.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),a=new x(t?l:s.remaining,t?s.remaining:l,null,0,-1);return s.transform.setSelection(o).setMeta(I,{redo:t,historyState:a})}let R=!1,G=null;function D(n){let e=n.plugins;if(G!=e){R=!1,G=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){R=!0;break}}return R}const I=new S("history"),De=new S("closeHistory");function ze(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new b({key:I,state:{init(){return new x(v.empty,v.empty,null,0,-1)},apply(e,t,r){return Ae(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,i=r=="historyUndo"?Q:r=="historyRedo"?$:null;return!i||!e.editable?!1:(t.preventDefault(),i(e.state,e.dispatch))}}}})}function Z(n,e){return(t,r)=>{let i=I.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(r){let s=Ne(i,t,n);s&&r(e?s.scrollIntoView():s)}return!0}}const Q=Z(!1,!0),$=Z(!0,!0);E.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const e=(n==null?void 0:n.node)||this.editor.state.doc;if(((n==null?void 0:n.mode)||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=n=>{const e=(n==null?void 0:n.node)||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let n=!1;return[new b({key:new S("characterCount"),appendTransaction:(e,t,r)=>{if(n)return;const i=this.options.limit;if(i==null||i===0){n=!0;return}const s=this.storage.characters({node:r.doc});if(s>i){const o=s-i,l=0,a=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=r.tr.deleteRange(l,a);return n=!0,u}n=!0},filterTransaction:(e,t)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const i=this.storage.characters({node:t.doc}),s=this.storage.characters({node:e.doc});if(s<=r||i>r&&s>r&&s<=i)return!0;if(i>r&&s>r&&s>i||!e.getMeta("paste"))return!1;const l=e.selection.$head.pos,a=s-r,u=l-a,p=l;return e.deleteRange(u,p),!(this.storage.characters({node:e.doc})>r)}})]}});var Ge=E.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[ve(this.options)]}});E.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new b({key:new S("focus"),props:{decorations:({doc:n,selection:e})=>{const{isEditable:t,isFocused:r}=this.editor,{anchor:i}=e,s=[];if(!t||!r)return k.create(n,[]);let o=0;this.options.mode==="deepest"&&n.descendants((a,u)=>{if(a.isText)return;if(!(i>=u&&i<=u+a.nodeSize-1))return!1;o+=1});let l=0;return n.descendants((a,u)=>{if(a.isText||!(i>=u&&i<=u+a.nodeSize-1))return!1;if(l+=1,this.options.mode==="deepest"&&o-l>0||this.options.mode==="shallowest"&&l>1)return this.options.mode==="deepest";s.push(V.node(u,u+a.nodeSize,{class:this.options.className}))}),k.create(n,s)}}})]}});var We=E.create({name:"gapCursor",addProseMirrorPlugins(){return[Ee()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=le(ae(n,"allowGapCursor",t)))!=null?e:null}}}),Ke=E.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new b({key:new S("placeholder"),props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!t)return null;const s=this.editor.isEmpty;return n.descendants((o,l)=>{const a=r>=l&&r<=l+o.nodeSize,u=!o.isLeaf&&oe(o);if((a||!this.options.showOnlyCurrent)&&u){const p=[this.options.emptyNodeClass];s&&p.push(this.options.emptyEditorClass);const d=V.node(l,l+o.nodeSize,{class:p.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:l,hasAnchor:a}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),k.create(n,i)}}})]}});E.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:e}=this;return[new b({key:new S("selection"),props:{decorations(t){return t.selection.empty||n.isFocused||!n.isEditable||de(t.selection)||n.view.dragging?null:k.create(t.doc,[V.inline(t.selection.from,t.selection.to,{class:e.className})])}}})]}});function W({types:n,node:e}){return e&&Array.isArray(n)&&n.includes(e.type)||(e==null?void 0:e.type)===n}var Ue=E.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var n;const e=new S(this.name),t=((n=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:n.name)||this.options.node||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(t).includes(i.name));return[new b({key:e,appendTransaction:(i,s,o)=>{const{doc:l,tr:a,schema:u}=o,p=e.getState(o),d=l.content.size,c=u.nodes[t];if(p)return a.insert(d,c.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!W({node:o,types:r})},apply:(i,s)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return s;const o=i.doc.lastChild;return!W({node:o,types:r})}}})]}}),Xe=E.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>Q(n,e),redo:()=>({state:n,dispatch:e})=>$(n,e)}},addProseMirrorPlugins(){return[ze(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});export{he as D,We as G,Ke as P,He as T,Xe as U,Re as a,je as b,Be as c,Ge as d,me as e,ge as f,Ue as g,_e as i};
