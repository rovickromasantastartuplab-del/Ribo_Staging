import{be as S,j as e,T as l,B as v,aj as k,as as T,aR as z,p as E,t as N,m as F,X as b,f as j,a1 as I,av as U,r as C,al as M,am as P,an as B,ap as D,aq as Q,l as q,ac as y,az as R,i as V,q as _,k as K}from"./client-DtfdVV77.js";import{F as L}from"./file-type-icon-CNIGAaMG.js";import{u as f,r as H,F as W}from"./file-upload-provider-B4w-VsYu.js";import{P as X}from"./progress-bar-BMzArYUQ.js";import{o as $}from"./open-upload-window-DE9Q8gNs.js";import{F as G}from"./normalized-model-field-D3Ui05eZ.js";import{h as w,o as J}from"./custom-menu-Dvq-fOnC.js";import{A as O,a as Y}from"./accordion-Dmxnze9z.js";import{C as Z}from"./checkbox-CS7ILu6P.js";import{E as ee}from"./Edit-BaEHOLuK.js";import{M as se}from"./managed-by-field-CVvllq11.js";import{V as te}from"./visible-to-field-gdyusxCr.js";import{F as ae}from"./form-chip-field-C7l8nGPv.js";function ne(){const s=f(a=>a.fileUploads),t=f(a=>a.abortUpload),n=f(a=>a.uploadMultiple),{fields:i,append:u,remove:p}=S({name:"attachments"}),h=async()=>{const a={uploadType:z.articleAttachments,onSuccess:c=>{u(c)},onError:c=>{c&&N.danger(c)}},o=H(a),r=await $({multiple:!0,types:o==null?void 0:o.allowedFileTypes});r.length&&n(r,a)};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-8 mt-34 text-sm",children:e.jsx(l,{message:"Attachments"})}),e.jsxs("div",{children:[i.map((a,o)=>{const r=a;return e.jsx(A,{name:r.name,mime:r.mime,onRemove:()=>p(o),downloadLink:`file-entries/download/${r.hash}`},r.id)}),[...s.entries()].filter(([a,o])=>o.status==="inProgress").map(([a,o])=>e.jsx(A,{name:o.file.name,mime:o.file.mime,progress:o.percentage,onRemove:()=>t(a)},a))]}),e.jsx("div",{className:"mt-6",children:e.jsx(v,{variant:"link",color:"primary",onClick:()=>h(),children:e.jsx(l,{message:"Upload attachment (max 20MB)"})})})]})}function A({name:s,mime:t,progress:n,onRemove:i,downloadLink:u}){return e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsx(L,{mime:t,size:"xs"}),e.jsx(ie,{name:s,className:"overflow-hidden overflow-ellipsis whitespace-nowrap",downloadLink:u}),e.jsx(k,{onClick:()=>i(),size:"xs",children:e.jsx(T,{})})]}),n?e.jsx(X,{value:n,className:"mt-4 max-w-224",size:"xs"}):null]})}function ie({name:s,downloadLink:t,className:n}){return t?e.jsx("a",{href:t,download:!0,className:E(n,"hover:underline"),children:s}):e.jsx("div",{className:n,children:s})}const oe=F("Select author..."),re=F("Find a user");function le(){return e.jsx(G,{endpoint:"helpdesk/normalized-models/article-authors",name:"author_id",background:"bg",className:"mb-24",label:e.jsx(l,{message:"Author"}),placeholder:oe,searchPlaceholder:re})}function ce({onSave:s}){var d;const{data:t}=b(w.categories.normalizedList()),n=(t==null?void 0:t.categories)||[],i=n.map(m=>m.sections).flat()||[],{watch:u,clearErrors:p}=j(),h=u("sections")||[],{getFieldState:a}=j(),o=(d=a("sections").error)==null?void 0:d.message,r=I({errorMessage:o}),c=i.find(m=>m.id===h[0]),x=n.find(m=>m.id===(c==null?void 0:c.parent_id)),g=h.length;return e.jsxs("div",{children:[e.jsx("div",{className:r.label,children:e.jsx(l,{message:"Publish in sections"})}),e.jsxs(U,{type:"modal",onClose:m=>{m&&(s(m),p("sections"))},children:[e.jsxs("div",{className:"relative cursor-pointer rounded-input border bg py-12 pl-12 pr-30 text-sm",children:[!c||!x?e.jsx(l,{message:"Select a section"}):e.jsxs(C.Fragment,{children:[e.jsx("div",{className:"mb-2 overflow-hidden overflow-ellipsis whitespace-nowrap font-semibold",children:x.name}),e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-xs text-muted",children:g>1?e.jsx(l,{message:":name + :count more sections",values:{name:c.name,count:g-1}}):c.name})]}),e.jsx(ee,{className:"absolute right-8 top-8 text-muted",size:"sm"})]}),e.jsx(de,{})]}),o&&e.jsx("div",{className:r.error,children:o})]})}function de(){var h;const{data:s}=b(w.categories.normalizedList()),{close:t}=M(),{getValues:n}=j(),[i,u]=C.useState(()=>n("sections")||[]),p=(a,o)=>{a.target.checked?u([...i,o.id]):u(i.filter(r=>r!==o.id))};return e.jsxs(P,{size:"lg",children:[e.jsx(B,{children:e.jsx(l,{message:"Select sections"})}),e.jsx(D,{children:e.jsx(O,{children:(h=s==null?void 0:s.categories)==null?void 0:h.map(a=>{var c,x,g;const r=(((c=a.sections)==null?void 0:c.map(d=>d.id))||[]).filter(d=>i.includes(d)).length;return e.jsx(Y,{disabled:!((x=a.sections)!=null&&x.length),description:r?e.jsx(l,{message:"[one 1 section|other :count sections] selected",values:{count:r}}):null,label:a.name,children:e.jsx("div",{className:"space-y-8",children:(g=a.sections)==null?void 0:g.map(d=>e.jsx(Z,{className:"block",checked:i.includes(d.id),onChange:m=>p(m,d),children:d.name},d.id))})},a.id)})})}),e.jsxs(Q,{children:[e.jsx(v,{onClick:()=>t(),children:e.jsx(l,{message:"Cancel"})}),e.jsx(v,{variant:"flat",color:"primary",onClick:()=>t(i),children:e.jsx(l,{message:"Select"})})]})]})}function Se({children:s}){const t=j();return e.jsxs(C.Fragment,{children:[s,e.jsx(te,{className:"mb-24",description:e.jsx(l,{message:"Control who can see this article in help center"})}),e.jsx(le,{}),e.jsx(se,{className:"mb-24",description:e.jsx(l,{message:"Control who can edit and publish this article"})}),e.jsx(ce,{onSave:n=>{t.setValue("sections",n)}}),e.jsx(me,{}),e.jsx(W,{children:e.jsx(ne,{})})]})}function me(){const{data:s}=b(q.tags.index()),t=(s==null?void 0:s.pagination.data)||[],{trans:n}=y();return t.length?e.jsx(ae,{className:"mt-24",placeholder:n({message:"Add tag..."}),background:"bg",label:e.jsx(l,{message:"Tags"}),name:"tags",chipSize:"sm",suggestions:t,description:e.jsx(l,{message:"Add content tags to help users find articles easier"}),children:i=>e.jsx(R,{value:i.id,capitalizeFirst:!0,children:e.jsx(l,{message:i.name})},i.id)}):null}function ke(s){const{trans:t}=y();return V({mutationFn:n=>he(n),onSuccess:async()=>{await _.invalidateQueries({queryKey:w.articles.invalidateKey}),N(t(F("Article created")))},onError:n=>J(n,s,["body"])})}function ue(s){var t,n;return{...s,attachments:(t=s.attachments)==null?void 0:t.map(i=>i.id),tags:(n=s.tags)==null?void 0:n.map(i=>i.name)}}function he(s){return K.post("hc/articles",ue(s)).then(t=>t.data)}export{Se as A,ue as a,ke as u};
