import{i as h,s as v,t as p,m as x,q as S,k as _,j as s,r as f,B as y,T as m,aE as b}from"./client-DtfdVV77.js";import{u as C}from"./useSuspenseQuery-Bmt2-NKx.js";import{C as g}from"./checkbox-CS7ILu6P.js";import{N as w,x as E}from"./main-BGmGAxtx.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./custom-menu-Dvq-fOnC.js";function k(t){return _.put("notifications/me/subscriptions",{selections:t}).then(i=>i.data)}function N(){return h({mutationFn:t=>k(t),onSuccess:()=>{p(x("Updated preferences")),S.invalidateQueries({queryKey:["notification-subscriptions"]})},onError:t=>v(t)})}function I(){return s.jsxs("div",{className:"min-h-screen bg",children:[s.jsx(w,{color:"bg",darkModeColor:"bg-elevated",menuPosition:"notifications-page"}),s.jsx("div",{className:"container mx-auto my-20 px-10 md:my-40 md:px-20",children:s.jsx("div",{className:"rounded-panel border bg-elevated px-20 pb-30 pt-20 shadow-sm",children:s.jsx(P,{})})})]})}function P(){const t=N(),{data:i}=C(E),[o,d]=f.useState(()=>{const n={},r={};return i.available_channels.forEach(e=>{r[e]=!1}),i.subscriptions.forEach(e=>{e.subscriptions.forEach(a=>{const c=i.user_selections.find(l=>l.notif_id===a.notif_id);n[a.notif_id]=(c==null?void 0:c.channels)||{...r}})}),n});return s.jsxs(f.Fragment,{children:[i.subscriptions.map(n=>s.jsxs("div",{className:"mb-10 text-sm",children:[s.jsx(q,{group:n,allChannels:i==null?void 0:i.available_channels,selection:o,setSelection:d},n.group_name),n.subscriptions.map(r=>s.jsx(O,{subscription:r,selection:o,setSelection:d,allChannels:i==null?void 0:i.available_channels},r.notif_id))]},n.group_name)),s.jsx(y,{className:"ml-10 mt-20",variant:"flat",color:"primary",disabled:t.isPending,onClick:()=>{t.mutate(Object.entries(o).map(([n,r])=>({notif_id:n,channels:r})))},children:s.jsx(m,{message:"Update preferences"})})]})}function q({group:t,allChannels:i,selection:o,setSelection:d}){const n=(e,a)=>{const c=b(o,l=>{Object.keys(o).forEach(u=>{l[u][e]=a})});d(c)},r=s.jsx("div",{className:"ml-auto flex items-center gap-40 max-md:hidden",children:i.map(e=>{const a=Object.values(o).every(l=>l[e]),c=!a&&Object.values(o).some(l=>l[e]);return s.jsx(g,{orientation:"vertical",isIndeterminate:c,checked:a,onChange:async l=>{if(e==="browser"){const u=await j();n(e,u?!a:!1)}else n(e,!a)},children:s.jsx(m,{message:e})},e)})});return s.jsxs("div",{className:"flex items-center border-b p-10",children:[s.jsx("div",{className:"font-semibold",children:s.jsx(m,{message:t.group_name})}),r]})}function O({subscription:t,allChannels:i,selection:o,setSelection:d}){const n=t.notif_id,r=(e,a)=>{const c=b(o,l=>{l[t.notif_id][e]=a});d(c)};return s.jsxs("div",{className:"items-center border-b py-10 pl-8 pr-10 md:flex md:pl-20",children:[s.jsx("div",{className:"pb-14 font-semibold md:pb-0 md:font-normal",children:s.jsx(m,{message:t.name})}),s.jsx("div",{className:"ml-auto flex items-center gap-40",children:i.map(e=>s.jsx(g,{orientation:"vertical",checked:o[n][e],onChange:async a=>{const c=!o[n][e];if(e==="browser"){const l=await j();r(e,l?c:!1)}else r(e,c)},"aria-label":e,children:s.jsx("div",{className:"md:invisible md:h-0",children:s.jsx(m,{message:e})})},e))})]})}function j(){return Notification.permission==="granted"?Promise.resolve(!0):Notification.permission==="denied"?(p.danger(x("Notifications blocked. Please enable them for this site from browser settings.")),Promise.resolve(!1)):Notification.requestPermission().then(t=>t==="granted")}export{I as Component,P as NotificationSettings};
