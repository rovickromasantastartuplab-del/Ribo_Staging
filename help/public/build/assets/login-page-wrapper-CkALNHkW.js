import{i as w,k as C,h as U,b4 as q,r as u,bw as A,af as B,aL as z,c as M,u as O,d as S,j as e,T as o,aP as F,F as m,L as x,B as f}from"./client-DtfdVV77.js";import{A as L,G}from"./auth-layout-Pf6PSjuN.js";import{L as y}from"./external-link-Cxcw6nc_.js";import{F as W}from"./checkbox-CS7ILu6P.js";import{l as H,h as k}from"./main-BGmGAxtx.js";import{o as N}from"./custom-menu-Dvq-fOnC.js";import{S as Q}from"./social-auth-section-DzmgHjYc.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./use-social-login-BVUj2tXy.js";import"./use-all-social-logins-disabled-aPb5okc5.js";import"./envato-DSHUfLey.js";import"./google-4IXOtUqo.js";function V(a){const t=T();return w({mutationFn:s=>C.post("auth/login",s).then(r=>r.data),onSuccess:s=>{s.two_factor||t(s)},onError:s=>N(s,a)})}function T(){const a=U(),{getRedirectUri:t}=q();return u.useCallback(s=>{var n,i;let r=((n=s.url)==null?void 0:n.intended)??t();if(r.includes("/oauth/"))window.location.href=r;else{A(s.bootstrapData),r=((i=s.url)==null?void 0:i.intended)??t();const c=r.replace(B().settings.base_url,"");a(c,{replace:!0})}},[a,t])}function J({onTwoFactorChallenge:a,bottomMessages:t}){var v;const[s]=z(),{pathname:r}=M(),n=r.includes("workspace"),i=s.get("email")||void 0,{branding:c,registration:d,site:P,social:g}=O(),p=!(d!=null&&d.disable),E=u.useContext(H),R=P.demo&&!i?X(E):{},l=S({defaultValues:{remember:!0,email:i,...R}}),j=V(l),D=n?e.jsx(o,{values:{siteName:c==null?void 0:c.site_name},message:"To join your team on :siteName, login to your account"}):e.jsx(o,{message:"Sign in to your account"}),_=(p||t)&&e.jsxs("div",{className:"space-y-8",children:[p&&e.jsx("div",{children:e.jsx(o,{message:"Don't have an account? <a>Sign up.</a>",values:{a:h=>e.jsx(x,{className:y,to:"/register",children:h})}})}),t]}),b=!!Object.keys(l.formState.errors).length;return e.jsxs(L,{heading:D,message:_,children:[e.jsx(k,{children:e.jsx(o,{message:"Login"})}),e.jsxs(F,{form:l,onSubmit:h=>{j.mutate(h,{onSuccess:I=>{I.two_factor&&a()}})},children:[e.jsx(m,{className:"mb-32",name:"email",type:"email",label:e.jsx(o,{message:"Email"}),disabled:!!i,invalid:b,errorMessage:((v=l.formState.errors.email)==null?void 0:v.message)&&e.jsx(K,{}),required:!0}),e.jsx(m,{className:"mb-12",name:"password",type:"password",label:e.jsx(o,{message:"Password"}),invalid:b,labelSuffix:e.jsx(x,{className:y,to:"/forgot-password",tabIndex:-1,children:e.jsx(o,{message:"Forgot your password?"})}),required:!0}),e.jsx(W,{name:"remember",className:"mb-32 block",children:e.jsx(o,{message:"Stay signed in for a month"})}),e.jsx(f,{className:"block w-full",type:"submit",variant:"flat",color:"primary",size:"md",disabled:j.isPending,children:e.jsx(o,{message:"Continue"})})]}),e.jsx(Q,{dividerMessage:g!=null&&g.compact_buttons?e.jsx(o,{message:"Or sign in with"}):e.jsx(o,{message:"OR"})})]})}function K(){return e.jsx(o,{message:"These credentials do not match our records. Try again or <a>get a new password</a>.",values:{a:a=>e.jsx(x,{className:"font-semibold underline",to:"/forgot-password",tabIndex:-1,children:a})}})}function X(a){var t,s;return{email:((t=a.demo)==null?void 0:t.email)??"admin@admin.com",password:((s=a.demo)==null?void 0:s.password)??"admin"}}function Y(a){const t=T();return w({mutationFn:s=>Z(s),onSuccess:s=>{t(s)},onError:s=>N(s,a)})}function Z(a){return C.post("auth/two-factor-challenge",a).then(t=>t.data)}function $(){const[a,t]=u.useState(!1),s=S(),r=Y(s);return e.jsxs(L,{children:[e.jsx(k,{children:e.jsx(o,{message:"Two factor authentication"})}),e.jsxs(F,{form:s,onSubmit:n=>{r.mutate(n)},children:[e.jsx("div",{className:"mb-32 text-sm",children:e.jsx(o,{message:"Confirm access to your account by entering the authentication code provided by your authenticator application."})}),e.jsx("div",{className:"mb-4",children:a?e.jsx(m,{name:"recovery_code",minLength:21,maxLength:21,autoComplete:"off",autoCorrect:"off",spellCheck:"false",label:e.jsx(o,{message:"Recovery code"}),autoFocus:!0,required:!0}):e.jsx(m,{name:"code",minLength:6,maxLength:6,autoComplete:"off",autoCorrect:"off",spellCheck:"false",label:e.jsx(o,{message:"Code"}),autoFocus:!0,required:!0})}),e.jsx("div",{className:"mb-32",children:e.jsx(f,{variant:"link",color:"primary",size:"sm",onClick:()=>t(!a),children:e.jsx(o,{message:"Use recovery code instead"})})}),e.jsx(f,{className:"block w-full",type:"submit",variant:"flat",color:"primary",size:"md",disabled:r.isPending,children:e.jsx(o,{message:"Continue"})})]})]})}function de({bottomMessages:a}){const[t,s]=u.useState(!1),r=t?e.jsx($,{}):e.jsx(J,{onTwoFactorChallenge:()=>s(!0),bottomMessages:a});return e.jsx(G,{children:r})}export{de as LoginPageWrapper};
