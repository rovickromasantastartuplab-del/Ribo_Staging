import{b3 as I,aZ as k,l as p,j as e,T as s,L as v,i as w,s as D,k as b,q as y,r as l,av as A,aw as N,aj as V,ax as R,az as c,al as H,$ as E,p as M,Y as q,aQ as h,D as L,t as j,m as f}from"./client-DtfdVV77.js";import{A as $}from"./admin-config-DXsixO44.js";import{D as B}from"./dashboard-icons-BJ4c3Z5i.js";import{u as F}from"./use-update-view-ChQ1dfH1.js";import{s as O}from"./search-D3bB1V5N.js";import{D as Q}from"./settings-links-CRsxvJIZ.js";import{G as K}from"./global-loading-progress-DVC8NxPo.js";import{a as z}from"./name-with-avatar-D8NZSkGp.js";import{D as U}from"./data-table-add-item-button-B_2m2pad.js";import{D as W}from"./data-table-header-CdCZHch7.js";import{D as G}from"./data-table-pagination-footer-B4yyc06A.js";import{u as _}from"./use-datatable-search-params-dzq5X78n.js";import{D as Y}from"./data-table-emty-state-message-DsPxSC6g.js";import{a as Z,D as J,b as X,c as ee}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{u as ae}from"./use-datatable-query-v3pOHYke.js";import{T as se,a as te}from"./table-CynOKbaN.js";import{D as re}from"./DragHandle-CczVUV80.js";import{M as ie}from"./MoreVert-BVDYtk4z.js";import{u as oe,D as ne}from"./is-touch-device-vJjKU1l2.js";import{u as me,m as le}from"./use-sortable-CsHM4tcn.js";import{C as de}from"./confirmation-dialog-BzXs9ksK.js";import"./Translate-DPB2wdvD.js";import"./main-BGmGAxtx.js";import"./custom-menu-Dvq-fOnC.js";import"./TextFields-CM1xUWDR.js";import"./library-icon-h4d3s9Ef.js";import"./messages-square-icon-D_3IR-rK.js";import"./Delete-DWP7kvj0.js";import"./Home-iO0iebLw.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./external-link-Cxcw6nc_.js";import"./book-open-D91H26Dq.js";import"./skeleton-D178v0-U.js";import"./Add-B1HfWgJf.js";import"./FilterAlt-CRhKT7zD.js";import"./select-filter-panel-hjhYEdoY.js";import"./form-chip-field-C7l8nGPv.js";import"./chip-list-DHXDGW6X.js";import"./filter-operator-names-BbrFb9i0.js";import"./select-D9niWe2H.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./normalized-model-field-D3Ui05eZ.js";import"./Edit-BaEHOLuK.js";import"./accordion-Dmxnze9z.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./ArrowDownward-DHtsWMyK.js";import"./useEffectEvent-Offmqu_S.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./useGlobalListeners-BGMP113F.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-CpvjuNXE.js";import"./uploaded-file-DOXWsty7.js";const ce=[{key:"dragHandle",width:"w-42 flex-shrink-0",header:()=>e.jsx(s,{message:"Drag handle"}),hideHeader:!0,body:()=>e.jsx(re,{className:"cursor-pointer text-muted hover:text"})},{key:"name",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:a=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(B,{name:a.icon,size:"sm"}),a.name]})},{key:"owner_id",allowsSorting:!0,header:()=>e.jsx(s,{message:"User"}),body:a=>a.user&&e.jsx(z,{image:a.user.image,label:a.user.name,description:a.user.email,avatarCircle:!0})},{key:"access",allowsSorting:!0,header:()=>e.jsx(s,{message:"Available for"}),body:a=>{var t;switch(a.access){case"anyone":return e.jsx(s,{message:"Any agent"});case"owner":return e.jsx(s,{message:"View owner"});case"group":return e.jsx(s,{message:"Agents in :name",values:{name:(t=a.group)==null?void 0:t.name}})}}},{key:"pinned",allowsSorting:!0,header:()=>e.jsx(s,{message:"Pinned"}),width:"w-96",body:a=>a.pinned&&e.jsx(h,{className:"text-muted"})},{key:"active",allowsSorting:!0,header:()=>e.jsx(s,{message:"Active"}),width:"w-96",body:a=>a.active&&e.jsx(h,{className:"text-muted"})},{key:"updatedAt",allowsSorting:!0,width:"w-124",header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx("time",{children:e.jsx(L,{date:a.updated_at})})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),width:"w-42 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:a=>e.jsx(xe,{view:a})}];function va(){const a=I(),{searchParams:t,sortDescriptor:i,mergeIntoSearchParams:r,setSearchQuery:d}=_(k),m=!!(t.query||t.filters),o=ae(p.views.index(t));return e.jsxs(Z,{children:[e.jsx(K,{query:o}),e.jsx(J,{title:e.jsx(s,{message:"Views"}),showSidebarToggleButton:!0,rightContent:e.jsx(Q,{variant:"button",link:$.pages.views,size:"xs"})}),e.jsxs(X,{children:[e.jsx(W,{searchValue:t.query,onSearchChange:d,actions:e.jsx(U,{elementType:v,to:"new",children:e.jsx(s,{message:"Add view"})})}),e.jsxs(ee,{children:[e.jsx(se,{columns:ce,data:o.items,sortDescriptor:i,onSortChange:r,enableSelection:!1,cellHeight:"h-64",renderRowAs:ue,onAction:n=>a(`${n.id}/update`)}),o.isEmpty&&e.jsx(Y,{isFiltering:m,image:O,title:e.jsx(s,{message:"No views have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching views"})}),e.jsx(G,{hideIfOnlyOnePage:!0,query:o,onPageChange:n=>r({page:n}),onPerPageChange:n=>r({perPage:n})})]})]})]})}function ue({item:a,children:t,className:i,...r}){const d=oe(),{data:m}=l.useContext(te),o=l.useRef(null),n=ge(),g=l.useRef(null),[x,S]=l.useState(null),{sortableProps:P}=me({ref:o,disabled:d??!1,item:a,items:m,type:"viewsTableItem",preview:g,strategy:"line",onDropPositionChange:u=>{S(u)},onSortEnd:(u,T)=>{n.mutate({viewIds:le(m.map(C=>C.id),u,T)})}});return e.jsxs("div",{className:M(i,x==="before"&&"sort-preview-before",x==="after"&&"sort-preview-after"),ref:o,...E(P,r),children:[t,!a.isPlaceholder&&e.jsx(pe,{item:a,ref:g})]})}const pe=q.forwardRef(({item:a},t)=>e.jsx(ne,{ref:t,children:()=>e.jsx("div",{className:"rounded bg-chip p-8 text-base shadow",children:a.name})}));function ge(){return w({mutationFn:a=>b.post("helpdesk/views/reorder",a).then(t=>t.data),onSuccess:()=>y.invalidateQueries({queryKey:p.views.invalidateKey}),onError:a=>D(a)})}function xe({view:a}){const[t,i]=l.useState(!1),r=F(a.id),d=()=>r.mutate({active:!0},{onSuccess:()=>j(f("Activated view"))}),m=()=>r.mutate({active:!1},{onSuccess:()=>j(f("Deactivated view"))});return e.jsxs(l.Fragment,{children:[t&&e.jsx(A,{type:"modal",isOpen:t,onOpenChange:i,children:e.jsx(he,{view:a})}),e.jsxs(N,{children:[e.jsx(V,{className:"text-muted",disabled:r.isPending,children:e.jsx(ie,{})}),e.jsxs(R,{children:[e.jsx(c,{value:"edit",elementType:v,to:`${a.id}/update`,children:e.jsx(s,{message:"Edit"})}),!a.active&&e.jsx(c,{value:"activate",onSelected:()=>d(),children:e.jsx(s,{message:"Activate"})}),a.active&&e.jsx(c,{value:"deactivate",onSelected:()=>m(),isDisabled:a.internal,children:e.jsx(s,{message:"Deactivate"})}),e.jsx(c,{value:"delete",className:"text-danger",onSelected:()=>i(!0),isDisabled:a.internal,children:e.jsx(s,{message:"Delete"})})]})]})]})}function he({view:a}){const t=w({mutationFn:()=>b.delete(`helpdesk/views/${a.id}`),onSuccess:()=>y.invalidateQueries({queryKey:p.views.invalidateKey}),onError:r=>D(r)}),{close:i}=H();return e.jsx(de,{isDanger:!0,isLoading:t.isPending,title:e.jsx(s,{message:"Delete view"}),body:e.jsx(s,{message:"Are you sure you want to delete this view?"}),confirm:e.jsx(s,{message:"Delete"}),onConfirm:()=>{t.mutate(void 0,{onSuccess:()=>i()})}})}export{xe as ActionsButton,va as Component,he as DeleteViewDialog,ge as useReorderViews};
