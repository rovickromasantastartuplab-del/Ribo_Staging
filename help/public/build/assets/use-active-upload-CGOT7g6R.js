import{i as b,s as g,k as S,r as l}from"./client-DtfdVV77.js";import{u,r as C}from"./file-upload-provider-B4w-VsYu.js";import{o as k}from"./open-upload-window-DE9Q8gNs.js";import{u as w}from"./shallow-BH2jDtXM.js";function h(n){return S.post("file-entries/delete",n).then(r=>r.data)}function x(){return b({mutationFn:n=>h(n),onError:n=>g(n)})}function T(){const n=x(),r=l.useRef(null),a=u(t=>t.uploadSingle),d=u(t=>t.abortUpload),c=u(t=>t.updateFileUpload),e=u(w(t=>r.current?t.fileUploads.get(r.current):null)),i=l.useCallback((t,s)=>{r.current=a(t,s)},[a]),m=l.useCallback(async t=>{const s=C(t),o=await k({types:s==null?void 0:s.allowedFileTypes});return i(o[0],t),o[0]},[i]),y=l.useCallback(({onSuccess:t,entryPath:s})=>{var p,f,F;const o=()=>{e&&c(e.file.id,{...e,entry:void 0}),t()};if(!s&&!((p=e==null?void 0:e.entry)!=null&&p.id)){o();return}n.mutate({paths:s?[s]:void 0,entryIds:(f=e==null?void 0:e.entry)!=null&&f.id?[(F=e==null?void 0:e.entry)==null?void 0:F.id]:void 0,deleteForever:!0},{onSuccess:o})},[n,e,c]),E=l.useCallback(()=>{e&&d(e.file.id)},[e,d]);return{uploadFile:i,selectAndUploadFile:m,percentage:(e==null?void 0:e.percentage)||0,uploadStatus:e==null?void 0:e.status,entry:e==null?void 0:e.entry,deleteEntry:y,isDeletingEntry:n.isPending,activeUpload:e,abortUpload:E}}export{T as u};
