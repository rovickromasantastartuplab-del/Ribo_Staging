var ur=Object.defineProperty;var lr=(t,e,r)=>e in t?ur(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B=(t,e,r)=>lr(t,typeof e!="symbol"?e+"":e,r);import{af as we,bV as He,m as Ae,k as $,cJ as ee,ct as It,n as fr,cK as Se,at as cr,cm as pr,cL as et,t as tt,w as hr,cM as dr,cN as yr,Y as mr,u as vr,r as Me,j as gr}from"./client-DtfdVV77.js";import{U as rt,a as br}from"./uploaded-file-DOXWsty7.js";import{p as _r}from"./pretty-bytes-bO14ePu9.js";import{u as wr}from"./with-selector-DPNnjGhI.js";const Lt=2097152;function nt(t,e,r){let n=t instanceof rt?t:new rt(t);return r!=null&&r.modifyUploadedFile&&(n=r.modifyUploadedFile(n)),{file:n,percentage:0,bytesUploaded:0,status:"pending",options:{...e,restrictions:Er(e)}}}function Er(t){var r;if(t.restrictions)return t.restrictions;const e=we().uploading_types[t.uploadType];return e.max_file_size||e.accept?{maxFileSize:e.max_file_size?parseInt(`${e.max_file_size}`):void 0,allowedFileTypes:(r=e.accept)==null?void 0:r.map(function(n){switch(n){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return n}})}:null}var Pe,ot;function Ur(){if(ot)return Pe;ot=1;function t(e,r){this.text=e=e||"",this.hasWild=~e.indexOf("*"),this.separator=r,this.parts=e.split(r)}return t.prototype.match=function(e){var r=!0,n=this.parts,o,i=n.length,s;if(typeof e=="string"||e instanceof String)if(!this.hasWild&&this.text!=e)r=!1;else{for(s=(e||"").split(this.separator),o=0;r&&o<i;o++)n[o]!=="*"&&(o<s.length?r=n[o]===s[o]:r=!1);r=r&&s}else if(typeof e.splice=="function")for(r=[],o=e.length;o--;)this.match(e[o])&&(r[r.length]=e[o]);else if(typeof e=="object"){r={};for(var f in e)this.match(f)&&(r[f]=e[f])}return r},Pe=function(e,r,n){var o=new t(e,n||/[\/\.]/);return typeof r<"u"?o.match(r):o},Pe}var Re,it;function Sr(){if(it)return Re;it=1;var t=Ur(),e=/[\/\+\.]/;return Re=function(r,n){function o(i){var s=t(i,r,e);return s&&s.length>=2}return n?o(n.split(";")[0]):o},Re}var Pr=Sr();const Rr=He(Pr);function Or(t,e){if(!e)return;const{maxFileSize:r,allowedFileTypes:n}=e;if(r&&t.size!=null&&t.size>r)return Ae("`:file` exceeds maximum allowed size of :size",{values:{file:t.name,size:_r(r)}});if(n!=null&&n.length&&!xr(t,n))return Ae("This file type is not allowed")}function xr(t,e){return e.map(r=>r.split(",")).flat().some(r=>{if(r.includes("/"))return t.mime?Rr(t.mime.replace(/;.*?$/,""),r):!1;const n=r.replace(".","").toLowerCase();return n&&t.extension?t.extension.toLowerCase()===n:!1})}class Tr{constructor(){B(this,"aliveTimer");B(this,"isDone",!1);B(this,"timeout",3e4);B(this,"timeoutHandler",null)}progress(){this.isDone||!this.timeoutHandler||this.timeout>0&&(clearTimeout(this.aliveTimer),this.aliveTimer=setTimeout(this.timeoutHandler,this.timeout))}done(){this.isDone||(clearTimeout(this.aliveTimer),this.aliveTimer=null,this.isDone=!0)}}class $e{constructor(e,r){B(this,"abortController");this.file=e,this.config=r,this.abortController=new AbortController}async start(){const e=new FormData,{onSuccess:r,onError:n,onProgress:o,metadata:i}=this.config;e.set("file",this.file.native),e.set("clientMime",this.file.mime),e.set("clientExtension",this.file.extension),e.set("uploadType",this.config.uploadType),e.set("backendId",this.config.backendId),i&&Object.entries(i).forEach(([f,p])=>{e.set(f,`${p}`)});const s=await $.post("file-entries",e,{onUploadProgress:f=>{f.event.lengthComputable&&(o==null||o({bytesUploaded:f.loaded,bytesTotal:f.total||0}))},signal:this.abortController.signal,headers:{"Content-Type":"multipart/form-data"}}).catch(f=>{f.code!=="ERR_CANCELED"&&(n==null||n(ee(f),this.file))});this.abortController.signal.aborted||s&&s.data.fileEntry&&(r==null||r(s.data.fileEntry,this.file))}abort(){return this.abortController.abort(),Promise.resolve()}static async create(e,r){return new $e(e,r)}}var Oe,at;function Cr(){if(at)return Oe;at=1;const t=new Set(["ENOTFOUND","ENETUNREACH","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_CRL","UNABLE_TO_DECRYPT_CERT_SIGNATURE","UNABLE_TO_DECRYPT_CRL_SIGNATURE","UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY","CERT_SIGNATURE_FAILURE","CRL_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CRL_NOT_YET_VALID","CRL_HAS_EXPIRED","ERROR_IN_CERT_NOT_BEFORE_FIELD","ERROR_IN_CERT_NOT_AFTER_FIELD","ERROR_IN_CRL_LAST_UPDATE_FIELD","ERROR_IN_CRL_NEXT_UPDATE_FIELD","OUT_OF_MEM","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","UNABLE_TO_VERIFY_LEAF_SIGNATURE","CERT_CHAIN_TOO_LONG","CERT_REVOKED","INVALID_CA","PATH_LENGTH_EXCEEDED","INVALID_PURPOSE","CERT_UNTRUSTED","CERT_REJECTED","HOSTNAME_MISMATCH"]);return Oe=e=>!t.has(e&&e.code),Oe}var kr=Cr();const Ar=He(kr),Ke="axios-retry";function Dt(t){const e=["ERR_CANCELED","ECONNABORTED"];return t.response||!t.code||e.includes(t.code)?!1:Ar(t)}const jt=["get","head","options"],Ir=jt.concat(["put","delete"]);function Ge(t){return t.code!=="ECONNABORTED"&&(!t.response||t.response.status===429||t.response.status>=500&&t.response.status<=599)}function Lr(t){var e;return(e=t.config)!=null&&e.method?Ge(t)&&jt.indexOf(t.config.method)!==-1:!1}function Ft(t){var e;return(e=t.config)!=null&&e.method?Ge(t)&&Ir.indexOf(t.config.method)!==-1:!1}function Nt(t){return Dt(t)||Ft(t)}function Ve(t=void 0){var n;const e=(n=t==null?void 0:t.response)==null?void 0:n.headers["retry-after"];if(!e)return 0;let r=(Number(e)||0)*1e3;return r===0&&(r=(new Date(e).valueOf()||0)-Date.now()),Math.max(0,r)}function Dr(t=0,e=void 0){return Math.max(0,Ve(e))}function jr(t=0,e=void 0,r=100){const n=2**t*r,o=Math.max(n,Ve(e)),i=o*.2*Math.random();return o+i}function Fr(t=100){return(e=0,r=void 0)=>{const n=e*t;return Math.max(n,Ve(r))}}const Nr={retries:3,retryCondition:Nt,retryDelay:Dr,shouldResetTimeout:!1,onRetry:()=>{},onMaxRetryTimesExceeded:()=>{},validateResponse:null};function qr(t,e){return{...Nr,...e,...t[Ke]}}function st(t,e,r=!1){const n=qr(t,e||{});return n.retryCount=n.retryCount||0,(!n.lastRequestTime||r)&&(n.lastRequestTime=Date.now()),t[Ke]=n,n}function zr(t,e){t.defaults.agent===e.agent&&delete e.agent,t.defaults.httpAgent===e.httpAgent&&delete e.httpAgent,t.defaults.httpsAgent===e.httpsAgent&&delete e.httpsAgent}async function Br(t,e){const{retries:r,retryCondition:n}=t,o=(t.retryCount||0)<r&&n(e);if(typeof o=="object")try{return await o!==!1}catch{return!1}return o}async function Hr(t,e,r,n){var p;e.retryCount+=1;const{retryDelay:o,shouldResetTimeout:i,onRetry:s}=e,f=o(e.retryCount,r);if(zr(t,n),!i&&n.timeout&&e.lastRequestTime){const y=Date.now()-e.lastRequestTime,w=n.timeout-y-f;if(w<=0)return Promise.reject(r);n.timeout=w}return n.transformRequest=[y=>y],await s(e.retryCount,r,n),(p=n.signal)!=null&&p.aborted?Promise.resolve(t(n)):new Promise(y=>{var P;const w=()=>{clearTimeout(x),y(t(n))},x=setTimeout(()=>{var k;y(t(n)),(k=n.signal)!=null&&k.removeEventListener&&n.signal.removeEventListener("abort",w)},f);(P=n.signal)!=null&&P.addEventListener&&n.signal.addEventListener("abort",w,{once:!0})})}async function Mr(t,e){t.retryCount>=t.retries&&await t.onMaxRetryTimesExceeded(e,t.retryCount)}const K=(t,e)=>{const r=t.interceptors.request.use(o=>{var i;return st(o,e,!0),(i=o[Ke])!=null&&i.validateResponse&&(o.validateStatus=()=>!1),o}),n=t.interceptors.response.use(null,async o=>{var f;const{config:i}=o;if(!i)return Promise.reject(o);const s=st(i,e);return o.response&&((f=s.validateResponse)!=null&&f.call(s,o.response))?o.response:await Br(s,o)?Hr(t,s,o,i):(await Mr(s,o),Promise.reject(o))});return{requestInterceptorId:r,responseInterceptorId:n}};K.isNetworkError=Dt;K.isSafeRequestError=Lr;K.isIdempotentRequestError=Ft;K.isNetworkOrIdempotentRequestError=Nt;K.exponentialDelay=jr;K.linearDelay=Fr;K.isRetryableError=Ge;const qt=1024*1024,$r=20*qt,Kr=10,Gr=5;class Ee{constructor(e,r){B(this,"abortController");B(this,"chunks",[]);B(this,"uploadId");B(this,"fileKey");B(this,"chunkAxios");B(this,"abortedByUser",!1);B(this,"uploadedParts");this.file=e,this.config=r,this.abortController=new AbortController,this.chunkAxios=It.create(),K(this.chunkAxios,{retries:3})}get storageKey(){return`s3-multipart::${this.file.fingerprint}`}async start(){var n,o,i,s,f;const e=fr(this.storageKey);if(e&&await this.getUploadedParts(e),!((n=this.uploadedParts)!=null&&n.length)&&(await this.createMultipartUpload(),!this.uploadId))return;if(this.prepareChunks(),await this.uploadParts()==="done"){if(!await this.completeMultipartUpload())return;try{const y=await this.createFileEntry();if(y!=null&&y.fileEntry){(i=(o=this.config).onSuccess)==null||i.call(o,y==null?void 0:y.fileEntry,this.file),Se(this.storageKey);return}}catch{}}this.abortController.signal.aborted||this.abortController.abort(),this.abortedByUser||(f=(s=this.config).onError)==null||f.call(s,null,this.file)}async abort(){this.abortedByUser=!0,this.abortController.abort(),await this.abortUploadOnS3()}async uploadParts(){const e=this.chunks.filter(n=>!n.done);if(!e.length)return Promise.resolve("done");const r=await this.batchSignUrls(e.slice(0,Kr));if(r){for(;r.length;){const o=r.splice(0,Gr).map(s=>this.uploadPartToS3(s));if(!(await Promise.all(o)).every(s=>s))return}return await this.uploadParts()}}async batchSignUrls(e){const r=await this.chunkAxios.post("api/v1/s3/multipart/batch-sign-part-urls",{backendId:this.config.backendId,uploadType:this.config.uploadType,partNumbers:e.map(n=>n.partNumber),uploadId:this.uploadId,key:this.fileKey},{signal:this.abortController.signal}).then(n=>n.data).catch(n=>{this.abortController.signal.aborted||this.abortController.abort()});return r==null?void 0:r.urls}async uploadPartToS3({url:e,partNumber:r}){const n=this.chunks.find(o=>o.partNumber===r);if(n)return this.chunkAxios.put(e,n.blob,{withCredentials:!1,signal:this.abortController.signal,onUploadProgress:o=>{var s,f;if(!o.event.lengthComputable)return;n.bytesUploaded=o.loaded;const i=this.chunks.reduce((p,y)=>p+y.bytesUploaded,0);(f=(s=this.config).onProgress)==null||f.call(s,{bytesUploaded:i,bytesTotal:this.file.size})}}).then(o=>{const i=o.headers.etag;if(i)return n.done=!0,n.etag=i,!0}).catch(o=>{!this.abortController.signal.aborted&&o!==void 0&&this.abortController.abort()})}async createMultipartUpload(){const e=await $.post("s3/multipart/create",{clientName:this.file.name,clientMime:this.file.mime,clientSize:this.file.size,clientExtension:this.file.extension,uploadType:this.config.uploadType,backendId:this.config.backendId,...this.config.metadata}).then(r=>r.data).catch(r=>{var n,o;r.code!=="ERR_CANCELED"&&((o=(n=this.config).onError)==null||o.call(n,ee(r),this.file))});e&&(this.uploadId=e.uploadId,this.fileKey=e.key,cr(this.storageKey,{createdAt:new Date().toISOString(),fileKey:this.fileKey,uploadId:this.uploadId}))}async getUploadedParts({fileKey:e,uploadId:r}){var o;const n=await $.post("s3/multipart/get-uploaded-parts",{backendId:this.config.backendId,uploadType:this.config.uploadType,key:e,uploadId:r}).then(i=>i.data).catch(()=>(Se(this.storageKey),null));(o=n==null?void 0:n.parts)!=null&&o.length&&(this.uploadedParts=n.parts,this.uploadId=r,this.fileKey=e)}async completeMultipartUpload(){return $.post("s3/multipart/complete",{backendId:this.config.backendId,uploadType:this.config.uploadType,key:this.fileKey,uploadId:this.uploadId,parts:this.chunks.map(e=>({ETag:e.etag,PartNumber:e.partNumber}))}).then(e=>e.data).catch(()=>{var e,r;(r=(e=this.config).onError)==null||r.call(e,null,this.file),this.abortUploadOnS3()}).finally(()=>{Se(this.storageKey)})}async createFileEntry(){return await $.post("s3/entries",{...this.config.metadata,clientMime:this.file.mime,clientName:this.file.name,clientSize:this.file.size,clientExtension:this.file.extension,filename:this.fileKey.split("/").pop(),uploadType:this.config.uploadType,backendId:this.config.backendId}).then(e=>e.data).catch()}prepareChunks(){var n;this.chunks=[];const e=Math.max(5*qt,Math.ceil(this.file.size/1e4)),r=Math.max($r,e);if(this.file.size===0)this.chunks.push({blob:this.file.native,done:!1,partNumber:1,bytesUploaded:0});else{let o=1;for(let i=0;i<this.file.size;i+=r){const s=Math.min(this.file.size,i+r),f=(n=this.uploadedParts)==null?void 0:n.find(p=>p.PartNumber===o);this.chunks.push({blob:this.file.native.slice(i,s),done:!!f,partNumber:o,etag:f?f.ETag:void 0,bytesUploaded:f!=null&&f.Size?parseInt(f==null?void 0:f.Size):0}),o++}}}abortUploadOnS3(){return $.post("s3/multipart/abort",{key:this.fileKey,uploadId:this.uploadId})}static async create(e,r){return new Ee(e,r)}}class Xe{constructor(e,r){B(this,"abortController");B(this,"presignedRequest");this.file=e,this.config=r,this.abortController=new AbortController}async start(){var n,o,i,s;if(this.presignedRequest=await this.presignPostUrl(),!this.presignedRequest||await this.uploadFileToS3()!=="uploaded")return;const r=await this.createFileEntry();r!=null&&r.fileEntry?(o=(n=this.config).onSuccess)==null||o.call(n,r.fileEntry,this.file):this.abortController.signal||(s=(i=this.config).onError)==null||s.call(i,null,this.file)}abort(){return this.abortController.abort(),Promise.resolve()}presignPostUrl(){return $.post("s3/simple/presign",{clientName:this.file.name,clientMime:this.file.mime,clientSize:this.file.size,clientExtension:this.file.extension,uploadType:this.config.uploadType,backendId:this.config.backendId,...this.config.metadata},{signal:this.abortController.signal}).then(e=>e.data).catch(e=>{var r,n;e.code!=="ERR_CANCELED"&&((n=(r=this.config).onError)==null||n.call(r,ee(e),this.file))})}uploadFileToS3(){const{url:e,acl:r}=this.presignedRequest;return It.put(e,this.file.native,{signal:this.abortController.signal,withCredentials:!1,headers:{"Content-Type":this.file.mime,"x-amz-acl":r},onUploadProgress:n=>{var o,i;n.event.lengthComputable&&((i=(o=this.config).onProgress)==null||i.call(o,{bytesUploaded:n.loaded,bytesTotal:n.total||0}))}}).then(()=>"uploaded").catch(n=>{var o,i;n.code!=="ERR_CANCELED"&&((i=(o=this.config).onError)==null||i.call(o,ee(n),this.file))})}async createFileEntry(){return await $.post("s3/entries",{...this.config.metadata,clientMime:this.file.mime,clientName:this.file.name,clientSize:this.file.size,clientExtension:this.file.extension,filename:this.presignedRequest.key.split("/").pop(),uploadType:this.config.uploadType,backendId:this.config.backendId}).then(e=>e.data).catch(e=>{var r,n;e.code!=="ERR_CANCELED"&&((n=(r=this.config).onError)==null||n.call(r,ee(e),this.file))})}static async create(e,r){return new Xe(e,r)}}var xe={},ut;function Vr(){return ut||(ut=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=L,t.setCookie=t.removeCookie=t.getCookie=void 0,t.stringifyOptions=P;var e=pr();function r(_,h){return f(_)||s(_,h)||o(_,h)||n()}function n(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o(_,h){if(_){if(typeof _=="string")return i(_,h);var c=Object.prototype.toString.call(_).slice(8,-1);if(c==="Object"&&_.constructor&&(c=_.constructor.name),c==="Map"||c==="Set")return Array.from(_);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return i(_,h)}}function i(_,h){(h==null||h>_.length)&&(h=_.length);for(var c=0,d=new Array(h);c<h;c++)d[c]=_[c];return d}function s(_,h){var c=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(c!=null){var d=[],m=!0,S=!1,U,C;try{for(c=c.call(_);!(m=(U=c.next()).done)&&(d.push(U.value),!(h&&d.length===h));m=!0);}catch(R){S=!0,C=R}finally{try{!m&&c.return!=null&&c.return()}finally{if(S)throw C}}return d}}function f(_){if(Array.isArray(_))return _}function p(_,h){var c=Object.keys(_);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(_);h&&(d=d.filter(function(m){return Object.getOwnPropertyDescriptor(_,m).enumerable})),c.push.apply(c,d)}return c}function y(_){for(var h=1;h<arguments.length;h++){var c=arguments[h]!=null?arguments[h]:{};h%2?p(Object(c),!0).forEach(function(d){w(_,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(c)):p(Object(c)).forEach(function(d){Object.defineProperty(_,d,Object.getOwnPropertyDescriptor(c,d))})}return _}function w(_,h,c){return h in _?Object.defineProperty(_,h,{value:c,enumerable:!0,configurable:!0,writable:!0}):_[h]=c,_}var x=typeof window<"u";function P(_){return Object.keys(_).reduce(function(h,c){return c==="days"||_[c]===!1?h:_[c]===!0?"".concat(h,"; ").concat(c):"".concat(h,"; ").concat(c,"=").concat(_[c])},"")}var k=function(h,c,d){if(x){var m=y({days:7,path:"/"},d),S=new Date(Date.now()+m.days*864e5).toUTCString();document.cookie=h+"="+encodeURIComponent(c)+"; expires="+S+P(m)}};t.setCookie=k;var D=function(h){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return x&&document.cookie.split("; ").reduce(function(d,m){var S=m.split("=");return S[0]===h?decodeURIComponent(S[1]):d},"")||c};t.getCookie=D;var T=function(h){document.cookie="".concat(h,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")};t.removeCookie=T;function L(_,h){var c=(0,e.useState)(function(){return D(_,h)}),d=r(c,2),m=d[0],S=d[1],U=(0,e.useCallback)(function(){S(void 0),T(_)},[_]),C=(0,e.useCallback)(function(R,N){S(R),k(_,R,N)},[_]);return[m,C,U]}})(xe)),xe}var Xr=Vr();function Ie(t){"@babel/helpers - typeof";return Ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ie(t)}function Yr(t,e,r){return Object.defineProperty(t,"prototype",{writable:!1}),t}function Wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e,r){return e=se(e),Zr(t,Ye()?Reflect.construct(e,r||[],se(t).constructor):e.apply(t,r))}function Zr(t,e){if(e&&(Ie(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jr(t)}function Jr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function en(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}function Le(t){var e=typeof Map=="function"?new Map:void 0;return Le=function(n){if(n===null||!rn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,o)}function o(){return tn(n,arguments,se(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),ae(o,n)},Le(t)}function tn(t,e,r){if(Ye())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&ae(o,r.prototype),o}function Ye(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ye=function(){return!!t})()}function rn(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function ae(t,e){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},ae(t,e)}function se(t){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},se(t)}var he=(function(t){function e(r){var n,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(Wr(this,e),n=Qr(this,e,[r]),n.originalRequest=i,n.originalResponse=s,n.causingError=o,o!=null&&(r+=", caused by ".concat(o.toString())),i!=null){var f=i.getHeader("X-Request-ID")||"n/a",p=i.getMethod(),y=i.getURL(),w=s?s.getStatus():"n/a",x=s?s.getBody()||"":"n/a";r+=", originated from request (method: ".concat(p,", url: ").concat(y,", response code: ").concat(w,", response text: ").concat(x,", request id: ").concat(f,")")}return n.message=r,n}return en(e,t),Yr(e)})(Le(Error));function ue(t){"@babel/helpers - typeof";return ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(t)}function nn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function on(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,sn(n.key),n)}}function an(t,e,r){return e&&on(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function sn(t){var e=un(t,"string");return ue(e)=="symbol"?e:e+""}function un(t,e){if(ue(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(ue(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ln=(function(){function t(){nn(this,t)}return an(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(r){return Promise.resolve([])}},{key:"removeUpload",value:function(r){return Promise.resolve()}},{key:"addUpload",value:function(r,n){return Promise.resolve(null)}}])})();const zt="3.7.8",fn=zt,ne=typeof Buffer=="function",lt=typeof TextDecoder=="function"?new TextDecoder:void 0,ft=typeof TextEncoder=="function"?new TextEncoder:void 0,cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",oe=Array.prototype.slice.call(cn),de=(t=>{let e={};return t.forEach((r,n)=>e[r]=n),e})(oe),pn=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,F=String.fromCharCode.bind(String),ct=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Bt=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Ht=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Mt=t=>{let e,r,n,o,i="";const s=t.length%3;for(let f=0;f<t.length;){if((r=t.charCodeAt(f++))>255||(n=t.charCodeAt(f++))>255||(o=t.charCodeAt(f++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|o,i+=oe[e>>18&63]+oe[e>>12&63]+oe[e>>6&63]+oe[e&63]}return s?i.slice(0,s-3)+"===".substring(s):i},We=typeof btoa=="function"?t=>btoa(t):ne?t=>Buffer.from(t,"binary").toString("base64"):Mt,De=ne?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let n=0,o=t.length;n<o;n+=4096)r.push(F.apply(null,t.subarray(n,n+4096)));return We(r.join(""))},me=(t,e=!1)=>e?Bt(De(t)):De(t),hn=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?F(192|e>>>6)+F(128|e&63):F(224|e>>>12&15)+F(128|e>>>6&63)+F(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return F(240|e>>>18&7)+F(128|e>>>12&63)+F(128|e>>>6&63)+F(128|e&63)}},dn=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,$t=t=>t.replace(dn,hn),pt=ne?t=>Buffer.from(t,"utf8").toString("base64"):ft?t=>De(ft.encode(t)):t=>We($t(t)),te=(t,e=!1)=>e?Bt(pt(t)):pt(t),ht=t=>te(t,!0),yn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,mn=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return F((r>>>10)+55296)+F((r&1023)+56320);case 3:return F((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return F((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Kt=t=>t.replace(yn,mn),Gt=t=>{if(t=t.replace(/\s+/g,""),!pn.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r,n,o=[];for(let i=0;i<t.length;)e=de[t.charAt(i++)]<<18|de[t.charAt(i++)]<<12|(r=de[t.charAt(i++)])<<6|(n=de[t.charAt(i++)]),r===64?o.push(F(e>>16&255)):n===64?o.push(F(e>>16&255,e>>8&255)):o.push(F(e>>16&255,e>>8&255,e&255));return o.join("")},Qe=typeof atob=="function"?t=>atob(Ht(t)):ne?t=>Buffer.from(t,"base64").toString("binary"):Gt,Vt=ne?t=>ct(Buffer.from(t,"base64")):t=>ct(Qe(t).split("").map(e=>e.charCodeAt(0))),Xt=t=>Vt(Yt(t)),vn=ne?t=>Buffer.from(t,"base64").toString("utf8"):lt?t=>lt.decode(Vt(t)):t=>Kt(Qe(t)),Yt=t=>Ht(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),je=t=>vn(Yt(t)),gn=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Wt=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Qt=function(){const t=(e,r)=>Object.defineProperty(String.prototype,e,Wt(r));t("fromBase64",function(){return je(this)}),t("toBase64",function(e){return te(this,e)}),t("toBase64URI",function(){return te(this,!0)}),t("toBase64URL",function(){return te(this,!0)}),t("toUint8Array",function(){return Xt(this)})},Zt=function(){const t=(e,r)=>Object.defineProperty(Uint8Array.prototype,e,Wt(r));t("toBase64",function(e){return me(this,e)}),t("toBase64URI",function(){return me(this,!0)}),t("toBase64URL",function(){return me(this,!0)})},bn=()=>{Qt(),Zt()},_n={version:zt,VERSION:fn,atob:Qe,atobPolyfill:Gt,btoa:We,btoaPolyfill:Mt,fromBase64:je,toBase64:te,encode:te,encodeURI:ht,encodeURL:ht,utob:$t,btou:Kt,decode:je,isValid:gn,fromUint8Array:me,toUint8Array:Xt,extendString:Qt,extendUint8Array:Zt,extendBuiltins:bn};var Te,dt;function wn(){return dt||(dt=1,Te=function(e,r){if(r=r.split(":")[0],e=+e,!e)return!1;switch(r){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}),Te}var ye={},yt;function En(){if(yt)return ye;yt=1;var t=Object.prototype.hasOwnProperty,e;function r(s){try{return decodeURIComponent(s.replace(/\+/g," "))}catch{return null}}function n(s){try{return encodeURIComponent(s)}catch{return null}}function o(s){for(var f=/([^=?#&]+)=?([^&]*)/g,p={},y;y=f.exec(s);){var w=r(y[1]),x=r(y[2]);w===null||x===null||w in p||(p[w]=x)}return p}function i(s,f){f=f||"";var p=[],y,w;typeof f!="string"&&(f="?");for(w in s)if(t.call(s,w)){if(y=s[w],!y&&(y===null||y===e||isNaN(y))&&(y=""),w=n(w),y=n(y),w===null||y===null)continue;p.push(w+"="+y)}return p.length?f+p.join("&"):""}return ye.stringify=i,ye.parse=o,ye}var Ce,mt;function Un(){if(mt)return Ce;mt=1;var t=wn(),e=En(),r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,n=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i=/:\d+$/,s=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,f=/^[a-zA-Z]:/;function p(h){return(h||"").toString().replace(r,"")}var y=[["#","hash"],["?","query"],function(c,d){return P(d.protocol)?c.replace(/\\/g,"/"):c},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],w={hash:1,query:1};function x(h){var c;typeof window<"u"?c=window:typeof et<"u"?c=et:typeof self<"u"?c=self:c={};var d=c.location||{};h=h||d;var m={},S=typeof h,U;if(h.protocol==="blob:")m=new T(unescape(h.pathname),{});else if(S==="string"){m=new T(h,{});for(U in w)delete m[U]}else if(S==="object"){for(U in h)U in w||(m[U]=h[U]);m.slashes===void 0&&(m.slashes=o.test(h.href))}return m}function P(h){return h==="file:"||h==="ftp:"||h==="http:"||h==="https:"||h==="ws:"||h==="wss:"}function k(h,c){h=p(h),h=h.replace(n,""),c=c||{};var d=s.exec(h),m=d[1]?d[1].toLowerCase():"",S=!!d[2],U=!!d[3],C=0,R;return S?U?(R=d[2]+d[3]+d[4],C=d[2].length+d[3].length):(R=d[2]+d[4],C=d[2].length):U?(R=d[3]+d[4],C=d[3].length):R=d[4],m==="file:"?C>=2&&(R=R.slice(2)):P(m)?R=d[4]:m?S&&(R=R.slice(2)):C>=2&&P(c.protocol)&&(R=d[4]),{protocol:m,slashes:S||P(m),slashesCount:C,rest:R}}function D(h,c){if(h==="")return c;for(var d=(c||"/").split("/").slice(0,-1).concat(h.split("/")),m=d.length,S=d[m-1],U=!1,C=0;m--;)d[m]==="."?d.splice(m,1):d[m]===".."?(d.splice(m,1),C++):C&&(m===0&&(U=!0),d.splice(m,1),C--);return U&&d.unshift(""),(S==="."||S==="..")&&d.push(""),d.join("/")}function T(h,c,d){if(h=p(h),h=h.replace(n,""),!(this instanceof T))return new T(h,c,d);var m,S,U,C,R,N,M=y.slice(),Y=typeof c,E=this,H=0;for(Y!=="object"&&Y!=="string"&&(d=c,c=null),d&&typeof d!="function"&&(d=e.parse),c=x(c),S=k(h||"",c),m=!S.protocol&&!S.slashes,E.slashes=S.slashes||m&&c.slashes,E.protocol=S.protocol||c.protocol||"",h=S.rest,(S.protocol==="file:"&&(S.slashesCount!==2||f.test(h))||!S.slashes&&(S.protocol||S.slashesCount<2||!P(E.protocol)))&&(M[3]=[/(.*)/,"pathname"]);H<M.length;H++){if(C=M[H],typeof C=="function"){h=C(h,E);continue}U=C[0],N=C[1],U!==U?E[N]=h:typeof U=="string"?(R=U==="@"?h.lastIndexOf(U):h.indexOf(U),~R&&(typeof C[2]=="number"?(E[N]=h.slice(0,R),h=h.slice(R+C[2])):(E[N]=h.slice(R),h=h.slice(0,R)))):(R=U.exec(h))&&(E[N]=R[1],h=h.slice(0,R.index)),E[N]=E[N]||m&&C[3]&&c[N]||"",C[4]&&(E[N]=E[N].toLowerCase())}d&&(E.query=d(E.query)),m&&c.slashes&&E.pathname.charAt(0)!=="/"&&(E.pathname!==""||c.pathname!=="")&&(E.pathname=D(E.pathname,c.pathname)),E.pathname.charAt(0)!=="/"&&P(E.protocol)&&(E.pathname="/"+E.pathname),t(E.port,E.protocol)||(E.host=E.hostname,E.port=""),E.username=E.password="",E.auth&&(R=E.auth.indexOf(":"),~R?(E.username=E.auth.slice(0,R),E.username=encodeURIComponent(decodeURIComponent(E.username)),E.password=E.auth.slice(R+1),E.password=encodeURIComponent(decodeURIComponent(E.password))):E.username=encodeURIComponent(decodeURIComponent(E.auth)),E.auth=E.password?E.username+":"+E.password:E.username),E.origin=E.protocol!=="file:"&&P(E.protocol)&&E.host?E.protocol+"//"+E.host:"null",E.href=E.toString()}function L(h,c,d){var m=this;switch(h){case"query":typeof c=="string"&&c.length&&(c=(d||e.parse)(c)),m[h]=c;break;case"port":m[h]=c,t(c,m.protocol)?c&&(m.host=m.hostname+":"+c):(m.host=m.hostname,m[h]="");break;case"hostname":m[h]=c,m.port&&(c+=":"+m.port),m.host=c;break;case"host":m[h]=c,i.test(c)?(c=c.split(":"),m.port=c.pop(),m.hostname=c.join(":")):(m.hostname=c,m.port="");break;case"protocol":m.protocol=c.toLowerCase(),m.slashes=!d;break;case"pathname":case"hash":if(c){var S=h==="pathname"?"/":"#";m[h]=c.charAt(0)!==S?S+c:c}else m[h]=c;break;case"username":case"password":m[h]=encodeURIComponent(c);break;case"auth":var U=c.indexOf(":");~U?(m.username=c.slice(0,U),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=c.slice(U+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(c))}for(var C=0;C<y.length;C++){var R=y[C];R[4]&&(m[R[1]]=m[R[1]].toLowerCase())}return m.auth=m.password?m.username+":"+m.password:m.username,m.origin=m.protocol!=="file:"&&P(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString(),m}function _(h){(!h||typeof h!="function")&&(h=e.stringify);var c,d=this,m=d.host,S=d.protocol;S&&S.charAt(S.length-1)!==":"&&(S+=":");var U=S+(d.protocol&&d.slashes||P(d.protocol)?"//":"");return d.username?(U+=d.username,d.password&&(U+=":"+d.password),U+="@"):d.password?(U+=":"+d.password,U+="@"):d.protocol!=="file:"&&P(d.protocol)&&!m&&d.pathname!=="/"&&(U+="@"),(m[m.length-1]===":"||i.test(d.hostname)&&!d.port)&&(m+=":"),U+=m+d.pathname,c=typeof d.query=="object"?h(d.query):d.query,c&&(U+=c.charAt(0)!=="?"?"?"+c:c),d.hash&&(U+=d.hash),U}return T.prototype={set:L,toString:_},T.extractProtocol=k,T.location=x,T.trimLeft=p,T.qs=e,Ce=T,Ce}var Sn=Un();const Pn=He(Sn);function Rn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,r=t==="x"?e:e&3|8;return r.toString(16)})}function Fe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(l,a,u){l[a]=u.value},i=typeof Symbol=="function"?Symbol:{},s=i.iterator||"@@iterator",f=i.asyncIterator||"@@asyncIterator",p=i.toStringTag||"@@toStringTag";function y(l,a,u){return Object.defineProperty(l,a,{value:u,enumerable:!0,configurable:!0,writable:!0}),l[a]}try{y({},"")}catch{y=function(u,v,b){return u[v]=b}}function w(l,a,u,v){var b=a&&a.prototype instanceof _?a:_,g=Object.create(b.prototype),O=new H(v||[]);return o(g,"_invoke",{value:N(l,u,O)}),g}function x(l,a,u){try{return{type:"normal",arg:l.call(a,u)}}catch(v){return{type:"throw",arg:v}}}e.wrap=w;var P="suspendedStart",k="suspendedYield",D="executing",T="completed",L={};function _(){}function h(){}function c(){}var d={};y(d,s,function(){return this});var m=Object.getPrototypeOf,S=m&&m(m(G([])));S&&S!==r&&n.call(S,s)&&(d=S);var U=c.prototype=_.prototype=Object.create(d);function C(l){["next","throw","return"].forEach(function(a){y(l,a,function(u){return this._invoke(a,u)})})}function R(l,a){function u(b,g,O,A){var I=x(l[b],l,g);if(I.type!=="throw"){var q=I.arg,j=q.value;return j&&V(j)=="object"&&n.call(j,"__await")?a.resolve(j.__await).then(function(z){u("next",z,O,A)},function(z){u("throw",z,O,A)}):a.resolve(j).then(function(z){q.value=z,O(q)},function(z){return u("throw",z,O,A)})}A(I.arg)}var v;o(this,"_invoke",{value:function(g,O){function A(){return new a(function(I,q){u(g,O,I,q)})}return v=v?v.then(A,A):A()}})}function N(l,a,u){var v=P;return function(b,g){if(v===D)throw Error("Generator is already running");if(v===T){if(b==="throw")throw g;return{value:t,done:!0}}for(u.method=b,u.arg=g;;){var O=u.delegate;if(O){var A=M(O,u);if(A){if(A===L)continue;return A}}if(u.method==="next")u.sent=u._sent=u.arg;else if(u.method==="throw"){if(v===P)throw v=T,u.arg;u.dispatchException(u.arg)}else u.method==="return"&&u.abrupt("return",u.arg);v=D;var I=x(l,a,u);if(I.type==="normal"){if(v=u.done?T:k,I.arg===L)continue;return{value:I.arg,done:u.done}}I.type==="throw"&&(v=T,u.method="throw",u.arg=I.arg)}}}function M(l,a){var u=a.method,v=l.iterator[u];if(v===t)return a.delegate=null,u==="throw"&&l.iterator.return&&(a.method="return",a.arg=t,M(l,a),a.method==="throw")||u!=="return"&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+u+"' method")),L;var b=x(v,l.iterator,a.arg);if(b.type==="throw")return a.method="throw",a.arg=b.arg,a.delegate=null,L;var g=b.arg;return g?g.done?(a[l.resultName]=g.value,a.next=l.nextLoc,a.method!=="return"&&(a.method="next",a.arg=t),a.delegate=null,L):g:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,L)}function Y(l){var a={tryLoc:l[0]};1 in l&&(a.catchLoc=l[1]),2 in l&&(a.finallyLoc=l[2],a.afterLoc=l[3]),this.tryEntries.push(a)}function E(l){var a=l.completion||{};a.type="normal",delete a.arg,l.completion=a}function H(l){this.tryEntries=[{tryLoc:"root"}],l.forEach(Y,this),this.reset(!0)}function G(l){if(l||l===""){var a=l[s];if(a)return a.call(l);if(typeof l.next=="function")return l;if(!isNaN(l.length)){var u=-1,v=function b(){for(;++u<l.length;)if(n.call(l,u))return b.value=l[u],b.done=!1,b;return b.value=t,b.done=!0,b};return v.next=v}}throw new TypeError(V(l)+" is not iterable")}return h.prototype=c,o(U,"constructor",{value:c,configurable:!0}),o(c,"constructor",{value:h,configurable:!0}),h.displayName=y(c,p,"GeneratorFunction"),e.isGeneratorFunction=function(l){var a=typeof l=="function"&&l.constructor;return!!a&&(a===h||(a.displayName||a.name)==="GeneratorFunction")},e.mark=function(l){return Object.setPrototypeOf?Object.setPrototypeOf(l,c):(l.__proto__=c,y(l,p,"GeneratorFunction")),l.prototype=Object.create(U),l},e.awrap=function(l){return{__await:l}},C(R.prototype),y(R.prototype,f,function(){return this}),e.AsyncIterator=R,e.async=function(l,a,u,v,b){b===void 0&&(b=Promise);var g=new R(w(l,a,u,v),b);return e.isGeneratorFunction(a)?g:g.next().then(function(O){return O.done?O.value:g.next()})},C(U),y(U,p,"Generator"),y(U,s,function(){return this}),y(U,"toString",function(){return"[object Generator]"}),e.keys=function(l){var a=Object(l),u=[];for(var v in a)u.push(v);return u.reverse(),function b(){for(;u.length;){var g=u.pop();if(g in a)return b.value=g,b.done=!1,b}return b.done=!0,b}},e.values=G,H.prototype={constructor:H,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!a)for(var u in this)u.charAt(0)==="t"&&n.call(this,u)&&!isNaN(+u.slice(1))&&(this[u]=t)},stop:function(){this.done=!0;var a=this.tryEntries[0].completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(a){if(this.done)throw a;var u=this;function v(q,j){return O.type="throw",O.arg=a,u.next=q,j&&(u.method="next",u.arg=t),!!j}for(var b=this.tryEntries.length-1;b>=0;--b){var g=this.tryEntries[b],O=g.completion;if(g.tryLoc==="root")return v("end");if(g.tryLoc<=this.prev){var A=n.call(g,"catchLoc"),I=n.call(g,"finallyLoc");if(A&&I){if(this.prev<g.catchLoc)return v(g.catchLoc,!0);if(this.prev<g.finallyLoc)return v(g.finallyLoc)}else if(A){if(this.prev<g.catchLoc)return v(g.catchLoc,!0)}else{if(!I)throw Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return v(g.finallyLoc)}}}},abrupt:function(a,u){for(var v=this.tryEntries.length-1;v>=0;--v){var b=this.tryEntries[v];if(b.tryLoc<=this.prev&&n.call(b,"finallyLoc")&&this.prev<b.finallyLoc){var g=b;break}}g&&(a==="break"||a==="continue")&&g.tryLoc<=u&&u<=g.finallyLoc&&(g=null);var O=g?g.completion:{};return O.type=a,O.arg=u,g?(this.method="next",this.next=g.finallyLoc,L):this.complete(O)},complete:function(a,u){if(a.type==="throw")throw a.arg;return a.type==="break"||a.type==="continue"?this.next=a.arg:a.type==="return"?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):a.type==="normal"&&u&&(this.next=u),L},finish:function(a){for(var u=this.tryEntries.length-1;u>=0;--u){var v=this.tryEntries[u];if(v.finallyLoc===a)return this.complete(v.completion,v.afterLoc),E(v),L}},catch:function(a){for(var u=this.tryEntries.length-1;u>=0;--u){var v=this.tryEntries[u];if(v.tryLoc===a){var b=v.completion;if(b.type==="throw"){var g=b.arg;E(v)}return g}}throw Error("illegal catch attempt")},delegateYield:function(a,u,v){return this.delegate={iterator:G(a),resultName:u,nextLoc:v},this.method==="next"&&(this.arg=t),L}},e}function vt(t,e,r,n,o,i,s){try{var f=t[i](s),p=f.value}catch(y){r(y);return}f.done?e(p):Promise.resolve(p).then(n,o)}function On(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function s(p){vt(i,n,o,s,f,"next",p)}function f(p){vt(i,n,o,s,f,"throw",p)}s(void 0)})}}function Jt(t,e){return Cn(t)||Tn(t,e)||er(t,e)||xn()}function xn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tn(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,o,i,s,f=[],p=!0,y=!1;try{if(i=(r=r.call(t)).next,e!==0)for(;!(p=(n=i.call(r)).done)&&(f.push(n.value),f.length!==e);p=!0);}catch(w){y=!0,o=w}finally{try{if(!p&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(y)throw o}}return f}}function Cn(t){if(Array.isArray(t))return t}function V(t){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(t)}function kn(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=er(t))||e){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,f;return{s:function(){r=r.call(t)},n:function(){var y=r.next();return i=y.done,y},e:function(y){s=!0,f=y},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw f}}}}function er(t,e){if(t){if(typeof t=="string")return gt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gt(t,e)}}function gt(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function W(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bt(Object(r),!0).forEach(function(n){An(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function An(t,e,r){return e=tr(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function In(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tr(n.key),n)}}function Ln(t,e,r){return e&&_t(t.prototype,e),r&&_t(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tr(t){var e=Dn(t,"string");return V(e)=="symbol"?e:e+""}function Dn(t,e){if(V(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(V(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ve="tus-v1",ge="ietf-draft-03",ie="ietf-draft-05",jn={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:rr,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:ve},be=(function(){function t(e,r){In(this,t),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return Ln(t,[{key:"findPreviousUploads",value:function(){var r=this;return this.options.fingerprint(this.file,this.options).then(function(n){return r._urlStorage.findUploadsByFingerprint(n)})}},{key:"resumeFromPreviousUpload",value:function(r){this.url=r.uploadUrl||null,this._parallelUploadUrls=r.parallelUploadUrls||null,this._urlStorageKey=r.urlStorageKey}},{key:"start",value:function(){var r=this,n=this.file;if(!n){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![ve,ge,ie].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var i=0,s=["uploadUrl","uploadSize","uploadLengthDeferred"];i<s.length;i++){var f=s[i];if(this.options[f]){this._emitError(new Error("tus: cannot use the ".concat(f," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(n,this.options).then(function(p){return r._fingerprint=p,r._source?r._source:r.options.fileReader.openFile(n,r.options.chunkSize)}).then(function(p){if(r._source=p,r.options.uploadLengthDeferred)r._size=null;else if(r.options.uploadSize!=null){if(r._size=Number(r.options.uploadSize),Number.isNaN(r._size)){r._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(r._size=r._source.size,r._size==null){r._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}r.options.parallelUploads>1||r._parallelUploadUrls!=null?r._startParallelUpload():r._startSingleUpload()}).catch(function(p){r._emitError(p)})}},{key:"_startParallelUpload",value:function(){var r,n=this,o=this._size,i=0;this._parallelUploads=[];var s=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,f=(r=this.options.parallelUploadBoundaries)!==null&&r!==void 0?r:Nn(this._source.size,s);this._parallelUploadUrls&&f.forEach(function(w,x){w.uploadUrl=n._parallelUploadUrls[x]||null}),this._parallelUploadUrls=new Array(f.length);var p=f.map(function(w,x){var P=0;return n._source.slice(w.start,w.end).then(function(k){var D=k.value;return new Promise(function(T,L){var _=W(W({},n.options),{},{uploadUrl:w.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:W(W({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:T,onError:L,onProgress:function(d){i=i-P+d,P=d,n._emitProgress(i,o)},onUploadUrlAvailable:function(){n._parallelUploadUrls[x]=h.url,n._parallelUploadUrls.filter(function(d){return!!d}).length===f.length&&n._saveUploadInUrlStorage()}}),h=new t(D,_);h.start(),n._parallelUploads.push(h)})})}),y;Promise.all(p).then(function(){y=n._openRequest("POST",n.options.endpoint),y.setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var w=wt(n.options.metadata);return w!==""&&y.setHeader("Upload-Metadata",w),n._sendRequest(y,null)}).then(function(w){if(!Z(w.getStatus(),200)){n._emitHttpError(y,w,"tus: unexpected response while creating upload");return}var x=w.getHeader("Location");if(x==null){n._emitHttpError(y,w,"tus: invalid or missing Location header");return}n.url=Pt(n.options.endpoint,x),"Created upload at ".concat(n.url),n._emitSuccess(w)}).catch(function(w){n._emitError(w)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(r){var n=this;if(this._parallelUploads!=null){var o=kn(this._parallelUploads),i;try{for(o.s();!(i=o.n()).done;){var s=i.value;s.abort(r)}}catch(f){o.e(f)}finally{o.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!r||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(r,n,o,i){this._emitError(new he(o,i,r,n))}},{key:"_emitError",value:function(r){var n=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),St(r,this._retryAttempt,this.options)){var i=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){n.start()},i);return}}if(typeof this.options.onError=="function")this.options.onError(r);else throw r}}},{key:"_emitSuccess",value:function(r){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:r})}},{key:"_emitProgress",value:function(r,n){typeof this.options.onProgress=="function"&&this.options.onProgress(r,n)}},{key:"_emitChunkComplete",value:function(r,n,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(r,n,o)}},{key:"_createUpload",value:function(){var r=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var n=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?n.setHeader("Upload-Defer-Length","1"):n.setHeader("Upload-Length","".concat(this._size));var o=wt(this.options.metadata);o!==""&&n.setHeader("Upload-Metadata",o);var i;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,i=this._addChunkToRequest(n)):((this.options.protocol===ge||this.options.protocol===ie)&&n.setHeader("Upload-Complete","?0"),i=this._sendRequest(n,null)),i.then(function(s){if(!Z(s.getStatus(),200)){r._emitHttpError(n,s,"tus: unexpected response while creating upload");return}var f=s.getHeader("Location");if(f==null){r._emitHttpError(n,s,"tus: invalid or missing Location header");return}if(r.url=Pt(r.options.endpoint,f),"Created upload at ".concat(r.url),typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._size===0){r._emitSuccess(s),r._source.close();return}r._saveUploadInUrlStorage().then(function(){r.options.uploadDataDuringCreation?r._handleUploadResponse(n,s):(r._offset=0,r._performUpload())})}).catch(function(s){r._emitHttpError(n,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var r=this,n=this._openRequest("HEAD",this.url),o=this._sendRequest(n,null);o.then(function(i){var s=i.getStatus();if(!Z(s,200)){if(s===423){r._emitHttpError(n,i,"tus: upload is currently locked; retry later");return}if(Z(s,400)&&r._removeFromUrlStorage(),!r.options.endpoint){r._emitHttpError(n,i,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}r.url=null,r._createUpload();return}var f=Number.parseInt(i.getHeader("Upload-Offset"),10);if(Number.isNaN(f)){r._emitHttpError(n,i,"tus: invalid or missing offset value");return}var p=Number.parseInt(i.getHeader("Upload-Length"),10);if(Number.isNaN(p)&&!r.options.uploadLengthDeferred&&r.options.protocol===ve){r._emitHttpError(n,i,"tus: invalid or missing length value");return}typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._saveUploadInUrlStorage().then(function(){if(f===p){r._emitProgress(p,p),r._emitSuccess(i);return}r._offset=f,r._performUpload()})}).catch(function(i){r._emitHttpError(n,null,"tus: failed to resume upload",i)})}},{key:"_performUpload",value:function(){var r=this;if(!this._aborted){var n;this.options.overridePatchMethod?(n=this._openRequest("POST",this.url),n.setHeader("X-HTTP-Method-Override","PATCH")):n=this._openRequest("PATCH",this.url),n.setHeader("Upload-Offset","".concat(this._offset));var o=this._addChunkToRequest(n);o.then(function(i){if(!Z(i.getStatus(),200)){r._emitHttpError(n,i,"tus: unexpected response while uploading chunk");return}r._handleUploadResponse(n,i)}).catch(function(i){r._aborted||r._emitHttpError(n,null,"tus: failed to upload chunk at offset ".concat(r._offset),i)})}}},{key:"_addChunkToRequest",value:function(r){var n=this,o=this._offset,i=this._offset+this.options.chunkSize;return r.setProgressHandler(function(s){n._emitProgress(o+s,n._size)}),this.options.protocol===ve?r.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===ie&&r.setHeader("Content-Type","application/partial-upload"),(i===Number.POSITIVE_INFINITY||i>this._size)&&!this.options.uploadLengthDeferred&&(i=this._size),this._source.slice(o,i).then(function(s){var f=s.value,p=s.done,y=f!=null&&f.size?f.size:0;n.options.uploadLengthDeferred&&p&&(n._size=n._offset+y,r.setHeader("Upload-Length","".concat(n._size)));var w=n._offset+y;return!n.options.uploadLengthDeferred&&p&&w!==n._size?Promise.reject(new Error("upload was configured with a size of ".concat(n._size," bytes, but the source is done after ").concat(w," bytes"))):f===null?n._sendRequest(r):((n.options.protocol===ge||n.options.protocol===ie)&&r.setHeader("Upload-Complete",p?"?1":"?0"),n._emitProgress(n._offset,n._size),n._sendRequest(r,f))})}},{key:"_handleUploadResponse",value:function(r,n){var o=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(r,n,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(n),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(r,n){var o=Et(r,n,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var r=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(n){r._emitError(n)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var r=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var n={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?n.parallelUploadUrls=this._parallelUploadUrls:n.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,n).then(function(o){r._urlStorageKey=o})}},{key:"_sendRequest",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Ut(r,n,this.options)}}],[{key:"terminate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=Et("DELETE",r,n);return Ut(o,null,n).then(function(i){if(i.getStatus()!==204)throw new he("tus: unexpected response while terminating upload",null,o,i)}).catch(function(i){if(i instanceof he||(i=new he("tus: failed to terminate upload",i,o,null)),!St(i,0,n))throw i;var s=n.retryDelays[0],f=n.retryDelays.slice(1),p=W(W({},n),{},{retryDelays:f});return new Promise(function(y){return setTimeout(y,s)}).then(function(){return t.terminate(r,p)})})}}])})();function wt(t){return Object.entries(t).map(function(e){var r=Jt(e,2),n=r[0],o=r[1];return"".concat(n," ").concat(_n.encode(String(o)))}).join(",")}function Z(t,e){return t>=e&&t<e+100}function Et(t,e,r){var n=r.httpStack.createRequest(t,e);r.protocol===ge?n.setHeader("Upload-Draft-Interop-Version","5"):r.protocol===ie?n.setHeader("Upload-Draft-Interop-Version","6"):n.setHeader("Tus-Resumable","1.0.0");for(var o=r.headers||{},i=0,s=Object.entries(o);i<s.length;i++){var f=Jt(s[i],2),p=f[0],y=f[1];n.setHeader(p,y)}if(r.addRequestId){var w=Rn();n.setHeader("X-Request-ID",w)}return n}function Ut(t,e,r){return Ne.apply(this,arguments)}function Ne(){return Ne=On(Fe().mark(function t(e,r,n){var o;return Fe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(typeof n.onBeforeRequest!="function"){s.next=3;break}return s.next=3,n.onBeforeRequest(e);case 3:return s.next=5,e.send(r);case 5:if(o=s.sent,typeof n.onAfterResponse!="function"){s.next=9;break}return s.next=9,n.onAfterResponse(e,o);case 9:return s.abrupt("return",o);case 10:case"end":return s.stop()}},t)})),Ne.apply(this,arguments)}function Fn(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function St(t,e,r){return r.retryDelays==null||e>=r.retryDelays.length||t.originalRequest==null?!1:r&&typeof r.onShouldRetry=="function"?r.onShouldRetry(t,e,r):rr(t)}function rr(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!Z(e,400)||e===409||e===423)&&Fn()}function Pt(t,e){return new Pn(e,t).toString()}function Nn(t,e){for(var r=Math.floor(t/e),n=[],o=0;o<e;o++)n.push({start:r*o,end:r*(o+1)});return n[e-1].end=t,n}be.defaultOptions=jn;var nr=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function qn(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var o=n.response;e(o)},n.onerror=function(o){r(o)},n.open("GET",t),n.send()})}var zn=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function Bn(t){return new Promise(function(e,r){var n=new FileReader;n.onload=function(){var o=new Uint8Array(n.result);e({value:o})},n.onerror=function(o){r(o)},n.readAsArrayBuffer(t)})}function le(t){"@babel/helpers - typeof";return le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(t)}function Hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Kn(n.key),n)}}function $n(t,e,r){return e&&Mn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kn(t){var e=Gn(t,"string");return le(e)=="symbol"?e:e+""}function Gn(t,e){if(le(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(le(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Rt=(function(){function t(e){Hn(this,t),this._file=e,this.size=e.size}return $n(t,[{key:"slice",value:function(r,n){if(zn())return Bn(this._file.slice(r,n));var o=this._file.slice(r,n),i=n>=this.size;return Promise.resolve({value:o,done:i})}},{key:"close",value:function(){}}])})();function fe(t){"@babel/helpers - typeof";return fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(t)}function Vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wn(n.key),n)}}function Yn(t,e,r){return e&&Xn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wn(t){var e=Qn(t,"string");return fe(e)=="symbol"?e:e+""}function Qn(t,e){if(fe(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(fe(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function Ot(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function Zn(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}throw new Error("Unknown data type")}var Jn=(function(){function t(e){Vn(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return Yn(t,[{key:"slice",value:function(r,n){return r<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(r,n)}},{key:"_readUntilEnoughDataOrDone",value:function(r,n){var o=this,i=n<=this._bufferOffset+Ot(this._buffer);if(this._done||i){var s=this._getDataFromBuffer(r,n),f=s==null?this._done:!1;return Promise.resolve({value:s,done:f})}return this._reader.read().then(function(p){var y=p.value,w=p.done;return w?o._done=!0:o._buffer===void 0?o._buffer=y:o._buffer=Zn(o._buffer,y),o._readUntilEnoughDataOrDone(r,n)})}},{key:"_getDataFromBuffer",value:function(r,n){r>this._bufferOffset&&(this._buffer=this._buffer.slice(r-this._bufferOffset),this._bufferOffset=r);var o=Ot(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,n-r)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])})();function X(t){"@babel/helpers - typeof";return X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(t)}function qe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */qe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(l,a,u){l[a]=u.value},i=typeof Symbol=="function"?Symbol:{},s=i.iterator||"@@iterator",f=i.asyncIterator||"@@asyncIterator",p=i.toStringTag||"@@toStringTag";function y(l,a,u){return Object.defineProperty(l,a,{value:u,enumerable:!0,configurable:!0,writable:!0}),l[a]}try{y({},"")}catch{y=function(u,v,b){return u[v]=b}}function w(l,a,u,v){var b=a&&a.prototype instanceof _?a:_,g=Object.create(b.prototype),O=new H(v||[]);return o(g,"_invoke",{value:N(l,u,O)}),g}function x(l,a,u){try{return{type:"normal",arg:l.call(a,u)}}catch(v){return{type:"throw",arg:v}}}e.wrap=w;var P="suspendedStart",k="suspendedYield",D="executing",T="completed",L={};function _(){}function h(){}function c(){}var d={};y(d,s,function(){return this});var m=Object.getPrototypeOf,S=m&&m(m(G([])));S&&S!==r&&n.call(S,s)&&(d=S);var U=c.prototype=_.prototype=Object.create(d);function C(l){["next","throw","return"].forEach(function(a){y(l,a,function(u){return this._invoke(a,u)})})}function R(l,a){function u(b,g,O,A){var I=x(l[b],l,g);if(I.type!=="throw"){var q=I.arg,j=q.value;return j&&X(j)=="object"&&n.call(j,"__await")?a.resolve(j.__await).then(function(z){u("next",z,O,A)},function(z){u("throw",z,O,A)}):a.resolve(j).then(function(z){q.value=z,O(q)},function(z){return u("throw",z,O,A)})}A(I.arg)}var v;o(this,"_invoke",{value:function(g,O){function A(){return new a(function(I,q){u(g,O,I,q)})}return v=v?v.then(A,A):A()}})}function N(l,a,u){var v=P;return function(b,g){if(v===D)throw Error("Generator is already running");if(v===T){if(b==="throw")throw g;return{value:t,done:!0}}for(u.method=b,u.arg=g;;){var O=u.delegate;if(O){var A=M(O,u);if(A){if(A===L)continue;return A}}if(u.method==="next")u.sent=u._sent=u.arg;else if(u.method==="throw"){if(v===P)throw v=T,u.arg;u.dispatchException(u.arg)}else u.method==="return"&&u.abrupt("return",u.arg);v=D;var I=x(l,a,u);if(I.type==="normal"){if(v=u.done?T:k,I.arg===L)continue;return{value:I.arg,done:u.done}}I.type==="throw"&&(v=T,u.method="throw",u.arg=I.arg)}}}function M(l,a){var u=a.method,v=l.iterator[u];if(v===t)return a.delegate=null,u==="throw"&&l.iterator.return&&(a.method="return",a.arg=t,M(l,a),a.method==="throw")||u!=="return"&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+u+"' method")),L;var b=x(v,l.iterator,a.arg);if(b.type==="throw")return a.method="throw",a.arg=b.arg,a.delegate=null,L;var g=b.arg;return g?g.done?(a[l.resultName]=g.value,a.next=l.nextLoc,a.method!=="return"&&(a.method="next",a.arg=t),a.delegate=null,L):g:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,L)}function Y(l){var a={tryLoc:l[0]};1 in l&&(a.catchLoc=l[1]),2 in l&&(a.finallyLoc=l[2],a.afterLoc=l[3]),this.tryEntries.push(a)}function E(l){var a=l.completion||{};a.type="normal",delete a.arg,l.completion=a}function H(l){this.tryEntries=[{tryLoc:"root"}],l.forEach(Y,this),this.reset(!0)}function G(l){if(l||l===""){var a=l[s];if(a)return a.call(l);if(typeof l.next=="function")return l;if(!isNaN(l.length)){var u=-1,v=function b(){for(;++u<l.length;)if(n.call(l,u))return b.value=l[u],b.done=!1,b;return b.value=t,b.done=!0,b};return v.next=v}}throw new TypeError(X(l)+" is not iterable")}return h.prototype=c,o(U,"constructor",{value:c,configurable:!0}),o(c,"constructor",{value:h,configurable:!0}),h.displayName=y(c,p,"GeneratorFunction"),e.isGeneratorFunction=function(l){var a=typeof l=="function"&&l.constructor;return!!a&&(a===h||(a.displayName||a.name)==="GeneratorFunction")},e.mark=function(l){return Object.setPrototypeOf?Object.setPrototypeOf(l,c):(l.__proto__=c,y(l,p,"GeneratorFunction")),l.prototype=Object.create(U),l},e.awrap=function(l){return{__await:l}},C(R.prototype),y(R.prototype,f,function(){return this}),e.AsyncIterator=R,e.async=function(l,a,u,v,b){b===void 0&&(b=Promise);var g=new R(w(l,a,u,v),b);return e.isGeneratorFunction(a)?g:g.next().then(function(O){return O.done?O.value:g.next()})},C(U),y(U,p,"Generator"),y(U,s,function(){return this}),y(U,"toString",function(){return"[object Generator]"}),e.keys=function(l){var a=Object(l),u=[];for(var v in a)u.push(v);return u.reverse(),function b(){for(;u.length;){var g=u.pop();if(g in a)return b.value=g,b.done=!1,b}return b.done=!0,b}},e.values=G,H.prototype={constructor:H,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!a)for(var u in this)u.charAt(0)==="t"&&n.call(this,u)&&!isNaN(+u.slice(1))&&(this[u]=t)},stop:function(){this.done=!0;var a=this.tryEntries[0].completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(a){if(this.done)throw a;var u=this;function v(q,j){return O.type="throw",O.arg=a,u.next=q,j&&(u.method="next",u.arg=t),!!j}for(var b=this.tryEntries.length-1;b>=0;--b){var g=this.tryEntries[b],O=g.completion;if(g.tryLoc==="root")return v("end");if(g.tryLoc<=this.prev){var A=n.call(g,"catchLoc"),I=n.call(g,"finallyLoc");if(A&&I){if(this.prev<g.catchLoc)return v(g.catchLoc,!0);if(this.prev<g.finallyLoc)return v(g.finallyLoc)}else if(A){if(this.prev<g.catchLoc)return v(g.catchLoc,!0)}else{if(!I)throw Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return v(g.finallyLoc)}}}},abrupt:function(a,u){for(var v=this.tryEntries.length-1;v>=0;--v){var b=this.tryEntries[v];if(b.tryLoc<=this.prev&&n.call(b,"finallyLoc")&&this.prev<b.finallyLoc){var g=b;break}}g&&(a==="break"||a==="continue")&&g.tryLoc<=u&&u<=g.finallyLoc&&(g=null);var O=g?g.completion:{};return O.type=a,O.arg=u,g?(this.method="next",this.next=g.finallyLoc,L):this.complete(O)},complete:function(a,u){if(a.type==="throw")throw a.arg;return a.type==="break"||a.type==="continue"?this.next=a.arg:a.type==="return"?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):a.type==="normal"&&u&&(this.next=u),L},finish:function(a){for(var u=this.tryEntries.length-1;u>=0;--u){var v=this.tryEntries[u];if(v.finallyLoc===a)return this.complete(v.completion,v.afterLoc),E(v),L}},catch:function(a){for(var u=this.tryEntries.length-1;u>=0;--u){var v=this.tryEntries[u];if(v.tryLoc===a){var b=v.completion;if(b.type==="throw"){var g=b.arg;E(v)}return g}}throw Error("illegal catch attempt")},delegateYield:function(a,u,v){return this.delegate={iterator:G(a),resultName:u,nextLoc:v},this.method==="next"&&(this.arg=t),L}},e}function xt(t,e,r,n,o,i,s){try{var f=t[i](s),p=f.value}catch(y){r(y);return}f.done?e(p):Promise.resolve(p).then(n,o)}function eo(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function s(p){xt(i,n,o,s,f,"next",p)}function f(p){xt(i,n,o,s,f,"throw",p)}s(void 0)})}}function to(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oo(n.key),n)}}function no(t,e,r){return e&&ro(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function oo(t){var e=io(t,"string");return X(e)=="symbol"?e:e+""}function io(t,e){if(X(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(X(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ao=(function(){function t(){to(this,t)}return no(t,[{key:"openFile",value:(function(){var e=eo(qe().mark(function n(o,i){var s;return qe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(nr()&&o&&typeof o.uri<"u")){p.next=11;break}return p.prev=1,p.next=4,qn(o.uri);case 4:return s=p.sent,p.abrupt("return",new Rt(s));case 8:throw p.prev=8,p.t0=p.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(p.t0));case 11:if(!(typeof o.slice=="function"&&typeof o.size<"u")){p.next=13;break}return p.abrupt("return",Promise.resolve(new Rt(o)));case 13:if(typeof o.read!="function"){p.next=18;break}if(i=Number(i),Number.isFinite(i)){p.next=17;break}return p.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return p.abrupt("return",Promise.resolve(new Jn(o,i)));case 18:return p.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return p.stop()}},n,null,[[1,8]])}));function r(n,o){return e.apply(this,arguments)}return r})()}])})();function so(t,e){return nr()?Promise.resolve(uo(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function uo(t,e){var r=t.exif?lo(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",r,e.endpoint].join("/")}function lo(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e&=e}return e}function ce(t){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(t)}function Ze(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,co(n.key),n)}}function Je(t,e,r){return e&&fo(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function co(t){var e=po(t,"string");return ce(e)=="symbol"?e:e+""}function po(t,e){if(ce(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(ce(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ho=(function(){function t(){Ze(this,t)}return Je(t,[{key:"createRequest",value:function(r,n){return new yo(r,n)}},{key:"getName",value:function(){return"XHRHttpStack"}}])})(),yo=(function(){function t(e,r){Ze(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,r,!0),this._method=e,this._url=r,this._headers={}}return Je(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(r,n){this._xhr.setRequestHeader(r,n),this._headers[r]=n}},{key:"getHeader",value:function(r){return this._headers[r]}},{key:"setProgressHandler",value:function(r){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(n){n.lengthComputable&&r(n.loaded)})}},{key:"send",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,i){r._xhr.onload=function(){o(new mo(r._xhr))},r._xhr.onerror=function(s){i(s)},r._xhr.send(n)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])})(),mo=(function(){function t(e){Ze(this,t),this._xhr=e}return Je(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(r){return this._xhr.getResponseHeader(r)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])})();function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(t)}function vo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function go(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_o(n.key),n)}}function bo(t,e,r){return e&&go(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _o(t){var e=wo(t,"string");return pe(e)=="symbol"?e:e+""}function wo(t,e){if(pe(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(pe(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ze=!1;try{ze="localStorage"in window;var ke="tusSupport",Tt=localStorage.getItem(ke);localStorage.setItem(ke,Tt),Tt===null&&localStorage.removeItem(ke)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)ze=!1;else throw t}var Eo=ze,Uo=(function(){function t(){vo(this,t)}return bo(t,[{key:"findAllUploads",value:function(){var r=this._findEntries("tus::");return Promise.resolve(r)}},{key:"findUploadsByFingerprint",value:function(r){var n=this._findEntries("tus::".concat(r,"::"));return Promise.resolve(n)}},{key:"removeUpload",value:function(r){return localStorage.removeItem(r),Promise.resolve()}},{key:"addUpload",value:function(r,n){var o=Math.round(Math.random()*1e12),i="tus::".concat(r,"::").concat(o);return localStorage.setItem(i,JSON.stringify(n)),Promise.resolve(i)}},{key:"_findEntries",value:function(r){for(var n=[],o=0;o<localStorage.length;o++){var i=localStorage.key(o);if(i.indexOf(r)===0)try{var s=JSON.parse(localStorage.getItem(i));s.urlStorageKey=i,n.push(s)}catch{}}return n}}])})();function re(t){"@babel/helpers - typeof";return re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(t)}function So(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Po(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ir(n.key),n)}}function Ro(t,e,r){return r&&Po(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Oo(t,e,r){return e=_e(e),xo(t,or()?Reflect.construct(e,r||[],_e(t).constructor):e.apply(t,r))}function xo(t,e){if(e&&(re(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return To(t)}function To(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function or(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(or=function(){return!!t})()}function _e(t){return _e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_e(t)}function Co(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Be(t,e)}function Be(t,e){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},Be(t,e)}function Ct(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function J(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ct(Object(r),!0).forEach(function(n){ko(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ko(t,e,r){return e=ir(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ir(t){var e=Ao(t,"string");return re(e)=="symbol"?e:e+""}function Ao(t,e){if(re(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(re(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var kt=J(J({},be.defaultOptions),{},{httpStack:new ho,fileReader:new ao,urlStorage:Eo?new Uo:new ln,fingerprint:so}),Io=(function(t){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return So(this,e),n=J(J({},kt),n),Oo(this,e,[r,n])}return Co(e,t),Ro(e,null,[{key:"terminate",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o=J(J({},kt),o),be.terminate(n,o)}}])})(be);class Ue{constructor(e){this.upload=e}start(){this.upload.start()}abort(){return this.upload.abort(!0)}static async create(e,{onProgress:r,onSuccess:n,onError:o,uploadType:i,backendId:s,metadata:f,chunkSize:p,baseUrl:y}){const w=["tus",e.fingerprint,"drive"].join("-"),x=new Io(e.native,{fingerprint:()=>Promise.resolve(w),removeFingerprintOnSuccess:!0,endpoint:`${y}/api/v1/tus/upload`,chunkSize:p,retryDelays:[0,3e3,5e3,1e4,2e4],overridePatchMethod:!0,metadata:{name:window.btoa(e.id),clientName:e.name,clientExtension:e.extension,clientMime:e.mime||"",clientSize:`${e.size}`,uploadType:i,backendId:s,...f},headers:{"X-XSRF-TOKEN":Xr.getCookie("XSRF-TOKEN")},onError:k=>{var D;if("originalResponse"in k&&k.originalResponse)try{const T=(D=JSON.parse(k.originalResponse.getBody()))==null?void 0:D.message;o==null||o(T,e)}catch{o==null||o(null,e)}else o==null||o(null,e)},onProgress(k,D){r==null||r({bytesUploaded:k,bytesTotal:D})},onSuccess:async()=>{var D;const k=(D=x.url)==null?void 0:D.split("/").pop();try{if(k){const T=await Lo(k);n==null||n(T.fileEntry,e)}}catch(T){localStorage.removeItem(w),o==null||o(ee(T),e)}}}),P=await x.findPreviousUploads();return P.length&&x.resumeFromPreviousUpload(P[0]),new Ue(x)}}function Lo(t){return $.post("tus/entries",{uploadKey:t}).then(e=>e.data)}async function Do(t,e){var w,x;const r=we().settings,n=t.options,o=t.file;if(n!=null&&n.restrictions){const P=Or(o,n.restrictions);if(P)return e.updateFileUpload(o.id,{errorMessage:P,status:"failed",request:void 0,timer:void 0}),n.showToastOnRestrictionFail&&tt.danger(P),e.runQueue(),null}const i=qo(n.uploadType);if(!i)throw new Error("No backend found for upload type "+n.uploadType);const s=new Tr,f={uploadType:n==null?void 0:n.uploadType,backendId:i.id,metadata:{...n==null?void 0:n.metadata,relativePath:o.relativePath,parentId:((w=n==null?void 0:n.metadata)==null?void 0:w.parentId)||""},chunkSize:((x=r.uploading)==null?void 0:x.chunk_size)??Lt,baseUrl:r.base_url,onError:P=>{var k;e.updateFileUpload(o.id,{errorMessage:P,status:"failed"}),e.runQueue(),s.done(),(k=n==null?void 0:n.onError)==null||k.call(n,P,o),n.showToastOnBackendError&&P&&tt.danger(P)},onSuccess:P=>{var k;e.updateFileUpload(o.id,{status:"completed",entry:P}),e.runQueue(),s.done(),(k=n==null?void 0:n.onSuccess)==null||k.call(n,P,o)},onProgress:({bytesUploaded:P,bytesTotal:k})=>{var T;const D=P/k*100;e.updateFileUpload(o.id,{percentage:D,bytesUploaded:P}),s.progress(),(T=n==null?void 0:n.onProgress)==null||T.call(n,{bytesUploaded:P,bytesTotal:k})}},y=await No(o,i).create(o,f);return s.timeoutHandler=()=>{y.abort(),e.updateFileUpload(o.id,{status:"failed",errorMessage:Ae("Upload timed out")}),e.runQueue()},e.updateFileUpload(o.id,{status:"inProgress",request:y}),y.start(),y}const ar=1024*1024,jo=4*ar,Fo=100*ar,No=(t,e)=>{var r;return e.driver==="s3"&&e.direct_upload?t.size>=Fo?Ee:Xe:t.size>=jo&&!((r=we().settings.uploading)!=null&&r.disable_tus)?Ue:$e};function qo(t){const e=we().uploading_types;if(e&&t){const r=e[t];return r.backends[Math.floor(Math.random()*r.backends.length)]}return null}yr();const At={uploadStarted:!1,concurrency:3,fileUploads:new Map,activeUploadsCount:0,inProgressUploadsCount:0,pendingUploadsCount:0,completedUploadsCount:0},zo=({settings:t,options:e})=>hr()(dr((r,n)=>({...At,reset:()=>{r(At)},getUpload:o=>n().fileUploads.get(o),getCompletedFileEntries:()=>[...n().fileUploads.values()].filter(o=>!!o.entry).map(o=>o.entry),clearInactive:()=>{r(o=>{o.fileUploads.forEach((i,s)=>{i.status!=="inProgress"&&o.fileUploads.delete(s)}),Q(o)}),n().runQueue()},abortUpload:o=>{var s;const i=n().fileUploads.get(o);i&&((s=i.request)==null||s.abort(),n().uploadStarted?(n().updateFileUpload(o,{status:"aborted",percentage:0}),n().runQueue()):n().removeUpload(o))},updateFileUpload:(o,i)=>{r(s=>{const f=s.fileUploads.get(o);f&&(s.fileUploads.set(o,{...f,...i}),"status"in i&&Q(s))})},addCompletedFileUpload:(o,i)=>{r(s=>{s.fileUploads.set(`${o.id}`,{file:new br(o),status:"completed",entry:o,percentage:100,bytesUploaded:o.file_size||0,options:{uploadType:i}}),Q(s)})},uploadSingle:(o,i)=>{const s=nt(o,i,e),f=new Map(n().fileUploads);return f.set(s.file.id,s),r(p=>{Q(p),p.fileUploads=f,p.uploadStarted=!0}),n().runQueue(),s.file.id},removeUpload:o=>{r(i=>{i.fileUploads.delete(o),Q(i)})},uploadMultiple:(o,i,{startUpload:s=!0}={})=>{const f=new Map(n().fileUploads);return[...o].forEach(p=>{const y=nt(p,i,e);f.set(y.file.id,y)}),r(p=>{p.uploadStarted=s,p.fileUploads=f,Q(p)}),s&&n().runQueue(),[...f.keys()]},startUpload:()=>{r(o=>{o.uploadStarted=!0}),n().runQueue()},runQueue:async()=>{if(n().uploadStarted===!1)return;const o=[...n().fileUploads.values()],i=o.filter(f=>f.status==="inProgress");let s=n().concurrency;if(i.filter(f=>{var p;return f.file.relativePath||f.request instanceof Ee||f.request instanceof Ue&&f.file.size>(((p=t.uploading)==null?void 0:p.chunk_size)??Lt)}).length&&(s=1),i.length<s){const f=o.find(p=>p.status==="pending");f?await Do(f,n()):r(p=>{p.uploadStarted=!1})}}}))),Q=t=>{const e=[...t.fileUploads.values()];t.completedUploadsCount=e.filter(r=>r.status==="completed").length,t.inProgressUploadsCount=e.filter(r=>r.status==="inProgress").length,t.pendingUploadsCount=e.filter(r=>r.status==="pending").length,t.activeUploadsCount=e.filter(r=>r.status==="inProgress"||r.status==="pending").length},{useSyncExternalStoreWithSelector:Bo}=wr,Ho=t=>t;function Mo(t,e=Ho,r){const n=Bo(t.subscribe,t.getState,t.getInitialState,e,r);return mr.useDebugValue(n),n}const sr=Me.createContext(null);function Yo(t,e){const r=Me.useContext(sr);return Mo(r,t,e)}function Wo({children:t,options:e}){const r=vr(),[n]=Me.useState(()=>zo({settings:r,options:e}));return gr.jsx(sr.Provider,{value:n,children:t})}export{Wo as F,Mo as a,Er as r,Yo as u};
