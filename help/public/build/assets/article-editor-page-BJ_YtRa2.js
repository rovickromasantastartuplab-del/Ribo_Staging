const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-editor-B7vDiNsP.js","./client-DtfdVV77.js"])))=>i.map(i=>d[i]);
import{m as Y,j as d,aw as xe,aj as L,p as O,ax as we,az as S,T as w,r as R,av as Ce,aM as st,B as K,ae as lt,a_ as le,cg as rt,d as it,al as De,am as Be,an as We,ap as _e,aP as at,F as $e,aq as Pe,Y as ct,P as dt,bd as ut,f as Oe,ac as ft}from"./client-DtfdVV77.js";import{F as ht,a as pt,b as mt,c as gt,d as bt,e as xt,f as wt,H as Ct,S as yt,N as St,U as At,R as jt}from"./Undo-BcDh75at.js";import{u as E}from"./tiptap-editor-context-CeN7pXcf.js";import{F as vt,L as Tt,a as Mt,C as Rt,b as kt}from"./list-buttons-CxLBLRRO.js";import{C as Nt}from"./color-picker-dialog-CeCHU4u7.js";import{F as Ht}from"./FormatColorFill-DNSNzsFD.js";import{I as Lt}from"./image-button-DUyjpM_5.js";import{M as Et}from"./MoreVert-BVDYtk4z.js";import{P as It}from"./PriorityHigh-BG38_UZP.js";import{D as Ve}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{C as zt}from"./FormatListNumbered-BcAdH5KM.js";import"./ArrowBack-DIhVch2U.js";import"./image-up-hBoBC5iJ.js";import{F as Ft}from"./file-upload-provider-B4w-VsYu.js";import"./Link-WHWZ7SV6.js";import{c as re,N as q,m as $,T as D,V as Dt,q as Ke,P as qe,j as ye,k as Bt,h as F,W as Wt,F as H,S as _,D as de,g as ue,f as _t,X as $t,n as Pt,o as Ot,Y as Vt}from"./index-uUjpwT6n.js";import{i as Kt,a as qt,T as Xt,C as Ut,b as Jt,l as Gt}from"./index-BCY5Ekxi.js";import{P as Yt,T as Qt,a as Zt}from"./index-Y7xUBCAo.js";import{E as en}from"./Edit-BaEHOLuK.js";import{D as Xe}from"./main-BGmGAxtx.js";import{D as tn}from"./dashboard-sidenav-q-Yy9ZLk.js";import{T as nn}from"./toggle-right-sidebar-icon-DuD5EnU1.js";const Q={left:{icon:gt,label:Y("Align left")},center:{icon:mt,label:Y("Align center")},right:{icon:pt,label:Y("Align right")},justify:{icon:ht,label:Y("Justify")}};function on({size:t}){const e=E(),n=Object.keys(Q).find(s=>e==null?void 0:e.isActive({textAlign:s})),o=n?Q[n].icon:Q.left.icon;return d.jsxs(xe,{floatingWidth:"auto",selectionMode:"single",selectedValue:n,onSelectionChange:s=>{e==null||e.commands.focus(),e==null||e.commands.setTextAlign(s)},children:[d.jsx(L,{size:t,disabled:!e,color:n?"primary":null,className:O("flex-shrink-0"),children:d.jsx(o,{})}),d.jsx(we,{children:Object.entries(Q).map(([s,l])=>{const r=l.icon;return d.jsx(S,{value:s,startIcon:d.jsx(r,{size:"md"}),capitalizeFirst:!0,children:d.jsx(w,{message:l.label.message})},s)})})]})}function sn({size:t}){const e=E(),[n,o]=R.useState(!1),s=e==null?void 0:e.getAttributes("textStyle").color,l=e==null?void 0:e.getAttributes("textStyle").backgroundColor;return d.jsxs(R.Fragment,{children:[d.jsxs("span",{className:O("flex-shrink-0 whitespace-nowrap"),children:[d.jsx(L,{disabled:!e,size:t,color:s?"primary":null,onClick:()=>{o("text")},children:d.jsx(bt,{})}),d.jsx(L,{disabled:!e,size:t,color:l?"primary":null,onClick:()=>{o("bg")},children:d.jsx(Ht,{})})]}),d.jsx(Ce,{defaultValue:n==="text"?"#000000":"#FFFFFF",type:"modal",isOpen:!!n,onClose:r=>{r&&(n==="text"?e==null||e.commands.setColor(r):e==null||e.commands.setBackgroundColor(r)),o(!1)},children:d.jsx(Nt,{})})]})}function V(){return d.jsx("div",{className:"self-stretch mx-4 w-1 bg-divider flex-shrink-0"})}function N({children:t,modifier:e,separator:n="+"}){const o=st()?d.jsx("span",{className:"text-base align-middle",children:"âŒ˜"}):"Ctrl";return d.jsxs("kbd",{className:"text-xs text-muted",children:[e&&d.jsxs(d.Fragment,{children:[o,n]}),t]})}function ln({size:t}){const e=E();return d.jsxs(xe,{floatingMinWidth:"w-256",onItemSelected:n=>{e==null||e.commands.focus(),typeof n=="string"&&n.startsWith("h")?e==null||e.commands.toggleHeading({level:parseInt(n.replace("h",""))}):n==="code"?e==null||e.commands.toggleCode():n==="strike"?e==null||e.commands.toggleStrike():n==="super"?e==null||e.commands.toggleSuperscript():n==="sub"?e==null||e.commands.toggleSubscript():n==="blockquote"?e==null||e.commands.toggleBlockquote():n==="paragraph"&&(e==null||e.commands.setParagraph())},children:[d.jsx(K,{className:O("flex-shrink-0"),variant:"text",size:t,endIcon:d.jsx(lt,{}),disabled:!e,children:d.jsx(w,{message:"Format"})}),d.jsxs(we,{children:[d.jsx(S,{value:"h1",endSection:d.jsx(N,{modifier:!0,children:"Alt+1"}),children:d.jsx(w,{message:"Heading :number",values:{number:1}})}),d.jsx(S,{value:"h2",endSection:d.jsx(N,{modifier:!0,children:"Alt+2"}),children:d.jsx(w,{message:"Heading :number",values:{number:2}})}),d.jsx(S,{value:"h3",endSection:d.jsx(N,{modifier:!0,children:"Alt+3"}),children:d.jsx(w,{message:"Heading :number",values:{number:3}})}),d.jsx(S,{value:"h4",endSection:d.jsx(N,{modifier:!0,children:"Alt+4"}),children:d.jsx(w,{message:"Heading :number",values:{number:4}})}),d.jsx(S,{value:"code",endSection:d.jsx(N,{modifier:!0,children:"E"}),children:d.jsx(w,{message:"Code"})}),d.jsx(S,{value:"strike",endSection:d.jsx(N,{modifier:!0,children:"Shift+X"}),children:d.jsx(w,{message:"Strikethrough"})}),d.jsx(S,{value:"super",endSection:d.jsx(N,{modifier:!0,separator:" ",children:"."}),children:d.jsx(w,{message:"Superscript"})}),d.jsx(S,{value:"sub",endSection:d.jsx(N,{modifier:!0,separator:" ",children:","}),children:d.jsx(w,{message:"Subscript"})}),d.jsx(S,{value:"blockquote",endSection:d.jsx(N,{modifier:!0,children:"Shift+B"}),children:d.jsx(w,{message:"Blockquote"})}),d.jsx(S,{value:"paragraph",endSection:d.jsx(N,{modifier:!0,children:"Alt+0"}),children:d.jsx(w,{message:"Paragraph"})})]})]})}function rn({size:t}){const e=E();return d.jsxs("span",{className:O("flex-shrink-0","whitespace-nowrap"),children:[d.jsx(le,{label:d.jsx(w,{message:"Decrease indent"}),children:d.jsx(L,{size:t,disabled:!e,onClick:()=>{e==null||e.commands.focus(),e==null||e.commands.outdent()},children:d.jsx(xt,{})})}),d.jsx(le,{label:d.jsx(w,{message:"Increase indent"}),children:d.jsx(L,{size:t,disabled:!e,onClick:()=>{e==null||e.commands.focus(),e==null||e.commands.indent()},children:d.jsx(wt,{})})})]})}function an({size:t}){const e=E(),[n,o]=R.useState(!1);return d.jsxs(d.Fragment,{children:[d.jsxs(xe,{onItemSelected:s=>{s==="hr"?(e==null||e.commands.focus(),e==null||e.commands.setHorizontalRule()):s==="embed"?o("embed"):(e==null||e.commands.focus(),e==null||e.commands.addInfo({type:s}))},children:[d.jsx(L,{variant:"text",size:t,className:O("flex-shrink-0"),disabled:!e,children:d.jsx(Et,{})}),d.jsxs(we,{children:[d.jsx(S,{value:"hr",startIcon:d.jsx(Ct,{}),children:d.jsx(w,{message:"Horizontal rule"})}),d.jsx(S,{value:"embed",startIcon:d.jsx(yt,{}),children:d.jsx(w,{message:"Embed"})}),d.jsx(S,{value:"important",startIcon:d.jsx(It,{}),children:d.jsx(w,{message:"Important"})}),d.jsx(S,{value:"warning",startIcon:d.jsx(rt,{}),children:d.jsx(w,{message:"Warning"})}),d.jsx(S,{value:"success",startIcon:d.jsx(St,{}),children:d.jsx(w,{message:"Note"})})]})]}),d.jsx(Ce,{type:"modal",isOpen:!!n,onClose:()=>{o(!1)},children:d.jsx(cn,{})})]})}function cn(){const t=E(),e=t==null?void 0:t.getAttributes("embed").src,n=it({defaultValues:{src:e}}),{formId:o,close:s}=De();return d.jsxs(Be,{children:[d.jsx(We,{children:d.jsx(w,{message:"Insert link"})}),d.jsx(_e,{children:d.jsx(at,{form:n,id:o,onSubmit:l=>{t==null||t.commands.setEmbed(l),s()},children:d.jsx($e,{name:"src",label:d.jsx(w,{message:"Embed URL"}),autoFocus:!0,type:"url",required:!0})})}),d.jsxs(Pe,{children:[d.jsx(K,{onClick:s,variant:"text",children:d.jsx(w,{message:"Cancel"})}),d.jsx(K,{type:"submit",form:o,disabled:!n.formState.isValid,variant:"flat",color:"primary",children:d.jsx(w,{message:"Add"})})]})]})}function dn({size:t="sm",justify:e="justify-center-safe",hideInsertButton:n=!1,imageUploadType:o}){return d.jsxs("div",{className:O("hidden-scrollbar flex flex-shrink-0 items-center overflow-x-auto border-b px-4 py-2 text-muted",e),children:[d.jsx(ln,{size:t}),d.jsx(V,{}),d.jsx(vt,{size:t}),d.jsx(V,{}),d.jsx(on,{size:t}),d.jsx(rn,{size:t}),d.jsx(V,{}),d.jsx(Tt,{size:t}),d.jsx(V,{}),d.jsx(Mt,{size:t}),d.jsx(Lt,{size:t,uploadType:o}),!n&&d.jsx(an,{size:t}),d.jsx(V,{}),d.jsx(sn,{size:t}),d.jsx(V,{}),d.jsx(Rt,{size:t}),d.jsx(kt,{size:t})]})}function un(){const t=E();return d.jsxs("span",{className:"flex items-center max-md:hidden",children:[d.jsx(L,{size:"md",disabled:!t||!t.can().undo(),onClick:()=>{t==null||t.commands.focus(),t==null||t.commands.undo()},children:d.jsx(At,{})}),d.jsx(L,{size:"md",disabled:!t||!t.can().redo(),onClick:()=>{t==null||t.commands.focus(),t==null||t.commands.redo()},children:d.jsx(jt,{})})]})}const fn=ct.lazy(()=>ut(()=>import("./ace-editor-B7vDiNsP.js"),__vite__mapDeps([0,1]),import.meta.url));function hn({defaultValue:t,mode:e="html",title:n,onSave:o,isSaving:s,footerStartAction:l,beautify:r,editorRef:i}){const[a,c]=R.useState(t),[u,f]=R.useState(!0);return d.jsxs(Be,{size:"fullscreen",className:"h-full w-full",children:[d.jsx(We,{children:n}),d.jsx(_e,{className:"relative flex-auto",padding:"p-0",children:d.jsx(R.Suspense,{fallback:d.jsx("div",{className:"flex h-400 w-full items-center justify-center",children:d.jsx(dt,{"aria-label":"Loading editor...",isIndeterminate:!0,size:"md"})}),children:d.jsx(fn,{beautify:r,mode:e,onChange:h=>c(h),defaultValue:a||"",onIsValidChange:f,editorRef:i})})}),d.jsx(pn,{disabled:!u||s,value:a,onSave:o,startAction:l})]})}function pn({disabled:t,value:e,onSave:n,startAction:o}){const{close:s}=De();return d.jsxs(Pe,{dividerTop:!0,startAction:o,children:[d.jsx(K,{onClick:()=>s(),children:d.jsx(w,{message:"Cancel"})}),d.jsx(K,{disabled:t,variant:"flat",color:"primary",onClick:()=>{n?n(e):s(e)},children:d.jsx(w,{message:"Save"})})]})}function mn(){const t=E();return d.jsxs(Ce,{type:"modal",onClose:e=>{e!=null&&(t==null||t.commands.setContent(e))},children:[d.jsx(le,{label:d.jsx(w,{message:"Source code"}),children:d.jsx(L,{className:"text-muted max-md:hidden",variant:"text",disabled:!t,children:d.jsx(zt,{})})}),d.jsx(hn,{title:d.jsx(w,{message:"Source code"}),defaultValue:(t==null?void 0:t.getHTML())??""})]})}function gn({children:t,onSave:e,saveButton:n,isSaving:o=!1,rightContent:s,showSidebarToggleButton:l=!0}){const r=E();return d.jsx(Ve,{showSidebarToggleButton:l,rightContent:d.jsxs(R.Fragment,{children:[d.jsx(un,{}),d.jsx(mn,{}),e&&d.jsx(bn,{onSave:()=>{e((r==null?void 0:r.getHTML())??"")},isLoading:o}),n,s]}),children:t})}function bn({onSave:t,isLoading:e}){const n=E(),s=Oe().watch("title");return d.jsx(K,{variant:"flat",size:"sm",color:"primary",className:"min-w-90",disabled:e||!s||!n,onClick:()=>t((n==null?void 0:n.getHTML())??""),children:d.jsx(w,{message:"Save"})})}const xn=re.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>t.style.backgroundColor.replace(/['"]+/g,""),renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),wn=q.create({name:"embed",group:"block",atom:!0,addAttributes(){return{allowfullscreen:{default:null},allow:{default:"autoplay; fullscreen; picture-in-picture"},src:{default:null}}},parseHTML(){return[{tag:"iframe"}]},renderHTML({HTMLAttributes:t}){return["iframe",$(this.options.HTMLAttributes,t)]},addCommands(){return{setEmbed:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}}}),Cn=re.create({name:"indent",addOptions:()=>({types:["listItem","paragraph"],minLevel:0,maxLevel:6}),addGlobalAttributes(){return[{types:this.options.types,attributes:{indent:{renderHTML:t=>(t==null?void 0:t.indent)>this.options.minLevel?{"data-indent":t.indent}:null,parseHTML:t=>{const e=Number(t.getAttribute("data-indent"));return e&&e>this.options.minLevel?e:null}}}}]},addCommands(){const t=(o,s,l)=>{var i;const r=(i=o==null?void 0:o.doc)==null?void 0:i.nodeAt(s);if(r){const a=(r.attrs.indent||0)+l,{minLevel:c,maxLevel:u}=this.options,f=a<c?c:a>u?u:a;if(f!==r.attrs.indent){const{indent:h,...p}=r.attrs,m=f>c?{...p,indent:f}:p;return o.setNodeMarkup(s,r.type,m,r.marks)}}return o},e=(o,s)=>{const{doc:l,selection:r}=o;if(l&&r&&(r instanceof D||r instanceof Dt)){const{from:i,to:a}=r;l.nodesBetween(i,a,(c,u)=>this.options.types.includes(c.type.name)?(o=t(o,u,s),!1):!0)}return o},n=o=>()=>({tr:s,state:l,dispatch:r})=>{const{selection:i}=l;return s=s.setSelection(i),s=e(s,o),s.docChanged?(r==null||r(s),!0):!1};return{indent:n(1),outdent:n(-1)}},addKeyboardShortcuts(){return{Tab:({editor:t})=>t.state.selection.to>t.state.selection.from?this.editor.commands.indent():!1,"Shift-Tab":({editor:t})=>t.state.selection.to>t.state.selection.from?this.editor.commands.outdent():!1}}}),yn=q.create({name:"be-info-block",group:"block",content:"block+",defining:!0,addOptions(){return{types:["important","warning","success"],defaultType:"success"}},addAttributes(){return{type:{default:this.options.defaultType,parseHTML:t=>{for(const e of this.options.types)if(t.classList.contains(e))return e;return this.options.defaultType},renderHTML:t=>({class:t.type})}}},parseHTML(){return[{tag:"div",contentElement:"p",getAttrs:t=>t.classList.contains("info-block")&&null}]},renderHTML({HTMLAttributes:t}){return["div",$(t,{class:"info-block"}),0]},addCommands(){return{addInfo:t=>({commands:e})=>e.wrapIn(this.name,t)}}});var Sn=Ke.create({name:"subscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sub"},{style:"vertical-align",getAttrs(t){return t!=="sub"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sub",$(this.options.HTMLAttributes,t),0]},addCommands(){return{setSubscript:()=>({commands:t})=>t.setMark(this.name),toggleSubscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSubscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-,":()=>this.editor.commands.toggleSubscript()}}}),An=Sn,jn=Ke.create({name:"superscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sup"},{style:"vertical-align",getAttrs(t){return t!=="super"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sup",$(this.options.HTMLAttributes,t),0]},addCommands(){return{setSuperscript:()=>({commands:t})=>t.setMark(this.name),toggleSuperscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSuperscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-.":()=>this.editor.commands.toggleSuperscript()}}}),vn=jn,fe,he;if(typeof WeakMap<"u"){let t=new WeakMap;fe=e=>t.get(e),he=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;fe=o=>{for(let s=0;s<t.length;s+=2)if(t[s]==o)return t[s+1]},he=(o,s)=>(n==10&&(n=0),t[n++]=o,t[n++]=s)}var y=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,s=e/this.width|0;let l=o+1,r=s+1;for(let i=1;l<this.width&&this.map[e+i]==n;i++)l++;for(let i=1;r<this.height&&this.map[e+this.width*i]==n;i++)r++;return{left:o,top:s,right:l,bottom:r}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:s,top:l,bottom:r}=this.findCell(t);return e=="horiz"?(n<0?o==0:s==this.width)?null:this.map[l*this.width+(n<0?o-1:s)]:(n<0?l==0:r==this.height)?null:this.map[o+this.width*(n<0?l-1:r)]}rectBetween(t,e){const{left:n,right:o,top:s,bottom:l}=this.findCell(t),{left:r,right:i,top:a,bottom:c}=this.findCell(e);return{left:Math.min(n,r),top:Math.min(s,a),right:Math.max(o,i),bottom:Math.max(l,c)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let s=t.left;s<t.right;s++){const l=o*this.width+s,r=this.map[l];n[r]||(n[r]=!0,!(s==t.left&&s&&this.map[l-1]==r||o==t.top&&o&&this.map[l-this.width]==r)&&e.push(r))}return e}positionAt(t,e,n){for(let o=0,s=0;;o++){const l=s+n.child(o).nodeSize;if(o==t){let r=e+t*this.width;const i=(t+1)*this.width;for(;r<i&&this.map[r]<s;)r++;return r==i?l-1:this.map[r]}s=l}}static get(t){return fe(t)||he(t,Tn(t))}};function Tn(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=Mn(t),n=t.childCount,o=[];let s=0,l=null;const r=[];for(let c=0,u=e*n;c<u;c++)o[c]=0;for(let c=0,u=0;c<n;c++){const f=t.child(c);u++;for(let m=0;;m++){for(;s<o.length&&o[s]!=0;)s++;if(m==f.childCount)break;const b=f.child(m),{colspan:g,rowspan:x,colwidth:j}=b.attrs;for(let T=0;T<x;T++){if(T+c>=n){(l||(l=[])).push({type:"overlong_rowspan",pos:u,n:x-T});break}const B=s+T*e;for(let M=0;M<g;M++){o[B+M]==0?o[B+M]=u:(l||(l=[])).push({type:"collision",row:c,pos:u,n:g-M});const G=j&&j[M];if(G){const U=(B+M)%e*2,ae=r[U];ae==null||ae!=G&&r[U+1]==1?(r[U]=G,r[U+1]=1):ae==G&&r[U+1]++}}}s+=g,u+=b.nodeSize}const h=(c+1)*e;let p=0;for(;s<h;)o[s++]==0&&p++;p&&(l||(l=[])).push({type:"missing",row:c,n:p}),u++}(e===0||n===0)&&(l||(l=[])).push({type:"zero_sized"});const i=new y(e,n,o,l);let a=!1;for(let c=0;!a&&c<r.length;c+=2)r[c]!=null&&r[c+1]<n&&(a=!0);return a&&Rn(i,r,t),i}function Mn(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const s=t.child(o);let l=0;if(n)for(let r=0;r<o;r++){const i=t.child(r);for(let a=0;a<i.childCount;a++){const c=i.child(a);r+c.attrs.rowspan>o&&(l+=c.attrs.colspan)}}for(let r=0;r<s.childCount;r++){const i=s.child(r);l+=i.attrs.colspan,i.attrs.rowspan>1&&(n=!0)}e==-1?e=l:e!=l&&(e=Math.max(e,l))}return e}function Rn(t,e,n){t.problems||(t.problems=[]);const o={};for(let s=0;s<t.map.length;s++){const l=t.map[s];if(o[l])continue;o[l]=!0;const r=n.nodeAt(l);if(!r)throw new RangeError(`No cell with offset ${l} found`);let i=null;const a=r.attrs;for(let c=0;c<a.colspan;c++){const u=(s+c)%t.width,f=e[u*2];f!=null&&(!a.colwidth||a.colwidth[c]!=f)&&((i||(i=kn(a)))[c]=f)}i&&t.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:i})}}function kn(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function A(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],s=o.spec.tableRole;s&&(e[s]=o)}}return e}var W=new ye("selectingCells");function X(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Nn(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function k(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function ie(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=X(e.$head)||Hn(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Hn(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function pe(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function Ln(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Se(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Ue(t,e,n){const o=t.node(-1),s=y.get(o),l=t.start(-1),r=s.nextCell(t.pos-l,e,n);return r==null?null:t.node(0).resolve(l+r)}function P(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some(s=>s>0)||(o.colwidth=null)),o}function Je(t,e,n=1){const o={...t,colspan:t.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let s=0;s<n;s++)o.colwidth.splice(e,0,0)}return o}function En(t,e,n){const o=A(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[n+s*t.width]).type!=o)return!1;return!0}var C=class z extends F{constructor(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.rectBetween(e.pos-l,n.pos-l),i=e.node(0),a=s.cellsInRect(r).filter(u=>u!=n.pos-l);a.unshift(n.pos-l);const c=a.map(u=>{const f=o.nodeAt(u);if(!f)throw RangeError(`No cell with offset ${u} found`);const h=l+u+1;return new Wt(i.resolve(h),i.resolve(h+f.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const o=e.resolve(n.map(this.$anchorCell.pos)),s=e.resolve(n.map(this.$headCell.pos));if(pe(o)&&pe(s)&&Se(o,s)){const l=this.$anchorCell.node(-1)!=o.node(-1);return l&&this.isRowSelection()?z.rowSelection(o,s):l&&this.isColSelection()?z.colSelection(o,s):new z(o,s)}return D.between(o,s)}content(){const e=this.$anchorCell.node(-1),n=y.get(e),o=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),l={},r=[];for(let a=s.top;a<s.bottom;a++){const c=[];for(let u=a*n.width+s.left,f=s.left;f<s.right;f++,u++){const h=n.map[u];if(l[h])continue;l[h]=!0;const p=n.findCell(h);let m=e.nodeAt(h);if(!m)throw RangeError(`No cell with offset ${h} found`);const b=s.left-p.left,g=p.right-s.right;if(b>0||g>0){let x=m.attrs;if(b>0&&(x=P(x,0,b)),g>0&&(x=P(x,x.colspan-g,g)),p.left<s.left){if(m=m.type.createAndFill(x),!m)throw RangeError(`Could not create cell with attrs ${JSON.stringify(x)}`)}else m=m.type.create(x,m.content)}if(p.top<s.top||p.bottom>s.bottom){const x={...m.attrs,rowspan:Math.min(p.bottom,s.bottom)-Math.max(p.top,s.top)};p.top<s.top?m=m.type.createAndFill(x):m=m.type.create(x,m.content)}c.push(m)}r.push(e.child(a).copy(H.from(c)))}const i=this.isColSelection()&&this.isRowSelection()?e:r;return new _(H.from(i),1,1)}replace(e,n=_.empty){const o=e.steps.length,s=this.ranges;for(let r=0;r<s.length;r++){const{$from:i,$to:a}=s[r],c=e.mapping.slice(o);e.replace(c.map(i.pos),c.map(a.pos),r?_.empty:n)}const l=F.findFrom(e.doc.resolve(e.mapping.slice(o).map(this.to)),-1);l&&e.setSelection(l)}replaceWith(e,n){this.replace(e,new _(H.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),o=y.get(n),s=this.$anchorCell.start(-1),l=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let r=0;r<l.length;r++)e(n.nodeAt(l[r]),s+l[r])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const o=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,s)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.findCell(e.pos-l),i=s.findCell(n.pos-l),a=e.node(0);return r.top<=i.top?(r.top>0&&(e=a.resolve(l+s.map[r.left])),i.bottom<s.height&&(n=a.resolve(l+s.map[s.width*(s.height-1)+i.right-1]))):(i.top>0&&(n=a.resolve(l+s.map[i.left])),r.bottom<s.height&&(e=a.resolve(l+s.map[s.width*(s.height-1)+r.right-1]))),new z(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=y.get(e),o=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-o),l=n.colCount(this.$headCell.pos-o);if(Math.min(s,l)>0)return!1;const r=s+this.$anchorCell.nodeAfter.attrs.colspan,i=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(r,i)==n.width}eq(e){return e instanceof z&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.findCell(e.pos-l),i=s.findCell(n.pos-l),a=e.node(0);return r.left<=i.left?(r.left>0&&(e=a.resolve(l+s.map[r.top*s.width])),i.right<s.width&&(n=a.resolve(l+s.map[s.width*(i.top+1)-1]))):(i.left>0&&(n=a.resolve(l+s.map[i.top*s.width])),r.right<s.width&&(e=a.resolve(l+s.map[s.width*(r.top+1)-1]))),new z(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new z(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){return new z(e.resolve(n),e.resolve(o))}getBookmark(){return new In(this.$anchorCell.pos,this.$headCell.pos)}};C.prototype.visible=!1;F.jsonID("cell",C);var In=class Ge{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Ge(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),o=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&o.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&o.index()<o.parent.childCount&&Se(n,o)?new C(n,o):F.near(o,1)}};function zn(t){if(!(t.selection instanceof C))return null;const e=[];return t.selection.forEachCell((n,o)=>{e.push(ue.node(o,o+n.nodeSize,{class:"selectedCell"}))}),de.create(t.doc,e)}function Fn({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,o=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,n++);for(let l=e.depth;l>=0&&!(e.before(l+1)>e.start(l));l--,o--);return n==o&&/row|table/.test(t.node(s).type.spec.tableRole)}function Dn({$from:t,$to:e}){let n,o;for(let s=t.depth;s>0;s--){const l=t.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){n=l;break}}for(let s=e.depth;s>0;s--){const l=e.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){o=l;break}}return n!==o&&e.parentOffset===0}function Bn(t,e,n){const o=(e||t).selection,s=(e||t).doc;let l,r;if(o instanceof _t&&(r=o.node.type.spec.tableRole)){if(r=="cell"||r=="header_cell")l=C.create(s,o.from);else if(r=="row"){const i=s.resolve(o.from+1);l=C.rowSelection(i,i)}else if(!n){const i=y.get(o.node),a=o.from+1,c=a+i.map[i.width*i.height-1];l=C.create(s,a+1,c)}}else o instanceof D&&Fn(o)?l=D.create(s,o.from):o instanceof D&&Dn(o)&&(l=D.create(s,o.$from.start(),o.$from.end()));return l&&(e||(e=t.tr)).setSelection(l),e}var Wn=new ye("fix-tables");function Ye(t,e,n,o){const s=t.childCount,l=e.childCount;e:for(let r=0,i=0;r<l;r++){const a=e.child(r);for(let c=i,u=Math.min(s,r+3);c<u;c++)if(t.child(c)==a){i=c+1,n+=a.nodeSize;continue e}o(a,n),i<s&&t.child(i).sameMarkup(a)?Ye(t.child(i),a,n+1,o):a.nodesBetween(0,a.content.size,o,n+1),n+=a.nodeSize}}function Qe(t,e){let n;const o=(s,l)=>{s.type.spec.tableRole=="table"&&(n=_n(t,s,l,n))};return e?e.doc!=t.doc&&Ye(e.doc,t.doc,0,o):t.doc.descendants(o),n}function _n(t,e,n,o){const s=y.get(e);if(!s.problems)return o;o||(o=t.tr);const l=[];for(let a=0;a<s.height;a++)l.push(0);for(let a=0;a<s.problems.length;a++){const c=s.problems[a];if(c.type=="collision"){const u=e.nodeAt(c.pos);if(!u)continue;const f=u.attrs;for(let h=0;h<f.rowspan;h++)l[c.row+h]+=c.n;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,P(f,f.colspan-c.n,c.n))}else if(c.type=="missing")l[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const u=e.nodeAt(c.pos);if(!u)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const u=e.nodeAt(c.pos);if(!u)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...u.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const u=o.mapping.map(n);o.delete(u,u+e.nodeSize)}}let r,i;for(let a=0;a<l.length;a++)l[a]&&(r==null&&(r=a),i=a);for(let a=0,c=n+1;a<s.height;a++){const u=e.child(a),f=c+u.nodeSize,h=l[a];if(h>0){let p="cell";u.firstChild&&(p=u.firstChild.type.spec.tableRole);const m=[];for(let g=0;g<h;g++){const x=A(t.schema)[p].createAndFill();x&&m.push(x)}const b=(a==0||r==a-1)&&i==a?c+1:f-1;o.insert(o.mapping.map(b),m)}c=f}return o.setMeta(Wn,{fixTables:!0})}function I(t){const e=t.selection,n=ie(t),o=n.node(-1),s=n.start(-1),l=y.get(o);return{...e instanceof C?l.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):l.findCell(n.pos-s),tableStart:s,map:l,table:o}}function Ze(t,{map:e,tableStart:n,table:o},s){let l=s>0?-1:0;En(e,o,s+l)&&(l=s==0||s==e.width?null:0);for(let r=0;r<e.height;r++){const i=r*e.width+s;if(s>0&&s<e.width&&e.map[i-1]==e.map[i]){const a=e.map[i],c=o.nodeAt(a);t.setNodeMarkup(t.mapping.map(n+a),null,Je(c.attrs,s-e.colCount(a))),r+=c.attrs.rowspan-1}else{const a=l==null?A(o.type.schema).cell:o.nodeAt(e.map[i+l]).type,c=e.positionAt(r,s,o);t.insert(t.mapping.map(n+c),a.createAndFill())}}return t}function $n(t,e){if(!k(t))return!1;if(e){const n=I(t);e(Ze(t.tr,n,n.left))}return!0}function Pn(t,e){if(!k(t))return!1;if(e){const n=I(t);e(Ze(t.tr,n,n.right))}return!0}function On(t,{map:e,table:n,tableStart:o},s){const l=t.mapping.maps.length;for(let r=0;r<e.height;){const i=r*e.width+s,a=e.map[i],c=n.nodeAt(a),u=c.attrs;if(s>0&&e.map[i-1]==a||s<e.width-1&&e.map[i+1]==a)t.setNodeMarkup(t.mapping.slice(l).map(o+a),null,P(u,s-e.colCount(a)));else{const f=t.mapping.slice(l).map(o+a);t.delete(f,f+c.nodeSize)}r+=u.rowspan}}function Vn(t,e){if(!k(t))return!1;if(e){const n=I(t),o=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;On(o,n,s),s!=n.left;s--){const l=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!l)throw RangeError("No table found");n.table=l,n.map=y.get(l)}e(o)}return!0}function Kn(t,e,n){var o;const s=A(e.type.schema).header_cell;for(let l=0;l<t.width;l++)if(((o=e.nodeAt(t.map[l+n*t.width]))==null?void 0:o.type)!=s)return!1;return!0}function et(t,{map:e,tableStart:n,table:o},s){var l;let r=n;for(let c=0;c<s;c++)r+=o.child(c).nodeSize;const i=[];let a=s>0?-1:0;Kn(e,o,s+a)&&(a=s==0||s==e.height?null:0);for(let c=0,u=e.width*s;c<e.width;c++,u++)if(s>0&&s<e.height&&e.map[u]==e.map[u-e.width]){const f=e.map[u],h=o.nodeAt(f).attrs;t.setNodeMarkup(n+f,null,{...h,rowspan:h.rowspan+1}),c+=h.colspan-1}else{const f=a==null?A(o.type.schema).cell:(l=o.nodeAt(e.map[u+a*e.width]))==null?void 0:l.type,h=f==null?void 0:f.createAndFill();h&&i.push(h)}return t.insert(r,A(o.type.schema).row.create(null,i)),t}function qn(t,e){if(!k(t))return!1;if(e){const n=I(t);e(et(t.tr,n,n.top))}return!0}function Xn(t,e){if(!k(t))return!1;if(e){const n=I(t);e(et(t.tr,n,n.bottom))}return!0}function Un(t,{map:e,table:n,tableStart:o},s){let l=0;for(let c=0;c<s;c++)l+=n.child(c).nodeSize;const r=l+n.child(s).nodeSize,i=t.mapping.maps.length;t.delete(l+o,r+o);const a=new Set;for(let c=0,u=s*e.width;c<e.width;c++,u++){const f=e.map[u];if(!a.has(f)){if(a.add(f),s>0&&f==e.map[u-e.width]){const h=n.nodeAt(f).attrs;t.setNodeMarkup(t.mapping.slice(i).map(f+o),null,{...h,rowspan:h.rowspan-1}),c+=h.colspan-1}else if(s<e.height&&f==e.map[u+e.width]){const h=n.nodeAt(f),p=h.attrs,m=h.type.create({...p,rowspan:h.attrs.rowspan-1},h.content),b=e.positionAt(s+1,c,n);t.insert(t.mapping.slice(i).map(o+b),m),c+=p.colspan-1}}}}function Jn(t,e){if(!k(t))return!1;if(e){const n=I(t),o=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;Un(o,n,s),s!=n.top;s--){const l=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!l)throw RangeError("No table found");n.table=l,n.map=y.get(n.table)}e(o)}return!0}function Ae(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Gn({width:t,height:e,map:n},o){let s=o.top*t+o.left,l=s,r=(o.bottom-1)*t+o.left,i=s+(o.right-o.left-1);for(let a=o.top;a<o.bottom;a++){if(o.left>0&&n[l]==n[l-1]||o.right<t&&n[i]==n[i+1])return!0;l+=t,i+=t}for(let a=o.left;a<o.right;a++){if(o.top>0&&n[s]==n[s-t]||o.bottom<e&&n[r]==n[r+t])return!0;s++,r++}return!1}function je(t,e){const n=t.selection;if(!(n instanceof C)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=I(t),{map:s}=o;if(Gn(s,o))return!1;if(e){const l=t.tr,r={};let i=H.empty,a,c;for(let u=o.top;u<o.bottom;u++)for(let f=o.left;f<o.right;f++){const h=s.map[u*s.width+f],p=o.table.nodeAt(h);if(!(r[h]||!p))if(r[h]=!0,a==null)a=h,c=p;else{Ae(p)||(i=i.append(p.content));const m=l.mapping.map(h+o.tableStart);l.delete(m,m+p.nodeSize)}}if(a==null||c==null)return!0;if(l.setNodeMarkup(a+o.tableStart,null,{...Je(c.attrs,c.attrs.colspan,o.right-o.left-c.attrs.colspan),rowspan:o.bottom-o.top}),i.size){const u=a+1+c.content.size,f=Ae(c)?a+1:u;l.replaceWith(f+o.tableStart,u+o.tableStart,i)}l.setSelection(new C(l.doc.resolve(a+o.tableStart))),e(l)}return!0}function ve(t,e){const n=A(t.schema);return Yn(({node:o})=>n[o.type.spec.tableRole])(t,e)}function Yn(t){return(e,n)=>{var o;const s=e.selection;let l,r;if(s instanceof C){if(s.$anchorCell.pos!=s.$headCell.pos)return!1;l=s.$anchorCell.nodeAfter,r=s.$anchorCell.pos}else{if(l=Nn(s.$from),!l)return!1;r=(o=X(s.$from))==null?void 0:o.pos}if(l==null||r==null||l.attrs.colspan==1&&l.attrs.rowspan==1)return!1;if(n){let i=l.attrs;const a=[],c=i.colwidth;i.rowspan>1&&(i={...i,rowspan:1}),i.colspan>1&&(i={...i,colspan:1});const u=I(e),f=e.tr;for(let p=0;p<u.right-u.left;p++)a.push(c?{...i,colwidth:c&&c[p]?[c[p]]:null}:i);let h;for(let p=u.top;p<u.bottom;p++){let m=u.map.positionAt(p,u.left,u.table);p==u.top&&(m+=l.nodeSize);for(let b=u.left,g=0;b<u.right;b++,g++)b==u.left&&p==u.top||f.insert(h=f.mapping.map(m+u.tableStart,1),t({node:l,row:p,col:b}).createAndFill(a[g]))}f.setNodeMarkup(r,t({node:l,row:u.top,col:u.left}),a[0]),s instanceof C&&f.setSelection(new C(f.doc.resolve(s.$anchorCell.pos),h?f.doc.resolve(h):void 0)),n(f)}return!0}}function Qn(t,e){return function(n,o){if(!k(n))return!1;const s=ie(n);if(s.nodeAfter.attrs[t]===e)return!1;if(o){const l=n.tr;n.selection instanceof C?n.selection.forEachCell((r,i)=>{r.attrs[t]!==e&&l.setNodeMarkup(i,null,{...r.attrs,[t]:e})}):l.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),o(l)}return!0}}function Zn(t){return function(e,n){if(!k(e))return!1;if(n){const o=A(e.schema),s=I(e),l=e.tr,r=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),i=r.map(a=>s.table.nodeAt(a));for(let a=0;a<r.length;a++)i[a].type==o.header_cell&&l.setNodeMarkup(s.tableStart+r[a],o.cell,i[a].attrs);if(l.steps.length==0)for(let a=0;a<r.length;a++)l.setNodeMarkup(s.tableStart+r[a],o.header_cell,i[a].attrs);n(l)}return!0}}function Te(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<o.length;s++){const l=e.table.nodeAt(o[s]);if(l&&l.type!==n.header_cell)return!1}return!0}function J(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?Zn(t):function(n,o){if(!k(n))return!1;if(o){const s=A(n.schema),l=I(n),r=n.tr,i=Te("row",l,s),a=Te("column",l,s),u=(t==="column"?i:t==="row"?a:!1)?1:0,f=t=="column"?{left:0,top:u,right:1,bottom:l.map.height}:t=="row"?{left:u,top:0,right:l.map.width,bottom:1}:l,h=t=="column"?a?s.cell:s.header_cell:t=="row"?i?s.cell:s.header_cell:s.cell;l.map.cellsInRect(f).forEach(p=>{const m=p+l.tableStart,b=r.doc.nodeAt(m);b&&r.setNodeMarkup(m,h,b.attrs)}),o(r)}return!0}}J("row",{useDeprecatedLogic:!0});J("column",{useDeprecatedLogic:!0});var eo=J("cell",{useDeprecatedLogic:!0});function to(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let o=t.index(-1)-1,s=t.before();o>=0;o--){const l=t.node(-1).child(o),r=l.lastChild;if(r)return s-1-r.nodeSize;s-=l.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let o=t.indexAfter(-1),s=t.after();o<n.childCount;o++){const l=n.child(o);if(l.childCount)return s+1;s+=l.nodeSize}}return null}function Me(t){return function(e,n){if(!k(e))return!1;const o=to(ie(e),t);if(o==null)return!1;if(n){const s=e.doc.resolve(o);n(e.tr.setSelection(D.between(s,Ln(s))).scrollIntoView())}return!0}}function no(t,e){const n=t.selection.$anchor;for(let o=n.depth;o>0;o--)if(n.node(o).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0;return!1}function Z(t,e){const n=t.selection;if(!(n instanceof C))return!1;if(e){const o=t.tr,s=A(t.schema).cell.createAndFill().content;n.forEachCell((l,r)=>{l.content.eq(s)||o.replace(o.mapping.map(r+1),o.mapping.map(r+l.nodeSize-1),new _(s,0,0))}),o.docChanged&&e(o)}return!0}function oo(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:o}=t;for(;e.childCount==1&&(n>0&&o>0||e.child(0).type.spec.tableRole=="table");)n--,o--,e=e.child(0).content;const s=e.child(0),l=s.type.spec.tableRole,r=s.type.schema,i=[];if(l=="row")for(let a=0;a<e.childCount;a++){let c=e.child(a).content;const u=a?0:Math.max(0,n-1),f=a<e.childCount-1?0:Math.max(0,o-1);(u||f)&&(c=me(A(r).row,new _(c,u,f)).content),i.push(c)}else if(l=="cell"||l=="header_cell")i.push(n||o?me(A(r).row,new _(e,n,o)).content:e);else return null;return so(r,i)}function so(t,e){const n=[];for(let s=0;s<e.length;s++){const l=e[s];for(let r=l.childCount-1;r>=0;r--){const{rowspan:i,colspan:a}=l.child(r).attrs;for(let c=s;c<s+i;c++)n[c]=(n[c]||0)+a}}let o=0;for(let s=0;s<n.length;s++)o=Math.max(o,n[s]);for(let s=0;s<n.length;s++)if(s>=e.length&&e.push(H.empty),n[s]<o){const l=A(t).cell.createAndFill(),r=[];for(let i=n[s];i<o;i++)r.push(l);e[s]=e[s].append(H.from(r))}return{height:e.length,width:o,rows:e}}function me(t,e){const n=t.createAndFill();return new $t(n).replace(0,n.content.size,e).doc}function lo({width:t,height:e,rows:n},o,s){if(t!=o){const l=[],r=[];for(let i=0;i<n.length;i++){const a=n[i],c=[];for(let u=l[i]||0,f=0;u<o;f++){let h=a.child(f%a.childCount);u+h.attrs.colspan>o&&(h=h.type.createChecked(P(h.attrs,h.attrs.colspan,u+h.attrs.colspan-o),h.content)),c.push(h),u+=h.attrs.colspan;for(let p=1;p<h.attrs.rowspan;p++)l[i+p]=(l[i+p]||0)+h.attrs.colspan}r.push(H.from(c))}n=r,t=o}if(e!=s){const l=[];for(let r=0,i=0;r<s;r++,i++){const a=[],c=n[i%e];for(let u=0;u<c.childCount;u++){let f=c.child(u);r+f.attrs.rowspan>s&&(f=f.type.create({...f.attrs,rowspan:Math.max(1,s-f.attrs.rowspan)},f.content)),a.push(f)}l.push(H.from(a))}n=l,e=s}return{width:t,height:e,rows:n}}function ro(t,e,n,o,s,l,r){const i=t.doc.type.schema,a=A(i);let c,u;if(s>e.width)for(let f=0,h=0;f<e.height;f++){const p=n.child(f);h+=p.nodeSize;const m=[];let b;p.lastChild==null||p.lastChild.type==a.cell?b=c||(c=a.cell.createAndFill()):b=u||(u=a.header_cell.createAndFill());for(let g=e.width;g<s;g++)m.push(b);t.insert(t.mapping.slice(r).map(h-1+o),m)}if(l>e.height){const f=[];for(let m=0,b=(e.height-1)*e.width;m<Math.max(e.width,s);m++){const g=m>=e.width?!1:n.nodeAt(e.map[b+m]).type==a.header_cell;f.push(g?u||(u=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const h=a.row.create(null,H.from(f)),p=[];for(let m=e.height;m<l;m++)p.push(h);t.insert(t.mapping.slice(r).map(o+n.nodeSize-2),p)}return!!(c||u)}function Re(t,e,n,o,s,l,r,i){if(r==0||r==e.height)return!1;let a=!1;for(let c=s;c<l;c++){const u=r*e.width+c,f=e.map[u];if(e.map[u-e.width]==f){a=!0;const h=n.nodeAt(f),{top:p,left:m}=e.findCell(f);t.setNodeMarkup(t.mapping.slice(i).map(f+o),null,{...h.attrs,rowspan:r-p}),t.insert(t.mapping.slice(i).map(e.positionAt(r,m,n)),h.type.createAndFill({...h.attrs,rowspan:p+h.attrs.rowspan-r})),c+=h.attrs.colspan-1}}return a}function ke(t,e,n,o,s,l,r,i){if(r==0||r==e.width)return!1;let a=!1;for(let c=s;c<l;c++){const u=c*e.width+r,f=e.map[u];if(e.map[u-1]==f){a=!0;const h=n.nodeAt(f),p=e.colCount(f),m=t.mapping.slice(i).map(f+o);t.setNodeMarkup(m,null,P(h.attrs,r-p,h.attrs.colspan-(r-p))),t.insert(m+h.nodeSize,h.type.createAndFill(P(h.attrs,0,r-p))),c+=h.attrs.rowspan-1}}return a}function Ne(t,e,n,o,s){let l=n?t.doc.nodeAt(n-1):t.doc;if(!l)throw new Error("No table found");let r=y.get(l);const{top:i,left:a}=o,c=a+s.width,u=i+s.height,f=t.tr;let h=0;function p(){if(l=n?f.doc.nodeAt(n-1):f.doc,!l)throw new Error("No table found");r=y.get(l),h=f.mapping.maps.length}ro(f,r,l,n,c,u,h)&&p(),Re(f,r,l,n,a,c,i,h)&&p(),Re(f,r,l,n,a,c,u,h)&&p(),ke(f,r,l,n,i,u,a,h)&&p(),ke(f,r,l,n,i,u,c,h)&&p();for(let m=i;m<u;m++){const b=r.positionAt(m,a,l),g=r.positionAt(m,c,l);f.replace(f.mapping.slice(h).map(b+n),f.mapping.slice(h).map(g+n),new _(s.rows[m-i],0,0))}p(),f.setSelection(new C(f.doc.resolve(n+r.positionAt(i,a,l)),f.doc.resolve(n+r.positionAt(u-1,c-1,l)))),e(f)}var io=Bt({ArrowLeft:ee("horiz",-1),ArrowRight:ee("horiz",1),ArrowUp:ee("vert",-1),ArrowDown:ee("vert",1),"Shift-ArrowLeft":te("horiz",-1),"Shift-ArrowRight":te("horiz",1),"Shift-ArrowUp":te("vert",-1),"Shift-ArrowDown":te("vert",1),Backspace:Z,"Mod-Backspace":Z,Delete:Z,"Mod-Delete":Z});function oe(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function ee(t,e){return(n,o,s)=>{if(!s)return!1;const l=n.selection;if(l instanceof C)return oe(n,o,F.near(l.$headCell,e));if(t!="horiz"&&!l.empty)return!1;const r=tt(s,t,e);if(r==null)return!1;if(t=="horiz")return oe(n,o,F.near(n.doc.resolve(l.head+e),e));{const i=n.doc.resolve(r),a=Ue(i,t,e);let c;return a?c=F.near(a,1):e<0?c=F.near(n.doc.resolve(i.before(-1)),-1):c=F.near(n.doc.resolve(i.after(-1)),1),oe(n,o,c)}}}function te(t,e){return(n,o,s)=>{if(!s)return!1;const l=n.selection;let r;if(l instanceof C)r=l;else{const a=tt(s,t,e);if(a==null)return!1;r=new C(n.doc.resolve(a))}const i=Ue(r.$headCell,t,e);return i?oe(n,o,new C(r.$anchorCell,i)):!1}}function ao(t,e){const n=t.state.doc,o=X(n.resolve(e));return o?(t.dispatch(t.state.tr.setSelection(new C(o))),!0):!1}function co(t,e,n){if(!k(t.state))return!1;let o=oo(n);const s=t.state.selection;if(s instanceof C){o||(o={width:1,height:1,rows:[H.from(me(A(t.state.schema).cell,n))]});const l=s.$anchorCell.node(-1),r=s.$anchorCell.start(-1),i=y.get(l).rectBetween(s.$anchorCell.pos-r,s.$headCell.pos-r);return o=lo(o,i.right-i.left,i.bottom-i.top),Ne(t.state,t.dispatch,r,i,o),!0}else if(o){const l=ie(t.state),r=l.start(-1);return Ne(t.state,t.dispatch,r,y.get(l.node(-1)).findCell(l.pos-r),o),!0}else return!1}function uo(t,e){var n;if(e.ctrlKey||e.metaKey)return;const o=He(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof C)l(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&(s=X(t.state.selection.$anchor))!=null&&((n=ce(t,e))==null?void 0:n.pos)!=s.pos)l(s,e),e.preventDefault();else if(!o)return;function l(a,c){let u=ce(t,c);const f=W.getState(t.state)==null;if(!u||!Se(a,u))if(f)u=a;else return;const h=new C(a,u);if(f||!t.state.selection.eq(h)){const p=t.state.tr.setSelection(h);f&&p.setMeta(W,a.pos),t.dispatch(p)}}function r(){t.root.removeEventListener("mouseup",r),t.root.removeEventListener("dragstart",r),t.root.removeEventListener("mousemove",i),W.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(W,-1))}function i(a){const c=a,u=W.getState(t.state);let f;if(u!=null)f=t.state.doc.resolve(u);else if(He(t,c.target)!=o&&(f=ce(t,e),!f))return r();f&&l(f,c)}t.root.addEventListener("mouseup",r),t.root.addEventListener("dragstart",r),t.root.addEventListener("mousemove",i)}function tt(t,e,n){if(!(t.state.selection instanceof D))return null;const{$head:o}=t.state.selection;for(let s=o.depth-1;s>=0;s--){const l=o.node(s);if((n<0?o.index(s):o.indexAfter(s))!=(n<0?0:l.childCount))return null;if(l.type.spec.tableRole=="cell"||l.type.spec.tableRole=="header_cell"){const i=o.before(s),a=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?i:null}}return null}function He(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function ce(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?X(t.state.doc.resolve(n.pos)):null}var fo=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ge(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,ge(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function ge(t,e,n,o,s,l){var r;let i=0,a=!0,c=e.firstChild;const u=t.firstChild;if(u){for(let f=0,h=0;f<u.childCount;f++){const{colspan:p,colwidth:m}=u.child(f).attrs;for(let b=0;b<p;b++,h++){const g=s==h?l:m&&m[b],x=g?g+"px":"";if(i+=g||o,g||(a=!1),c)c.style.width!=x&&(c.style.width=x),c=c.nextSibling;else{const j=document.createElement("col");j.style.width=x,e.appendChild(j)}}}for(;c;){const f=c.nextSibling;(r=c.parentNode)==null||r.removeChild(c),c=f}a?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}}var v=new ye("tableColumnResizing");function ho({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:o=fo,lastColumnResizable:s=!0}={}){const l=new qe({key:v,state:{init(r,i){var a,c;const u=(c=(a=l.spec)==null?void 0:a.props)==null?void 0:c.nodeViews,f=A(i.schema).table.name;return o&&u&&(u[f]=(h,p)=>new o(h,n,p)),new po(-1,!1)},apply(r,i){return i.apply(r)}},props:{attributes:r=>{const i=v.getState(r);return i&&i.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(r,i)=>{mo(r,i,t,s)},mouseleave:r=>{go(r)},mousedown:(r,i)=>{bo(r,i,e,n)}},decorations:r=>{const i=v.getState(r);if(i&&i.activeHandle>-1)return So(r,i.activeHandle)},nodeViews:{}}});return l}var po=class se{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,o=e.getMeta(v);if(o&&o.setHandle!=null)return new se(o.setHandle,!1);if(o&&o.setDragging!==void 0)return new se(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&e.docChanged){let s=e.mapping.map(n.activeHandle,-1);return pe(e.doc.resolve(s))||(s=-1),new se(s,n.dragging)}return n}};function mo(t,e,n,o){if(!t.editable)return;const s=v.getState(t.state);if(s&&!s.dragging){const l=wo(e.target);let r=-1;if(l){const{left:i,right:a}=l.getBoundingClientRect();e.clientX-i<=n?r=Le(t,e,"left",n):a-e.clientX<=n&&(r=Le(t,e,"right",n))}if(r!=s.activeHandle){if(!o&&r!==-1){const i=t.state.doc.resolve(r),a=i.node(-1),c=y.get(a),u=i.start(-1);if(c.colCount(i.pos-u)+i.nodeAfter.attrs.colspan-1==c.width-1)return}nt(t,r)}}}function go(t){if(!t.editable)return;const e=v.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&nt(t,-1)}function bo(t,e,n,o){var s;if(!t.editable)return!1;const l=(s=t.dom.ownerDocument.defaultView)!=null?s:window,r=v.getState(t.state);if(!r||r.activeHandle==-1||r.dragging)return!1;const i=t.state.doc.nodeAt(r.activeHandle),a=xo(t,r.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(v,{setDragging:{startX:e.clientX,startWidth:a}}));function c(f){l.removeEventListener("mouseup",c),l.removeEventListener("mousemove",u);const h=v.getState(t.state);h!=null&&h.dragging&&(Co(t,h.activeHandle,Ee(h.dragging,f,n)),t.dispatch(t.state.tr.setMeta(v,{setDragging:null})))}function u(f){if(!f.which)return c(f);const h=v.getState(t.state);if(h&&h.dragging){const p=Ee(h.dragging,f,n);Ie(t,h.activeHandle,p,o)}}return Ie(t,r.activeHandle,a,o),l.addEventListener("mouseup",c),l.addEventListener("mousemove",u),e.preventDefault(),!0}function xo(t,e,{colspan:n,colwidth:o}){const s=o&&o[o.length-1];if(s)return s;const l=t.domAtPos(e);let i=l.node.childNodes[l.offset].offsetWidth,a=n;if(o)for(let c=0;c<n;c++)o[c]&&(i-=o[c],a--);return i/a}function wo(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function Le(t,e,n,o){const s=n=="right"?-o:o,l=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!l)return-1;const{pos:r}=l,i=X(t.state.doc.resolve(r));if(!i)return-1;if(n=="right")return i.pos;const a=y.get(i.node(-1)),c=i.start(-1),u=a.map.indexOf(i.pos-c);return u%a.width==0?-1:c+a.map[u-1]}function Ee(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function nt(t,e){t.dispatch(t.state.tr.setMeta(v,{setHandle:e}))}function Co(t,e,n){const o=t.state.doc.resolve(e),s=o.node(-1),l=y.get(s),r=o.start(-1),i=l.colCount(o.pos-r)+o.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let c=0;c<l.height;c++){const u=c*l.width+i;if(c&&l.map[u]==l.map[u-l.width])continue;const f=l.map[u],h=s.nodeAt(f).attrs,p=h.colspan==1?0:i-l.colCount(f);if(h.colwidth&&h.colwidth[p]==n)continue;const m=h.colwidth?h.colwidth.slice():yo(h.colspan);m[p]=n,a.setNodeMarkup(r+f,null,{...h,colwidth:m})}a.docChanged&&t.dispatch(a)}function Ie(t,e,n,o){const s=t.state.doc.resolve(e),l=s.node(-1),r=s.start(-1),i=y.get(l).colCount(s.pos-r)+s.nodeAfter.attrs.colspan-1;let a=t.domAtPos(s.start(-1)).node;for(;a&&a.nodeName!="TABLE";)a=a.parentNode;a&&ge(l,a.firstChild,a,o,i,n)}function yo(t){return Array(t).fill(0)}function So(t,e){var n;const o=[],s=t.doc.resolve(e),l=s.node(-1);if(!l)return de.empty;const r=y.get(l),i=s.start(-1),a=r.colCount(s.pos-i)+s.nodeAfter.attrs.colspan-1;for(let c=0;c<r.height;c++){const u=a+c*r.width;if((a==r.width-1||r.map[u]!=r.map[u+1])&&(c==0||r.map[u]!=r.map[u-r.width])){const f=r.map[u],h=i+f+l.nodeAt(f).nodeSize-1,p=document.createElement("div");p.className="column-resize-handle",(n=v.getState(t))!=null&&n.dragging&&o.push(ue.node(i+f,i+f+l.nodeAt(f).nodeSize,{class:"column-resize-dragging"})),o.push(ue.widget(h,p))}}return de.create(t.doc,o)}function Ao({allowTableNodeSelection:t=!1}={}){return new qe({key:W,state:{init(){return null},apply(e,n){const o=e.getMeta(W);if(o!=null)return o==-1?null:o;if(n==null||!e.docChanged)return n;const{deleted:s,pos:l}=e.mapping.mapResult(n);return s?null:l}},props:{decorations:zn,handleDOMEvents:{mousedown:uo},createSelectionBetween(e){return W.getState(e.state)!=null?e.state.selection:null},handleTripleClick:ao,handleKeyDown:io,handlePaste:co},appendTransaction(e,n,o){return Bn(o,Qe(o,n),t)}})}var jo=q.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const o=t.getAttribute("colwidth"),s=o?o.split(",").map(l=>parseInt(l,10)):null;if(!s){const l=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),r=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(r&&r>-1&&l&&l[r]){const i=l[r].getAttribute("width");return i?[parseInt(i,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",$(this.options.HTMLAttributes,t),0]}}),vo=q.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",$(this.options.HTMLAttributes,t),0]}}),To=q.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",$(this.options.HTMLAttributes,t),0]}});function be(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function ze(t,e,n,o,s,l){var r;let i=0,a=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let h=0,p=0;h<u.childCount;h+=1){const{colspan:m,colwidth:b}=u.child(h).attrs;for(let g=0;g<m;g+=1,p+=1){const x=s===p?l:b&&b[g],j=x?`${x}px`:"";if(i+=x||o,x||(a=!1),c){if(c.style.width!==j){const[T,B]=be(o,x);c.style.setProperty(T,B)}c=c.nextSibling}else{const T=document.createElement("col"),[B,M]=be(o,x);T.style.setProperty(B,M),e.appendChild(T)}}}for(;c;){const h=c.nextSibling;(r=c.parentNode)==null||r.removeChild(c),c=h}const f=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);a&&!f?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}var Mo=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ze(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,ze(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),o=this.contentDOM.contains(e);return!!(n&&!o&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function Ro(t,e,n,o){let s=0,l=!0;const r=[],i=t.firstChild;if(!i)return{};for(let f=0,h=0;f<i.childCount;f+=1){const{colspan:p,colwidth:m}=i.child(f).attrs;for(let b=0;b<p;b+=1,h+=1){const g=n===h?o:m&&m[b];s+=g||e,g||(l=!1);const[x,j]=be(e,g);r.push(["col",{style:`${x}: ${j}`}])}}const a=l?`${s}px`:"",c=l?"":`${s}px`;return{colgroup:["colgroup",{},...r],tableWidth:a,tableMinWidth:c}}function Fe(t,e){return t.createAndFill()}function ko(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const o=t.nodes[n];o.spec.tableRole&&(e[o.spec.tableRole]=o)}),t.cached.tableNodeTypes=e,e}function No(t,e,n,o,s){const l=ko(t),r=[],i=[];for(let c=0;c<n;c+=1){const u=Fe(l.cell);if(u&&i.push(u),o){const f=Fe(l.header_cell);f&&r.push(f)}}const a=[];for(let c=0;c<e;c+=1)a.push(l.row.createChecked(null,o&&c===0?r:i));return l.table.createChecked(null,a)}function Ho(t){return t instanceof C}var ne=({editor:t})=>{const{selection:e}=t.state;if(!Ho(e))return!1;let n=0;const o=Vt(e.ranges[0].$from,l=>l.type.name==="table");return o==null||o.node.descendants(l=>{if(l.type.name==="table")return!1;["tableCell","tableHeader"].includes(l.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},Lo="";function Eo(t){return(t||"").replace(/\s+/g," ").trim()}function Io(t,e,n={}){var o;const s=(o=n.cellLineSeparator)!=null?o:Lo;if(!t||!t.content||t.content.length===0)return"";const l=[];t.content.forEach(m=>{const b=[];m.content&&m.content.forEach(g=>{let x="";g.content&&Array.isArray(g.content)&&g.content.length>1?x=g.content.map(M=>e.renderChildren(M)).join(s):x=g.content?e.renderChildren(g.content):"";const j=Eo(x),T=g.type==="tableHeader";b.push({text:j,isHeader:T})}),l.push(b)});const r=l.reduce((m,b)=>Math.max(m,b.length),0);if(r===0)return"";const i=new Array(r).fill(0);l.forEach(m=>{var b;for(let g=0;g<r;g+=1){const j=(((b=m[g])==null?void 0:b.text)||"").length;j>i[g]&&(i[g]=j),i[g]<3&&(i[g]=3)}});const a=(m,b)=>m+" ".repeat(Math.max(0,b-m.length)),c=l[0],u=c.some(m=>m.isHeader);let f=`
`;const h=new Array(r).fill(0).map((m,b)=>u&&c[b]&&c[b].text||"");return f+=`| ${h.map((m,b)=>a(m,i[b])).join(" | ")} |
`,f+=`| ${i.map(m=>"-".repeat(Math.max(3,m))).join(" | ")} |
`,(u?l.slice(1):l).forEach(m=>{f+=`| ${new Array(r).fill(0).map((b,g)=>a(m[g]&&m[g].text||"",i[g])).join(" | ")} |
`}),f}var zo=Io,Fo=q.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Mo,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:o,tableMinWidth:s}=Ro(t,this.options.cellMinWidth),l=e.style;function r(){return l||(o?`width: ${o}`:`min-width: ${s}`)}const i=["table",$(this.options.HTMLAttributes,e,{style:r()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},i]:i},parseMarkdown:(t,e)=>{const n=[];if(t.header){const o=[];t.header.forEach(s=>{o.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(s.tokens)}]))}),n.push(e.createNode("tableRow",{},o))}return t.rows&&t.rows.forEach(o=>{const s=[];o.forEach(l=>{s.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(l.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>zo(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:o,dispatch:s,editor:l})=>{const r=No(l.schema,t,e,n);if(s){const i=o.selection.from+1;o.replaceSelectionWith(r).scrollIntoView().setSelection(D.near(o.doc.resolve(i)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>$n(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Pn(t,e),deleteColumn:()=>({state:t,dispatch:e})=>Vn(t,e),addRowBefore:()=>({state:t,dispatch:e})=>qn(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Xn(t,e),deleteRow:()=>({state:t,dispatch:e})=>Jn(t,e),deleteTable:()=>({state:t,dispatch:e})=>no(t,e),mergeCells:()=>({state:t,dispatch:e})=>je(t,e),splitCell:()=>({state:t,dispatch:e})=>ve(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>J("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>J("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>eo(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>je(t,e)?!0:ve(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:o})=>Qn(t,e)(n,o),goToNextCell:()=>({state:t,dispatch:e})=>Me(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Me(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Qe(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const o=C.create(e.doc,t.anchorCell,t.headCell);e.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ne,"Mod-Backspace":ne,Delete:ne,"Mod-Delete":ne}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[ho({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Ao({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Pt(Ot(t,"tableRole",e))}}}),Do=re.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(Fo.configure(this.options.table)),this.options.tableCell!==!1&&t.push(jo.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(vo.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(To.configure(this.options.tableRow)),t}}),Bo=re.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).some(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).some(e=>e),toggleTextAlign:t=>({editor:e,commands:n})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),Wo=Bo;const _o=[Kt.configure({codeBlock:!1,link:{shouldAutoLink:t=>/^https?:\/\//.test(t)}}),Do.configure({table:{resizable:!0}}),Yt.configure({placeholder:"Write something..."}),qt,vn,An,Xt,Ut,xn,Cn,Jt.configure({lowlight:Gt}),Wo.configure({types:["heading","paragraph"]}),yn,wn];function $o(){const[t,e]=R.useState(!1),{trans:n}=ft(),s=Oe().watch("title"),l=n({message:"Title"}),r=t?d.jsx($e,{placeholder:l,autoFocus:!0,className:"mb-30",onBlur:()=>{e(!1)},name:"title",required:!0}):d.jsxs("h1",{tabIndex:0,onClick:()=>{e(!0)},onFocus:()=>{e(!0)},className:O("cursor-pointer rounded hover:bg-primary/focus",!s&&"text-muted"),children:[s||l,d.jsx(en,{className:"mx-8 mt-8 align-top text-muted icon-sm"})]});return d.jsx("div",{className:"prose mx-auto my-48 w-full flex-shrink-0 px-24 dark:prose-invert",children:r})}function ot(){const{rightSidenavStatus:t,setRightSidenavStatus:e}=R.useContext(Xe);return d.jsx(le,{label:d.jsx(w,{message:"Toggle sidebar"}),children:d.jsx(L,{size:"xs",onClick:()=>e(t==="open"?"closed":"open"),children:d.jsx(nn,{})})})}function fs({initialContent:t,onChange:e,title:n,saveButton:o,imageUploadType:s,aside:l}){const{rightSidenavStatus:r}=R.useContext(Xe);return d.jsx(Qt,{extensions:_o,initialContent:t,onChange:e,children:d.jsxs(Ft,{children:[d.jsxs("section",{className:"dashboard-grid-content dashboard-rounded-panel flex h-full min-h-0 min-w-0 flex-col",children:[d.jsx(gn,{saveButton:o,rightContent:r==="closed"?d.jsx(ot,{}):null,children:n}),d.jsx(dn,{imageUploadType:s}),d.jsxs("div",{className:"flex-auto overflow-y-auto",children:[d.jsx($o,{}),d.jsx(Zt,{className:"prose mx-auto flex-auto px-24 dark:prose-invert"})]})]}),l&&d.jsx(tn,{position:"right",size:"w-[350px]",className:"dashboard-rounded-panel flex-shrink-0 flex-col lg:ml-8",children:d.jsx(Po,{children:l})})]})})}function Po({children:t}){return d.jsxs(R.Fragment,{children:[d.jsx(Ve,{rightContent:d.jsx(ot,{}),children:d.jsx(w,{message:"Details"})}),d.jsx("div",{className:"flex-auto overflow-y-auto p-24",children:t})]})}export{fs as A};
