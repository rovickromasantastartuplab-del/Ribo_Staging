var kd=Object.defineProperty;var Ad=(e,t,n)=>t in e?kd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var fe=(e,t,n)=>Ad(e,typeof t!="symbol"?t+"":t,n);import{r as z,j as a,ak as Md,m as ae,bg as nr,bf as Td,bV as Pd,Y as Dd,b$ as Rd,bA as $o,aP as rr,ac as je,F as sn,T as $,d as xe,az as le,f as $e,X as Ae,aG as Ne,aj as Ie,as as Qs,a_ as ft,E as Ld,cf as zd,cg as Xa,bZ as $d,P as on,b as Ua,be as Je,B as ie,p as ge,a1 as Od,aX as Js,av as Yt,q as Za,aR as eo,al as sr,am as to,an as no,ap as ro,aq as so,z as On,C as oo,aw as or,ax as ir,bF as Vd,b2 as Ds,bD as Bd,b0 as Fd,ae as Hd,e as io,t as Ka,aJ as qd,aK as Gd,l as Rs,L as Qa,A as Yd,aQ as Wd,cj as Xd,ao as Ud,i as Zd,s as Kd,k as Qd}from"./client-DtfdVV77.js";import{P as Oo,g as ke,A as Ja,k as Jd,U as Vo}from"./main-BGmGAxtx.js";import{L as ef}from"./library-icon-h4d3s9Ef.js";import{A as tf}from"./AccountTree-BVzukxeW.js";import{C as nf}from"./Chat-C94dcr0C.js";import{F as Bo,C as yn,V as Fo,a as rf,R as sf}from"./Remove-zJbHEDiB.js";import{D as el}from"./DataObject-3cjjRxnv.js";import{H as of}from"./HelpOutline-DkAeNvPf.js";import{H as tl}from"./Home-iO0iebLw.js";import{P as af}from"./Power-BC4_tQD3.js";import{R as lf}from"./Route-DzO-FrWL.js";import{S as cf}from"./dashboard-icons-BJ4c3Z5i.js";import{a as uf,u as Et,r as df,F as nl}from"./file-upload-provider-B4w-VsYu.js";import{u as ff}from"./use-tags-BV0JpuMa.js";import{F as hf}from"./form-chip-field-C7l8nGPv.js";import{u as yt}from"./use-required-params-BhaT_-q3.js";import{a as mf}from"./file-thumbnail-DlIWt16b.js";import{u as rl}from"./shallow-BH2jDtXM.js";import{F as Le}from"./tiptap-text-field-DefhwkAZ.js";import{F as qe}from"./select-D9niWe2H.js";import{a as Vn,u as it,A as sl,b as pf}from"./variable-extension-BUEoymSX.js";import{A as ol}from"./attribute-input-renderer-BEkqCl5D.js";import{t as il,T as al}from"./technology-or-locale-select-LDBO6buo.js";import{A as Oe}from"./Add-B1HfWgJf.js";import{I as gf}from"./image-up-hBoBC5iJ.js";import{P as xf}from"./paperclip-1tb_aUIl.js";import{o as yf}from"./open-upload-window-DE9Q8gNs.js";import{h as wf}from"./custom-menu-Dvq-fOnC.js";import{C as bf}from"./combobox-CFh39yI7.js";import{D as ao}from"./DragHandle-CczVUV80.js";import{u as ar,a as vf}from"./use-sortable-CsHM4tcn.js";import{D as Nf}from"./DragIndicator-CvftiD3i.js";import{M as jf}from"./MoreHoriz-Df3_bV9s.js";import{C as Ef}from"./confirmation-dialog-BzXs9ksK.js";import{F as ll}from"./filter-operator-names-BbrFb9i0.js";import{A as _f}from"./attribute-renderer-C6KvryoI.js";import{F as If}from"./formatted-country-name-D5NqMtcP.js";import{A as Sf}from"./ArrowBack-DIhVch2U.js";import{D as Bn}from"./Delete-DWP7kvj0.js";import{E as cl}from"./Edit-BaEHOLuK.js";import{F as Cf}from"./image-selector-fVyS7PG4.js";import{A as ul,a as dl}from"./accordion-Dmxnze9z.js";import{A as kf}from"./attributes-manager-D-sW2vlt.js";import{u as fl}from"./useSuspenseQuery-Bmt2-NKx.js";import{O as hl}from"./OpenInNew-C06CZDpe.js";import{C as ml}from"./chip-list-DHXDGW6X.js";import{C as Af}from"./check-circle-filled-B4oRGH_i.js";import{i as Mf,u as Ar}from"./use-keybind-DRgaCeX0.js";import{u as Tf}from"./with-selector-DPNnjGhI.js";import{P as Pf,T as Df}from"./toggle-preview-button-BfqVe6Bw.js";import{A as Rf}from"./admin-config-DXsixO44.js";import{D as Lf}from"./settings-links-CRsxvJIZ.js";import{D as zf}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{S as $f}from"./section-helper-BcMoHesA.js";import{u as Of}from"./useMutationState-Bmyxea6H.js";import{B as Vf,a as Ho}from"./breadcrumb-CaNBY_Ut.js";import{B as Bf}from"./blocker-dialog-B0Vc-LIE.js";import"./messages-square-icon-D_3IR-rK.js";import"./SupervisorAccount-Bkn2ibMi.js";import"./uploaded-file-DOXWsty7.js";import"./pretty-bytes-bO14ePu9.js";import"./file-type-icon-CNIGAaMG.js";import"./emoji-picker-button-Cm_kBrZ5.js";import"./tiptap-editor-context-CeN7pXcf.js";import"./index-Y7xUBCAo.js";import"./index-uUjpwT6n.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DZmli5NZ.js";import"./Event-DDJ424UR.js";import"./ToggleOn-DbVFGpQu.js";import"./TextFields-CM1xUWDR.js";import"./button-group-DAgYjIi8.js";import"./date-picker-BGiTN72q.js";import"./radio-DP8xYP6t.js";import"./radio-group-C_T7jNq6.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./ThumbDown-BB-li-Gi.js";import"./ThumbUp-CTCneb2T.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-CpvjuNXE.js";import"./useGlobalListeners-BGMP113F.js";import"./use-active-upload-CGOT7g6R.js";import"./AddAPhoto-Bl3FQpaJ.js";import"./progress-bar-BMzArYUQ.js";import"./file-input-config-DrcTpI3-.js";import"./accordtion-animation-BGCK95Hj.js";import"./pretty-attribute-type-DnpvguCK.js";import"./Lock-Dv_tThfr.js";import"./skeleton-D178v0-U.js";import"./group-array-by-5IjT7qk6.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./preview-messages-B_u8VttT.js";import"./RestartAlt-DTi82oFC.js";import"./use-is-module-installed-CDjratdW.js";import"./Translate-DPB2wdvD.js";import"./external-link-Cxcw6nc_.js";import"./book-open-D91H26Dq.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./useEffectEvent-Offmqu_S.js";import"./ChevronRight-C5OrfRtB.js";const Ff=z.forwardRef((e,t)=>a.jsxs(Md,{...e,ref:t,children:[a.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),a.jsx("path",{d:"m14.5 7.5-5 5"}),a.jsx("path",{d:"m9.5 7.5 5 5"})]}));var K=(e=>(e.start="start",e.message="message",e.buttons="buttons",e.dynamicButtons="dynamicButtons",e.buttonsItem="buttonsItem",e.articles="articles",e.cards="cards",e.dynamicCards="dynamicCards",e.transfer="transfer",e.closeConversation="closeConversation",e.goToStep="goToStep",e.goToFlow="goToFlow",e.collectDetails="collectDetails",e.tool="tool",e.toolResult="toolResult",e.setAttribute="setAttribute",e.addTags="addTags",e.branches="branches",e.branchesItem="branchesItem",e.placeholder="placeholder",e))(K||{});const wn={width:200,height:100},Hf={width:60,height:60},Me={width:200,height:60},Mr={width:120,height:40};function he(e,t){return{...t,type:e,createNewStoredNode:t.createNewStoredNode||(n=>[we({type:e,parentId:n})])}}const ce={start:he(K.start,{size:Me,icon:tl,displayName:ae("Start point")}),message:he(K.message,{size:wn,icon:nf,displayName:ae("Message"),createNewStoredNode:e=>[we({type:K.message,parentId:e,data:{message:"",buttons:[],attachmentIds:[]}})]}),buttons:he(K.buttons,{size:wn,icon:yn,displayName:ae("Buttons"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=we({type:K.buttons,parentId:e,data:{message:"Select one of these options",attachmentIds:[]}});return[t,...ce.buttonsItem.createNewStoredNode(t.id)]}}),buttonsItem:he(K.buttonsItem,{size:Mr,icon:yn,displayName:ae("Buttons item"),createNewStoredNode:e=>[we({type:K.buttonsItem,parentId:e,data:{name:"Button"}})]}),dynamicButtons:he(K.dynamicButtons,{size:Me,icon:yn,displayName:ae("Dynamic buttons"),requiredAnsector:K.tool}),articles:he(K.articles,{size:Me,icon:ef,displayName:ae("Help center articles"),createNewStoredNode:e=>[we({type:K.articles,parentId:e,data:{message:"",attachmentIds:[],articleIds:[]}})]}),cards:he(K.cards,{size:Me,icon:Fo,displayName:ae("Cards"),createNewStoredNode:e=>[we({type:K.cards,parentId:e,data:{message:"",attachmentIds:[],cards:[{title:"Card title",description:"Card description",buttons:[{name:"Button",actionType:"openUrl",actionValue:"https://example.com"}]}]}})]}),dynamicCards:he(K.dynamicCards,{size:Me,icon:Fo,displayName:ae("Dynamic cards"),requiredAnsector:K.tool,createNewStoredNode:e=>[we({type:K.dynamicCards,parentId:e,data:{message:"",listPath:"",attachmentIds:[],toolId:0,card:{title:"",description:"",buttons:[{name:"",actionType:"sendMessage",actionValue:""}]}}})]}),collectDetails:he(K.collectDetails,{size:Me,icon:of,displayName:ae("Ask for details"),createNewStoredNode:e=>[we({type:K.collectDetails,parentId:e,data:{attributeIds:[]}})]}),tool:he(K.tool,{size:Me,icon:af,displayName:ae("Use tool"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=we({type:K.tool,parentId:e});return[t,...ce.toolResult.createNewStoredNode(t.id,{type:"success"}),...ce.toolResult.createNewStoredNode(t.id,{type:"failure"})]}}),toolResult:he(K.toolResult,{size:Mr,icon:yn,displayName:ae("Tool result"),createNewStoredNode:(e,t)=>[we({type:K.toolResult,parentId:e,data:{type:(t==null?void 0:t.type)??"success"}})]}),setAttribute:he(K.setAttribute,{size:Me,icon:el,displayName:ae("Set attribute")}),addTags:he(K.addTags,{size:Me,icon:cf,displayName:ae("Add tags")}),branches:he(K.branches,{size:Hf,icon:Bo,displayName:ae("Branches"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=we({type:K.branches,parentId:e});return[t,ce.branchesItem.createNewStoredNode(t.id,{name:"If this"})[0],ce.branchesItem.createNewStoredNode(t.id,{name:"Else",isElseBranch:!0})[0]]}}),branchesItem:he(K.branchesItem,{size:Mr,icon:Bo,displayName:ae("Branch item"),createNewStoredNode:(e,t)=>[we({type:K.branchesItem,parentId:e,data:{name:"Branch",branchMatchType:"or",conditionGroups:[{conditions:[],matchType:"or"}],...t}})]}),goToStep:he(K.goToStep,{size:Me,icon:lf,displayName:ae("Go to step"),isTerminal:!0,createNewStoredNode:e=>[we({type:K.goToStep,parentId:e,data:{targetNodeId:""}})]}),goToFlow:he(K.goToFlow,{size:Me,icon:tf,displayName:ae("Go to flow"),isTerminal:!0,createNewStoredNode:e=>[we({type:K.goToFlow,parentId:e,data:{targetFlowId:0}})]}),transfer:he(K.transfer,{size:wn,icon:Oo,displayName:ae("Transfer"),isTerminal:!0,createNewStoredNode:e=>[we({type:K.transfer,parentId:e,data:{message:"",attachmentIds:[]}})]}),closeConversation:he(K.closeConversation,{size:wn,icon:Ff,displayName:ae("Close conversation"),isTerminal:!0}),placeholder:he(K.placeholder,{size:{width:200,height:28},icon:Oo,displayName:ae("Placeholder")})};function qf(e,t){let{type:n,parentId:s,asNewBranch:r,data:i}=t,o=ce[n].createNewStoredNode(s,i);const l=e.findLastIndex(c=>c.parentId===s);if(l!==-1)e.splice(l+1,0,...o);else{const c=e.findIndex(u=>u.id===s);e.splice(c+1,0,...o)}return r||(e=e.map(c=>c.parentId===s&&c.id!==o[0].id?{...c,parentId:o[0].id}:c)),{allNodes:e,newNodes:o}}function lo(e,t,n){const s=e.findIndex(i=>i.id===t),r=e[s];return e[s]={...r,data:{...r.data,...n}},e}function Gf(e,t){var r;const n=(r=e.find(i=>i.id===t))==null?void 0:r.parentId;return!e.find(i=>i.id===t)||!n?null:(e=e.filter(i=>i.id!==t),e=e.map(i=>i.parentId===t?{...i,parentId:n}:i),{allNodes:e,parentId:n})}function Yf(e,t){var i;const n=(i=e.find(o=>o.id===t))==null?void 0:i.parentId;if(!n)return null;const s=[];return{allNodes:e.filter(o=>o.id===t||o.parentId===t||s.includes(o.parentId)?(s.push(o.id),!1):!0),parentId:n}}function we({id:e,type:t,parentId:n,data:s}){let r=s;r||(r={});const i=e??nr();return r.parentId=n,r.flowId=i,{id:i,parentId:n,type:t,data:r}}const pl="TB",Dt=()=>{const[e,t]=Td("flow-direction",pl);return{flowDirection:e,setFlowDirection:t}},Wf=()=>localStorage.getItem("flow-direction")??pl;var Tr,qo;function co(){if(qo)return Tr;qo=1;var e="\0",t="\0",n="";class s{constructor(d){fe(this,"_isDirected",!0);fe(this,"_isMultigraph",!1);fe(this,"_isCompound",!1);fe(this,"_label");fe(this,"_defaultNodeLabelFn",()=>{});fe(this,"_defaultEdgeLabelFn",()=>{});fe(this,"_nodes",{});fe(this,"_in",{});fe(this,"_preds",{});fe(this,"_out",{});fe(this,"_sucs",{});fe(this,"_edgeObjs",{});fe(this,"_edgeLabels",{});fe(this,"_nodeCount",0);fe(this,"_edgeCount",0);fe(this,"_parent");fe(this,"_children");d&&(this._isDirected=Object.hasOwn(d,"directed")?d.directed:!0,this._isMultigraph=Object.hasOwn(d,"multigraph")?d.multigraph:!1,this._isCompound=Object.hasOwn(d,"compound")?d.compound:!1),this._isCompound&&(this._parent={},this._children={},this._children[t]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(d){return this._label=d,this}graph(){return this._label}setDefaultNodeLabel(d){return this._defaultNodeLabelFn=d,typeof d!="function"&&(this._defaultNodeLabelFn=()=>d),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var d=this;return this.nodes().filter(f=>Object.keys(d._in[f]).length===0)}sinks(){var d=this;return this.nodes().filter(f=>Object.keys(d._out[f]).length===0)}setNodes(d,f){var h=arguments,m=this;return d.forEach(function(x){h.length>1?m.setNode(x,f):m.setNode(x)}),this}setNode(d,f){return Object.hasOwn(this._nodes,d)?(arguments.length>1&&(this._nodes[d]=f),this):(this._nodes[d]=arguments.length>1?f:this._defaultNodeLabelFn(d),this._isCompound&&(this._parent[d]=t,this._children[d]={},this._children[t][d]=!0),this._in[d]={},this._preds[d]={},this._out[d]={},this._sucs[d]={},++this._nodeCount,this)}node(d){return this._nodes[d]}hasNode(d){return Object.hasOwn(this._nodes,d)}removeNode(d){var f=this;if(Object.hasOwn(this._nodes,d)){var h=m=>f.removeEdge(f._edgeObjs[m]);delete this._nodes[d],this._isCompound&&(this._removeFromParentsChildList(d),delete this._parent[d],this.children(d).forEach(function(m){f.setParent(m)}),delete this._children[d]),Object.keys(this._in[d]).forEach(h),delete this._in[d],delete this._preds[d],Object.keys(this._out[d]).forEach(h),delete this._out[d],delete this._sucs[d],--this._nodeCount}return this}setParent(d,f){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(f===void 0)f=t;else{f+="";for(var h=f;h!==void 0;h=this.parent(h))if(h===d)throw new Error("Setting "+f+" as parent of "+d+" would create a cycle");this.setNode(f)}return this.setNode(d),this._removeFromParentsChildList(d),this._parent[d]=f,this._children[f][d]=!0,this}_removeFromParentsChildList(d){delete this._children[this._parent[d]][d]}parent(d){if(this._isCompound){var f=this._parent[d];if(f!==t)return f}}children(d=t){if(this._isCompound){var f=this._children[d];if(f)return Object.keys(f)}else{if(d===t)return this.nodes();if(this.hasNode(d))return[]}}predecessors(d){var f=this._preds[d];if(f)return Object.keys(f)}successors(d){var f=this._sucs[d];if(f)return Object.keys(f)}neighbors(d){var f=this.predecessors(d);if(f){const m=new Set(f);for(var h of this.successors(d))m.add(h);return Array.from(m.values())}}isLeaf(d){var f;return this.isDirected()?f=this.successors(d):f=this.neighbors(d),f.length===0}filterNodes(d){var f=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});f.setGraph(this.graph());var h=this;Object.entries(this._nodes).forEach(function([g,w]){d(g)&&f.setNode(g,w)}),Object.values(this._edgeObjs).forEach(function(g){f.hasNode(g.v)&&f.hasNode(g.w)&&f.setEdge(g,h.edge(g))});var m={};function x(g){var w=h.parent(g);return w===void 0||f.hasNode(w)?(m[g]=w,w):w in m?m[w]:x(w)}return this._isCompound&&f.nodes().forEach(g=>f.setParent(g,x(g))),f}setDefaultEdgeLabel(d){return this._defaultEdgeLabelFn=d,typeof d!="function"&&(this._defaultEdgeLabelFn=()=>d),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(d,f){var h=this,m=arguments;return d.reduce(function(x,g){return m.length>1?h.setEdge(x,g,f):h.setEdge(x,g),g}),this}setEdge(){var d,f,h,m,x=!1,g=arguments[0];typeof g=="object"&&g!==null&&"v"in g?(d=g.v,f=g.w,h=g.name,arguments.length===2&&(m=arguments[1],x=!0)):(d=g,f=arguments[1],h=arguments[3],arguments.length>2&&(m=arguments[2],x=!0)),d=""+d,f=""+f,h!==void 0&&(h=""+h);var w=o(this._isDirected,d,f,h);if(Object.hasOwn(this._edgeLabels,w))return x&&(this._edgeLabels[w]=m),this;if(h!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(d),this.setNode(f),this._edgeLabels[w]=x?m:this._defaultEdgeLabelFn(d,f,h);var y=l(this._isDirected,d,f,h);return d=y.v,f=y.w,Object.freeze(y),this._edgeObjs[w]=y,r(this._preds[f],d),r(this._sucs[d],f),this._in[f][w]=y,this._out[d][w]=y,this._edgeCount++,this}edge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h);return this._edgeLabels[m]}edgeAsObj(){const d=this.edge(...arguments);return typeof d!="object"?{label:d}:d}hasEdge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h);return Object.hasOwn(this._edgeLabels,m)}removeEdge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h),x=this._edgeObjs[m];return x&&(d=x.v,f=x.w,delete this._edgeLabels[m],delete this._edgeObjs[m],i(this._preds[f],d),i(this._sucs[d],f),delete this._in[f][m],delete this._out[d][m],this._edgeCount--),this}inEdges(d,f){var h=this._in[d];if(h){var m=Object.values(h);return f?m.filter(x=>x.v===f):m}}outEdges(d,f){var h=this._out[d];if(h){var m=Object.values(h);return f?m.filter(x=>x.w===f):m}}nodeEdges(d,f){var h=this.inEdges(d,f);if(h)return h.concat(this.outEdges(d,f))}}function r(u,d){u[d]?u[d]++:u[d]=1}function i(u,d){--u[d]||delete u[d]}function o(u,d,f,h){var m=""+d,x=""+f;if(!u&&m>x){var g=m;m=x,x=g}return m+n+x+n+(h===void 0?e:h)}function l(u,d,f,h){var m=""+d,x=""+f;if(!u&&m>x){var g=m;m=x,x=g}var w={v:m,w:x};return h&&(w.name=h),w}function c(u,d){return o(u,d.v,d.w,d.name)}return Tr=s,Tr}var Pr,Go;function Xf(){return Go||(Go=1,Pr="2.2.4"),Pr}var Dr,Yo;function Uf(){return Yo||(Yo=1,Dr={Graph:co(),version:Xf()}),Dr}var Rr,Wo;function Zf(){if(Wo)return Rr;Wo=1;var e=co();Rr={write:t,read:r};function t(i){var o={options:{directed:i.isDirected(),multigraph:i.isMultigraph(),compound:i.isCompound()},nodes:n(i),edges:s(i)};return i.graph()!==void 0&&(o.value=structuredClone(i.graph())),o}function n(i){return i.nodes().map(function(o){var l=i.node(o),c=i.parent(o),u={v:o};return l!==void 0&&(u.value=l),c!==void 0&&(u.parent=c),u})}function s(i){return i.edges().map(function(o){var l=i.edge(o),c={v:o.v,w:o.w};return o.name!==void 0&&(c.name=o.name),l!==void 0&&(c.value=l),c})}function r(i){var o=new e(i.options).setGraph(i.value);return i.nodes.forEach(function(l){o.setNode(l.v,l.value),l.parent&&o.setParent(l.v,l.parent)}),i.edges.forEach(function(l){o.setEdge({v:l.v,w:l.w,name:l.name},l.value)}),o}return Rr}var Lr,Xo;function Kf(){if(Xo)return Lr;Xo=1,Lr=e;function e(t){var n={},s=[],r;function i(o){Object.hasOwn(n,o)||(n[o]=!0,r.push(o),t.successors(o).forEach(i),t.predecessors(o).forEach(i))}return t.nodes().forEach(function(o){r=[],i(o),r.length&&s.push(r)}),s}return Lr}var zr,Uo;function gl(){if(Uo)return zr;Uo=1;class e{constructor(){fe(this,"_arr",[]);fe(this,"_keyIndices",{})}size(){return this._arr.length}keys(){return this._arr.map(function(n){return n.key})}has(n){return Object.hasOwn(this._keyIndices,n)}priority(n){var s=this._keyIndices[n];if(s!==void 0)return this._arr[s].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(n,s){var r=this._keyIndices;if(n=String(n),!Object.hasOwn(r,n)){var i=this._arr,o=i.length;return r[n]=o,i.push({key:n,priority:s}),this._decrease(o),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key}decrease(n,s){var r=this._keyIndices[n];if(s>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[r].priority+" New: "+s);this._arr[r].priority=s,this._decrease(r)}_heapify(n){var s=this._arr,r=2*n,i=r+1,o=n;r<s.length&&(o=s[r].priority<s[o].priority?r:o,i<s.length&&(o=s[i].priority<s[o].priority?i:o),o!==n&&(this._swap(n,o),this._heapify(o)))}_decrease(n){for(var s=this._arr,r=s[n].priority,i;n!==0&&(i=n>>1,!(s[i].priority<r));)this._swap(n,i),n=i}_swap(n,s){var r=this._arr,i=this._keyIndices,o=r[n],l=r[s];r[n]=l,r[s]=o,i[l.key]=n,i[o.key]=s}}return zr=e,zr}var $r,Zo;function xl(){if(Zo)return $r;Zo=1;var e=gl();$r=n;var t=()=>1;function n(r,i,o,l){return s(r,String(i),o||t,l||function(c){return r.outEdges(c)})}function s(r,i,o,l){var c={},u=new e,d,f,h=function(m){var x=m.v!==d?m.v:m.w,g=c[x],w=o(m),y=f.distance+w;if(w<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+w);y<g.distance&&(g.distance=y,g.predecessor=d,u.decrease(x,y))};for(r.nodes().forEach(function(m){var x=m===i?0:Number.POSITIVE_INFINITY;c[m]={distance:x},u.add(m,x)});u.size()>0&&(d=u.removeMin(),f=c[d],f.distance!==Number.POSITIVE_INFINITY);)l(d).forEach(h);return c}return $r}var Or,Ko;function Qf(){if(Ko)return Or;Ko=1;var e=xl();Or=t;function t(n,s,r){return n.nodes().reduce(function(i,o){return i[o]=e(n,o,s,r),i},{})}return Or}var Vr,Qo;function yl(){if(Qo)return Vr;Qo=1,Vr=e;function e(t){var n=0,s=[],r={},i=[];function o(l){var c=r[l]={onStack:!0,lowlink:n,index:n++};if(s.push(l),t.successors(l).forEach(function(f){Object.hasOwn(r,f)?r[f].onStack&&(c.lowlink=Math.min(c.lowlink,r[f].index)):(o(f),c.lowlink=Math.min(c.lowlink,r[f].lowlink))}),c.lowlink===c.index){var u=[],d;do d=s.pop(),r[d].onStack=!1,u.push(d);while(l!==d);i.push(u)}}return t.nodes().forEach(function(l){Object.hasOwn(r,l)||o(l)}),i}return Vr}var Br,Jo;function Jf(){if(Jo)return Br;Jo=1;var e=yl();Br=t;function t(n){return e(n).filter(function(s){return s.length>1||s.length===1&&n.hasEdge(s[0],s[0])})}return Br}var Fr,ei;function eh(){if(ei)return Fr;ei=1,Fr=t;var e=()=>1;function t(s,r,i){return n(s,r||e,i||function(o){return s.outEdges(o)})}function n(s,r,i){var o={},l=s.nodes();return l.forEach(function(c){o[c]={},o[c][c]={distance:0},l.forEach(function(u){c!==u&&(o[c][u]={distance:Number.POSITIVE_INFINITY})}),i(c).forEach(function(u){var d=u.v===c?u.w:u.v,f=r(u);o[c][d]={distance:f,predecessor:c}})}),l.forEach(function(c){var u=o[c];l.forEach(function(d){var f=o[d];l.forEach(function(h){var m=f[c],x=u[h],g=f[h],w=m.distance+x.distance;w<g.distance&&(g.distance=w,g.predecessor=x.predecessor)})})}),o}return Fr}var Hr,ti;function wl(){if(ti)return Hr;ti=1;function e(n){var s={},r={},i=[];function o(l){if(Object.hasOwn(r,l))throw new t;Object.hasOwn(s,l)||(r[l]=!0,s[l]=!0,n.predecessors(l).forEach(o),delete r[l],i.push(l))}if(n.sinks().forEach(o),Object.keys(s).length!==n.nodeCount())throw new t;return i}class t extends Error{constructor(){super(...arguments)}}return Hr=e,e.CycleException=t,Hr}var qr,ni;function th(){if(ni)return qr;ni=1;var e=wl();qr=t;function t(n){try{e(n)}catch(s){if(s instanceof e.CycleException)return!1;throw s}return!0}return qr}var Gr,ri;function bl(){if(ri)return Gr;ri=1,Gr=e;function e(r,i,o){Array.isArray(i)||(i=[i]);var l=r.isDirected()?f=>r.successors(f):f=>r.neighbors(f),c=o==="post"?t:n,u=[],d={};return i.forEach(f=>{if(!r.hasNode(f))throw new Error("Graph does not have node: "+f);c(f,l,d,u)}),u}function t(r,i,o,l){for(var c=[[r,!1]];c.length>0;){var u=c.pop();u[1]?l.push(u[0]):Object.hasOwn(o,u[0])||(o[u[0]]=!0,c.push([u[0],!0]),s(i(u[0]),d=>c.push([d,!1])))}}function n(r,i,o,l){for(var c=[r];c.length>0;){var u=c.pop();Object.hasOwn(o,u)||(o[u]=!0,l.push(u),s(i(u),d=>c.push(d)))}}function s(r,i){for(var o=r.length;o--;)i(r[o],o,r);return r}return Gr}var Yr,si;function nh(){if(si)return Yr;si=1;var e=bl();Yr=t;function t(n,s){return e(n,s,"post")}return Yr}var Wr,oi;function rh(){if(oi)return Wr;oi=1;var e=bl();Wr=t;function t(n,s){return e(n,s,"pre")}return Wr}var Xr,ii;function sh(){if(ii)return Xr;ii=1;var e=co(),t=gl();Xr=n;function n(s,r){var i=new e,o={},l=new t,c;function u(f){var h=f.v===c?f.w:f.v,m=l.priority(h);if(m!==void 0){var x=r(f);x<m&&(o[h]=c,l.decrease(h,x))}}if(s.nodeCount()===0)return i;s.nodes().forEach(function(f){l.add(f,Number.POSITIVE_INFINITY),i.setNode(f)}),l.decrease(s.nodes()[0],0);for(var d=!1;l.size()>0;){if(c=l.removeMin(),Object.hasOwn(o,c))i.setEdge(c,o[c]);else{if(d)throw new Error("Input graph is not connected: "+s);d=!0}s.nodeEdges(c).forEach(u)}return i}return Xr}var Ur,ai;function oh(){return ai||(ai=1,Ur={components:Kf(),dijkstra:xl(),dijkstraAll:Qf(),findCycles:Jf(),floydWarshall:eh(),isAcyclic:th(),postorder:nh(),preorder:rh(),prim:sh(),tarjan:yl(),topsort:wl()}),Ur}var Zr,li;function ze(){if(li)return Zr;li=1;var e=Uf();return Zr={Graph:e.Graph,json:Zf(),alg:oh(),version:e.version},Zr}var Kr,ci;function ih(){if(ci)return Kr;ci=1;class e{constructor(){let r={};r._next=r._prev=r,this._sentinel=r}dequeue(){let r=this._sentinel,i=r._prev;if(i!==r)return t(i),i}enqueue(r){let i=this._sentinel;r._prev&&r._next&&t(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i}toString(){let r=[],i=this._sentinel,o=i._prev;for(;o!==i;)r.push(JSON.stringify(o,n)),o=o._prev;return"["+r.join(", ")+"]"}}function t(s){s._prev._next=s._next,s._next._prev=s._prev,delete s._next,delete s._prev}function n(s,r){if(s!=="_next"&&s!=="_prev")return r}return Kr=e,Kr}var Qr,ui;function ah(){if(ui)return Qr;ui=1;let e=ze().Graph,t=ih();Qr=s;let n=()=>1;function s(u,d){if(u.nodeCount()<=1)return[];let f=o(u,d||n);return r(f.graph,f.buckets,f.zeroIdx).flatMap(m=>u.outEdges(m.v,m.w))}function r(u,d,f){let h=[],m=d[d.length-1],x=d[0],g;for(;u.nodeCount();){for(;g=x.dequeue();)i(u,d,f,g);for(;g=m.dequeue();)i(u,d,f,g);if(u.nodeCount()){for(let w=d.length-2;w>0;--w)if(g=d[w].dequeue(),g){h=h.concat(i(u,d,f,g,!0));break}}}return h}function i(u,d,f,h,m){let x=m?[]:void 0;return u.inEdges(h.v).forEach(g=>{let w=u.edge(g),y=u.node(g.v);m&&x.push({v:g.v,w:g.w}),y.out-=w,l(d,f,y)}),u.outEdges(h.v).forEach(g=>{let w=u.edge(g),y=g.w,v=u.node(y);v.in-=w,l(d,f,v)}),u.removeNode(h.v),x}function o(u,d){let f=new e,h=0,m=0;u.nodes().forEach(w=>{f.setNode(w,{v:w,in:0,out:0})}),u.edges().forEach(w=>{let y=f.edge(w.v,w.w)||0,v=d(w),p=y+v;f.setEdge(w.v,w.w,p),m=Math.max(m,f.node(w.v).out+=v),h=Math.max(h,f.node(w.w).in+=v)});let x=c(m+h+3).map(()=>new t),g=h+1;return f.nodes().forEach(w=>{l(x,g,f.node(w))}),{graph:f,buckets:x,zeroIdx:g}}function l(u,d,f){f.out?f.in?u[f.out-f.in+d].enqueue(f):u[u.length-1].enqueue(f):u[0].enqueue(f)}function c(u){const d=[];for(let f=0;f<u;f++)d.push(f);return d}return Qr}var Jr,di;function me(){if(di)return Jr;di=1;let e=ze().Graph;Jr={addBorderNode:d,addDummyNode:t,applyWithChunking:m,asNonCompoundGraph:s,buildLayerMatrix:l,intersectRect:o,mapValues:E,maxRank:x,normalizeRanks:c,notime:y,partition:g,pick:I,predecessorWeights:i,range:b,removeEmptyRanks:u,simplify:n,successorWeights:r,time:w,uniqueId:p,zipObject:k};function t(N,_,T,C){for(var S=C;N.hasNode(S);)S=p(C);return T.dummy=_,N.setNode(S,T),S}function n(N){let _=new e().setGraph(N.graph());return N.nodes().forEach(T=>_.setNode(T,N.node(T))),N.edges().forEach(T=>{let C=_.edge(T.v,T.w)||{weight:0,minlen:1},S=N.edge(T);_.setEdge(T.v,T.w,{weight:C.weight+S.weight,minlen:Math.max(C.minlen,S.minlen)})}),_}function s(N){let _=new e({multigraph:N.isMultigraph()}).setGraph(N.graph());return N.nodes().forEach(T=>{N.children(T).length||_.setNode(T,N.node(T))}),N.edges().forEach(T=>{_.setEdge(T,N.edge(T))}),_}function r(N){let _=N.nodes().map(T=>{let C={};return N.outEdges(T).forEach(S=>{C[S.w]=(C[S.w]||0)+N.edge(S).weight}),C});return k(N.nodes(),_)}function i(N){let _=N.nodes().map(T=>{let C={};return N.inEdges(T).forEach(S=>{C[S.v]=(C[S.v]||0)+N.edge(S).weight}),C});return k(N.nodes(),_)}function o(N,_){let T=N.x,C=N.y,S=_.x-T,O=_.y-C,j=N.width/2,P=N.height/2;if(!S&&!O)throw new Error("Not possible to find intersection inside of the rectangle");let M,V;return Math.abs(O)*j>Math.abs(S)*P?(O<0&&(P=-P),M=P*S/O,V=P):(S<0&&(j=-j),M=j,V=j*O/S),{x:T+M,y:C+V}}function l(N){let _=b(x(N)+1).map(()=>[]);return N.nodes().forEach(T=>{let C=N.node(T),S=C.rank;S!==void 0&&(_[S][C.order]=T)}),_}function c(N){let _=N.nodes().map(C=>{let S=N.node(C).rank;return S===void 0?Number.MAX_VALUE:S}),T=m(Math.min,_);N.nodes().forEach(C=>{let S=N.node(C);Object.hasOwn(S,"rank")&&(S.rank-=T)})}function u(N){let _=N.nodes().map(j=>N.node(j).rank),T=m(Math.min,_),C=[];N.nodes().forEach(j=>{let P=N.node(j).rank-T;C[P]||(C[P]=[]),C[P].push(j)});let S=0,O=N.graph().nodeRankFactor;Array.from(C).forEach((j,P)=>{j===void 0&&P%O!==0?--S:j!==void 0&&S&&j.forEach(M=>N.node(M).rank+=S)})}function d(N,_,T,C){let S={width:0,height:0};return arguments.length>=4&&(S.rank=T,S.order=C),t(N,"border",S,_)}function f(N,_=h){const T=[];for(let C=0;C<N.length;C+=_){const S=N.slice(C,C+_);T.push(S)}return T}const h=65535;function m(N,_){if(_.length>h){const T=f(_);return N.apply(null,T.map(C=>N.apply(null,C)))}else return N.apply(null,_)}function x(N){const T=N.nodes().map(C=>{let S=N.node(C).rank;return S===void 0?Number.MIN_VALUE:S});return m(Math.max,T)}function g(N,_){let T={lhs:[],rhs:[]};return N.forEach(C=>{_(C)?T.lhs.push(C):T.rhs.push(C)}),T}function w(N,_){let T=Date.now();try{return _()}finally{console.log(N+" time: "+(Date.now()-T)+"ms")}}function y(N,_){return _()}let v=0;function p(N){var _=++v;return N+(""+_)}function b(N,_,T=1){_==null&&(_=N,N=0);let C=O=>O<_;T<0&&(C=O=>_<O);const S=[];for(let O=N;C(O);O+=T)S.push(O);return S}function I(N,_){const T={};for(const C of _)N[C]!==void 0&&(T[C]=N[C]);return T}function E(N,_){let T=_;return typeof _=="string"&&(T=C=>C[_]),Object.entries(N).reduce((C,[S,O])=>(C[S]=T(O,S),C),{})}function k(N,_){return N.reduce((T,C,S)=>(T[C]=_[S],T),{})}return Jr}var es,fi;function lh(){if(fi)return es;fi=1;let e=ah(),t=me().uniqueId;es={run:n,undo:r};function n(i){(i.graph().acyclicer==="greedy"?e(i,l(i)):s(i)).forEach(c=>{let u=i.edge(c);i.removeEdge(c),u.forwardName=c.name,u.reversed=!0,i.setEdge(c.w,c.v,u,t("rev"))});function l(c){return u=>c.edge(u).weight}}function s(i){let o=[],l={},c={};function u(d){Object.hasOwn(c,d)||(c[d]=!0,l[d]=!0,i.outEdges(d).forEach(f=>{Object.hasOwn(l,f.w)?o.push(f):u(f.w)}),delete l[d])}return i.nodes().forEach(u),o}function r(i){i.edges().forEach(o=>{let l=i.edge(o);if(l.reversed){i.removeEdge(o);let c=l.forwardName;delete l.reversed,delete l.forwardName,i.setEdge(o.w,o.v,l,c)}})}return es}var ts,hi;function ch(){if(hi)return ts;hi=1;let e=me();ts={run:t,undo:s};function t(r){r.graph().dummyChains=[],r.edges().forEach(i=>n(r,i))}function n(r,i){let o=i.v,l=r.node(o).rank,c=i.w,u=r.node(c).rank,d=i.name,f=r.edge(i),h=f.labelRank;if(u===l+1)return;r.removeEdge(i);let m,x,g;for(g=0,++l;l<u;++g,++l)f.points=[],x={width:0,height:0,edgeLabel:f,edgeObj:i,rank:l},m=e.addDummyNode(r,"edge",x,"_d"),l===h&&(x.width=f.width,x.height=f.height,x.dummy="edge-label",x.labelpos=f.labelpos),r.setEdge(o,m,{weight:f.weight},d),g===0&&r.graph().dummyChains.push(m),o=m;r.setEdge(o,c,{weight:f.weight},d)}function s(r){r.graph().dummyChains.forEach(i=>{let o=r.node(i),l=o.edgeLabel,c;for(r.setEdge(o.edgeObj,l);o.dummy;)c=r.successors(i)[0],r.removeNode(i),l.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(l.x=o.x,l.y=o.y,l.width=o.width,l.height=o.height),i=c,o=r.node(i)})}return ts}var ns,mi;function Fn(){if(mi)return ns;mi=1;const{applyWithChunking:e}=me();ns={longestPath:t,slack:n};function t(s){var r={};function i(o){var l=s.node(o);if(Object.hasOwn(r,o))return l.rank;r[o]=!0;let c=s.outEdges(o).map(d=>d==null?Number.POSITIVE_INFINITY:i(d.w)-s.edge(d).minlen);var u=e(Math.min,c);return u===Number.POSITIVE_INFINITY&&(u=0),l.rank=u}s.sources().forEach(i)}function n(s,r){return s.node(r.w).rank-s.node(r.v).rank-s.edge(r).minlen}return ns}var rs,pi;function vl(){if(pi)return rs;pi=1;var e=ze().Graph,t=Fn().slack;rs=n;function n(o){var l=new e({directed:!1}),c=o.nodes()[0],u=o.nodeCount();l.setNode(c,{});for(var d,f;s(l,o)<u;)d=r(l,o),f=l.hasNode(d.v)?t(o,d):-t(o,d),i(l,o,f);return l}function s(o,l){function c(u){l.nodeEdges(u).forEach(d=>{var f=d.v,h=u===f?d.w:f;!o.hasNode(h)&&!t(l,d)&&(o.setNode(h,{}),o.setEdge(u,h,{}),c(h))})}return o.nodes().forEach(c),o.nodeCount()}function r(o,l){return l.edges().reduce((u,d)=>{let f=Number.POSITIVE_INFINITY;return o.hasNode(d.v)!==o.hasNode(d.w)&&(f=t(l,d)),f<u[0]?[f,d]:u},[Number.POSITIVE_INFINITY,null])[1]}function i(o,l,c){o.nodes().forEach(u=>l.node(u).rank+=c)}return rs}var ss,gi;function uh(){if(gi)return ss;gi=1;var e=vl(),t=Fn().slack,n=Fn().longestPath,s=ze().alg.preorder,r=ze().alg.postorder,i=me().simplify;ss=o,o.initLowLimValues=d,o.initCutValues=l,o.calcCutValue=u,o.leaveEdge=h,o.enterEdge=m,o.exchangeEdges=x;function o(v){v=i(v),n(v);var p=e(v);d(p),l(p,v);for(var b,I;b=h(p);)I=m(p,v,b),x(p,v,b,I)}function l(v,p){var b=r(v,v.nodes());b=b.slice(0,b.length-1),b.forEach(I=>c(v,p,I))}function c(v,p,b){var I=v.node(b),E=I.parent;v.edge(b,E).cutvalue=u(v,p,b)}function u(v,p,b){var I=v.node(b),E=I.parent,k=!0,N=p.edge(b,E),_=0;return N||(k=!1,N=p.edge(E,b)),_=N.weight,p.nodeEdges(b).forEach(T=>{var C=T.v===b,S=C?T.w:T.v;if(S!==E){var O=C===k,j=p.edge(T).weight;if(_+=O?j:-j,w(v,b,S)){var P=v.edge(b,S).cutvalue;_+=O?-P:P}}}),_}function d(v,p){arguments.length<2&&(p=v.nodes()[0]),f(v,{},1,p)}function f(v,p,b,I,E){var k=b,N=v.node(I);return p[I]=!0,v.neighbors(I).forEach(_=>{Object.hasOwn(p,_)||(b=f(v,p,b,_,I))}),N.low=k,N.lim=b++,E?N.parent=E:delete N.parent,b}function h(v){return v.edges().find(p=>v.edge(p).cutvalue<0)}function m(v,p,b){var I=b.v,E=b.w;p.hasEdge(I,E)||(I=b.w,E=b.v);var k=v.node(I),N=v.node(E),_=k,T=!1;k.lim>N.lim&&(_=N,T=!0);var C=p.edges().filter(S=>T===y(v,v.node(S.v),_)&&T!==y(v,v.node(S.w),_));return C.reduce((S,O)=>t(p,O)<t(p,S)?O:S)}function x(v,p,b,I){var E=b.v,k=b.w;v.removeEdge(E,k),v.setEdge(I.v,I.w,{}),d(v),l(v,p),g(v,p)}function g(v,p){var b=v.nodes().find(E=>!p.node(E).parent),I=s(v,b);I=I.slice(1),I.forEach(E=>{var k=v.node(E).parent,N=p.edge(E,k),_=!1;N||(N=p.edge(k,E),_=!0),p.node(E).rank=p.node(k).rank+(_?N.minlen:-N.minlen)})}function w(v,p,b){return v.hasEdge(p,b)}function y(v,p,b){return b.low<=p.lim&&p.lim<=b.lim}return ss}var os,xi;function dh(){if(xi)return os;xi=1;var e=Fn(),t=e.longestPath,n=vl(),s=uh();os=r;function r(c){var u=c.graph().ranker;if(u instanceof Function)return u(c);switch(c.graph().ranker){case"network-simplex":l(c);break;case"tight-tree":o(c);break;case"longest-path":i(c);break;case"none":break;default:l(c)}}var i=t;function o(c){t(c),n(c)}function l(c){s(c)}return os}var is,yi;function fh(){if(yi)return is;yi=1,is=e;function e(s){let r=n(s);s.graph().dummyChains.forEach(i=>{let o=s.node(i),l=o.edgeObj,c=t(s,r,l.v,l.w),u=c.path,d=c.lca,f=0,h=u[f],m=!0;for(;i!==l.w;){if(o=s.node(i),m){for(;(h=u[f])!==d&&s.node(h).maxRank<o.rank;)f++;h===d&&(m=!1)}if(!m){for(;f<u.length-1&&s.node(h=u[f+1]).minRank<=o.rank;)f++;h=u[f]}s.setParent(i,h),i=s.successors(i)[0]}})}function t(s,r,i,o){let l=[],c=[],u=Math.min(r[i].low,r[o].low),d=Math.max(r[i].lim,r[o].lim),f,h;f=i;do f=s.parent(f),l.push(f);while(f&&(r[f].low>u||d>r[f].lim));for(h=f,f=o;(f=s.parent(f))!==h;)c.push(f);return{path:l.concat(c.reverse()),lca:h}}function n(s){let r={},i=0;function o(l){let c=i;s.children(l).forEach(o),r[l]={low:c,lim:i++}}return s.children().forEach(o),r}return is}var as,wi;function hh(){if(wi)return as;wi=1;let e=me();as={run:t,cleanup:i};function t(o){let l=e.addDummyNode(o,"root",{},"_root"),c=s(o),u=Object.values(c),d=e.applyWithChunking(Math.max,u)-1,f=2*d+1;o.graph().nestingRoot=l,o.edges().forEach(m=>o.edge(m).minlen*=f);let h=r(o)+1;o.children().forEach(m=>n(o,l,f,h,d,c,m)),o.graph().nodeRankFactor=f}function n(o,l,c,u,d,f,h){let m=o.children(h);if(!m.length){h!==l&&o.setEdge(l,h,{weight:0,minlen:c});return}let x=e.addBorderNode(o,"_bt"),g=e.addBorderNode(o,"_bb"),w=o.node(h);o.setParent(x,h),w.borderTop=x,o.setParent(g,h),w.borderBottom=g,m.forEach(y=>{n(o,l,c,u,d,f,y);let v=o.node(y),p=v.borderTop?v.borderTop:y,b=v.borderBottom?v.borderBottom:y,I=v.borderTop?u:2*u,E=p!==b?1:d-f[h]+1;o.setEdge(x,p,{weight:I,minlen:E,nestingEdge:!0}),o.setEdge(b,g,{weight:I,minlen:E,nestingEdge:!0})}),o.parent(h)||o.setEdge(l,x,{weight:0,minlen:d+f[h]})}function s(o){var l={};function c(u,d){var f=o.children(u);f&&f.length&&f.forEach(h=>c(h,d+1)),l[u]=d}return o.children().forEach(u=>c(u,1)),l}function r(o){return o.edges().reduce((l,c)=>l+o.edge(c).weight,0)}function i(o){var l=o.graph();o.removeNode(l.nestingRoot),delete l.nestingRoot,o.edges().forEach(c=>{var u=o.edge(c);u.nestingEdge&&o.removeEdge(c)})}return as}var ls,bi;function mh(){if(bi)return ls;bi=1;let e=me();ls=t;function t(s){function r(i){let o=s.children(i),l=s.node(i);if(o.length&&o.forEach(r),Object.hasOwn(l,"minRank")){l.borderLeft=[],l.borderRight=[];for(let c=l.minRank,u=l.maxRank+1;c<u;++c)n(s,"borderLeft","_bl",i,l,c),n(s,"borderRight","_br",i,l,c)}}s.children().forEach(r)}function n(s,r,i,o,l,c){let u={width:0,height:0,rank:c,borderType:r},d=l[r][c-1],f=e.addDummyNode(s,"border",u,i);l[r][c]=f,s.setParent(f,o),d&&s.setEdge(d,f,{weight:1})}return ls}var cs,vi;function ph(){if(vi)return cs;vi=1,cs={adjust:e,undo:t};function e(c){let u=c.graph().rankdir.toLowerCase();(u==="lr"||u==="rl")&&n(c)}function t(c){let u=c.graph().rankdir.toLowerCase();(u==="bt"||u==="rl")&&r(c),(u==="lr"||u==="rl")&&(o(c),n(c))}function n(c){c.nodes().forEach(u=>s(c.node(u))),c.edges().forEach(u=>s(c.edge(u)))}function s(c){let u=c.width;c.width=c.height,c.height=u}function r(c){c.nodes().forEach(u=>i(c.node(u))),c.edges().forEach(u=>{let d=c.edge(u);d.points.forEach(i),Object.hasOwn(d,"y")&&i(d)})}function i(c){c.y=-c.y}function o(c){c.nodes().forEach(u=>l(c.node(u))),c.edges().forEach(u=>{let d=c.edge(u);d.points.forEach(l),Object.hasOwn(d,"x")&&l(d)})}function l(c){let u=c.x;c.x=c.y,c.y=u}return cs}var us,Ni;function gh(){if(Ni)return us;Ni=1;let e=me();us=t;function t(n){let s={},r=n.nodes().filter(d=>!n.children(d).length),i=r.map(d=>n.node(d).rank),o=e.applyWithChunking(Math.max,i),l=e.range(o+1).map(()=>[]);function c(d){if(s[d])return;s[d]=!0;let f=n.node(d);l[f.rank].push(d),n.successors(d).forEach(c)}return r.sort((d,f)=>n.node(d).rank-n.node(f).rank).forEach(c),l}return us}var ds,ji;function xh(){if(ji)return ds;ji=1;let e=me().zipObject;ds=t;function t(s,r){let i=0;for(let o=1;o<r.length;++o)i+=n(s,r[o-1],r[o]);return i}function n(s,r,i){let o=e(i,i.map((h,m)=>m)),l=r.flatMap(h=>s.outEdges(h).map(m=>({pos:o[m.w],weight:s.edge(m).weight})).sort((m,x)=>m.pos-x.pos)),c=1;for(;c<i.length;)c<<=1;let u=2*c-1;c-=1;let d=new Array(u).fill(0),f=0;return l.forEach(h=>{let m=h.pos+c;d[m]+=h.weight;let x=0;for(;m>0;)m%2&&(x+=d[m+1]),m=m-1>>1,d[m]+=h.weight;f+=h.weight*x}),f}return ds}var fs,Ei;function yh(){if(Ei)return fs;Ei=1,fs=e;function e(t,n=[]){return n.map(s=>{let r=t.inEdges(s);if(r.length){let i=r.reduce((o,l)=>{let c=t.edge(l),u=t.node(l.v);return{sum:o.sum+c.weight*u.order,weight:o.weight+c.weight}},{sum:0,weight:0});return{v:s,barycenter:i.sum/i.weight,weight:i.weight}}else return{v:s}})}return fs}var hs,_i;function wh(){if(_i)return hs;_i=1;let e=me();hs=t;function t(r,i){let o={};r.forEach((c,u)=>{let d=o[c.v]={indegree:0,in:[],out:[],vs:[c.v],i:u};c.barycenter!==void 0&&(d.barycenter=c.barycenter,d.weight=c.weight)}),i.edges().forEach(c=>{let u=o[c.v],d=o[c.w];u!==void 0&&d!==void 0&&(d.indegree++,u.out.push(o[c.w]))});let l=Object.values(o).filter(c=>!c.indegree);return n(l)}function n(r){let i=[];function o(c){return u=>{u.merged||(u.barycenter===void 0||c.barycenter===void 0||u.barycenter>=c.barycenter)&&s(c,u)}}function l(c){return u=>{u.in.push(c),--u.indegree===0&&r.push(u)}}for(;r.length;){let c=r.pop();i.push(c),c.in.reverse().forEach(o(c)),c.out.forEach(l(c))}return i.filter(c=>!c.merged).map(c=>e.pick(c,["vs","i","barycenter","weight"]))}function s(r,i){let o=0,l=0;r.weight&&(o+=r.barycenter*r.weight,l+=r.weight),i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),r.vs=i.vs.concat(r.vs),r.barycenter=o/l,r.weight=l,r.i=Math.min(i.i,r.i),i.merged=!0}return hs}var ms,Ii;function bh(){if(Ii)return ms;Ii=1;let e=me();ms=t;function t(r,i){let o=e.partition(r,x=>Object.hasOwn(x,"barycenter")),l=o.lhs,c=o.rhs.sort((x,g)=>g.i-x.i),u=[],d=0,f=0,h=0;l.sort(s(!!i)),h=n(u,c,h),l.forEach(x=>{h+=x.vs.length,u.push(x.vs),d+=x.barycenter*x.weight,f+=x.weight,h=n(u,c,h)});let m={vs:u.flat(!0)};return f&&(m.barycenter=d/f,m.weight=f),m}function n(r,i,o){let l;for(;i.length&&(l=i[i.length-1]).i<=o;)i.pop(),r.push(l.vs),o++;return o}function s(r){return(i,o)=>i.barycenter<o.barycenter?-1:i.barycenter>o.barycenter?1:r?o.i-i.i:i.i-o.i}return ms}var ps,Si;function vh(){if(Si)return ps;Si=1;let e=yh(),t=wh(),n=bh();ps=s;function s(o,l,c,u){let d=o.children(l),f=o.node(l),h=f?f.borderLeft:void 0,m=f?f.borderRight:void 0,x={};h&&(d=d.filter(v=>v!==h&&v!==m));let g=e(o,d);g.forEach(v=>{if(o.children(v.v).length){let p=s(o,v.v,c,u);x[v.v]=p,Object.hasOwn(p,"barycenter")&&i(v,p)}});let w=t(g,c);r(w,x);let y=n(w,u);if(h&&(y.vs=[h,y.vs,m].flat(!0),o.predecessors(h).length)){let v=o.node(o.predecessors(h)[0]),p=o.node(o.predecessors(m)[0]);Object.hasOwn(y,"barycenter")||(y.barycenter=0,y.weight=0),y.barycenter=(y.barycenter*y.weight+v.order+p.order)/(y.weight+2),y.weight+=2}return y}function r(o,l){o.forEach(c=>{c.vs=c.vs.flatMap(u=>l[u]?l[u].vs:u)})}function i(o,l){o.barycenter!==void 0?(o.barycenter=(o.barycenter*o.weight+l.barycenter*l.weight)/(o.weight+l.weight),o.weight+=l.weight):(o.barycenter=l.barycenter,o.weight=l.weight)}return ps}var gs,Ci;function Nh(){if(Ci)return gs;Ci=1;let e=ze().Graph,t=me();gs=n;function n(r,i,o,l){l||(l=r.nodes());let c=s(r),u=new e({compound:!0}).setGraph({root:c}).setDefaultNodeLabel(d=>r.node(d));return l.forEach(d=>{let f=r.node(d),h=r.parent(d);(f.rank===i||f.minRank<=i&&i<=f.maxRank)&&(u.setNode(d),u.setParent(d,h||c),r[o](d).forEach(m=>{let x=m.v===d?m.w:m.v,g=u.edge(x,d),w=g!==void 0?g.weight:0;u.setEdge(x,d,{weight:r.edge(m).weight+w})}),Object.hasOwn(f,"minRank")&&u.setNode(d,{borderLeft:f.borderLeft[i],borderRight:f.borderRight[i]}))}),u}function s(r){for(var i;r.hasNode(i=t.uniqueId("_root")););return i}return gs}var xs,ki;function jh(){if(ki)return xs;ki=1,xs=e;function e(t,n,s){let r={},i;s.forEach(o=>{let l=t.parent(o),c,u;for(;l;){if(c=t.parent(l),c?(u=r[c],r[c]=l):(u=i,i=l),u&&u!==l){n.setEdge(u,l);return}l=c}})}return xs}var ys,Ai;function Eh(){if(Ai)return ys;Ai=1;let e=gh(),t=xh(),n=vh(),s=Nh(),r=jh(),i=ze().Graph,o=me();ys=l;function l(f,h){if(h&&typeof h.customOrder=="function"){h.customOrder(f,l);return}let m=o.maxRank(f),x=c(f,o.range(1,m+1),"inEdges"),g=c(f,o.range(m-1,-1,-1),"outEdges"),w=e(f);if(d(f,w),h&&h.disableOptimalOrderHeuristic)return;let y=Number.POSITIVE_INFINITY,v;for(let p=0,b=0;b<4;++p,++b){u(p%2?x:g,p%4>=2),w=o.buildLayerMatrix(f);let I=t(f,w);I<y&&(b=0,v=Object.assign({},w),y=I)}d(f,v)}function c(f,h,m){const x=new Map,g=(w,y)=>{x.has(w)||x.set(w,[]),x.get(w).push(y)};for(const w of f.nodes()){const y=f.node(w);if(typeof y.rank=="number"&&g(y.rank,w),typeof y.minRank=="number"&&typeof y.maxRank=="number")for(let v=y.minRank;v<=y.maxRank;v++)v!==y.rank&&g(v,w)}return h.map(function(w){return s(f,w,m,x.get(w)||[])})}function u(f,h){let m=new i;f.forEach(function(x){let g=x.graph().root,w=n(x,g,m,h);w.vs.forEach((y,v)=>x.node(y).order=v),r(x,m,w.vs)})}function d(f,h){Object.values(h).forEach(m=>m.forEach((x,g)=>f.node(x).order=g))}return ys}var ws,Mi;function _h(){if(Mi)return ws;Mi=1;let e=ze().Graph,t=me();ws={positionX:m,findType1Conflicts:n,findType2Conflicts:s,addConflict:i,hasConflict:o,verticalAlignment:l,horizontalCompaction:c,alignCoordinates:f,findSmallestWidthAlignment:d,balance:h};function n(w,y){let v={};function p(b,I){let E=0,k=0,N=b.length,_=I[I.length-1];return I.forEach((T,C)=>{let S=r(w,T),O=S?w.node(S).order:N;(S||T===_)&&(I.slice(k,C+1).forEach(j=>{w.predecessors(j).forEach(P=>{let M=w.node(P),V=M.order;(V<E||O<V)&&!(M.dummy&&w.node(j).dummy)&&i(v,P,j)})}),k=C+1,E=O)}),I}return y.length&&y.reduce(p),v}function s(w,y){let v={};function p(I,E,k,N,_){let T;t.range(E,k).forEach(C=>{T=I[C],w.node(T).dummy&&w.predecessors(T).forEach(S=>{let O=w.node(S);O.dummy&&(O.order<N||O.order>_)&&i(v,S,T)})})}function b(I,E){let k=-1,N,_=0;return E.forEach((T,C)=>{if(w.node(T).dummy==="border"){let S=w.predecessors(T);S.length&&(N=w.node(S[0]).order,p(E,_,C,k,N),_=C,k=N)}p(E,_,E.length,N,I.length)}),E}return y.length&&y.reduce(b),v}function r(w,y){if(w.node(y).dummy)return w.predecessors(y).find(v=>w.node(v).dummy)}function i(w,y,v){if(y>v){let b=y;y=v,v=b}let p=w[y];p||(w[y]=p={}),p[v]=!0}function o(w,y,v){if(y>v){let p=y;y=v,v=p}return!!w[y]&&Object.hasOwn(w[y],v)}function l(w,y,v,p){let b={},I={},E={};return y.forEach(k=>{k.forEach((N,_)=>{b[N]=N,I[N]=N,E[N]=_})}),y.forEach(k=>{let N=-1;k.forEach(_=>{let T=p(_);if(T.length){T=T.sort((S,O)=>E[S]-E[O]);let C=(T.length-1)/2;for(let S=Math.floor(C),O=Math.ceil(C);S<=O;++S){let j=T[S];I[_]===_&&N<E[j]&&!o(v,_,j)&&(I[j]=_,I[_]=b[_]=b[j],N=E[j])}}})}),{root:b,align:I}}function c(w,y,v,p,b){let I={},E=u(w,y,v,b),k=b?"borderLeft":"borderRight";function N(C,S){let O=E.nodes(),j=O.pop(),P={};for(;j;)P[j]?C(j):(P[j]=!0,O.push(j),O=O.concat(S(j))),j=O.pop()}function _(C){I[C]=E.inEdges(C).reduce((S,O)=>Math.max(S,I[O.v]+E.edge(O)),0)}function T(C){let S=E.outEdges(C).reduce((j,P)=>Math.min(j,I[P.w]-E.edge(P)),Number.POSITIVE_INFINITY),O=w.node(C);S!==Number.POSITIVE_INFINITY&&O.borderType!==k&&(I[C]=Math.max(I[C],S))}return N(_,E.predecessors.bind(E)),N(T,E.successors.bind(E)),Object.keys(p).forEach(C=>I[C]=I[v[C]]),I}function u(w,y,v,p){let b=new e,I=w.graph(),E=x(I.nodesep,I.edgesep,p);return y.forEach(k=>{let N;k.forEach(_=>{let T=v[_];if(b.setNode(T),N){var C=v[N],S=b.edge(C,T);b.setEdge(C,T,Math.max(E(w,_,N),S||0))}N=_})}),b}function d(w,y){return Object.values(y).reduce((v,p)=>{let b=Number.NEGATIVE_INFINITY,I=Number.POSITIVE_INFINITY;Object.entries(p).forEach(([k,N])=>{let _=g(w,k)/2;b=Math.max(N+_,b),I=Math.min(N-_,I)});const E=b-I;return E<v[0]&&(v=[E,p]),v},[Number.POSITIVE_INFINITY,null])[1]}function f(w,y){let v=Object.values(y),p=t.applyWithChunking(Math.min,v),b=t.applyWithChunking(Math.max,v);["u","d"].forEach(I=>{["l","r"].forEach(E=>{let k=I+E,N=w[k];if(N===y)return;let _=Object.values(N),T=p-t.applyWithChunking(Math.min,_);E!=="l"&&(T=b-t.applyWithChunking(Math.max,_)),T&&(w[k]=t.mapValues(N,C=>C+T))})})}function h(w,y){return t.mapValues(w.ul,(v,p)=>{if(y)return w[y.toLowerCase()][p];{let b=Object.values(w).map(I=>I[p]).sort((I,E)=>I-E);return(b[1]+b[2])/2}})}function m(w){let y=t.buildLayerMatrix(w),v=Object.assign(n(w,y),s(w,y)),p={},b;["u","d"].forEach(E=>{b=E==="u"?y:Object.values(y).reverse(),["l","r"].forEach(k=>{k==="r"&&(b=b.map(C=>Object.values(C).reverse()));let N=(E==="u"?w.predecessors:w.successors).bind(w),_=l(w,b,v,N),T=c(w,b,_.root,_.align,k==="r");k==="r"&&(T=t.mapValues(T,C=>-C)),p[E+k]=T})});let I=d(w,p);return f(p,I),h(p,w.graph().align)}function x(w,y,v){return(p,b,I)=>{let E=p.node(b),k=p.node(I),N=0,_;if(N+=E.width/2,Object.hasOwn(E,"labelpos"))switch(E.labelpos.toLowerCase()){case"l":_=-E.width/2;break;case"r":_=E.width/2;break}if(_&&(N+=v?_:-_),_=0,N+=(E.dummy?y:w)/2,N+=(k.dummy?y:w)/2,N+=k.width/2,Object.hasOwn(k,"labelpos"))switch(k.labelpos.toLowerCase()){case"l":_=k.width/2;break;case"r":_=-k.width/2;break}return _&&(N+=v?_:-_),_=0,N}}function g(w,y){return w.node(y).width}return ws}var bs,Ti;function Ih(){if(Ti)return bs;Ti=1;let e=me(),t=_h().positionX;bs=n;function n(r){r=e.asNonCompoundGraph(r),s(r),Object.entries(t(r)).forEach(([i,o])=>r.node(i).x=o)}function s(r){let i=e.buildLayerMatrix(r),o=r.graph().ranksep,l=0;i.forEach(c=>{const u=c.reduce((d,f)=>{const h=r.node(f).height;return d>h?d:h},0);c.forEach(d=>r.node(d).y=l+u/2),l+=u+o})}return bs}var vs,Pi;function Sh(){if(Pi)return vs;Pi=1;let e=lh(),t=ch(),n=dh(),s=me().normalizeRanks,r=fh(),i=me().removeEmptyRanks,o=hh(),l=mh(),c=ph(),u=Eh(),d=Ih(),f=me(),h=ze().Graph;vs=m;function m(A,R){let B=R&&R.debugTiming?f.time:f.notime;B("layout",()=>{let H=B("  buildLayoutGraph",()=>N(A));B("  runLayout",()=>x(H,B,R)),B("  updateInputGraph",()=>g(A,H))})}function x(A,R,B){R("    makeSpaceForEdgeLabels",()=>_(A)),R("    removeSelfEdges",()=>L(A)),R("    acyclic",()=>e.run(A)),R("    nestingGraph.run",()=>o.run(A)),R("    rank",()=>n(f.asNonCompoundGraph(A))),R("    injectEdgeLabelProxies",()=>T(A)),R("    removeEmptyRanks",()=>i(A)),R("    nestingGraph.cleanup",()=>o.cleanup(A)),R("    normalizeRanks",()=>s(A)),R("    assignRankMinMax",()=>C(A)),R("    removeEdgeLabelProxies",()=>S(A)),R("    normalize.run",()=>t.run(A)),R("    parentDummyChains",()=>r(A)),R("    addBorderSegments",()=>l(A)),R("    order",()=>u(A,B)),R("    insertSelfEdges",()=>D(A)),R("    adjustCoordinateSystem",()=>c.adjust(A)),R("    position",()=>d(A)),R("    positionSelfEdges",()=>F(A)),R("    removeBorderNodes",()=>V(A)),R("    normalize.undo",()=>t.undo(A)),R("    fixupEdgeLabelCoords",()=>P(A)),R("    undoCoordinateSystem",()=>c.undo(A)),R("    translateGraph",()=>O(A)),R("    assignNodeIntersects",()=>j(A)),R("    reversePoints",()=>M(A)),R("    acyclic.undo",()=>e.undo(A))}function g(A,R){A.nodes().forEach(B=>{let H=A.node(B),W=R.node(B);H&&(H.x=W.x,H.y=W.y,H.rank=W.rank,R.children(B).length&&(H.width=W.width,H.height=W.height))}),A.edges().forEach(B=>{let H=A.edge(B),W=R.edge(B);H.points=W.points,Object.hasOwn(W,"x")&&(H.x=W.x,H.y=W.y)}),A.graph().width=R.graph().width,A.graph().height=R.graph().height}let w=["nodesep","edgesep","ranksep","marginx","marginy"],y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},v=["acyclicer","ranker","rankdir","align"],p=["width","height","rank"],b={width:0,height:0},I=["minlen","weight","width","height","labeloffset"],E={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},k=["labelpos"];function N(A){let R=new h({multigraph:!0,compound:!0}),B=G(A.graph());return R.setGraph(Object.assign({},y,Y(B,w),f.pick(B,v))),A.nodes().forEach(H=>{let W=G(A.node(H));const q=Y(W,p);Object.keys(b).forEach(X=>{q[X]===void 0&&(q[X]=b[X])}),R.setNode(H,q),R.setParent(H,A.parent(H))}),A.edges().forEach(H=>{let W=G(A.edge(H));R.setEdge(H,Object.assign({},E,Y(W,I),f.pick(W,k)))}),R}function _(A){let R=A.graph();R.ranksep/=2,A.edges().forEach(B=>{let H=A.edge(B);H.minlen*=2,H.labelpos.toLowerCase()!=="c"&&(R.rankdir==="TB"||R.rankdir==="BT"?H.width+=H.labeloffset:H.height+=H.labeloffset)})}function T(A){A.edges().forEach(R=>{let B=A.edge(R);if(B.width&&B.height){let H=A.node(R.v),q={rank:(A.node(R.w).rank-H.rank)/2+H.rank,e:R};f.addDummyNode(A,"edge-proxy",q,"_ep")}})}function C(A){let R=0;A.nodes().forEach(B=>{let H=A.node(B);H.borderTop&&(H.minRank=A.node(H.borderTop).rank,H.maxRank=A.node(H.borderBottom).rank,R=Math.max(R,H.maxRank))}),A.graph().maxRank=R}function S(A){A.nodes().forEach(R=>{let B=A.node(R);B.dummy==="edge-proxy"&&(A.edge(B.e).labelRank=B.rank,A.removeNode(R))})}function O(A){let R=Number.POSITIVE_INFINITY,B=0,H=Number.POSITIVE_INFINITY,W=0,q=A.graph(),X=q.marginx||0,ee=q.marginy||0;function te(Q){let Z=Q.x,ne=Q.y,oe=Q.width,re=Q.height;R=Math.min(R,Z-oe/2),B=Math.max(B,Z+oe/2),H=Math.min(H,ne-re/2),W=Math.max(W,ne+re/2)}A.nodes().forEach(Q=>te(A.node(Q))),A.edges().forEach(Q=>{let Z=A.edge(Q);Object.hasOwn(Z,"x")&&te(Z)}),R-=X,H-=ee,A.nodes().forEach(Q=>{let Z=A.node(Q);Z.x-=R,Z.y-=H}),A.edges().forEach(Q=>{let Z=A.edge(Q);Z.points.forEach(ne=>{ne.x-=R,ne.y-=H}),Object.hasOwn(Z,"x")&&(Z.x-=R),Object.hasOwn(Z,"y")&&(Z.y-=H)}),q.width=B-R+X,q.height=W-H+ee}function j(A){A.edges().forEach(R=>{let B=A.edge(R),H=A.node(R.v),W=A.node(R.w),q,X;B.points?(q=B.points[0],X=B.points[B.points.length-1]):(B.points=[],q=W,X=H),B.points.unshift(f.intersectRect(H,q)),B.points.push(f.intersectRect(W,X))})}function P(A){A.edges().forEach(R=>{let B=A.edge(R);if(Object.hasOwn(B,"x"))switch((B.labelpos==="l"||B.labelpos==="r")&&(B.width-=B.labeloffset),B.labelpos){case"l":B.x-=B.width/2+B.labeloffset;break;case"r":B.x+=B.width/2+B.labeloffset;break}})}function M(A){A.edges().forEach(R=>{let B=A.edge(R);B.reversed&&B.points.reverse()})}function V(A){A.nodes().forEach(R=>{if(A.children(R).length){let B=A.node(R),H=A.node(B.borderTop),W=A.node(B.borderBottom),q=A.node(B.borderLeft[B.borderLeft.length-1]),X=A.node(B.borderRight[B.borderRight.length-1]);B.width=Math.abs(X.x-q.x),B.height=Math.abs(W.y-H.y),B.x=q.x+B.width/2,B.y=H.y+B.height/2}}),A.nodes().forEach(R=>{A.node(R).dummy==="border"&&A.removeNode(R)})}function L(A){A.edges().forEach(R=>{if(R.v===R.w){var B=A.node(R.v);B.selfEdges||(B.selfEdges=[]),B.selfEdges.push({e:R,label:A.edge(R)}),A.removeEdge(R)}})}function D(A){var R=f.buildLayerMatrix(A);R.forEach(B=>{var H=0;B.forEach((W,q)=>{var X=A.node(W);X.order=q+H,(X.selfEdges||[]).forEach(ee=>{f.addDummyNode(A,"selfedge",{width:ee.label.width,height:ee.label.height,rank:X.rank,order:q+ ++H,e:ee.e,label:ee.label},"_se")}),delete X.selfEdges})})}function F(A){A.nodes().forEach(R=>{var B=A.node(R);if(B.dummy==="selfedge"){var H=A.node(B.e.v),W=H.x+H.width/2,q=H.y,X=B.x-W,ee=H.height/2;A.setEdge(B.e,B.label),A.removeNode(R),B.label.points=[{x:W+2*X/3,y:q-ee},{x:W+5*X/6,y:q-ee},{x:W+X,y:q},{x:W+5*X/6,y:q+ee},{x:W+2*X/3,y:q+ee}],B.label.x=B.x,B.label.y=B.y}})}function Y(A,R){return f.mapValues(f.pick(A,R),Number)}function G(A){var R={};return A&&Object.entries(A).forEach(([B,H])=>{typeof B=="string"&&(B=B.toLowerCase()),R[B]=H}),R}return vs}var Ns,Di;function Ch(){if(Di)return Ns;Di=1;let e=me(),t=ze().Graph;Ns={debugOrdering:n};function n(s){let r=e.buildLayerMatrix(s),i=new t({compound:!0,multigraph:!0}).setGraph({});return s.nodes().forEach(o=>{i.setNode(o,{label:o}),i.setParent(o,"layer"+s.node(o).rank)}),s.edges().forEach(o=>i.setEdge(o.v,o.w,{},o.name)),r.forEach((o,l)=>{let c="layer"+l;i.setNode(c,{rank:"same"}),o.reduce((u,d)=>(i.setEdge(u,d,{style:"invis"}),d))}),i}return Ns}var js,Ri;function kh(){return Ri||(Ri=1,js="1.1.8"),js}var Es,Li;function Ah(){return Li||(Li=1,Es={graphlib:ze(),layout:Sh(),debug:Ch(),util:{time:me().time,notime:me().notime},version:kh()}),Es}var Mh=Ah();const zi=Pd(Mh),vt=44,Hn=.5,qn=1,Ls=512,Th=400;function Ph(e,t){const n=new zi.graphlib.Graph,s=Wf();return n.setDefaultEdgeLabel(()=>({})),n.setGraph({rankdir:s,ranksep:100,nodesep:50}),e.forEach(r=>{n.setNode(r.id,{width:r.width,height:r.height})}),t.forEach(r=>{n.setEdge(r.source,r.target)}),zi.layout(n,{disableOptimalOrderHeuristic:!0}),e.map(r=>{const i=n.node(r.id);return{...r,position:{x:i.x-r.width/2,y:i.y-r.height/2}}})}function pe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=pe(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Dh={value:()=>{}};function lr(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Pn(n)}function Pn(e){this._=e}function Rh(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Pn.prototype=lr.prototype={constructor:Pn,on:function(e,t){var n=this._,s=Rh(e+"",n),r,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((r=(e=s[i]).type)&&(r=Lh(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(r=(e=s[i]).type)n[r]=$i(n[r],e.name,t);else if(t==null)for(r in n)n[r]=$i(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Pn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,i;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)}};function Lh(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function $i(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=Dh,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var zs="http://www.w3.org/1999/xhtml";const Oi={svg:"http://www.w3.org/2000/svg",xhtml:zs,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function cr(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Oi.hasOwnProperty(t)?{space:Oi[t],local:e}:e}function zh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===zs&&t.documentElement.namespaceURI===zs?t.createElement(e):t.createElementNS(n,e)}}function $h(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Nl(e){var t=cr(e);return(t.local?$h:zh)(t)}function Oh(){}function uo(e){return e==null?Oh:function(){return this.querySelector(e)}}function Vh(e){typeof e!="function"&&(e=uo(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,l=s[r]=new Array(o),c,u,d=0;d<o;++d)(c=i[d])&&(u=e.call(c,c.__data__,d,i))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u);return new Ce(s,this._parents)}function Bh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Fh(){return[]}function jl(e){return e==null?Fh:function(){return this.querySelectorAll(e)}}function Hh(e){return function(){return Bh(e.apply(this,arguments))}}function qh(e){typeof e=="function"?e=Hh(e):e=jl(e);for(var t=this._groups,n=t.length,s=[],r=[],i=0;i<n;++i)for(var o=t[i],l=o.length,c,u=0;u<l;++u)(c=o[u])&&(s.push(e.call(c,c.__data__,u,o)),r.push(c));return new Ce(s,r)}function El(e){return function(){return this.matches(e)}}function _l(e){return function(t){return t.matches(e)}}var Gh=Array.prototype.find;function Yh(e){return function(){return Gh.call(this.children,e)}}function Wh(){return this.firstElementChild}function Xh(e){return this.select(e==null?Wh:Yh(typeof e=="function"?e:_l(e)))}var Uh=Array.prototype.filter;function Zh(){return Array.from(this.children)}function Kh(e){return function(){return Uh.call(this.children,e)}}function Qh(e){return this.selectAll(e==null?Zh:Kh(typeof e=="function"?e:_l(e)))}function Jh(e){typeof e!="function"&&(e=El(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,l=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&l.push(c);return new Ce(s,this._parents)}function Il(e){return new Array(e.length)}function em(){return new Ce(this._enter||this._groups.map(Il),this._parents)}function Gn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Gn.prototype={constructor:Gn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function tm(e){return function(){return e}}function nm(e,t,n,s,r,i){for(var o=0,l,c=t.length,u=i.length;o<u;++o)(l=t[o])?(l.__data__=i[o],s[o]=l):n[o]=new Gn(e,i[o]);for(;o<c;++o)(l=t[o])&&(r[o]=l)}function rm(e,t,n,s,r,i,o){var l,c,u=new Map,d=t.length,f=i.length,h=new Array(d),m;for(l=0;l<d;++l)(c=t[l])&&(h[l]=m=o.call(c,c.__data__,l,t)+"",u.has(m)?r[l]=c:u.set(m,c));for(l=0;l<f;++l)m=o.call(e,i[l],l,i)+"",(c=u.get(m))?(s[l]=c,c.__data__=i[l],u.delete(m)):n[l]=new Gn(e,i[l]);for(l=0;l<d;++l)(c=t[l])&&u.get(h[l])===c&&(r[l]=c)}function sm(e){return e.__data__}function om(e,t){if(!arguments.length)return Array.from(this,sm);var n=t?rm:nm,s=this._parents,r=this._groups;typeof e!="function"&&(e=tm(e));for(var i=r.length,o=new Array(i),l=new Array(i),c=new Array(i),u=0;u<i;++u){var d=s[u],f=r[u],h=f.length,m=im(e.call(d,d&&d.__data__,u,s)),x=m.length,g=l[u]=new Array(x),w=o[u]=new Array(x),y=c[u]=new Array(h);n(d,f,g,w,y,m,t);for(var v=0,p=0,b,I;v<x;++v)if(b=g[v]){for(v>=p&&(p=v+1);!(I=w[p])&&++p<x;);b._next=I||null}}return o=new Ce(o,s),o._enter=l,o._exit=c,o}function im(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function am(){return new Ce(this._exit||this._groups.map(Il),this._parents)}function lm(e,t,n){var s=this.enter(),r=this,i=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),s&&r?s.merge(r).order():r}function cm(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,i=s.length,o=Math.min(r,i),l=new Array(r),c=0;c<o;++c)for(var u=n[c],d=s[c],f=u.length,h=l[c]=new Array(f),m,x=0;x<f;++x)(m=u[x]||d[x])&&(h[x]=m);for(;c<r;++c)l[c]=n[c];return new Ce(l,this._parents)}function um(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,i=s[r],o;--r>=0;)(o=s[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function dm(e){e||(e=fm);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,s=n.length,r=new Array(s),i=0;i<s;++i){for(var o=n[i],l=o.length,c=r[i]=new Array(l),u,d=0;d<l;++d)(u=o[d])&&(c[d]=u);c.sort(t)}return new Ce(r,this._parents).order()}function fm(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function hm(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function mm(){return Array.from(this)}function pm(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length;r<i;++r){var o=s[r];if(o)return o}return null}function gm(){let e=0;for(const t of this)++e;return e}function xm(){return!this.node()}function ym(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],i=0,o=r.length,l;i<o;++i)(l=r[i])&&e.call(l,l.__data__,i,r);return this}function wm(e){return function(){this.removeAttribute(e)}}function bm(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vm(e,t){return function(){this.setAttribute(e,t)}}function Nm(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function jm(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Em(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function _m(e,t){var n=cr(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?bm:wm:typeof t=="function"?n.local?Em:jm:n.local?Nm:vm)(n,t))}function Sl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Im(e){return function(){this.style.removeProperty(e)}}function Sm(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Cm(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function km(e,t,n){return arguments.length>1?this.each((t==null?Im:typeof t=="function"?Cm:Sm)(e,t,n??"")):St(this.node(),e)}function St(e,t){return e.style.getPropertyValue(t)||Sl(e).getComputedStyle(e,null).getPropertyValue(t)}function Am(e){return function(){delete this[e]}}function Mm(e,t){return function(){this[e]=t}}function Tm(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Pm(e,t){return arguments.length>1?this.each((t==null?Am:typeof t=="function"?Tm:Mm)(e,t)):this.node()[e]}function Cl(e){return e.trim().split(/^|\s+/)}function fo(e){return e.classList||new kl(e)}function kl(e){this._node=e,this._names=Cl(e.getAttribute("class")||"")}kl.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Al(e,t){for(var n=fo(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function Ml(e,t){for(var n=fo(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function Dm(e){return function(){Al(this,e)}}function Rm(e){return function(){Ml(this,e)}}function Lm(e,t){return function(){(t.apply(this,arguments)?Al:Ml)(this,e)}}function zm(e,t){var n=Cl(e+"");if(arguments.length<2){for(var s=fo(this.node()),r=-1,i=n.length;++r<i;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Lm:t?Dm:Rm)(n,t))}function $m(){this.textContent=""}function Om(e){return function(){this.textContent=e}}function Vm(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Bm(e){return arguments.length?this.each(e==null?$m:(typeof e=="function"?Vm:Om)(e)):this.node().textContent}function Fm(){this.innerHTML=""}function Hm(e){return function(){this.innerHTML=e}}function qm(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Gm(e){return arguments.length?this.each(e==null?Fm:(typeof e=="function"?qm:Hm)(e)):this.node().innerHTML}function Ym(){this.nextSibling&&this.parentNode.appendChild(this)}function Wm(){return this.each(Ym)}function Xm(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Um(){return this.each(Xm)}function Zm(e){var t=typeof e=="function"?e:Nl(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Km(){return null}function Qm(e,t){var n=typeof e=="function"?e:Nl(e),s=t==null?Km:typeof t=="function"?t:uo(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function Jm(){var e=this.parentNode;e&&e.removeChild(this)}function ep(){return this.each(Jm)}function tp(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function np(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function rp(e){return this.select(e?np:tp)}function sp(e){return arguments.length?this.property("__data__",e):this.node().__data__}function op(e){return function(t){e.call(this,t,this.__data__)}}function ip(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function ap(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function lp(e,t,n){return function(){var s=this.__on,r,i=op(t);if(s){for(var o=0,l=s.length;o<l;++o)if((r=s[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},s?s.push(r):this.__on=[r]}}function cp(e,t,n){var s=ip(e+""),r,i=s.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,u=l.length,d;c<u;++c)for(r=0,d=l[c];r<i;++r)if((o=s[r]).type===d.type&&o.name===d.name)return d.value}return}for(l=t?lp:ap,r=0;r<i;++r)this.each(l(s[r],t,n));return this}function Tl(e,t,n){var s=Sl(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function up(e,t){return function(){return Tl(this,e,t)}}function dp(e,t){return function(){return Tl(this,e,t.apply(this,arguments))}}function fp(e,t){return this.each((typeof t=="function"?dp:up)(e,t))}function*hp(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length,o;r<i;++r)(o=s[r])&&(yield o)}var Pl=[null];function Ce(e,t){this._groups=e,this._parents=t}function an(){return new Ce([[document.documentElement]],Pl)}function mp(){return this}Ce.prototype=an.prototype={constructor:Ce,select:Vh,selectAll:qh,selectChild:Xh,selectChildren:Qh,filter:Jh,data:om,enter:em,exit:am,join:lm,merge:cm,selection:mp,order:um,sort:dm,call:hm,nodes:mm,node:pm,size:gm,empty:xm,each:ym,attr:_m,style:km,property:Pm,classed:zm,text:Bm,html:Gm,raise:Wm,lower:Um,append:Zm,insert:Qm,remove:ep,clone:rp,datum:sp,on:cp,dispatch:fp,[Symbol.iterator]:hp};function Se(e){return typeof e=="string"?new Ce([[document.querySelector(e)]],[document.documentElement]):new Ce([[e]],Pl)}function pp(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Te(e,t){if(e=pp(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const gp={passive:!1},Wt={capture:!0,passive:!1};function _s(e){e.stopImmediatePropagation()}function _t(e){e.preventDefault(),e.stopImmediatePropagation()}function Dl(e){var t=e.document.documentElement,n=Se(e).on("dragstart.drag",_t,Wt);"onselectstart"in t?n.on("selectstart.drag",_t,Wt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Rl(e,t){var n=e.document.documentElement,s=Se(e).on("dragstart.drag",null);t&&(s.on("click.drag",_t,Wt),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const bn=e=>()=>e;function $s(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:i,x:o,y:l,dx:c,dy:u,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}$s.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function xp(e){return!e.ctrlKey&&!e.button}function yp(){return this.parentNode}function wp(e,t){return t??{x:e.x,y:e.y}}function bp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ll(){var e=xp,t=yp,n=wp,s=bp,r={},i=lr("start","drag","end"),o=0,l,c,u,d,f=0;function h(b){b.on("mousedown.drag",m).filter(s).on("touchstart.drag",w).on("touchmove.drag",y,gp).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(b,I){if(!(d||!e.call(this,b,I))){var E=p(this,t.call(this,b,I),b,I,"mouse");E&&(Se(b.view).on("mousemove.drag",x,Wt).on("mouseup.drag",g,Wt),Dl(b.view),_s(b),u=!1,l=b.clientX,c=b.clientY,E("start",b))}}function x(b){if(_t(b),!u){var I=b.clientX-l,E=b.clientY-c;u=I*I+E*E>f}r.mouse("drag",b)}function g(b){Se(b.view).on("mousemove.drag mouseup.drag",null),Rl(b.view,u),_t(b),r.mouse("end",b)}function w(b,I){if(e.call(this,b,I)){var E=b.changedTouches,k=t.call(this,b,I),N=E.length,_,T;for(_=0;_<N;++_)(T=p(this,k,b,I,E[_].identifier,E[_]))&&(_s(b),T("start",b,E[_]))}}function y(b){var I=b.changedTouches,E=I.length,k,N;for(k=0;k<E;++k)(N=r[I[k].identifier])&&(_t(b),N("drag",b,I[k]))}function v(b){var I=b.changedTouches,E=I.length,k,N;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),k=0;k<E;++k)(N=r[I[k].identifier])&&(_s(b),N("end",b,I[k]))}function p(b,I,E,k,N,_){var T=i.copy(),C=Te(_||E,I),S,O,j;if((j=n.call(b,new $s("beforestart",{sourceEvent:E,target:h,identifier:N,active:o,x:C[0],y:C[1],dx:0,dy:0,dispatch:T}),k))!=null)return S=j.x-C[0]||0,O=j.y-C[1]||0,function P(M,V,L){var D=C,F;switch(M){case"start":r[N]=P,F=o++;break;case"end":delete r[N],--o;case"drag":C=Te(L||V,I),F=o;break}T.call(M,b,new $s(M,{sourceEvent:V,subject:j,target:h,identifier:N,active:F,x:C[0]+S,y:C[1]+O,dx:C[0]-D[0],dy:C[1]-D[1],dispatch:T}),k)}}return h.filter=function(b){return arguments.length?(e=typeof b=="function"?b:bn(!!b),h):e},h.container=function(b){return arguments.length?(t=typeof b=="function"?b:bn(b),h):t},h.subject=function(b){return arguments.length?(n=typeof b=="function"?b:bn(b),h):n},h.touchable=function(b){return arguments.length?(s=typeof b=="function"?b:bn(!!b),h):s},h.on=function(){var b=i.on.apply(i,arguments);return b===i?h:b},h.clickDistance=function(b){return arguments.length?(f=(b=+b)*b,h):Math.sqrt(f)},h}function ho(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function zl(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function ln(){}var Xt=.7,Yn=1/Xt,It="\\s*([+-]?\\d+)\\s*",Ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",He="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vp=/^#([0-9a-f]{3,8})$/,Np=new RegExp(`^rgb\\(${It},${It},${It}\\)$`),jp=new RegExp(`^rgb\\(${He},${He},${He}\\)$`),Ep=new RegExp(`^rgba\\(${It},${It},${It},${Ut}\\)$`),_p=new RegExp(`^rgba\\(${He},${He},${He},${Ut}\\)$`),Ip=new RegExp(`^hsl\\(${Ut},${He},${He}\\)$`),Sp=new RegExp(`^hsla\\(${Ut},${He},${He},${Ut}\\)$`),Vi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ho(ln,pt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Bi,formatHex:Bi,formatHex8:Cp,formatHsl:kp,formatRgb:Fi,toString:Fi});function Bi(){return this.rgb().formatHex()}function Cp(){return this.rgb().formatHex8()}function kp(){return $l(this).formatHsl()}function Fi(){return this.rgb().formatRgb()}function pt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=vp.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Hi(t):n===3?new _e(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?vn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?vn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Np.exec(e))?new _e(t[1],t[2],t[3],1):(t=jp.exec(e))?new _e(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ep.exec(e))?vn(t[1],t[2],t[3],t[4]):(t=_p.exec(e))?vn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ip.exec(e))?Yi(t[1],t[2]/100,t[3]/100,1):(t=Sp.exec(e))?Yi(t[1],t[2]/100,t[3]/100,t[4]):Vi.hasOwnProperty(e)?Hi(Vi[e]):e==="transparent"?new _e(NaN,NaN,NaN,0):null}function Hi(e){return new _e(e>>16&255,e>>8&255,e&255,1)}function vn(e,t,n,s){return s<=0&&(e=t=n=NaN),new _e(e,t,n,s)}function Ap(e){return e instanceof ln||(e=pt(e)),e?(e=e.rgb(),new _e(e.r,e.g,e.b,e.opacity)):new _e}function Os(e,t,n,s){return arguments.length===1?Ap(e):new _e(e,t,n,s??1)}function _e(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}ho(_e,Os,zl(ln,{brighter(e){return e=e==null?Yn:Math.pow(Yn,e),new _e(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Xt:Math.pow(Xt,e),new _e(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new _e(ht(this.r),ht(this.g),ht(this.b),Wn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qi,formatHex:qi,formatHex8:Mp,formatRgb:Gi,toString:Gi}));function qi(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}`}function Mp(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}${dt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Gi(){const e=Wn(this.opacity);return`${e===1?"rgb(":"rgba("}${ht(this.r)}, ${ht(this.g)}, ${ht(this.b)}${e===1?")":`, ${e})`}`}function Wn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ht(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function dt(e){return e=ht(e),(e<16?"0":"")+e.toString(16)}function Yi(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pe(e,t,n,s)}function $l(e){if(e instanceof Pe)return new Pe(e.h,e.s,e.l,e.opacity);if(e instanceof ln||(e=pt(e)),!e)return new Pe;if(e instanceof Pe)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),i=Math.max(t,n,s),o=NaN,l=i-r,c=(i+r)/2;return l?(t===i?o=(n-s)/l+(n<s)*6:n===i?o=(s-t)/l+2:o=(t-n)/l+4,l/=c<.5?i+r:2-i-r,o*=60):l=c>0&&c<1?0:o,new Pe(o,l,c,e.opacity)}function Tp(e,t,n,s){return arguments.length===1?$l(e):new Pe(e,t,n,s??1)}function Pe(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}ho(Pe,Tp,zl(ln,{brighter(e){return e=e==null?Yn:Math.pow(Yn,e),new Pe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Xt:Math.pow(Xt,e),new Pe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new _e(Is(e>=240?e-240:e+120,r,s),Is(e,r,s),Is(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new Pe(Wi(this.h),Nn(this.s),Nn(this.l),Wn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Wn(this.opacity);return`${e===1?"hsl(":"hsla("}${Wi(this.h)}, ${Nn(this.s)*100}%, ${Nn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Wi(e){return e=(e||0)%360,e<0?e+360:e}function Nn(e){return Math.max(0,Math.min(1,e||0))}function Is(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const mo=e=>()=>e;function Pp(e,t){return function(n){return e+n*t}}function Dp(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Rp(e){return(e=+e)==1?Ol:function(t,n){return n-t?Dp(t,n,e):mo(isNaN(t)?n:t)}}function Ol(e,t){var n=t-e;return n?Pp(e,n):mo(isNaN(e)?t:e)}const Xn=(function e(t){var n=Rp(t);function s(r,i){var o=n((r=Os(r)).r,(i=Os(i)).r),l=n(r.g,i.g),c=n(r.b,i.b),u=Ol(r.opacity,i.opacity);return function(d){return r.r=o(d),r.g=l(d),r.b=c(d),r.opacity=u(d),r+""}}return s.gamma=e,s})(1);function Lp(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),r;return function(i){for(r=0;r<n;++r)s[r]=e[r]*(1-i)+t[r]*i;return s}}function zp(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $p(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,r=new Array(s),i=new Array(n),o;for(o=0;o<s;++o)r[o]=Ht(e[o],t[o]);for(;o<n;++o)i[o]=t[o];return function(l){for(o=0;o<s;++o)i[o]=r[o](l);return i}}function Op(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Fe(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Vp(e,t){var n={},s={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ht(e[r],t[r]):s[r]=t[r];return function(i){for(r in n)s[r]=n[r](i);return s}}var Vs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ss=new RegExp(Vs.source,"g");function Bp(e){return function(){return e}}function Fp(e){return function(t){return e(t)+""}}function Vl(e,t){var n=Vs.lastIndex=Ss.lastIndex=0,s,r,i,o=-1,l=[],c=[];for(e=e+"",t=t+"";(s=Vs.exec(e))&&(r=Ss.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),l[o]?l[o]+=i:l[++o]=i),(s=s[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,c.push({i:o,x:Fe(s,r)})),n=Ss.lastIndex;return n<t.length&&(i=t.slice(n),l[o]?l[o]+=i:l[++o]=i),l.length<2?c[0]?Fp(c[0].x):Bp(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function Ht(e,t){var n=typeof t,s;return t==null||n==="boolean"?mo(t):(n==="number"?Fe:n==="string"?(s=pt(t))?(t=s,Xn):Vl:t instanceof pt?Xn:t instanceof Date?Op:zp(t)?Lp:Array.isArray(t)?$p:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Vp:Fe)(e,t)}var Xi=180/Math.PI,Bs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bl(e,t,n,s,r,i){var o,l,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*n+t*s)&&(n-=e*c,s-=t*c),(l=Math.sqrt(n*n+s*s))&&(n/=l,s/=l,c/=l),e*s<t*n&&(e=-e,t=-t,c=-c,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Xi,skewX:Math.atan(c)*Xi,scaleX:o,scaleY:l}}var jn;function Hp(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Bs:Bl(t.a,t.b,t.c,t.d,t.e,t.f)}function qp(e){return e==null||(jn||(jn=document.createElementNS("http://www.w3.org/2000/svg","g")),jn.setAttribute("transform",e),!(e=jn.transform.baseVal.consolidate()))?Bs:(e=e.matrix,Bl(e.a,e.b,e.c,e.d,e.e,e.f))}function Fl(e,t,n,s){function r(u){return u.length?u.pop()+" ":""}function i(u,d,f,h,m,x){if(u!==f||d!==h){var g=m.push("translate(",null,t,null,n);x.push({i:g-4,x:Fe(u,f)},{i:g-2,x:Fe(d,h)})}else(f||h)&&m.push("translate("+f+t+h+n)}function o(u,d,f,h){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),h.push({i:f.push(r(f)+"rotate(",null,s)-2,x:Fe(u,d)})):d&&f.push(r(f)+"rotate("+d+s)}function l(u,d,f,h){u!==d?h.push({i:f.push(r(f)+"skewX(",null,s)-2,x:Fe(u,d)}):d&&f.push(r(f)+"skewX("+d+s)}function c(u,d,f,h,m,x){if(u!==f||d!==h){var g=m.push(r(m)+"scale(",null,",",null,")");x.push({i:g-4,x:Fe(u,f)},{i:g-2,x:Fe(d,h)})}else(f!==1||h!==1)&&m.push(r(m)+"scale("+f+","+h+")")}return function(u,d){var f=[],h=[];return u=e(u),d=e(d),i(u.translateX,u.translateY,d.translateX,d.translateY,f,h),o(u.rotate,d.rotate,f,h),l(u.skewX,d.skewX,f,h),c(u.scaleX,u.scaleY,d.scaleX,d.scaleY,f,h),u=d=null,function(m){for(var x=-1,g=h.length,w;++x<g;)f[(w=h[x]).i]=w.x(m);return f.join("")}}}var Gp=Fl(Hp,"px, ","px)","deg)"),Yp=Fl(qp,", ",")",")"),Wp=1e-12;function Ui(e){return((e=Math.exp(e))+1/e)/2}function Xp(e){return((e=Math.exp(e))-1/e)/2}function Up(e){return((e=Math.exp(2*e))-1)/(e+1)}const Dn=(function e(t,n,s){function r(i,o){var l=i[0],c=i[1],u=i[2],d=o[0],f=o[1],h=o[2],m=d-l,x=f-c,g=m*m+x*x,w,y;if(g<Wp)y=Math.log(h/u)/t,w=function(k){return[l+k*m,c+k*x,u*Math.exp(t*k*y)]};else{var v=Math.sqrt(g),p=(h*h-u*u+s*g)/(2*u*n*v),b=(h*h-u*u-s*g)/(2*h*n*v),I=Math.log(Math.sqrt(p*p+1)-p),E=Math.log(Math.sqrt(b*b+1)-b);y=(E-I)/t,w=function(k){var N=k*y,_=Ui(I),T=u/(n*v)*(_*Up(t*N+I)-Xp(I));return[l+T*m,c+T*x,u*_/Ui(t*N+I)]}}return w.duration=y*1e3*t/Math.SQRT2,w}return r.rho=function(i){var o=Math.max(.001,+i),l=o*o,c=l*l;return e(o,l,c)},r})(Math.SQRT2,2,4);var Ct=0,Bt=0,Ot=0,Hl=1e3,Un,Ft,Zn=0,gt=0,ur=0,Zt=typeof performance=="object"&&performance.now?performance:Date,ql=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function po(){return gt||(ql(Zp),gt=Zt.now()+ur)}function Zp(){gt=0}function Kn(){this._call=this._time=this._next=null}Kn.prototype=Gl.prototype={constructor:Kn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?po():+n)+(t==null?0:+t),!this._next&&Ft!==this&&(Ft?Ft._next=this:Un=this,Ft=this),this._call=e,this._time=n,Fs()},stop:function(){this._call&&(this._call=null,this._time=1/0,Fs())}};function Gl(e,t,n){var s=new Kn;return s.restart(e,t,n),s}function Kp(){po(),++Ct;for(var e=Un,t;e;)(t=gt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ct}function Zi(){gt=(Zn=Zt.now())+ur,Ct=Bt=0;try{Kp()}finally{Ct=0,Jp(),gt=0}}function Qp(){var e=Zt.now(),t=e-Zn;t>Hl&&(ur-=t,Zn=e)}function Jp(){for(var e,t=Un,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Un=n);Ft=e,Fs(s)}function Fs(e){if(!Ct){Bt&&(Bt=clearTimeout(Bt));var t=e-gt;t>24?(e<1/0&&(Bt=setTimeout(Zi,e-Zt.now()-ur)),Ot&&(Ot=clearInterval(Ot))):(Ot||(Zn=Zt.now(),Ot=setInterval(Qp,Hl)),Ct=1,ql(Zi))}}function Ki(e,t,n){var s=new Kn;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}var eg=lr("start","end","cancel","interrupt"),tg=[],Yl=0,Qi=1,Hs=2,Rn=3,Ji=4,qs=5,Ln=6;function dr(e,t,n,s,r,i){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;ng(e,n,{name:t,index:s,group:r,on:eg,tween:tg,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Yl})}function go(e,t){var n=Ve(e,t);if(n.state>Yl)throw new Error("too late; already scheduled");return n}function We(e,t){var n=Ve(e,t);if(n.state>Rn)throw new Error("too late; already running");return n}function Ve(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ng(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=Gl(i,0,n.time);function i(u){n.state=Qi,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var d,f,h,m;if(n.state!==Qi)return c();for(d in s)if(m=s[d],m.name===n.name){if(m.state===Rn)return Ki(o);m.state===Ji?(m.state=Ln,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete s[d]):+d<t&&(m.state=Ln,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete s[d])}if(Ki(function(){n.state===Rn&&(n.state=Ji,n.timer.restart(l,n.delay,n.time),l(u))}),n.state=Hs,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Hs){for(n.state=Rn,r=new Array(h=n.tween.length),d=0,f=-1;d<h;++d)(m=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(r[++f]=m);r.length=f+1}}function l(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=qs,1),f=-1,h=r.length;++f<h;)r[f].call(e,d);n.state===qs&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Ln,n.timer.stop(),delete s[t];for(var u in s)return;delete e.__transition}}function zn(e,t){var n=e.__transition,s,r,i=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((s=n[o]).name!==t){i=!1;continue}r=s.state>Hs&&s.state<qs,s.state=Ln,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[o]}i&&delete e.__transition}}function rg(e){return this.each(function(){zn(this,e)})}function sg(e,t){var n,s;return function(){var r=We(this,e),i=r.tween;if(i!==n){s=n=i;for(var o=0,l=s.length;o<l;++o)if(s[o].name===t){s=s.slice(),s.splice(o,1);break}}r.tween=s}}function og(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var i=We(this,e),o=i.tween;if(o!==s){r=(s=o).slice();for(var l={name:t,value:n},c=0,u=r.length;c<u;++c)if(r[c].name===t){r[c]=l;break}c===u&&r.push(l)}i.tween=r}}function ig(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=Ve(this.node(),n).tween,r=0,i=s.length,o;r<i;++r)if((o=s[r]).name===e)return o.value;return null}return this.each((t==null?sg:og)(n,e,t))}function xo(e,t,n){var s=e._id;return e.each(function(){var r=We(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ve(r,s).value[t]}}function Wl(e,t){var n;return(typeof t=="number"?Fe:t instanceof pt?Xn:(n=pt(t))?(t=n,Xn):Vl)(e,t)}function ag(e){return function(){this.removeAttribute(e)}}function lg(e){return function(){this.removeAttributeNS(e.space,e.local)}}function cg(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttribute(e);return o===r?null:o===s?i:i=t(s=o,n)}}function ug(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===s?i:i=t(s=o,n)}}function dg(e,t,n){var s,r,i;return function(){var o,l=n(this),c;return l==null?void this.removeAttribute(e):(o=this.getAttribute(e),c=l+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,l)))}}function fg(e,t,n){var s,r,i;return function(){var o,l=n(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),c=l+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,l)))}}function hg(e,t){var n=cr(e),s=n==="transform"?Yp:Wl;return this.attrTween(e,typeof t=="function"?(n.local?fg:dg)(n,s,xo(this,"attr."+e,t)):t==null?(n.local?lg:ag)(n):(n.local?ug:cg)(n,s,t))}function mg(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function pg(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function gg(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&pg(e,i)),n}return r._value=t,r}function xg(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&mg(e,i)),n}return r._value=t,r}function yg(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=cr(e);return this.tween(n,(s.local?gg:xg)(s,t))}function wg(e,t){return function(){go(this,e).delay=+t.apply(this,arguments)}}function bg(e,t){return t=+t,function(){go(this,e).delay=t}}function vg(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?wg:bg)(t,e)):Ve(this.node(),t).delay}function Ng(e,t){return function(){We(this,e).duration=+t.apply(this,arguments)}}function jg(e,t){return t=+t,function(){We(this,e).duration=t}}function Eg(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ng:jg)(t,e)):Ve(this.node(),t).duration}function _g(e,t){if(typeof t!="function")throw new Error;return function(){We(this,e).ease=t}}function Ig(e){var t=this._id;return arguments.length?this.each(_g(t,e)):Ve(this.node(),t).ease}function Sg(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;We(this,e).ease=n}}function Cg(e){if(typeof e!="function")throw new Error;return this.each(Sg(this._id,e))}function kg(e){typeof e!="function"&&(e=El(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,l=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&l.push(c);return new Qe(s,this._parents,this._name,this._id)}function Ag(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,i=Math.min(s,r),o=new Array(s),l=0;l<i;++l)for(var c=t[l],u=n[l],d=c.length,f=o[l]=new Array(d),h,m=0;m<d;++m)(h=c[m]||u[m])&&(f[m]=h);for(;l<s;++l)o[l]=t[l];return new Qe(o,this._parents,this._name,this._id)}function Mg(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Tg(e,t,n){var s,r,i=Mg(t)?go:We;return function(){var o=i(this,e),l=o.on;l!==s&&(r=(s=l).copy()).on(t,n),o.on=r}}function Pg(e,t){var n=this._id;return arguments.length<2?Ve(this.node(),n).on.on(e):this.each(Tg(n,e,t))}function Dg(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Rg(){return this.on("end.remove",Dg(this._id))}function Lg(e){var t=this._name,n=this._id;typeof e!="function"&&(e=uo(e));for(var s=this._groups,r=s.length,i=new Array(r),o=0;o<r;++o)for(var l=s[o],c=l.length,u=i[o]=new Array(c),d,f,h=0;h<c;++h)(d=l[h])&&(f=e.call(d,d.__data__,h,l))&&("__data__"in d&&(f.__data__=d.__data__),u[h]=f,dr(u[h],t,n,h,u,Ve(d,n)));return new Qe(i,this._parents,t,n)}function zg(e){var t=this._name,n=this._id;typeof e!="function"&&(e=jl(e));for(var s=this._groups,r=s.length,i=[],o=[],l=0;l<r;++l)for(var c=s[l],u=c.length,d,f=0;f<u;++f)if(d=c[f]){for(var h=e.call(d,d.__data__,f,c),m,x=Ve(d,n),g=0,w=h.length;g<w;++g)(m=h[g])&&dr(m,t,n,g,h,x);i.push(h),o.push(d)}return new Qe(i,o,t,n)}var $g=an.prototype.constructor;function Og(){return new $g(this._groups,this._parents)}function Vg(e,t){var n,s,r;return function(){var i=St(this,e),o=(this.style.removeProperty(e),St(this,e));return i===o?null:i===n&&o===s?r:r=t(n=i,s=o)}}function Xl(e){return function(){this.style.removeProperty(e)}}function Bg(e,t,n){var s,r=n+"",i;return function(){var o=St(this,e);return o===r?null:o===s?i:i=t(s=o,n)}}function Fg(e,t,n){var s,r,i;return function(){var o=St(this,e),l=n(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),St(this,e))),o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,l))}}function Hg(e,t){var n,s,r,i="style."+t,o="end."+i,l;return function(){var c=We(this,e),u=c.on,d=c.value[i]==null?l||(l=Xl(t)):void 0;(u!==n||r!==d)&&(s=(n=u).copy()).on(o,r=d),c.on=s}}function qg(e,t,n){var s=(e+="")=="transform"?Gp:Wl;return t==null?this.styleTween(e,Vg(e,s)).on("end.style."+e,Xl(e)):typeof t=="function"?this.styleTween(e,Fg(e,s,xo(this,"style."+e,t))).each(Hg(this._id,e)):this.styleTween(e,Bg(e,s,t),n).on("end.style."+e,null)}function Gg(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function Yg(e,t,n){var s,r;function i(){var o=t.apply(this,arguments);return o!==r&&(s=(r=o)&&Gg(e,o,n)),s}return i._value=t,i}function Wg(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,Yg(e,t,n??""))}function Xg(e){return function(){this.textContent=e}}function Ug(e){return function(){var t=e(this);this.textContent=t??""}}function Zg(e){return this.tween("text",typeof e=="function"?Ug(xo(this,"text",e)):Xg(e==null?"":e+""))}function Kg(e){return function(t){this.textContent=e.call(this,t)}}function Qg(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Kg(r)),t}return s._value=e,s}function Jg(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Qg(e))}function ex(){for(var e=this._name,t=this._id,n=Ul(),s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],l=o.length,c,u=0;u<l;++u)if(c=o[u]){var d=Ve(c,t);dr(c,e,n,u,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Qe(s,this._parents,e,n)}function tx(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(i,o){var l={value:o},c={value:function(){--r===0&&i()}};n.each(function(){var u=We(this,s),d=u.on;d!==e&&(t=(e=d).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),u.on=t}),r===0&&i()})}var nx=0;function Qe(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function Ul(){return++nx}var Ue=an.prototype;Qe.prototype={constructor:Qe,select:Lg,selectAll:zg,selectChild:Ue.selectChild,selectChildren:Ue.selectChildren,filter:kg,merge:Ag,selection:Og,transition:ex,call:Ue.call,nodes:Ue.nodes,node:Ue.node,size:Ue.size,empty:Ue.empty,each:Ue.each,on:Pg,attr:hg,attrTween:yg,style:qg,styleTween:Wg,text:Zg,textTween:Jg,remove:Rg,tween:ig,delay:vg,duration:Eg,ease:Ig,easeVarying:Cg,end:tx,[Symbol.iterator]:Ue[Symbol.iterator]};function rx(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var sx={time:null,delay:0,duration:250,ease:rx};function ox(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function ix(e){var t,n;e instanceof Qe?(t=e._id,e=e._name):(t=Ul(),(n=sx).time=po(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],l=o.length,c,u=0;u<l;++u)(c=o[u])&&dr(c,e,t,u,o,n||ox(c,t));return new Qe(s,this._parents,e,t)}an.prototype.interrupt=rg;an.prototype.transition=ix;const En=e=>()=>e;function ax(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function Ke(e,t,n){this.k=e,this.x=t,this.y=n}Ke.prototype={constructor:Ke,scale:function(e){return e===1?this:new Ke(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ke(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var fr=new Ke(1,0,0);Zl.prototype=Ke.prototype;function Zl(e){for(;!e.__zoom;)if(!(e=e.parentNode))return fr;return e.__zoom}function Cs(e){e.stopImmediatePropagation()}function Vt(e){e.preventDefault(),e.stopImmediatePropagation()}function lx(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function cx(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ea(){return this.__zoom||fr}function ux(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function dx(){return navigator.maxTouchPoints||"ontouchstart"in this}function fx(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function Kl(){var e=lx,t=cx,n=fx,s=ux,r=dx,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,c=Dn,u=lr("start","zoom","end"),d,f,h,m=500,x=150,g=0,w=10;function y(j){j.property("__zoom",ea).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",_).on("dblclick.zoom",T).filter(r).on("touchstart.zoom",C).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(j,P,M,V){var L=j.selection?j.selection():j;L.property("__zoom",ea),j!==L?I(j,P,M,V):L.interrupt().each(function(){E(this,arguments).event(V).start().zoom(null,typeof P=="function"?P.apply(this,arguments):P).end()})},y.scaleBy=function(j,P,M,V){y.scaleTo(j,function(){var L=this.__zoom.k,D=typeof P=="function"?P.apply(this,arguments):P;return L*D},M,V)},y.scaleTo=function(j,P,M,V){y.transform(j,function(){var L=t.apply(this,arguments),D=this.__zoom,F=M==null?b(L):typeof M=="function"?M.apply(this,arguments):M,Y=D.invert(F),G=typeof P=="function"?P.apply(this,arguments):P;return n(p(v(D,G),F,Y),L,o)},M,V)},y.translateBy=function(j,P,M,V){y.transform(j,function(){return n(this.__zoom.translate(typeof P=="function"?P.apply(this,arguments):P,typeof M=="function"?M.apply(this,arguments):M),t.apply(this,arguments),o)},null,V)},y.translateTo=function(j,P,M,V,L){y.transform(j,function(){var D=t.apply(this,arguments),F=this.__zoom,Y=V==null?b(D):typeof V=="function"?V.apply(this,arguments):V;return n(fr.translate(Y[0],Y[1]).scale(F.k).translate(typeof P=="function"?-P.apply(this,arguments):-P,typeof M=="function"?-M.apply(this,arguments):-M),D,o)},V,L)};function v(j,P){return P=Math.max(i[0],Math.min(i[1],P)),P===j.k?j:new Ke(P,j.x,j.y)}function p(j,P,M){var V=P[0]-M[0]*j.k,L=P[1]-M[1]*j.k;return V===j.x&&L===j.y?j:new Ke(j.k,V,L)}function b(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function I(j,P,M,V){j.on("start.zoom",function(){E(this,arguments).event(V).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(V).end()}).tween("zoom",function(){var L=this,D=arguments,F=E(L,D).event(V),Y=t.apply(L,D),G=M==null?b(Y):typeof M=="function"?M.apply(L,D):M,A=Math.max(Y[1][0]-Y[0][0],Y[1][1]-Y[0][1]),R=L.__zoom,B=typeof P=="function"?P.apply(L,D):P,H=c(R.invert(G).concat(A/R.k),B.invert(G).concat(A/B.k));return function(W){if(W===1)W=B;else{var q=H(W),X=A/q[2];W=new Ke(X,G[0]-q[0]*X,G[1]-q[1]*X)}F.zoom(null,W)}})}function E(j,P,M){return!M&&j.__zooming||new k(j,P)}function k(j,P){this.that=j,this.args=P,this.active=0,this.sourceEvent=null,this.extent=t.apply(j,P),this.taps=0}k.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,P){return this.mouse&&j!=="mouse"&&(this.mouse[1]=P.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=P.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=P.invert(this.touch1[0])),this.that.__zoom=P,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var P=Se(this.that).datum();u.call(j,this.that,new ax(j,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:u}),P)}};function N(j,...P){if(!e.apply(this,arguments))return;var M=E(this,P).event(j),V=this.__zoom,L=Math.max(i[0],Math.min(i[1],V.k*Math.pow(2,s.apply(this,arguments)))),D=Te(j);if(M.wheel)(M.mouse[0][0]!==D[0]||M.mouse[0][1]!==D[1])&&(M.mouse[1]=V.invert(M.mouse[0]=D)),clearTimeout(M.wheel);else{if(V.k===L)return;M.mouse=[D,V.invert(D)],zn(this),M.start()}Vt(j),M.wheel=setTimeout(F,x),M.zoom("mouse",n(p(v(V,L),M.mouse[0],M.mouse[1]),M.extent,o));function F(){M.wheel=null,M.end()}}function _(j,...P){if(h||!e.apply(this,arguments))return;var M=j.currentTarget,V=E(this,P,!0).event(j),L=Se(j.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",A,!0),D=Te(j,M),F=j.clientX,Y=j.clientY;Dl(j.view),Cs(j),V.mouse=[D,this.__zoom.invert(D)],zn(this),V.start();function G(R){if(Vt(R),!V.moved){var B=R.clientX-F,H=R.clientY-Y;V.moved=B*B+H*H>g}V.event(R).zoom("mouse",n(p(V.that.__zoom,V.mouse[0]=Te(R,M),V.mouse[1]),V.extent,o))}function A(R){L.on("mousemove.zoom mouseup.zoom",null),Rl(R.view,V.moved),Vt(R),V.event(R).end()}}function T(j,...P){if(e.apply(this,arguments)){var M=this.__zoom,V=Te(j.changedTouches?j.changedTouches[0]:j,this),L=M.invert(V),D=M.k*(j.shiftKey?.5:2),F=n(p(v(M,D),V,L),t.apply(this,P),o);Vt(j),l>0?Se(this).transition().duration(l).call(I,F,V,j):Se(this).call(y.transform,F,V,j)}}function C(j,...P){if(e.apply(this,arguments)){var M=j.touches,V=M.length,L=E(this,P,j.changedTouches.length===V).event(j),D,F,Y,G;for(Cs(j),F=0;F<V;++F)Y=M[F],G=Te(Y,this),G=[G,this.__zoom.invert(G),Y.identifier],L.touch0?!L.touch1&&L.touch0[2]!==G[2]&&(L.touch1=G,L.taps=0):(L.touch0=G,D=!0,L.taps=1+!!d);d&&(d=clearTimeout(d)),D&&(L.taps<2&&(f=G[0],d=setTimeout(function(){d=null},m)),zn(this),L.start())}}function S(j,...P){if(this.__zooming){var M=E(this,P).event(j),V=j.changedTouches,L=V.length,D,F,Y,G;for(Vt(j),D=0;D<L;++D)F=V[D],Y=Te(F,this),M.touch0&&M.touch0[2]===F.identifier?M.touch0[0]=Y:M.touch1&&M.touch1[2]===F.identifier&&(M.touch1[0]=Y);if(F=M.that.__zoom,M.touch1){var A=M.touch0[0],R=M.touch0[1],B=M.touch1[0],H=M.touch1[1],W=(W=B[0]-A[0])*W+(W=B[1]-A[1])*W,q=(q=H[0]-R[0])*q+(q=H[1]-R[1])*q;F=v(F,Math.sqrt(W/q)),Y=[(A[0]+B[0])/2,(A[1]+B[1])/2],G=[(R[0]+H[0])/2,(R[1]+H[1])/2]}else if(M.touch0)Y=M.touch0[0],G=M.touch0[1];else return;M.zoom("touch",n(p(F,Y,G),M.extent,o))}}function O(j,...P){if(this.__zooming){var M=E(this,P).event(j),V=j.changedTouches,L=V.length,D,F;for(Cs(j),h&&clearTimeout(h),h=setTimeout(function(){h=null},m),D=0;D<L;++D)F=V[D],M.touch0&&M.touch0[2]===F.identifier?delete M.touch0:M.touch1&&M.touch1[2]===F.identifier&&delete M.touch1;if(M.touch1&&!M.touch0&&(M.touch0=M.touch1,delete M.touch1),M.touch0)M.touch0[1]=this.__zoom.invert(M.touch0[0]);else if(M.end(),M.taps===2&&(F=Te(F,this),Math.hypot(f[0]-F[0],f[1]-F[1])<w)){var Y=Se(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return y.wheelDelta=function(j){return arguments.length?(s=typeof j=="function"?j:En(+j),y):s},y.filter=function(j){return arguments.length?(e=typeof j=="function"?j:En(!!j),y):e},y.touchable=function(j){return arguments.length?(r=typeof j=="function"?j:En(!!j),y):r},y.extent=function(j){return arguments.length?(t=typeof j=="function"?j:En([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),y):t},y.scaleExtent=function(j){return arguments.length?(i[0]=+j[0],i[1]=+j[1],y):[i[0],i[1]]},y.translateExtent=function(j){return arguments.length?(o[0][0]=+j[0][0],o[1][0]=+j[1][0],o[0][1]=+j[0][1],o[1][1]=+j[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(j){return arguments.length?(n=j,y):n},y.duration=function(j){return arguments.length?(l=+j,y):l},y.interpolate=function(j){return arguments.length?(c=j,y):c},y.on=function(){var j=u.on.apply(u,arguments);return j===u?y:j},y.clickDistance=function(j){return arguments.length?(g=(j=+j)*j,y):Math.sqrt(g)},y.tapDistance=function(j){return arguments.length?(w=+j,y):w},y}const Ge={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Kt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ql=["Enter"," ","Escape"],Jl={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var kt;(function(e){e.Strict="strict",e.Loose="loose"})(kt||(kt={}));var mt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(mt||(mt={}));var Qt;(function(e){e.Partial="partial",e.Full="full"})(Qt||(Qt={}));const ec={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ze;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ze||(Ze={}));var Qn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Qn||(Qn={}));var U;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(U||(U={}));const ta={[U.Left]:U.Right,[U.Right]:U.Left,[U.Top]:U.Bottom,[U.Bottom]:U.Top};function tc(e){return e===null?null:e?"valid":"invalid"}const nc=e=>"id"in e&&"source"in e&&"target"in e,hx=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),yo=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),cn=(e,t=[0,0])=>{const{width:n,height:s}=et(e),r=e.origin??t,i=n*r[0],o=s*r[1];return{x:e.position.x-i,y:e.position.y-o}},rc=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,r)=>{const i=typeof r=="string";let o=!t.nodeLookup&&!i?r:void 0;t.nodeLookup&&(o=i?t.nodeLookup.get(r):yo(r)?r:t.nodeLookup.get(r.id));const l=o?Jn(o,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return hr(s,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return mr(n)},un=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(n=hr(n,Jn(r)),s=!0)}),s?mr(n):{x:0,y:0,width:0,height:0}},wo=(e,t,[n,s,r]=[0,0,1],i=!1,o=!1)=>{const l={...fn(t,[n,s,r]),width:t.width/r,height:t.height/r},c=[];for(const u of e.values()){const{measured:d,selectable:f=!0,hidden:h=!1}=u;if(o&&!f||h)continue;const m=d.width??u.width??u.initialWidth??null,x=d.height??u.height??u.initialHeight??null,g=Jt(l,Mt(u)),w=(m??0)*(x??0),y=i&&g>0;(!u.internals.handleBounds||y||g>=w||u.dragging)&&c.push(u)}return c},mx=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function px(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!s||s.has(r.id))&&n.set(r.id,r)}),n}async function gx({nodes:e,width:t,height:n,panZoom:s,minZoom:r,maxZoom:i},o){if(e.size===0)return Promise.resolve(!0);const l=px(e,o),c=un(l),u=pr(c,t,n,(o==null?void 0:o.minZoom)??r,(o==null?void 0:o.maxZoom)??i,(o==null?void 0:o.padding)??.1);return await s.setViewport(u,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)}function sc({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:r,onError:i}){const o=n.get(e),l=o.parentId?n.get(o.parentId):void 0,{x:c,y:u}=l?l.internals.positionAbsolute:{x:0,y:0},d=o.origin??s;let f=o.extent||r;if(o.extent==="parent"&&!o.expandParent)if(!l)i==null||i("005",Ge.error005());else{const m=l.measured.width,x=l.measured.height;m&&x&&(f=[[c,u],[c+m,u+x]])}else l&&Tt(o.extent)&&(f=[[o.extent[0][0]+c,o.extent[0][1]+u],[o.extent[1][0]+c,o.extent[1][1]+u]]);const h=Tt(f)?xt(t,f,o.measured):t;return(o.measured.width===void 0||o.measured.height===void 0)&&(i==null||i("015",Ge.error015())),{position:{x:h.x-c+(o.measured.width??0)*d[0],y:h.y-u+(o.measured.height??0)*d[1]},positionAbsolute:h}}async function xx({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:r}){const i=new Set(e.map(h=>h.id)),o=[];for(const h of n){if(h.deletable===!1)continue;const m=i.has(h.id),x=!m&&h.parentId&&o.find(g=>g.id===h.parentId);(m||x)&&o.push(h)}const l=new Set(t.map(h=>h.id)),c=s.filter(h=>h.deletable!==!1),d=mx(o,c);for(const h of c)l.has(h.id)&&!d.find(x=>x.id===h.id)&&d.push(h);if(!r)return{edges:d,nodes:o};const f=await r({nodes:o,edges:d});return typeof f=="boolean"?f?{edges:d,nodes:o}:{edges:[],nodes:[]}:f}const At=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),xt=(e={x:0,y:0},t,n)=>({x:At(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:At(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function oc(e,t,n){const{width:s,height:r}=et(n),{x:i,y:o}=n.internals.positionAbsolute;return xt(e,[[i,o],[i+s,o+r]],t)}const na=(e,t,n)=>e<t?At(Math.abs(e-t),1,t)/t:e>n?-At(Math.abs(e-n),1,t)/t:0,ic=(e,t,n=15,s=40)=>{const r=na(e.x,s,t.width-s)*n,i=na(e.y,s,t.height-s)*n;return[r,i]},hr=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Gs=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),mr=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Mt=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=yo(e)?e.internals.positionAbsolute:cn(e,t);return{x:n,y:s,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},Jn=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=yo(e)?e.internals.positionAbsolute:cn(e,t);return{x:n,y:s,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:s+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},ac=(e,t)=>mr(hr(Gs(e),Gs(t))),Jt=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},ra=e=>De(e.width)&&De(e.height)&&De(e.x)&&De(e.y),De=e=>!isNaN(e)&&isFinite(e),yx=(e,t)=>{},dn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),fn=({x:e,y:t},[n,s,r],i=!1,o=[1,1])=>{const l={x:(e-n)/r,y:(t-s)/r};return i?dn(l,o):l},er=({x:e,y:t},[n,s,r])=>({x:e*r+n,y:t*r+s});function bt(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function wx(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=bt(e,n),r=bt(e,t);return{top:s,right:r,bottom:s,left:r,x:r*2,y:s*2}}if(typeof e=="object"){const s=bt(e.top??e.y??0,n),r=bt(e.bottom??e.y??0,n),i=bt(e.left??e.x??0,t),o=bt(e.right??e.x??0,t);return{top:s,right:o,bottom:r,left:i,x:i+o,y:s+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function bx(e,t,n,s,r,i){const{x:o,y:l}=er(e,[t,n,s]),{x:c,y:u}=er({x:e.x+e.width,y:e.y+e.height},[t,n,s]),d=r-c,f=i-u;return{left:Math.floor(o),top:Math.floor(l),right:Math.floor(d),bottom:Math.floor(f)}}const pr=(e,t,n,s,r,i)=>{const o=wx(i,t,n),l=(t-o.x)/e.width,c=(n-o.y)/e.height,u=Math.min(l,c),d=At(u,s,r),f=e.x+e.width/2,h=e.y+e.height/2,m=t/2-f*d,x=n/2-h*d,g=bx(e,m,x,d,t,n),w={left:Math.min(g.left-o.left,0),top:Math.min(g.top-o.top,0),right:Math.min(g.right-o.right,0),bottom:Math.min(g.bottom-o.bottom,0)};return{x:m-w.left+w.right,y:x-w.top+w.bottom,zoom:d}},en=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Tt(e){return e!=null&&e!=="parent"}function et(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function lc(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function cc(e,t={width:0,height:0},n,s,r){const i={...e},o=s.get(n);if(o){const l=o.origin||r;i.x+=o.internals.positionAbsolute.x-(t.width??0)*l[0],i.y+=o.internals.positionAbsolute.y-(t.height??0)*l[1]}return i}function sa(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function vx(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}function Nx(e){return{...Jl,...e||{}}}function qt(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:r}){const{x:i,y:o}=Re(e),l=fn({x:i-((r==null?void 0:r.left)??0),y:o-((r==null?void 0:r.top)??0)},s),{x:c,y:u}=n?dn(l,t):l;return{xSnapped:c,ySnapped:u,...l}}const bo=e=>({width:e.offsetWidth,height:e.offsetHeight}),uc=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},jx=["INPUT","SELECT","TEXTAREA"];function dc(e){var s,r;const t=((r=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:jx.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const fc=e=>"clientX"in e,Re=(e,t)=>{var i,o;const n=fc(e),s=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(o=e.touches)==null?void 0:o[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},oa=(e,t,n,s,r)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(o=>{const l=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:e,nodeId:r,position:o.getAttribute("data-handlepos"),x:(l.left-n.left)/s,y:(l.top-n.top)/s,...bo(o)}})};function hc({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:o,targetControlY:l}){const c=e*.125+r*.375+o*.375+n*.125,u=t*.125+i*.375+l*.375+s*.125,d=Math.abs(c-e),f=Math.abs(u-t);return[c,u,d,f]}function _n(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function ia({pos:e,x1:t,y1:n,x2:s,y2:r,c:i}){switch(e){case U.Left:return[t-_n(t-s,i),n];case U.Right:return[t+_n(s-t,i),n];case U.Top:return[t,n-_n(n-r,i)];case U.Bottom:return[t,n+_n(r-n,i)]}}function mc({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top,curvature:o=.25}){const[l,c]=ia({pos:n,x1:e,y1:t,x2:s,y2:r,c:o}),[u,d]=ia({pos:i,x1:s,y1:r,x2:e,y2:t,c:o}),[f,h,m,x]=hc({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:l,sourceControlY:c,targetControlX:u,targetControlY:d});return[`M${e},${t} C${l},${c} ${u},${d} ${s},${r}`,f,h,m,x]}function pc({sourceX:e,sourceY:t,targetX:n,targetY:s}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,o=Math.abs(s-t)/2,l=s<t?s+o:s-o;return[i,l,r,o]}function Ex({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s,elevateOnSelect:r=!1}){if(s!==void 0)return s;const i=r&&n?1e3:0,o=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return i+o}function _x({sourceNode:e,targetNode:t,width:n,height:s,transform:r}){const i=hr(Jn(e),Jn(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const o={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:s/r[2]};return Jt(o,mr(i))>0}const Ix=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,Sx=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Cx=(e,t)=>{if(!e.source||!e.target)return t;let n;return nc(e)?n={...e}:n={...e,id:Ix(e)},Sx(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function gc({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[r,i,o,l]=pc({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,r,i,o,l]}const aa={[U.Left]:{x:-1,y:0},[U.Right]:{x:1,y:0},[U.Top]:{x:0,y:-1},[U.Bottom]:{x:0,y:1}},kx=({source:e,sourcePosition:t=U.Bottom,target:n})=>t===U.Left||t===U.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},la=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Ax({source:e,sourcePosition:t=U.Bottom,target:n,targetPosition:s=U.Top,center:r,offset:i,stepPosition:o}){const l=aa[t],c=aa[s],u={x:e.x+l.x*i,y:e.y+l.y*i},d={x:n.x+c.x*i,y:n.y+c.y*i},f=kx({source:u,sourcePosition:t,target:d}),h=f.x!==0?"x":"y",m=f[h];let x=[],g,w;const y={x:0,y:0},v={x:0,y:0},[,,p,b]=pc({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(l[h]*c[h]===-1){h==="x"?(g=r.x??u.x+(d.x-u.x)*o,w=r.y??(u.y+d.y)/2):(g=r.x??(u.x+d.x)/2,w=r.y??u.y+(d.y-u.y)*o);const E=[{x:g,y:u.y},{x:g,y:d.y}],k=[{x:u.x,y:w},{x:d.x,y:w}];l[h]===m?x=h==="x"?E:k:x=h==="x"?k:E}else{const E=[{x:u.x,y:d.y}],k=[{x:d.x,y:u.y}];if(h==="x"?x=l.x===m?k:E:x=l.y===m?E:k,t===s){const S=Math.abs(e[h]-n[h]);if(S<=i){const O=Math.min(i-1,i-S);l[h]===m?y[h]=(u[h]>e[h]?-1:1)*O:v[h]=(d[h]>n[h]?-1:1)*O}}if(t!==s){const S=h==="x"?"y":"x",O=l[h]===c[S],j=u[S]>d[S],P=u[S]<d[S];(l[h]===1&&(!O&&j||O&&P)||l[h]!==1&&(!O&&P||O&&j))&&(x=h==="x"?E:k)}const N={x:u.x+y.x,y:u.y+y.y},_={x:d.x+v.x,y:d.y+v.y},T=Math.max(Math.abs(N.x-x[0].x),Math.abs(_.x-x[0].x)),C=Math.max(Math.abs(N.y-x[0].y),Math.abs(_.y-x[0].y));T>=C?(g=(N.x+_.x)/2,w=x[0].y):(g=x[0].x,w=(N.y+_.y)/2)}return[[e,{x:u.x+y.x,y:u.y+y.y},...x,{x:d.x+v.x,y:d.y+v.y},n],g,w,p,b]}function Mx(e,t,n,s){const r=Math.min(la(e,t)/2,la(t,n)/2,s),{x:i,y:o}=t;if(e.x===i&&i===n.x||e.y===o&&o===n.y)return`L${i} ${o}`;if(e.y===o){const u=e.x<n.x?-1:1,d=e.y<n.y?1:-1;return`L ${i+r*u},${o}Q ${i},${o} ${i},${o+r*d}`}const l=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${o+r*c}Q ${i},${o} ${i+r*l},${o}`}function Ys({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top,borderRadius:o=5,centerX:l,centerY:c,offset:u=20,stepPosition:d=.5}){const[f,h,m,x,g]=Ax({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:r},targetPosition:i,center:{x:l,y:c},offset:u,stepPosition:d});return[f.reduce((y,v,p)=>{let b="";return p>0&&p<f.length-1?b=Mx(f[p-1],v,f[p+1],o):b=`${p===0?"M":"L"}${v.x} ${v.y}`,y+=b,y},""),h,m,x,g]}function ca(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Tx(e){var f;const{sourceNode:t,targetNode:n}=e;if(!ca(t)||!ca(n))return null;const s=t.internals.handleBounds||ua(t.handles),r=n.internals.handleBounds||ua(n.handles),i=da((s==null?void 0:s.source)??[],e.sourceHandle),o=da(e.connectionMode===kt.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!i||!o)return(f=e.onError)==null||f.call(e,"008",Ge.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=(i==null?void 0:i.position)||U.Bottom,c=(o==null?void 0:o.position)||U.Top,u=tn(t,i,l),d=tn(n,o,c);return{sourceX:u.x,sourceY:u.y,targetX:d.x,targetY:d.y,sourcePosition:l,targetPosition:c}}function ua(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function tn(e,t,n=U.Left,s=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:o,height:l}=t??et(e);if(s)return{x:r+o/2,y:i+l/2};switch((t==null?void 0:t.position)??n){case U.Top:return{x:r+o/2,y:i};case U.Right:return{x:r+o,y:i+l/2};case U.Bottom:return{x:r+o/2,y:i+l};case U.Left:return{x:r,y:i+l/2}}}function da(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Ws(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function Px(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:r}){const i=new Set;return e.reduce((o,l)=>([l.markerStart||s,l.markerEnd||r].forEach(c=>{if(c&&typeof c=="object"){const u=Ws(c,t);i.has(u)||(o.push({id:u,color:c.color||n,...c}),i.add(u))}}),o),[]).sort((o,l)=>o.id.localeCompare(l.id))}const xc=1e3,Dx=10,vo={nodeOrigin:[0,0],nodeExtent:Kt,elevateNodesOnSelect:!0,defaults:{}},Rx={...vo,checkEquality:!0};function No(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function Lx(e,t,n){const s=No(vo,n);for(const r of e.values())if(r.parentId)jo(r,e,t,s);else{const i=cn(r,s.nodeOrigin),o=Tt(r.extent)?r.extent:s.nodeExtent,l=xt(i,o,et(r));r.internals.positionAbsolute=l}}function zx(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const r of e.handles){const i={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?n.push(i):r.type==="target"&&s.push(i)}return{source:n,target:s}}function Xs(e,t,n,s){var u,d;const r=No(Rx,s);let i={i:-1},o=e.length>0;const l=new Map(t),c=r!=null&&r.elevateNodesOnSelect?xc:0;t.clear(),n.clear();for(const f of e){let h=l.get(f.id);if(r.checkEquality&&f===(h==null?void 0:h.internals.userNode))t.set(f.id,h);else{const m=cn(f,r.nodeOrigin),x=Tt(f.extent)?f.extent:r.nodeExtent,g=xt(m,x,et(f));h={...r.defaults,...f,measured:{width:(u=f.measured)==null?void 0:u.width,height:(d=f.measured)==null?void 0:d.height},internals:{positionAbsolute:g,handleBounds:zx(f,h),z:yc(f,c),userNode:f}},t.set(f.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(o=!1),f.parentId&&jo(h,t,n,s,i)}return o}function $x(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function jo(e,t,n,s,r){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:l}=No(vo,s),c=e.parentId,u=t.get(c);if(!u){console.warn(`Parent node ${c} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}$x(e,n),r&&!u.parentId&&u.internals.rootParentIndex===void 0&&(u.internals.rootParentIndex=++r.i,u.internals.z=u.internals.z+r.i*Dx),r&&u.internals.rootParentIndex!==void 0&&(r.i=u.internals.rootParentIndex);const d=i?xc:0,{x:f,y:h,z:m}=Ox(e,u,o,l,d),{positionAbsolute:x}=e.internals,g=f!==x.x||h!==x.y;(g||m!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:f,y:h}:x,z:m}})}function yc(e,t){return(De(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Ox(e,t,n,s,r){const{x:i,y:o}=t.internals.positionAbsolute,l=et(e),c=cn(e,n),u=Tt(e.extent)?xt(c,e.extent,l):c;let d=xt({x:i+u.x,y:o+u.y},s,l);e.extent==="parent"&&(d=oc(d,l,t));const f=yc(e,r),h=t.internals.z??0;return{x:d.x,y:d.y,z:h>=f?h+1:f}}function Eo(e,t,n,s=[0,0]){var o;const r=[],i=new Map;for(const l of e){const c=t.get(l.parentId);if(!c)continue;const u=((o=i.get(l.parentId))==null?void 0:o.expandedRect)??Mt(c),d=ac(u,l.rect);i.set(l.parentId,{expandedRect:d,parent:c})}return i.size>0&&i.forEach(({expandedRect:l,parent:c},u)=>{var p;const d=c.internals.positionAbsolute,f=et(c),h=c.origin??s,m=l.x<d.x?Math.round(Math.abs(d.x-l.x)):0,x=l.y<d.y?Math.round(Math.abs(d.y-l.y)):0,g=Math.max(f.width,Math.round(l.width)),w=Math.max(f.height,Math.round(l.height)),y=(g-f.width)*h[0],v=(w-f.height)*h[1];(m>0||x>0||y||v)&&(r.push({id:u,type:"position",position:{x:c.position.x-m+y,y:c.position.y-x+v}}),(p=n.get(u))==null||p.forEach(b=>{e.some(I=>I.id===b.id)||r.push({id:b.id,type:"position",position:{x:b.position.x+m,y:b.position.y+x}})})),(f.width<l.width||f.height<l.height||m||x)&&r.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:g+(m?h[0]*m-y:0),height:w+(x?h[1]*x-v:0)}})}),r}function Vx(e,t,n,s,r,i){const o=s==null?void 0:s.querySelector(".xyflow__viewport");let l=!1;if(!o)return{changes:[],updatedInternals:l};const c=[],u=window.getComputedStyle(o),{m22:d}=new window.DOMMatrixReadOnly(u.transform),f=[];for(const h of e.values()){const m=t.get(h.id);if(!m)continue;if(m.hidden){t.set(m.id,{...m,internals:{...m.internals,handleBounds:void 0}}),l=!0;continue}const x=bo(h.nodeElement),g=m.measured.width!==x.width||m.measured.height!==x.height;if(!!(x.width&&x.height&&(g||!m.internals.handleBounds||h.force))){const y=h.nodeElement.getBoundingClientRect(),v=Tt(m.extent)?m.extent:i;let{positionAbsolute:p}=m.internals;m.parentId&&m.extent==="parent"?p=oc(p,x,t.get(m.parentId)):v&&(p=xt(p,v,x));const b={...m,measured:x,internals:{...m.internals,positionAbsolute:p,handleBounds:{source:oa("source",h.nodeElement,y,d,m.id),target:oa("target",h.nodeElement,y,d,m.id)}}};t.set(m.id,b),m.parentId&&jo(b,t,n,{nodeOrigin:r}),l=!0,g&&(c.push({id:m.id,type:"dimensions",dimensions:x}),m.expandParent&&m.parentId&&f.push({id:m.id,parentId:m.parentId,rect:Mt(b,r)}))}}if(f.length>0){const h=Eo(f,t,n,r);c.push(...h)}return{changes:c,updatedInternals:l}}async function Bx({delta:e,panZoom:t,transform:n,translateExtent:s,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const o=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],s),l=!!o&&(o.x!==n[0]||o.y!==n[1]||o.k!==n[2]);return Promise.resolve(l)}function fa(e,t,n,s,r,i){let o=r;const l=s.get(o)||new Map;s.set(o,l.set(n,t)),o=`${r}-${e}`;const c=s.get(o)||new Map;if(s.set(o,c.set(n,t)),i){o=`${r}-${e}-${i}`;const u=s.get(o)||new Map;s.set(o,u.set(n,t))}}function wc(e,t,n){e.clear(),t.clear();for(const s of n){const{source:r,target:i,sourceHandle:o=null,targetHandle:l=null}=s,c={edgeId:s.id,source:r,target:i,sourceHandle:o,targetHandle:l},u=`${r}-${o}--${i}-${l}`,d=`${i}-${l}--${r}-${o}`;fa("source",c,d,e,r,o),fa("target",c,u,e,i,l),t.set(s.id,s)}}function bc(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:bc(n,t):!1}function ha(e,t,n){var r;let s=e;do{if((r=s==null?void 0:s.matches)!=null&&r.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function Fx(e,t,n,s){const r=new Map;for(const[i,o]of e)if((o.selected||o.id===s)&&(!o.parentId||!bc(o,e))&&(o.draggable||t&&typeof o.draggable>"u")){const l=e.get(i);l&&r.set(i,{id:i,position:l.position||{x:0,y:0},distance:{x:n.x-l.internals.positionAbsolute.x,y:n.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return r}function ks({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var o,l,c;const r=[];for(const[u,d]of t){const f=(o=n.get(u))==null?void 0:o.internals.userNode;f&&r.push({...f,position:d.position,dragging:s})}if(!e)return[r[0],r];const i=(l=n.get(e))==null?void 0:l.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:s}:r[0],r]}function Hx({dragItems:e,snapGrid:t,x:n,y:s}){const r=e.values().next().value;if(!r)return null;const i={x:n-r.distance.x,y:s-r.distance.y},o=dn(i,t);return{x:o.x-i.x,y:o.y-i.y}}function qx({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:r}){let i={x:null,y:null},o=0,l=new Map,c=!1,u={x:0,y:0},d=null,f=!1,h=null,m=!1,x=!1,g=null;function w({noDragClassName:v,handleSelector:p,domNode:b,isSelectable:I,nodeId:E,nodeClickDistance:k=0}){h=Se(b);function N({x:S,y:O}){const{nodeLookup:j,nodeExtent:P,snapGrid:M,snapToGrid:V,nodeOrigin:L,onNodeDrag:D,onSelectionDrag:F,onError:Y,updateNodePositions:G}=t();i={x:S,y:O};let A=!1;const R=l.size>1,B=R&&P?Gs(un(l)):null,H=R&&V?Hx({dragItems:l,snapGrid:M,x:S,y:O}):null;for(const[W,q]of l){if(!j.has(W))continue;let X={x:S-q.distance.x,y:O-q.distance.y};V&&(X=H?{x:Math.round(X.x+H.x),y:Math.round(X.y+H.y)}:dn(X,M));let ee=null;if(R&&P&&!q.extent&&B){const{positionAbsolute:Z}=q.internals,ne=Z.x-B.x+P[0][0],oe=Z.x+q.measured.width-B.x2+P[1][0],re=Z.y-B.y+P[0][1],ye=Z.y+q.measured.height-B.y2+P[1][1];ee=[[ne,re],[oe,ye]]}const{position:te,positionAbsolute:Q}=sc({nodeId:W,nextPosition:X,nodeLookup:j,nodeExtent:ee||P,nodeOrigin:L,onError:Y});A=A||q.position.x!==te.x||q.position.y!==te.y,q.position=te,q.internals.positionAbsolute=Q}if(x=x||A,!!A&&(G(l,!0),g&&(s||D||!E&&F))){const[W,q]=ks({nodeId:E,dragItems:l,nodeLookup:j});s==null||s(g,l,W,q),D==null||D(g,W,q),E||F==null||F(g,q)}}async function _(){if(!d)return;const{transform:S,panBy:O,autoPanSpeed:j,autoPanOnNodeDrag:P}=t();if(!P){c=!1,cancelAnimationFrame(o);return}const[M,V]=ic(u,d,j);(M!==0||V!==0)&&(i.x=(i.x??0)-M/S[2],i.y=(i.y??0)-V/S[2],await O({x:M,y:V})&&N(i)),o=requestAnimationFrame(_)}function T(S){var R;const{nodeLookup:O,multiSelectionActive:j,nodesDraggable:P,transform:M,snapGrid:V,snapToGrid:L,selectNodesOnDrag:D,onNodeDragStart:F,onSelectionDragStart:Y,unselectNodesAndEdges:G}=t();f=!0,(!D||!I)&&!j&&E&&((R=O.get(E))!=null&&R.selected||G()),I&&D&&E&&(e==null||e(E));const A=qt(S.sourceEvent,{transform:M,snapGrid:V,snapToGrid:L,containerBounds:d});if(i=A,l=Fx(O,P,A,E),l.size>0&&(n||F||!E&&Y)){const[B,H]=ks({nodeId:E,dragItems:l,nodeLookup:O});n==null||n(S.sourceEvent,l,B,H),F==null||F(S.sourceEvent,B,H),E||Y==null||Y(S.sourceEvent,H)}}const C=Ll().clickDistance(k).on("start",S=>{const{domNode:O,nodeDragThreshold:j,transform:P,snapGrid:M,snapToGrid:V}=t();d=(O==null?void 0:O.getBoundingClientRect())||null,m=!1,x=!1,g=S.sourceEvent,j===0&&T(S),i=qt(S.sourceEvent,{transform:P,snapGrid:M,snapToGrid:V,containerBounds:d}),u=Re(S.sourceEvent,d)}).on("drag",S=>{const{autoPanOnNodeDrag:O,transform:j,snapGrid:P,snapToGrid:M,nodeDragThreshold:V,nodeLookup:L}=t(),D=qt(S.sourceEvent,{transform:j,snapGrid:P,snapToGrid:M,containerBounds:d});if(g=S.sourceEvent,(S.sourceEvent.type==="touchmove"&&S.sourceEvent.touches.length>1||E&&!L.has(E))&&(m=!0),!m){if(!c&&O&&f&&(c=!0,_()),!f){const F=Re(S.sourceEvent,d),Y=F.x-u.x,G=F.y-u.y;Math.sqrt(Y*Y+G*G)>V&&T(S)}(i.x!==D.xSnapped||i.y!==D.ySnapped)&&l&&f&&(u=Re(S.sourceEvent,d),N(D))}}).on("end",S=>{if(!(!f||m)&&(c=!1,f=!1,cancelAnimationFrame(o),l.size>0)){const{nodeLookup:O,updateNodePositions:j,onNodeDragStop:P,onSelectionDragStop:M}=t();if(x&&(j(l,!1),x=!1),r||P||!E&&M){const[V,L]=ks({nodeId:E,dragItems:l,nodeLookup:O,dragging:!1});r==null||r(S.sourceEvent,l,V,L),P==null||P(S.sourceEvent,V,L),E||M==null||M(S.sourceEvent,L)}}}).filter(S=>{const O=S.target;return!S.button&&(!v||!ha(O,`.${v}`,b))&&(!p||ha(O,p,b))});h.call(C)}function y(){h==null||h.on(".drag",null)}return{update:w,destroy:y}}function Gx(e,t,n){const s=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())Jt(r,Mt(i))>0&&s.push(i);return s}const Yx=250;function Wx(e,t,n,s){var l,c;let r=[],i=1/0;const o=Gx(e,n,t+Yx);for(const u of o){const d=[...((l=u.internals.handleBounds)==null?void 0:l.source)??[],...((c=u.internals.handleBounds)==null?void 0:c.target)??[]];for(const f of d){if(s.nodeId===f.nodeId&&s.type===f.type&&s.id===f.id)continue;const{x:h,y:m}=tn(u,f,f.position,!0),x=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(m-e.y,2));x>t||(x<i?(r=[{...f,x:h,y:m}],i=x):x===i&&r.push({...f,x:h,y:m}))}}if(!r.length)return null;if(r.length>1){const u=s.type==="source"?"target":"source";return r.find(d=>d.type===u)??r[0]}return r[0]}function vc(e,t,n,s,r,i=!1){var u,d,f;const o=s.get(e);if(!o)return null;const l=r==="strict"?(u=o.internals.handleBounds)==null?void 0:u[t]:[...((d=o.internals.handleBounds)==null?void 0:d.source)??[],...((f=o.internals.handleBounds)==null?void 0:f.target)??[]],c=(n?l==null?void 0:l.find(h=>h.id===n):l==null?void 0:l[0])??null;return c&&i?{...c,...tn(o,c,c.position,!0)}:c}function Nc(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Xx(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const jc=()=>!0;function Ux(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:r,edgeUpdaterType:i,isTarget:o,domNode:l,nodeLookup:c,lib:u,autoPanOnConnect:d,flowId:f,panBy:h,cancelConnection:m,onConnectStart:x,onConnect:g,onConnectEnd:w,isValidConnection:y=jc,onReconnectEnd:v,updateConnection:p,getTransform:b,getFromHandle:I,autoPanSpeed:E,dragThreshold:k=1,handleDomNode:N}){const _=uc(e.target);let T=0,C;const{x:S,y:O}=Re(e),j=Nc(i,N),P=l==null?void 0:l.getBoundingClientRect();let M=!1;if(!P||!j)return;const V=vc(r,j,s,c,t);if(!V)return;let L=Re(e,P),D=!1,F=null,Y=!1,G=null;function A(){if(!d||!P)return;const[te,Q]=ic(L,P,E);h({x:te,y:Q}),T=requestAnimationFrame(A)}const R={...V,nodeId:r,type:j,position:V.position},B=c.get(r);let W={inProgress:!0,isValid:null,from:tn(B,R,U.Left,!0),fromHandle:R,fromPosition:R.position,fromNode:B,to:L,toHandle:null,toPosition:ta[R.position],toNode:null,pointer:L};function q(){M=!0,p(W),x==null||x(e,{nodeId:r,handleId:s,handleType:j})}k===0&&q();function X(te){if(!M){const{x:oe,y:re}=Re(te),ye=oe-S,Xe=re-O;if(!(ye*ye+Xe*Xe>k*k))return;q()}if(!I()||!R){ee(te);return}const Q=b();L=Re(te,P),C=Wx(fn(L,Q,!1,[1,1]),n,c,R),D||(A(),D=!0);const Z=Ec(te,{handle:C,connectionMode:t,fromNodeId:r,fromHandleId:s,fromType:o?"target":"source",isValidConnection:y,doc:_,lib:u,flowId:f,nodeLookup:c});G=Z.handleDomNode,F=Z.connection,Y=Xx(!!C,Z.isValid);const ne={...W,isValid:Y,to:Z.toHandle&&Y?er({x:Z.toHandle.x,y:Z.toHandle.y},Q):L,toHandle:Z.toHandle,toPosition:Y&&Z.toHandle?Z.toHandle.position:ta[R.position],toNode:Z.toHandle?c.get(Z.toHandle.nodeId):null,pointer:L};p(ne),W=ne}function ee(te){if(!("touches"in te&&te.touches.length>0)){if(M){(C||G)&&F&&Y&&(g==null||g(F));const{inProgress:Q,...Z}=W,ne={...Z,toPosition:W.toHandle?W.toPosition:null};w==null||w(te,ne),i&&(v==null||v(te,ne))}m(),cancelAnimationFrame(T),D=!1,Y=!1,F=null,G=null,_.removeEventListener("mousemove",X),_.removeEventListener("mouseup",ee),_.removeEventListener("touchmove",X),_.removeEventListener("touchend",ee)}}_.addEventListener("mousemove",X),_.addEventListener("mouseup",ee),_.addEventListener("touchmove",X),_.addEventListener("touchend",ee)}function Ec(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:r,fromType:i,doc:o,lib:l,flowId:c,isValidConnection:u=jc,nodeLookup:d}){const f=i==="target",h=t?o.querySelector(`.${l}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:m,y:x}=Re(e),g=o.elementFromPoint(m,x),w=g!=null&&g.classList.contains(`${l}-flow__handle`)?g:h,y={handleDomNode:w,isValid:!1,connection:null,toHandle:null};if(w){const v=Nc(void 0,w),p=w.getAttribute("data-nodeid"),b=w.getAttribute("data-handleid"),I=w.classList.contains("connectable"),E=w.classList.contains("connectableend");if(!p||!v)return y;const k={source:f?p:s,sourceHandle:f?b:r,target:f?s:p,targetHandle:f?r:b};y.connection=k;const _=I&&E&&(n===kt.Strict?f&&v==="source"||!f&&v==="target":p!==s||b!==r);y.isValid=_&&u(k),y.toHandle=vc(p,v,b,d,n,!0)}return y}const Us={onPointerDown:Ux,isValid:Ec};function Zx({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const r=Se(e);function i({translateExtent:l,width:c,height:u,zoomStep:d=1,pannable:f=!0,zoomable:h=!0,inversePan:m=!1}){const x=p=>{if(p.sourceEvent.type!=="wheel"||!t)return;const b=n(),I=p.sourceEvent.ctrlKey&&en()?10:1,E=-p.sourceEvent.deltaY*(p.sourceEvent.deltaMode===1?.05:p.sourceEvent.deltaMode?1:.002)*d,k=b[2]*Math.pow(2,E*I);t.scaleTo(k)};let g=[0,0];const w=p=>{(p.sourceEvent.type==="mousedown"||p.sourceEvent.type==="touchstart")&&(g=[p.sourceEvent.clientX??p.sourceEvent.touches[0].clientX,p.sourceEvent.clientY??p.sourceEvent.touches[0].clientY])},y=p=>{const b=n();if(p.sourceEvent.type!=="mousemove"&&p.sourceEvent.type!=="touchmove"||!t)return;const I=[p.sourceEvent.clientX??p.sourceEvent.touches[0].clientX,p.sourceEvent.clientY??p.sourceEvent.touches[0].clientY],E=[I[0]-g[0],I[1]-g[1]];g=I;const k=s()*Math.max(b[2],Math.log(b[2]))*(m?-1:1),N={x:b[0]-E[0]*k,y:b[1]-E[1]*k},_=[[0,0],[c,u]];t.setViewportConstrained({x:N.x,y:N.y,zoom:b[2]},_,l)},v=Kl().on("start",w).on("zoom",f?y:null).on("zoom.wheel",h?x:null);r.call(v,{})}function o(){r.on("zoom",null)}return{update:i,destroy:o,pointer:Te}}const gr=e=>({x:e.x,y:e.y,zoom:e.k}),As=({x:e,y:t,zoom:n})=>fr.translate(e,t).scale(n),Nt=(e,t)=>e.target.closest(`.${t}`),_c=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Kx=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Ms=(e,t=0,n=Kx,s=()=>{})=>{const r=typeof t=="number"&&t>0;return r||s(),r?e.transition().duration(t).ease(n).on("end",s):e},Ic=e=>{const t=e.ctrlKey&&en()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Qx({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:o,onPanZoomStart:l,onPanZoom:c,onPanZoomEnd:u}){return d=>{if(Nt(d,t))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const f=n.property("__zoom").k||1;if(d.ctrlKey&&o){const w=Te(d),y=Ic(d),v=f*Math.pow(2,y);s.scaleTo(n,v,w,d);return}const h=d.deltaMode===1?20:1;let m=r===mt.Vertical?0:d.deltaX*h,x=r===mt.Horizontal?0:d.deltaY*h;!en()&&d.shiftKey&&r!==mt.Vertical&&(m=d.deltaY*h,x=0),s.translateBy(n,-(m/f)*i,-(x/f)*i,{internal:!0});const g=gr(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c==null||c(d,g),e.panScrollTimeout=setTimeout(()=>{u==null||u(d,g),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,l==null||l(d,g))}}function Jx({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,r){const i=s.type==="wheel",o=!t&&i&&!s.ctrlKey,l=Nt(s,e);if(s.ctrlKey&&i&&l&&s.preventDefault(),o||l)return null;s.preventDefault(),n.call(this,s,r)}}function e0({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var i,o,l;if((i=s.sourceEvent)!=null&&i.internal)return;const r=gr(s.transform);e.mouseButton=((o=s.sourceEvent)==null?void 0:o.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((l=s.sourceEvent)==null?void 0:l.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,r))}}function t0({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:r}){return i=>{var o,l;e.usedRightMouseButton=!!(n&&_c(t,e.mouseButton??0)),(o=i.sourceEvent)!=null&&o.sync||s([i.transform.x,i.transform.y,i.transform.k]),r&&!((l=i.sourceEvent)!=null&&l.internal)&&(r==null||r(i.sourceEvent,gr(i.transform)))}}function n0({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:r,onPaneContextMenu:i}){return o=>{var l;if(!((l=o.sourceEvent)!=null&&l.internal)&&(e.isZoomingOrPanning=!1,i&&_c(t,e.mouseButton??0)&&!e.usedRightMouseButton&&o.sourceEvent&&i(o.sourceEvent),e.usedRightMouseButton=!1,s(!1),r)){const c=gr(o.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(o.sourceEvent,c)},n?150:0)}}}function r0({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:o,noWheelClassName:l,noPanClassName:c,lib:u,connectionInProgress:d}){return f=>{var w;const h=e||t,m=n&&f.ctrlKey,x=f.type==="wheel";if(f.button===1&&f.type==="mousedown"&&(Nt(f,`${u}-flow__node`)||Nt(f,`${u}-flow__edge`)))return!0;if(!s&&!h&&!r&&!i&&!n||o||d&&!x||Nt(f,l)&&x||Nt(f,c)&&(!x||r&&x&&!e)||!n&&f.ctrlKey&&x)return!1;if(!n&&f.type==="touchstart"&&((w=f.touches)==null?void 0:w.length)>1)return f.preventDefault(),!1;if(!h&&!r&&!m&&x||!s&&(f.type==="mousedown"||f.type==="touchstart")||Array.isArray(s)&&!s.includes(f.button)&&f.type==="mousedown")return!1;const g=Array.isArray(s)&&s.includes(f.button)||!f.button||f.button<=1;return(!f.ctrlKey||x)&&g}}function s0({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:r,onPanZoom:i,onPanZoomStart:o,onPanZoomEnd:l,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),f=Kl().scaleExtent([t,n]).translateExtent(s),h=Se(e).call(f);v({x:r.x,y:r.y,zoom:At(r.zoom,t,n)},[[0,0],[d.width,d.height]],s);const m=h.on("wheel.zoom"),x=h.on("dblclick.zoom");f.wheelDelta(Ic);function g(C,S){return h?new Promise(O=>{f==null||f.interpolate((S==null?void 0:S.interpolate)==="linear"?Ht:Dn).transform(Ms(h,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>O(!0)),C)}):Promise.resolve(!1)}function w({noWheelClassName:C,noPanClassName:S,onPaneContextMenu:O,userSelectionActive:j,panOnScroll:P,panOnDrag:M,panOnScrollMode:V,panOnScrollSpeed:L,preventScrolling:D,zoomOnPinch:F,zoomOnScroll:Y,zoomOnDoubleClick:G,zoomActivationKeyPressed:A,lib:R,onTransformChange:B,connectionInProgress:H,paneClickDistance:W,selectionOnDrag:q}){j&&!u.isZoomingOrPanning&&y();const X=P&&!A&&!j;f.clickDistance(q?1/0:!De(W)||W<0?0:W);const ee=X?Qx({zoomPanValues:u,noWheelClassName:C,d3Selection:h,d3Zoom:f,panOnScrollMode:V,panOnScrollSpeed:L,zoomOnPinch:F,onPanZoomStart:o,onPanZoom:i,onPanZoomEnd:l}):Jx({noWheelClassName:C,preventScrolling:D,d3ZoomHandler:m});if(h.on("wheel.zoom",ee,{passive:!1}),!j){const Q=e0({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:o});f.on("start",Q);const Z=t0({zoomPanValues:u,panOnDrag:M,onPaneContextMenu:!!O,onPanZoom:i,onTransformChange:B});f.on("zoom",Z);const ne=n0({zoomPanValues:u,panOnDrag:M,panOnScroll:P,onPaneContextMenu:O,onPanZoomEnd:l,onDraggingChange:c});f.on("end",ne)}const te=r0({zoomActivationKeyPressed:A,panOnDrag:M,zoomOnScroll:Y,panOnScroll:P,zoomOnDoubleClick:G,zoomOnPinch:F,userSelectionActive:j,noPanClassName:S,noWheelClassName:C,lib:R,connectionInProgress:H});f.filter(te),G?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function y(){f.on("zoom",null)}async function v(C,S,O){const j=As(C),P=f==null?void 0:f.constrain()(j,S,O);return P&&await g(P),new Promise(M=>M(P))}async function p(C,S){const O=As(C);return await g(O,S),new Promise(j=>j(O))}function b(C){if(h){const S=As(C),O=h.property("__zoom");(O.k!==C.zoom||O.x!==C.x||O.y!==C.y)&&(f==null||f.transform(h,S,null,{sync:!0}))}}function I(){const C=h?Zl(h.node()):{x:0,y:0,k:1};return{x:C.x,y:C.y,zoom:C.k}}function E(C,S){return h?new Promise(O=>{f==null||f.interpolate((S==null?void 0:S.interpolate)==="linear"?Ht:Dn).scaleTo(Ms(h,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>O(!0)),C)}):Promise.resolve(!1)}function k(C,S){return h?new Promise(O=>{f==null||f.interpolate((S==null?void 0:S.interpolate)==="linear"?Ht:Dn).scaleBy(Ms(h,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>O(!0)),C)}):Promise.resolve(!1)}function N(C){f==null||f.scaleExtent(C)}function _(C){f==null||f.translateExtent(C)}function T(C){const S=!De(C)||C<0?0:C;f==null||f.clickDistance(S)}return{update:w,destroy:y,setViewport:p,setViewportConstrained:v,getViewport:I,scaleTo:E,scaleBy:k,setScaleExtent:N,setTranslateExtent:_,syncViewport:b,setClickDistance:T}}var Pt;(function(e){e.Line="line",e.Handle="handle"})(Pt||(Pt={}));function o0({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:r,affectsY:i}){const o=e-t,l=n-s,c=[o>0?1:o<0?-1:0,l>0?1:l<0?-1:0];return o&&r&&(c[0]=c[0]*-1),l&&i&&(c[1]=c[1]*-1),c}function ma(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:r}}function tt(e,t){return Math.max(0,t-e)}function nt(e,t){return Math.max(0,e-t)}function In(e,t,n){return Math.max(0,t-e,e-n)}function pa(e,t){return e?!t:t}function i0(e,t,n,s,r,i,o,l){let{affectsX:c,affectsY:u}=t;const{isHorizontal:d,isVertical:f}=t,h=d&&f,{xSnapped:m,ySnapped:x}=n,{minWidth:g,maxWidth:w,minHeight:y,maxHeight:v}=s,{x:p,y:b,width:I,height:E,aspectRatio:k}=e;let N=Math.floor(d?m-e.pointerX:0),_=Math.floor(f?x-e.pointerY:0);const T=I+(c?-N:N),C=E+(u?-_:_),S=-i[0]*I,O=-i[1]*E;let j=In(T,g,w),P=In(C,y,v);if(o){let L=0,D=0;c&&N<0?L=tt(p+N+S,o[0][0]):!c&&N>0&&(L=nt(p+T+S,o[1][0])),u&&_<0?D=tt(b+_+O,o[0][1]):!u&&_>0&&(D=nt(b+C+O,o[1][1])),j=Math.max(j,L),P=Math.max(P,D)}if(l){let L=0,D=0;c&&N>0?L=nt(p+N,l[0][0]):!c&&N<0&&(L=tt(p+T,l[1][0])),u&&_>0?D=nt(b+_,l[0][1]):!u&&_<0&&(D=tt(b+C,l[1][1])),j=Math.max(j,L),P=Math.max(P,D)}if(r){if(d){const L=In(T/k,y,v)*k;if(j=Math.max(j,L),o){let D=0;!c&&!u||c&&!u&&h?D=nt(b+O+T/k,o[1][1])*k:D=tt(b+O+(c?N:-N)/k,o[0][1])*k,j=Math.max(j,D)}if(l){let D=0;!c&&!u||c&&!u&&h?D=tt(b+T/k,l[1][1])*k:D=nt(b+(c?N:-N)/k,l[0][1])*k,j=Math.max(j,D)}}if(f){const L=In(C*k,g,w)/k;if(P=Math.max(P,L),o){let D=0;!c&&!u||u&&!c&&h?D=nt(p+C*k+S,o[1][0])/k:D=tt(p+(u?_:-_)*k+S,o[0][0])/k,P=Math.max(P,D)}if(l){let D=0;!c&&!u||u&&!c&&h?D=tt(p+C*k,l[1][0])/k:D=nt(p+(u?_:-_)*k,l[0][0])/k,P=Math.max(P,D)}}}_=_+(_<0?P:-P),N=N+(N<0?j:-j),r&&(h?T>C*k?_=(pa(c,u)?-N:N)/k:N=(pa(c,u)?-_:_)*k:d?(_=N/k,u=c):(N=_*k,c=u));const M=c?p+N:p,V=u?b+_:b;return{width:I+(c?-N:N),height:E+(u?-_:_),x:i[0]*N*(c?-1:1)+M,y:i[1]*_*(u?-1:1)+V}}const Sc={width:0,height:0,x:0,y:0},a0={...Sc,pointerX:0,pointerY:0,aspectRatio:1};function l0(e){return[[0,0],[e.measured.width,e.measured.height]]}function c0(e,t,n){const s=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,o=e.measured.height??0,l=n[0]*i,c=n[1]*o;return[[s-l,r-c],[s+i-l,r+o-c]]}function u0({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:r}){const i=Se(e);let o={controlDirection:ma("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function l({controlPosition:u,boundaries:d,keepAspectRatio:f,resizeDirection:h,onResizeStart:m,onResize:x,onResizeEnd:g,shouldResize:w}){let y={...Sc},v={...a0};o={boundaries:d,resizeDirection:h,keepAspectRatio:f,controlDirection:ma(u)};let p,b=null,I=[],E,k,N,_=!1;const T=Ll().on("start",C=>{const{nodeLookup:S,transform:O,snapGrid:j,snapToGrid:P,nodeOrigin:M,paneDomNode:V}=n();if(p=S.get(t),!p)return;b=(V==null?void 0:V.getBoundingClientRect())??null;const{xSnapped:L,ySnapped:D}=qt(C.sourceEvent,{transform:O,snapGrid:j,snapToGrid:P,containerBounds:b});y={width:p.measured.width??0,height:p.measured.height??0,x:p.position.x??0,y:p.position.y??0},v={...y,pointerX:L,pointerY:D,aspectRatio:y.width/y.height},E=void 0,p.parentId&&(p.extent==="parent"||p.expandParent)&&(E=S.get(p.parentId),k=E&&p.extent==="parent"?l0(E):void 0),I=[],N=void 0;for(const[F,Y]of S)if(Y.parentId===t&&(I.push({id:F,position:{...Y.position},extent:Y.extent}),Y.extent==="parent"||Y.expandParent)){const G=c0(Y,p,Y.origin??M);N?N=[[Math.min(G[0][0],N[0][0]),Math.min(G[0][1],N[0][1])],[Math.max(G[1][0],N[1][0]),Math.max(G[1][1],N[1][1])]]:N=G}m==null||m(C,{...y})}).on("drag",C=>{const{transform:S,snapGrid:O,snapToGrid:j,nodeOrigin:P}=n(),M=qt(C.sourceEvent,{transform:S,snapGrid:O,snapToGrid:j,containerBounds:b}),V=[];if(!p)return;const{x:L,y:D,width:F,height:Y}=y,G={},A=p.origin??P,{width:R,height:B,x:H,y:W}=i0(v,o.controlDirection,M,o.boundaries,o.keepAspectRatio,A,k,N),q=R!==F,X=B!==Y,ee=H!==L&&q,te=W!==D&&X;if(!ee&&!te&&!q&&!X)return;if((ee||te||A[0]===1||A[1]===1)&&(G.x=ee?H:y.x,G.y=te?W:y.y,y.x=G.x,y.y=G.y,I.length>0)){const oe=H-L,re=W-D;for(const ye of I)ye.position={x:ye.position.x-oe+A[0]*(R-F),y:ye.position.y-re+A[1]*(B-Y)},V.push(ye)}if((q||X)&&(G.width=q&&(!o.resizeDirection||o.resizeDirection==="horizontal")?R:y.width,G.height=X&&(!o.resizeDirection||o.resizeDirection==="vertical")?B:y.height,y.width=G.width,y.height=G.height),E&&p.expandParent){const oe=A[0]*(G.width??0);G.x&&G.x<oe&&(y.x=oe,v.x=v.x-(G.x-oe));const re=A[1]*(G.height??0);G.y&&G.y<re&&(y.y=re,v.y=v.y-(G.y-re))}const Q=o0({width:y.width,prevWidth:F,height:y.height,prevHeight:Y,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),Z={...y,direction:Q};(w==null?void 0:w(C,Z))!==!1&&(_=!0,x==null||x(C,Z),s(G,V))}).on("end",C=>{_&&(g==null||g(C,{...y}),r==null||r({...y}),_=!1)});i.call(T)}function c(){i.on(".drag",null)}return{update:l,destroy:c}}const d0={},ga=e=>{let t;const n=new Set,s=(d,f)=>{const h=typeof d=="function"?d(t):d;if(!Object.is(h,t)){const m=t;t=f??(typeof h!="object"||h===null)?h:Object.assign({},t,h),n.forEach(x=>x(t,m))}},r=()=>t,c={setState:s,getState:r,getInitialState:()=>u,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{(d0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(s,r,c);return c},f0=e=>e?ga(e):ga,{useDebugValue:h0}=Dd,{useSyncExternalStoreWithSelector:m0}=Tf,p0=e=>e;function Cc(e,t=p0,n){const s=m0(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return h0(s),s}const xa=(e,t)=>{const n=f0(e),s=(r,i=t)=>Cc(n,r,i);return Object.assign(s,n),s},g0=(e,t)=>e?xa(e,t):xa;function de(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const xr=z.createContext(null),x0=xr.Provider,kc=Ge.error001();function se(e,t){const n=z.useContext(xr);if(n===null)throw new Error(kc);return Cc(n,e,t)}function ue(){const e=z.useContext(xr);if(e===null)throw new Error(kc);return z.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const ya={display:"none"},y0={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ac="react-flow__node-desc",Mc="react-flow__edge-desc",w0="react-flow__aria-live",b0=e=>e.ariaLiveMessage,v0=e=>e.ariaLabelConfig;function N0({rfId:e}){const t=se(b0);return a.jsx("div",{id:`${w0}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:y0,children:t})}function j0({rfId:e,disableKeyboardA11y:t}){const n=se(v0);return a.jsxs(a.Fragment,{children:[a.jsx("div",{id:`${Ac}-${e}`,style:ya,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),a.jsx("div",{id:`${Mc}-${e}`,style:ya,children:n["edge.a11yDescription.default"]}),!t&&a.jsx(N0,{rfId:e})]})}const yr=z.forwardRef(({position:e="top-left",children:t,className:n,style:s,...r},i)=>{const o=`${e}`.split("-");return a.jsx("div",{className:pe(["react-flow__panel",n,...o]),style:s,ref:i,...r,children:t})});yr.displayName="Panel";function E0({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:a.jsx(yr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:a.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const _0=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},Sn=e=>e.id;function I0(e,t){return de(e.selectedNodes.map(Sn),t.selectedNodes.map(Sn))&&de(e.selectedEdges.map(Sn),t.selectedEdges.map(Sn))}function S0({onSelectionChange:e}){const t=ue(),{selectedNodes:n,selectedEdges:s}=se(_0,I0);return z.useEffect(()=>{const r={nodes:n,edges:s};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(i=>i(r))},[n,s,e]),null}const C0=e=>!!e.onSelectionChangeHandlers;function k0({onSelectionChange:e}){const t=se(C0);return e||t?a.jsx(S0,{onSelectionChange:e}):null}const Tc=[0,0],A0={x:0,y:0,zoom:1},M0=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig"],wa=[...M0,"rfId"],T0=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),ba={translateExtent:Kt,nodeOrigin:Tc,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function P0(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:r,setTranslateExtent:i,setNodeExtent:o,reset:l,setDefaultNodesAndEdges:c}=se(T0,de),u=ue();z.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{d.current=ba,l()}),[]);const d=z.useRef(ba);return z.useEffect(()=>{for(const f of wa){const h=e[f],m=d.current[f];h!==m&&(typeof e[f]>"u"||(f==="nodes"?t(h):f==="edges"?n(h):f==="minZoom"?s(h):f==="maxZoom"?r(h):f==="translateExtent"?i(h):f==="nodeExtent"?o(h):f==="ariaLabelConfig"?u.setState({ariaLabelConfig:Nx(h)}):f==="fitView"?u.setState({fitViewQueued:h}):f==="fitViewOptions"?u.setState({fitViewOptions:h}):u.setState({[f]:h})))}d.current=e},wa.map(f=>e[f])),null}function va(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function D0(e){var s;const[t,n]=z.useState(e==="system"?null:e);return z.useEffect(()=>{if(e!=="system"){n(e);return}const r=va(),i=()=>n(r!=null&&r.matches?"dark":"light");return i(),r==null||r.addEventListener("change",i),()=>{r==null||r.removeEventListener("change",i)}},[e]),t!==null?t:(s=va())!=null&&s.matches?"dark":"light"}const Na=typeof document<"u"?document:null;function nn(e=null,t={target:Na,actInsideInputWithModifier:!0}){const[n,s]=z.useState(!1),r=z.useRef(!1),i=z.useRef(new Set([])),[o,l]=z.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),d=u.reduce((f,h)=>f.concat(...h),[]);return[u,d]}return[[],[]]},[e]);return z.useEffect(()=>{const c=(t==null?void 0:t.target)??Na,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const d=m=>{var w,y;if(r.current=m.ctrlKey||m.metaKey||m.shiftKey||m.altKey,(!r.current||r.current&&!u)&&dc(m))return!1;const g=Ea(m.code,l);if(i.current.add(m[g]),ja(o,i.current,!1)){const v=((y=(w=m.composedPath)==null?void 0:w.call(m))==null?void 0:y[0])||m.target,p=(v==null?void 0:v.nodeName)==="BUTTON"||(v==null?void 0:v.nodeName)==="A";t.preventDefault!==!1&&(r.current||!p)&&m.preventDefault(),s(!0)}},f=m=>{const x=Ea(m.code,l);ja(o,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(m[x]),m.key==="Meta"&&i.current.clear(),r.current=!1},h=()=>{i.current.clear(),s(!1)};return c==null||c.addEventListener("keydown",d),c==null||c.addEventListener("keyup",f),window.addEventListener("blur",h),window.addEventListener("contextmenu",h),()=>{c==null||c.removeEventListener("keydown",d),c==null||c.removeEventListener("keyup",f),window.removeEventListener("blur",h),window.removeEventListener("contextmenu",h)}}},[e,s]),n}function ja(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(r=>t.has(r)))}function Ea(e,t){return t.includes(e)?"code":"key"}const R0=()=>{const e=ue();return z.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,r,i],panZoom:o}=e.getState();return o?(await o.setViewport({x:t.x??s,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:r,minZoom:i,maxZoom:o,panZoom:l}=e.getState(),c=pr(t,s,r,i,o,(n==null?void 0:n.padding)??.1);return l?(await l.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:r,snapToGrid:i,domNode:o}=e.getState();if(!o)return t;const{x:l,y:c}=o.getBoundingClientRect(),u={x:t.x-l,y:t.y-c},d=n.snapGrid??r,f=n.snapToGrid??i;return fn(u,s,f,d)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:r,y:i}=s.getBoundingClientRect(),o=er(t,n);return{x:o.x+r,y:o.y+i}}}),[])};function Pc(e,t){const n=[],s=new Map,r=[];for(const i of e)if(i.type==="add"){r.push(i);continue}else if(i.type==="remove"||i.type==="replace")s.set(i.id,[i]);else{const o=s.get(i.id);o?o.push(i):s.set(i.id,[i])}for(const i of t){const o=s.get(i.id);if(!o){n.push(i);continue}if(o[0].type==="remove")continue;if(o[0].type==="replace"){n.push({...o[0].item});continue}const l={...i};for(const c of o)L0(c,l);n.push(l)}return r.length&&r.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function L0(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function z0(e,t){return Pc(e,t)}function $0(e,t){return Pc(e,t)}function ut(e,t){return{id:e,type:"select",selected:t}}function jt(e,t=new Set,n=!1){const s=[];for(const[r,i]of e){const o=t.has(r);!(i.selected===void 0&&!o)&&i.selected!==o&&(n&&(i.selected=o),s.push(ut(i.id,o)))}return s}function _a({items:e=[],lookup:t}){var r;const n=[],s=new Map(e.map(i=>[i.id,i]));for(const[i,o]of e.entries()){const l=t.get(o.id),c=((r=l==null?void 0:l.internals)==null?void 0:r.userNode)??l;c!==void 0&&c!==o&&n.push({id:o.id,item:o,type:"replace"}),c===void 0&&n.push({item:o,type:"add",index:i})}for(const[i]of t)s.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function Ia(e){return{id:e.id,type:"remove"}}const Sa=e=>hx(e),O0=e=>nc(e);function Dc(e){return z.forwardRef(e)}const V0=typeof window<"u"?z.useLayoutEffect:z.useEffect;function Ca(e){const[t,n]=z.useState(BigInt(0)),[s]=z.useState(()=>B0(()=>n(r=>r+BigInt(1))));return V0(()=>{const r=s.get();r.length&&(e(r),s.reset())},[t]),s}function B0(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Rc=z.createContext(null);function F0({children:e}){const t=ue(),n=z.useCallback(l=>{const{nodes:c=[],setNodes:u,hasDefaultNodes:d,onNodesChange:f,nodeLookup:h,fitViewQueued:m}=t.getState();let x=c;for(const w of l)x=typeof w=="function"?w(x):w;const g=_a({items:x,lookup:h});d&&u(x),g.length>0?f==null||f(g):m&&window.requestAnimationFrame(()=>{const{fitViewQueued:w,nodes:y,setNodes:v}=t.getState();w&&v(y)})},[]),s=Ca(n),r=z.useCallback(l=>{const{edges:c=[],setEdges:u,hasDefaultEdges:d,onEdgesChange:f,edgeLookup:h}=t.getState();let m=c;for(const x of l)m=typeof x=="function"?x(m):x;d?u(m):f&&f(_a({items:m,lookup:h}))},[]),i=Ca(r),o=z.useMemo(()=>({nodeQueue:s,edgeQueue:i}),[]);return a.jsx(Rc.Provider,{value:o,children:e})}function H0(){const e=z.useContext(Rc);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const q0=e=>!!e.panZoom;function wr(){const e=R0(),t=ue(),n=H0(),s=se(q0),r=z.useMemo(()=>{const i=f=>t.getState().nodeLookup.get(f),o=f=>{n.nodeQueue.push(f)},l=f=>{n.edgeQueue.push(f)},c=f=>{var y,v;const{nodeLookup:h,nodeOrigin:m}=t.getState(),x=Sa(f)?f:h.get(f.id),g=x.parentId?cc(x.position,x.measured,x.parentId,h,m):x.position,w={...x,position:g,width:((y=x.measured)==null?void 0:y.width)??x.width,height:((v=x.measured)==null?void 0:v.height)??x.height};return Mt(w)},u=(f,h,m={replace:!1})=>{o(x=>x.map(g=>{if(g.id===f){const w=typeof h=="function"?h(g):h;return m.replace&&Sa(w)?w:{...g,...w}}return g}))},d=(f,h,m={replace:!1})=>{l(x=>x.map(g=>{if(g.id===f){const w=typeof h=="function"?h(g):h;return m.replace&&O0(w)?w:{...g,...w}}return g}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>{var h;return(h=i(f))==null?void 0:h.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(h=>({...h}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:o,setEdges:l,addNodes:f=>{const h=Array.isArray(f)?f:[f];n.nodeQueue.push(m=>[...m,...h])},addEdges:f=>{const h=Array.isArray(f)?f:[f];n.edgeQueue.push(m=>[...m,...h])},toObject:()=>{const{nodes:f=[],edges:h=[],transform:m}=t.getState(),[x,g,w]=m;return{nodes:f.map(y=>({...y})),edges:h.map(y=>({...y})),viewport:{x,y:g,zoom:w}}},deleteElements:async({nodes:f=[],edges:h=[]})=>{const{nodes:m,edges:x,onNodesDelete:g,onEdgesDelete:w,triggerNodeChanges:y,triggerEdgeChanges:v,onDelete:p,onBeforeDelete:b}=t.getState(),{nodes:I,edges:E}=await xx({nodesToRemove:f,edgesToRemove:h,nodes:m,edges:x,onBeforeDelete:b}),k=E.length>0,N=I.length>0;if(k){const _=E.map(Ia);w==null||w(E),v(_)}if(N){const _=I.map(Ia);g==null||g(I),y(_)}return(N||k)&&(p==null||p({nodes:I,edges:E})),{deletedNodes:I,deletedEdges:E}},getIntersectingNodes:(f,h=!0,m)=>{const x=ra(f),g=x?f:c(f),w=m!==void 0;return g?(m||t.getState().nodes).filter(y=>{const v=t.getState().nodeLookup.get(y.id);if(v&&!x&&(y.id===f.id||!v.internals.positionAbsolute))return!1;const p=Mt(w?y:v),b=Jt(p,g);return h&&b>0||b>=p.width*p.height||b>=g.width*g.height}):[]},isNodeIntersecting:(f,h,m=!0)=>{const g=ra(f)?f:c(f);if(!g)return!1;const w=Jt(g,h);return m&&w>0||w>=h.width*h.height||w>=g.width*g.height},updateNode:u,updateNodeData:(f,h,m={replace:!1})=>{u(f,x=>{const g=typeof h=="function"?h(x):h;return m.replace?{...x,data:g}:{...x,data:{...x.data,...g}}},m)},updateEdge:d,updateEdgeData:(f,h,m={replace:!1})=>{d(f,x=>{const g=typeof h=="function"?h(x):h;return m.replace?{...x,data:g}:{...x,data:{...x.data,...g}}},m)},getNodesBounds:f=>{const{nodeLookup:h,nodeOrigin:m}=t.getState();return rc(f,{nodeLookup:h,nodeOrigin:m})},getHandleConnections:({type:f,id:h,nodeId:m})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${m}-${f}${h?`-${h}`:""}`))==null?void 0:x.values())??[])},getNodeConnections:({type:f,handleId:h,nodeId:m})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${m}${f?h?`-${f}-${h}`:`-${f}`:""}`))==null?void 0:x.values())??[])},fitView:async f=>{const h=t.getState().fitViewResolver??vx();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:h}),n.nodeQueue.push(m=>[...m]),h.promise}}},[]);return z.useMemo(()=>({...r,...e,viewportInitialized:s}),[s])}const ka=e=>e.selected,G0=typeof window<"u"?window:void 0;function Y0({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=ue(),{deleteElements:s}=wr(),r=nn(e,{actInsideInputWithModifier:!1}),i=nn(t,{target:G0});z.useEffect(()=>{if(r){const{edges:o,nodes:l}=n.getState();s({nodes:l.filter(ka),edges:o.filter(ka)}),n.setState({nodesSelectionActive:!1})}},[r]),z.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function W0(e){const t=ue();z.useEffect(()=>{const n=()=>{var r,i,o,l;if(!e.current||!(((i=(r=e.current).checkVisibility)==null?void 0:i.call(r))??!0))return!1;const s=bo(e.current);(s.height===0||s.width===0)&&((l=(o=t.getState()).onError)==null||l.call(o,"004",Ge.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const br={position:"absolute",width:"100%",height:"100%",top:0,left:0},X0=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function U0({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:r=.5,panOnScrollMode:i=mt.Free,zoomOnDoubleClick:o=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:u,minZoom:d,maxZoom:f,zoomActivationKeyCode:h,preventScrolling:m=!0,children:x,noWheelClassName:g,noPanClassName:w,onViewportChange:y,isControlledViewport:v,paneClickDistance:p,selectionOnDrag:b}){const I=ue(),E=z.useRef(null),{userSelectionActive:k,lib:N,connectionInProgress:_}=se(X0,de),T=nn(h),C=z.useRef();W0(E);const S=z.useCallback(O=>{y==null||y({x:O[0],y:O[1],zoom:O[2]}),v||I.setState({transform:O})},[y,v]);return z.useEffect(()=>{if(E.current){C.current=s0({domNode:E.current,minZoom:d,maxZoom:f,translateExtent:u,viewport:c,onDraggingChange:M=>I.setState({paneDragging:M}),onPanZoomStart:(M,V)=>{const{onViewportChangeStart:L,onMoveStart:D}=I.getState();D==null||D(M,V),L==null||L(V)},onPanZoom:(M,V)=>{const{onViewportChange:L,onMove:D}=I.getState();D==null||D(M,V),L==null||L(V)},onPanZoomEnd:(M,V)=>{const{onViewportChangeEnd:L,onMoveEnd:D}=I.getState();D==null||D(M,V),L==null||L(V)}});const{x:O,y:j,zoom:P}=C.current.getViewport();return I.setState({panZoom:C.current,transform:[O,j,P],domNode:E.current.closest(".react-flow")}),()=>{var M;(M=C.current)==null||M.destroy()}}},[]),z.useEffect(()=>{var O;(O=C.current)==null||O.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:r,panOnScrollMode:i,zoomOnDoubleClick:o,panOnDrag:l,zoomActivationKeyPressed:T,preventScrolling:m,noPanClassName:w,userSelectionActive:k,noWheelClassName:g,lib:N,onTransformChange:S,connectionInProgress:_,selectionOnDrag:b,paneClickDistance:p})},[e,t,n,s,r,i,o,l,T,m,w,k,g,N,S,_,b,p]),a.jsx("div",{className:"react-flow__renderer",ref:E,style:br,children:x})}const Z0=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function K0(){const{userSelectionActive:e,userSelectionRect:t}=se(Z0,de);return e&&t?a.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Ts=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Q0=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function J0({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Qt.Full,panOnDrag:s,paneClickDistance:r,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:u,onPaneScroll:d,onPaneMouseEnter:f,onPaneMouseMove:h,onPaneMouseLeave:m,children:x}){const g=ue(),{userSelectionActive:w,elementsSelectable:y,dragging:v,connectionInProgress:p}=se(Q0,de),b=y&&(e||w),I=z.useRef(null),E=z.useRef(),k=z.useRef(new Set),N=z.useRef(new Set),_=z.useRef(!1),T=L=>{if(_.current||p){_.current=!1;return}c==null||c(L),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},C=L=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){L.preventDefault();return}u==null||u(L)},S=d?L=>d(L):void 0,O=L=>{_.current&&(L.stopPropagation(),_.current=!1)},j=L=>{var B,H;const{domNode:D}=g.getState();if(E.current=D==null?void 0:D.getBoundingClientRect(),!E.current)return;const F=L.target===I.current;if(!F&&!!L.target.closest(".nokey")||!e||!(i&&F||t)||L.button!==0||!L.isPrimary)return;(H=(B=L.target)==null?void 0:B.setPointerCapture)==null||H.call(B,L.pointerId),_.current=!1;const{x:A,y:R}=Re(L.nativeEvent,E.current);g.setState({userSelectionRect:{width:0,height:0,startX:A,startY:R,x:A,y:R}}),F||(L.stopPropagation(),L.preventDefault())},P=L=>{const{userSelectionRect:D,transform:F,nodeLookup:Y,edgeLookup:G,connectionLookup:A,triggerNodeChanges:R,triggerEdgeChanges:B,defaultEdgeOptions:H,resetSelectedElements:W}=g.getState();if(!E.current||!D)return;const{x:q,y:X}=Re(L.nativeEvent,E.current),{startX:ee,startY:te}=D;if(!_.current){const re=t?0:r;if(Math.hypot(q-ee,X-te)<=re)return;W(),o==null||o(L)}_.current=!0;const Q={startX:ee,startY:te,x:q<ee?q:ee,y:X<te?X:te,width:Math.abs(q-ee),height:Math.abs(X-te)},Z=k.current,ne=N.current;k.current=new Set(wo(Y,Q,F,n===Qt.Partial,!0).map(re=>re.id)),N.current=new Set;const oe=(H==null?void 0:H.selectable)??!0;for(const re of k.current){const ye=A.get(re);if(ye)for(const{edgeId:Xe}of ye.values()){const ct=G.get(Xe);ct&&(ct.selectable??oe)&&N.current.add(Xe)}}if(!sa(Z,k.current)){const re=jt(Y,k.current,!0);R(re)}if(!sa(ne,N.current)){const re=jt(G,N.current);B(re)}g.setState({userSelectionRect:Q,userSelectionActive:!0,nodesSelectionActive:!1})},M=L=>{var D,F;L.button===0&&((F=(D=L.target)==null?void 0:D.releasePointerCapture)==null||F.call(D,L.pointerId),!w&&L.target===I.current&&g.getState().userSelectionRect&&(T==null||T(L)),g.setState({userSelectionActive:!1,userSelectionRect:null}),_.current&&(l==null||l(L),g.setState({nodesSelectionActive:k.current.size>0})))},V=s===!0||Array.isArray(s)&&s.includes(0);return a.jsxs("div",{className:pe(["react-flow__pane",{draggable:V,dragging:v,selection:e}]),onClick:b?void 0:Ts(T,I),onContextMenu:Ts(C,I),onWheel:Ts(S,I),onPointerEnter:b?void 0:f,onPointerMove:b?P:h,onPointerUp:b?M:void 0,onPointerDownCapture:b?j:void 0,onClickCapture:b?O:void 0,onPointerLeave:m,ref:I,style:br,children:[x,a.jsx(K0,{})]})}function Zs({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:o,nodeLookup:l,onError:c}=t.getState(),u=l.get(e);if(!u){c==null||c("012",Ge.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&o)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var d;return(d=s==null?void 0:s.current)==null?void 0:d.blur()})):r([e])}function Lc({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:r,isSelectable:i,nodeClickDistance:o}){const l=ue(),[c,u]=z.useState(!1),d=z.useRef();return z.useEffect(()=>{d.current=qx({getStoreItems:()=>l.getState(),onNodeMouseDown:f=>{Zs({id:f,store:l,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),z.useEffect(()=>{var f,h;if(t)(f=d.current)==null||f.destroy();else if(e.current)return(h=d.current)==null||h.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:i,nodeId:r,nodeClickDistance:o}),()=>{var m;(m=d.current)==null||m.destroy()}},[n,s,t,i,e,r]),c}const ey=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function zc(){const e=ue();return z.useCallback(n=>{const{nodeExtent:s,snapToGrid:r,snapGrid:i,nodesDraggable:o,onError:l,updateNodePositions:c,nodeLookup:u,nodeOrigin:d}=e.getState(),f=new Map,h=ey(o),m=r?i[0]:5,x=r?i[1]:5,g=n.direction.x*m*n.factor,w=n.direction.y*x*n.factor;for(const[,y]of u){if(!h(y))continue;let v={x:y.internals.positionAbsolute.x+g,y:y.internals.positionAbsolute.y+w};r&&(v=dn(v,i));const{position:p,positionAbsolute:b}=sc({nodeId:y.id,nextPosition:v,nodeLookup:u,nodeExtent:s,nodeOrigin:d,onError:l});y.position=p,y.internals.positionAbsolute=b,f.set(y.id,y)}c(f)},[])}const _o=z.createContext(null),ty=_o.Provider;_o.Consumer;const $c=()=>z.useContext(_o),ny=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),ry=(e,t,n)=>s=>{const{connectionClickStartHandle:r,connectionMode:i,connection:o}=s,{fromHandle:l,toHandle:c,isValid:u}=o,d=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(l==null?void 0:l.nodeId)===e&&(l==null?void 0:l.id)===t&&(l==null?void 0:l.type)===n,connectingTo:d,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:i===kt.Strict?(l==null?void 0:l.type)!==n:e!==(l==null?void 0:l.nodeId)||t!==(l==null?void 0:l.id),connectionInProcess:!!l,clickConnectionInProcess:!!r,valid:d&&u}};function sy({type:e="source",position:t=U.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:o,onConnect:l,children:c,className:u,onMouseDown:d,onTouchStart:f,...h},m){var P,M;const x=o||null,g=e==="target",w=ue(),y=$c(),{connectOnClick:v,noPanClassName:p,rfId:b}=se(ny,de),{connectingFrom:I,connectingTo:E,clickConnecting:k,isPossibleEndHandle:N,connectionInProcess:_,clickConnectionInProcess:T,valid:C}=se(ry(y,x,e),de);y||(M=(P=w.getState()).onError)==null||M.call(P,"010",Ge.error010());const S=V=>{const{defaultEdgeOptions:L,onConnect:D,hasDefaultEdges:F}=w.getState(),Y={...L,...V};if(F){const{edges:G,setEdges:A}=w.getState();A(Cx(Y,G))}D==null||D(Y),l==null||l(Y)},O=V=>{if(!y)return;const L=fc(V.nativeEvent);if(r&&(L&&V.button===0||!L)){const D=w.getState();Us.onPointerDown(V.nativeEvent,{handleDomNode:V.currentTarget,autoPanOnConnect:D.autoPanOnConnect,connectionMode:D.connectionMode,connectionRadius:D.connectionRadius,domNode:D.domNode,nodeLookup:D.nodeLookup,lib:D.lib,isTarget:g,handleId:x,nodeId:y,flowId:D.rfId,panBy:D.panBy,cancelConnection:D.cancelConnection,onConnectStart:D.onConnectStart,onConnectEnd:D.onConnectEnd,updateConnection:D.updateConnection,onConnect:S,isValidConnection:n||D.isValidConnection,getTransform:()=>w.getState().transform,getFromHandle:()=>w.getState().connection.fromHandle,autoPanSpeed:D.autoPanSpeed,dragThreshold:D.connectionDragThreshold})}L?d==null||d(V):f==null||f(V)},j=V=>{const{onClickConnectStart:L,onClickConnectEnd:D,connectionClickStartHandle:F,connectionMode:Y,isValidConnection:G,lib:A,rfId:R,nodeLookup:B,connection:H}=w.getState();if(!y||!F&&!r)return;if(!F){L==null||L(V.nativeEvent,{nodeId:y,handleId:x,handleType:e}),w.setState({connectionClickStartHandle:{nodeId:y,type:e,id:x}});return}const W=uc(V.target),q=n||G,{connection:X,isValid:ee}=Us.isValid(V.nativeEvent,{handle:{nodeId:y,id:x,type:e},connectionMode:Y,fromNodeId:F.nodeId,fromHandleId:F.id||null,fromType:F.type,isValidConnection:q,flowId:R,doc:W,lib:A,nodeLookup:B});ee&&X&&S(X);const te=structuredClone(H);delete te.inProgress,te.toPosition=te.toHandle?te.toHandle.position:null,D==null||D(V,te),w.setState({connectionClickStartHandle:null})};return a.jsx("div",{"data-handleid":x,"data-nodeid":y,"data-handlepos":t,"data-id":`${b}-${y}-${x}-${e}`,className:pe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",p,u,{source:!g,target:g,connectable:s,connectablestart:r,connectableend:i,clickconnecting:k,connectingfrom:I,connectingto:E,valid:C,connectionindicator:s&&(!_||N)&&(_||T?i:r)}]),onMouseDown:O,onTouchStart:O,onClick:v?j:void 0,ref:m,...h,children:c})}const rn=z.memo(Dc(sy));function oy({data:e,isConnectable:t,sourcePosition:n=U.Bottom}){return a.jsxs(a.Fragment,{children:[e==null?void 0:e.label,a.jsx(rn,{type:"source",position:n,isConnectable:t})]})}function iy({data:e,isConnectable:t,targetPosition:n=U.Top,sourcePosition:s=U.Bottom}){return a.jsxs(a.Fragment,{children:[a.jsx(rn,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,a.jsx(rn,{type:"source",position:s,isConnectable:t})]})}function ay(){return null}function ly({data:e,isConnectable:t,targetPosition:n=U.Top}){return a.jsxs(a.Fragment,{children:[a.jsx(rn,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const tr={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Aa={input:oy,default:iy,output:ly,group:ay};function cy(e){var t,n,s,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const uy=e=>{const{width:t,height:n,x:s,y:r}=un(e.nodeLookup,{filter:i=>!!i.selected});return{width:De(t)?t:null,height:De(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${r}px)`}};function dy({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=ue(),{width:r,height:i,transformString:o,userSelectionActive:l}=se(uy,de),c=zc(),u=z.useRef(null);if(z.useEffect(()=>{var h;n||(h=u.current)==null||h.focus({preventScroll:!0})},[n]),Lc({nodeRef:u}),l||!r||!i)return null;const d=e?h=>{const m=s.getState().nodes.filter(x=>x.selected);e(h,m)}:void 0,f=h=>{Object.prototype.hasOwnProperty.call(tr,h.key)&&(h.preventDefault(),c({direction:tr[h.key],factor:h.shiftKey?4:1}))};return a.jsx("div",{className:pe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:o},children:a.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:r,height:i}})})}const Ma=typeof window<"u"?window:void 0,fy=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Oc({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:u,selectionOnDrag:d,selectionMode:f,onSelectionStart:h,onSelectionEnd:m,multiSelectionKeyCode:x,panActivationKeyCode:g,zoomActivationKeyCode:w,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:p,panOnScroll:b,panOnScrollSpeed:I,panOnScrollMode:E,zoomOnDoubleClick:k,panOnDrag:N,defaultViewport:_,translateExtent:T,minZoom:C,maxZoom:S,preventScrolling:O,onSelectionContextMenu:j,noWheelClassName:P,noPanClassName:M,disableKeyboardA11y:V,onViewportChange:L,isControlledViewport:D}){const{nodesSelectionActive:F,userSelectionActive:Y}=se(fy),G=nn(u,{target:Ma}),A=nn(g,{target:Ma}),R=A||N,B=A||b,H=d&&R!==!0,W=G||Y||H;return Y0({deleteKeyCode:c,multiSelectionKeyCode:x}),a.jsx(U0,{onPaneContextMenu:i,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:p,panOnScroll:B,panOnScrollSpeed:I,panOnScrollMode:E,zoomOnDoubleClick:k,panOnDrag:!G&&R,defaultViewport:_,translateExtent:T,minZoom:C,maxZoom:S,zoomActivationKeyCode:w,preventScrolling:O,noWheelClassName:P,noPanClassName:M,onViewportChange:L,isControlledViewport:D,paneClickDistance:l,selectionOnDrag:H,children:a.jsxs(J0,{onSelectionStart:h,onSelectionEnd:m,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:R,isSelecting:!!W,selectionMode:f,selectionKeyPressed:G,paneClickDistance:l,selectionOnDrag:H,children:[e,F&&a.jsx(dy,{onSelectionContextMenu:j,noPanClassName:M,disableKeyboardA11y:V})]})})}Oc.displayName="FlowRenderer";const hy=z.memo(Oc),my=e=>t=>e?wo(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function py(e){return se(z.useCallback(my(e),[e]),de)}const gy=e=>e.updateNodeInternals;function xy(){const e=se(gy),[t]=z.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(r=>{const i=r.target.getAttribute("data-id");s.set(i,{id:i,nodeElement:r.target,force:!0})}),e(s)}));return z.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function yy({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const r=ue(),i=z.useRef(null),o=z.useRef(null),l=z.useRef(e.sourcePosition),c=z.useRef(e.targetPosition),u=z.useRef(t),d=n&&!!e.internals.handleBounds;return z.useEffect(()=>{i.current&&!e.hidden&&(!d||o.current!==i.current)&&(o.current&&(s==null||s.unobserve(o.current)),s==null||s.observe(i.current),o.current=i.current)},[d,e.hidden]),z.useEffect(()=>()=>{o.current&&(s==null||s.unobserve(o.current),o.current=null)},[]),z.useEffect(()=>{if(i.current){const f=u.current!==t,h=l.current!==e.sourcePosition,m=c.current!==e.targetPosition;(f||h||m)&&(u.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function wy({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:r,onContextMenu:i,onDoubleClick:o,nodesDraggable:l,elementsSelectable:c,nodesConnectable:u,nodesFocusable:d,resizeObserver:f,noDragClassName:h,noPanClassName:m,disableKeyboardA11y:x,rfId:g,nodeTypes:w,nodeClickDistance:y,onError:v}){const{node:p,internals:b,isParent:I}=se(q=>{const X=q.nodeLookup.get(e),ee=q.parentLookup.has(e);return{node:X,internals:X.internals,isParent:ee}},de);let E=p.type||"default",k=(w==null?void 0:w[E])||Aa[E];k===void 0&&(v==null||v("003",Ge.error003(E)),E="default",k=(w==null?void 0:w.default)||Aa.default);const N=!!(p.draggable||l&&typeof p.draggable>"u"),_=!!(p.selectable||c&&typeof p.selectable>"u"),T=!!(p.connectable||u&&typeof p.connectable>"u"),C=!!(p.focusable||d&&typeof p.focusable>"u"),S=ue(),O=lc(p),j=yy({node:p,nodeType:E,hasDimensions:O,resizeObserver:f}),P=Lc({nodeRef:j,disabled:p.hidden||!N,noDragClassName:h,handleSelector:p.dragHandle,nodeId:e,isSelectable:_,nodeClickDistance:y}),M=zc();if(p.hidden)return null;const V=et(p),L=cy(p),D=_||N||t||n||s||r,F=n?q=>n(q,{...b.userNode}):void 0,Y=s?q=>s(q,{...b.userNode}):void 0,G=r?q=>r(q,{...b.userNode}):void 0,A=i?q=>i(q,{...b.userNode}):void 0,R=o?q=>o(q,{...b.userNode}):void 0,B=q=>{const{selectNodesOnDrag:X,nodeDragThreshold:ee}=S.getState();_&&(!X||!N||ee>0)&&Zs({id:e,store:S,nodeRef:j}),t&&t(q,{...b.userNode})},H=q=>{if(!(dc(q.nativeEvent)||x)){if(Ql.includes(q.key)&&_){const X=q.key==="Escape";Zs({id:e,store:S,unselect:X,nodeRef:j})}else if(N&&p.selected&&Object.prototype.hasOwnProperty.call(tr,q.key)){q.preventDefault();const{ariaLabelConfig:X}=S.getState();S.setState({ariaLiveMessage:X["node.a11yDescription.ariaLiveMessage"]({direction:q.key.replace("Arrow","").toLowerCase(),x:~~b.positionAbsolute.x,y:~~b.positionAbsolute.y})}),M({direction:tr[q.key],factor:q.shiftKey?4:1})}}},W=()=>{var ne;if(x||!((ne=j.current)!=null&&ne.matches(":focus-visible")))return;const{transform:q,width:X,height:ee,autoPanOnNodeFocus:te,setCenter:Q}=S.getState();if(!te)return;wo(new Map([[e,p]]),{x:0,y:0,width:X,height:ee},q,!0).length>0||Q(p.position.x+V.width/2,p.position.y+V.height/2,{zoom:q[2]})};return a.jsx("div",{className:pe(["react-flow__node",`react-flow__node-${E}`,{[m]:N},p.className,{selected:p.selected,selectable:_,parent:I,draggable:N,dragging:P}]),ref:j,style:{zIndex:b.z,transform:`translate(${b.positionAbsolute.x}px,${b.positionAbsolute.y}px)`,pointerEvents:D?"all":"none",visibility:O?"visible":"hidden",...p.style,...L},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:F,onMouseMove:Y,onMouseLeave:G,onContextMenu:A,onClick:B,onDoubleClick:R,onKeyDown:C?H:void 0,tabIndex:C?0:void 0,onFocus:C?W:void 0,role:p.ariaRole??(C?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${Ac}-${g}`,"aria-label":p.ariaLabel,...p.domAttributes,children:a.jsx(ty,{value:e,children:a.jsx(k,{id:e,data:p.data,type:E,positionAbsoluteX:b.positionAbsolute.x,positionAbsoluteY:b.positionAbsolute.y,selected:p.selected??!1,selectable:_,draggable:N,deletable:p.deletable??!0,isConnectable:T,sourcePosition:p.sourcePosition,targetPosition:p.targetPosition,dragging:P,dragHandle:p.dragHandle,zIndex:b.z,parentId:p.parentId,...V})})})}var by=z.memo(wy);const vy=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Vc(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,onError:i}=se(vy,de),o=py(e.onlyRenderVisibleElements),l=xy();return a.jsx("div",{className:"react-flow__nodes",style:br,children:o.map(c=>a.jsx(by,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}Vc.displayName="NodeRenderer";const Ny=z.memo(Vc);function jy(e){return se(z.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const s=[];if(n.width&&n.height)for(const r of n.edges){const i=n.nodeLookup.get(r.source),o=n.nodeLookup.get(r.target);i&&o&&_x({sourceNode:i,targetNode:o,width:n.width,height:n.height,transform:n.transform})&&s.push(r.id)}return s},[e]),de)}const Ey=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return a.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},_y=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return a.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Ta={[Qn.Arrow]:Ey,[Qn.ArrowClosed]:_y};function Iy(e){const t=ue();return z.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(Ta,e)?Ta[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",Ge.error009(e)),null)},[e])}const Sy=({id:e,type:t,color:n,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:l="auto-start-reverse"})=>{const c=Iy(t);return c?a.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:l,refX:"0",refY:"0",children:a.jsx(c,{color:n,strokeWidth:o})}):null},Bc=({defaultColor:e,rfId:t})=>{const n=se(i=>i.edges),s=se(i=>i.defaultEdgeOptions),r=z.useMemo(()=>Px(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return r.length?a.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:a.jsx("defs",{children:r.map(i=>a.jsx(Sy,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};Bc.displayName="MarkerDefinitions";var Cy=z.memo(Bc);function Fc({x:e,y:t,label:n,labelStyle:s,labelShowBg:r=!0,labelBgStyle:i,labelBgPadding:o=[2,4],labelBgBorderRadius:l=2,children:c,className:u,...d}){const[f,h]=z.useState({x:1,y:0,width:0,height:0}),m=pe(["react-flow__edge-textwrapper",u]),x=z.useRef(null);return z.useEffect(()=>{if(x.current){const g=x.current.getBBox();h({x:g.x,y:g.y,width:g.width,height:g.height})}},[n]),n?a.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:m,visibility:f.width?"visible":"hidden",...d,children:[r&&a.jsx("rect",{width:f.width+2*o[0],x:-o[0],y:-o[1],height:f.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:l,ry:l}),a.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:x,style:s,children:n}),c]}):null}Fc.displayName="EdgeText";const ky=z.memo(Fc);function vr({path:e,labelX:t,labelY:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:c,interactionWidth:u=20,...d}){return a.jsxs(a.Fragment,{children:[a.jsx("path",{...d,d:e,fill:"none",className:pe(["react-flow__edge-path",d.className])}),u?a.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,s&&De(t)&&De(n)?a.jsx(ky,{x:t,y:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function Pa({pos:e,x1:t,y1:n,x2:s,y2:r}){return e===U.Left||e===U.Right?[.5*(t+s),n]:[t,.5*(n+r)]}function Hc({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top}){const[o,l]=Pa({pos:n,x1:e,y1:t,x2:s,y2:r}),[c,u]=Pa({pos:i,x1:s,y1:r,x2:e,y2:t}),[d,f,h,m]=hc({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${e},${t} C${o},${l} ${c},${u} ${s},${r}`,d,f,h,m]}function qc(e){return z.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:o,targetPosition:l,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:x,markerEnd:g,markerStart:w,interactionWidth:y})=>{const[v,p,b]=Hc({sourceX:n,sourceY:s,sourcePosition:o,targetX:r,targetY:i,targetPosition:l}),I=e.isInternal?void 0:t;return a.jsx(vr,{id:I,path:v,labelX:p,labelY:b,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:x,markerEnd:g,markerStart:w,interactionWidth:y})})}const Ay=qc({isInternal:!1}),Gc=qc({isInternal:!0});Ay.displayName="SimpleBezierEdge";Gc.displayName="SimpleBezierEdgeInternal";function Yc(e){return z.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:o,labelStyle:l,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,sourcePosition:m=U.Bottom,targetPosition:x=U.Top,markerEnd:g,markerStart:w,pathOptions:y,interactionWidth:v})=>{const[p,b,I]=Ys({sourceX:n,sourceY:s,sourcePosition:m,targetX:r,targetY:i,targetPosition:x,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset,stepPosition:y==null?void 0:y.stepPosition}),E=e.isInternal?void 0:t;return a.jsx(vr,{id:E,path:p,labelX:b,labelY:I,label:o,labelStyle:l,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:g,markerStart:w,interactionWidth:v})})}const Wc=Yc({isInternal:!1}),Xc=Yc({isInternal:!0});Wc.displayName="SmoothStepEdge";Xc.displayName="SmoothStepEdgeInternal";function Uc(e){return z.memo(({id:t,...n})=>{var r;const s=e.isInternal?void 0:t;return a.jsx(Wc,{...n,id:s,pathOptions:z.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const My=Uc({isInternal:!1}),Zc=Uc({isInternal:!0});My.displayName="StepEdge";Zc.displayName="StepEdgeInternal";function Kc(e){return z.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:o,labelStyle:l,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:m,markerStart:x,interactionWidth:g})=>{const[w,y,v]=gc({sourceX:n,sourceY:s,targetX:r,targetY:i}),p=e.isInternal?void 0:t;return a.jsx(vr,{id:p,path:w,labelX:y,labelY:v,label:o,labelStyle:l,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:m,markerStart:x,interactionWidth:g})})}const Ty=Kc({isInternal:!1}),Qc=Kc({isInternal:!0});Ty.displayName="StraightEdge";Qc.displayName="StraightEdgeInternal";function Jc(e){return z.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:o=U.Bottom,targetPosition:l=U.Top,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:x,markerEnd:g,markerStart:w,pathOptions:y,interactionWidth:v})=>{const[p,b,I]=mc({sourceX:n,sourceY:s,sourcePosition:o,targetX:r,targetY:i,targetPosition:l,curvature:y==null?void 0:y.curvature}),E=e.isInternal?void 0:t;return a.jsx(vr,{id:E,path:p,labelX:b,labelY:I,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:x,markerEnd:g,markerStart:w,interactionWidth:v})})}const Py=Jc({isInternal:!1}),eu=Jc({isInternal:!0});Py.displayName="BezierEdge";eu.displayName="BezierEdgeInternal";const Da={default:eu,straight:Qc,step:Zc,smoothstep:Xc,simplebezier:Gc},Ra={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Dy=(e,t,n)=>n===U.Left?e-t:n===U.Right?e+t:e,Ry=(e,t,n)=>n===U.Top?e-t:n===U.Bottom?e+t:e,La="react-flow__edgeupdater";function za({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:o,type:l}){return a.jsx("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:o,className:pe([La,`${La}-${l}`]),cx:Dy(t,s,e),cy:Ry(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function Ly({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:r,targetX:i,targetY:o,sourcePosition:l,targetPosition:c,onReconnect:u,onReconnectStart:d,onReconnectEnd:f,setReconnecting:h,setUpdateHover:m}){const x=ue(),g=(b,I)=>{if(b.button!==0)return;const{autoPanOnConnect:E,domNode:k,isValidConnection:N,connectionMode:_,connectionRadius:T,lib:C,onConnectStart:S,onConnectEnd:O,cancelConnection:j,nodeLookup:P,rfId:M,panBy:V,updateConnection:L}=x.getState(),D=I.type==="target",F=(A,R)=>{h(!1),f==null||f(A,n,I.type,R)},Y=A=>u==null?void 0:u(n,A),G=(A,R)=>{h(!0),d==null||d(b,n,I.type),S==null||S(A,R)};Us.onPointerDown(b.nativeEvent,{autoPanOnConnect:E,connectionMode:_,connectionRadius:T,domNode:k,handleId:I.id,nodeId:I.nodeId,nodeLookup:P,isTarget:D,edgeUpdaterType:I.type,lib:C,flowId:M,cancelConnection:j,panBy:V,isValidConnection:N,onConnect:Y,onConnectStart:G,onConnectEnd:O,onReconnectEnd:F,updateConnection:L,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:b.currentTarget})},w=b=>g(b,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=b=>g(b,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>m(!0),p=()=>m(!1);return a.jsxs(a.Fragment,{children:[(e===!0||e==="source")&&a.jsx(za,{position:l,centerX:s,centerY:r,radius:t,onMouseDown:w,onMouseEnter:v,onMouseOut:p,type:"source"}),(e===!0||e==="target")&&a.jsx(za,{position:c,centerX:i,centerY:o,radius:t,onMouseDown:y,onMouseEnter:v,onMouseOut:p,type:"target"})]})}function zy({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:r,onDoubleClick:i,onContextMenu:o,onMouseEnter:l,onMouseMove:c,onMouseLeave:u,reconnectRadius:d,onReconnect:f,onReconnectStart:h,onReconnectEnd:m,rfId:x,edgeTypes:g,noPanClassName:w,onError:y,disableKeyboardA11y:v}){let p=se(Q=>Q.edgeLookup.get(e));const b=se(Q=>Q.defaultEdgeOptions);p=b?{...b,...p}:p;let I=p.type||"default",E=(g==null?void 0:g[I])||Da[I];E===void 0&&(y==null||y("011",Ge.error011(I)),I="default",E=(g==null?void 0:g.default)||Da.default);const k=!!(p.focusable||t&&typeof p.focusable>"u"),N=typeof f<"u"&&(p.reconnectable||n&&typeof p.reconnectable>"u"),_=!!(p.selectable||s&&typeof p.selectable>"u"),T=z.useRef(null),[C,S]=z.useState(!1),[O,j]=z.useState(!1),P=ue(),{zIndex:M,sourceX:V,sourceY:L,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G}=se(z.useCallback(Q=>{const Z=Q.nodeLookup.get(p.source),ne=Q.nodeLookup.get(p.target);if(!Z||!ne)return{zIndex:p.zIndex,...Ra};const oe=Tx({id:e,sourceNode:Z,targetNode:ne,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:Q.connectionMode,onError:y});return{zIndex:Ex({selected:p.selected,zIndex:p.zIndex,sourceNode:Z,targetNode:ne,elevateOnSelect:Q.elevateEdgesOnSelect}),...oe||Ra}},[p.source,p.target,p.sourceHandle,p.targetHandle,p.selected,p.zIndex]),de),A=z.useMemo(()=>p.markerStart?`url('#${Ws(p.markerStart,x)}')`:void 0,[p.markerStart,x]),R=z.useMemo(()=>p.markerEnd?`url('#${Ws(p.markerEnd,x)}')`:void 0,[p.markerEnd,x]);if(p.hidden||V===null||L===null||D===null||F===null)return null;const B=Q=>{var re;const{addSelectedEdges:Z,unselectNodesAndEdges:ne,multiSelectionActive:oe}=P.getState();_&&(P.setState({nodesSelectionActive:!1}),p.selected&&oe?(ne({nodes:[],edges:[p]}),(re=T.current)==null||re.blur()):Z([e])),r&&r(Q,p)},H=i?Q=>{i(Q,{...p})}:void 0,W=o?Q=>{o(Q,{...p})}:void 0,q=l?Q=>{l(Q,{...p})}:void 0,X=c?Q=>{c(Q,{...p})}:void 0,ee=u?Q=>{u(Q,{...p})}:void 0,te=Q=>{var Z;if(!v&&Ql.includes(Q.key)&&_){const{unselectNodesAndEdges:ne,addSelectedEdges:oe}=P.getState();Q.key==="Escape"?((Z=T.current)==null||Z.blur(),ne({edges:[p]})):oe([e])}};return a.jsx("svg",{style:{zIndex:M},children:a.jsxs("g",{className:pe(["react-flow__edge",`react-flow__edge-${I}`,p.className,w,{selected:p.selected,animated:p.animated,inactive:!_&&!r,updating:C,selectable:_}]),onClick:B,onDoubleClick:H,onContextMenu:W,onMouseEnter:q,onMouseMove:X,onMouseLeave:ee,onKeyDown:k?te:void 0,tabIndex:k?0:void 0,role:p.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":p.ariaLabel===null?void 0:p.ariaLabel||`Edge from ${p.source} to ${p.target}`,"aria-describedby":k?`${Mc}-${x}`:void 0,ref:T,...p.domAttributes,children:[!O&&a.jsx(E,{id:e,source:p.source,target:p.target,type:p.type,selected:p.selected,animated:p.animated,selectable:_,deletable:p.deletable??!0,label:p.label,labelStyle:p.labelStyle,labelShowBg:p.labelShowBg,labelBgStyle:p.labelBgStyle,labelBgPadding:p.labelBgPadding,labelBgBorderRadius:p.labelBgBorderRadius,sourceX:V,sourceY:L,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G,data:p.data,style:p.style,sourceHandleId:p.sourceHandle,targetHandleId:p.targetHandle,markerStart:A,markerEnd:R,pathOptions:"pathOptions"in p?p.pathOptions:void 0,interactionWidth:p.interactionWidth}),N&&a.jsx(Ly,{edge:p,isReconnectable:N,reconnectRadius:d,onReconnect:f,onReconnectStart:h,onReconnectEnd:m,sourceX:V,sourceY:L,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G,setUpdateHover:S,setReconnecting:j})]})})}var $y=z.memo(zy);const Oy=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function tu({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:r,onReconnect:i,onEdgeContextMenu:o,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:d,reconnectRadius:f,onEdgeDoubleClick:h,onReconnectStart:m,onReconnectEnd:x,disableKeyboardA11y:g}){const{edgesFocusable:w,edgesReconnectable:y,elementsSelectable:v,onError:p}=se(Oy,de),b=jy(t);return a.jsxs("div",{className:"react-flow__edges",children:[a.jsx(Cy,{defaultColor:e,rfId:n}),b.map(I=>a.jsx($y,{id:I,edgesFocusable:w,edgesReconnectable:y,elementsSelectable:v,noPanClassName:r,onReconnect:i,onContextMenu:o,onMouseEnter:l,onMouseMove:c,onMouseLeave:u,onClick:d,reconnectRadius:f,onDoubleClick:h,onReconnectStart:m,onReconnectEnd:x,rfId:n,onError:p,edgeTypes:s,disableKeyboardA11y:g},I))]})}tu.displayName="EdgeRenderer";const Vy=z.memo(tu),By=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Fy({children:e}){const t=se(By);return a.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Hy(e){const t=wr(),n=z.useRef(!1);z.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const qy=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Gy(e){const t=se(qy),n=ue();return z.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Yy(e){return e.connection.inProgress?{...e.connection,to:fn(e.connection.to,e.transform)}:{...e.connection}}function Wy(e){return Yy}function Xy(e){const t=Wy();return se(t,de)}const Uy=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Zy({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:r,width:i,height:o,isValid:l,inProgress:c}=se(Uy,de);return!(i&&r&&c)?null:a.jsx("svg",{style:e,width:i,height:o,className:"react-flow__connectionline react-flow__container",children:a.jsx("g",{className:pe(["react-flow__connection",tc(l)]),children:a.jsx(nu,{style:t,type:n,CustomComponent:s,isValid:l})})})}const nu=({style:e,type:t=Ze.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:r,from:i,fromNode:o,fromHandle:l,fromPosition:c,to:u,toNode:d,toHandle:f,toPosition:h,pointer:m}=Xy();if(!r)return;if(n)return a.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:o,fromHandle:l,fromX:i.x,fromY:i.y,toX:u.x,toY:u.y,fromPosition:c,toPosition:h,connectionStatus:tc(s),toNode:d,toHandle:f,pointer:m});let x="";const g={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:u.x,targetY:u.y,targetPosition:h};switch(t){case Ze.Bezier:[x]=mc(g);break;case Ze.SimpleBezier:[x]=Hc(g);break;case Ze.Step:[x]=Ys({...g,borderRadius:0});break;case Ze.SmoothStep:[x]=Ys(g);break;default:[x]=gc(g)}return a.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:e})};nu.displayName="ConnectionLine";const Ky={};function $a(e=Ky){z.useRef(e),ue(),z.useEffect(()=>{},[e])}function Qy(){ue(),z.useRef(!1),z.useEffect(()=>{},[])}function ru({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:r,onNodeDoubleClick:i,onEdgeDoubleClick:o,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:d,onSelectionContextMenu:f,onSelectionStart:h,onSelectionEnd:m,connectionLineType:x,connectionLineStyle:g,connectionLineComponent:w,connectionLineContainerStyle:y,selectionKeyCode:v,selectionOnDrag:p,selectionMode:b,multiSelectionKeyCode:I,panActivationKeyCode:E,zoomActivationKeyCode:k,deleteKeyCode:N,onlyRenderVisibleElements:_,elementsSelectable:T,defaultViewport:C,translateExtent:S,minZoom:O,maxZoom:j,preventScrolling:P,defaultMarkerColor:M,zoomOnScroll:V,zoomOnPinch:L,panOnScroll:D,panOnScrollSpeed:F,panOnScrollMode:Y,zoomOnDoubleClick:G,panOnDrag:A,onPaneClick:R,onPaneMouseEnter:B,onPaneMouseMove:H,onPaneMouseLeave:W,onPaneScroll:q,onPaneContextMenu:X,paneClickDistance:ee,nodeClickDistance:te,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:re,onReconnect:ye,onReconnectStart:Xe,onReconnectEnd:ct,noDragClassName:mn,noWheelClassName:pn,noPanClassName:Lt,disableKeyboardA11y:zt,nodeExtent:Sr,rfId:gn,viewport:wt,onViewportChange:$t}){return $a(e),$a(t),Qy(),Hy(n),Gy(wt),a.jsx(hy,{onPaneClick:R,onPaneMouseEnter:B,onPaneMouseMove:H,onPaneMouseLeave:W,onPaneContextMenu:X,onPaneScroll:q,paneClickDistance:ee,deleteKeyCode:N,selectionKeyCode:v,selectionOnDrag:p,selectionMode:b,onSelectionStart:h,onSelectionEnd:m,multiSelectionKeyCode:I,panActivationKeyCode:E,zoomActivationKeyCode:k,elementsSelectable:T,zoomOnScroll:V,zoomOnPinch:L,zoomOnDoubleClick:G,panOnScroll:D,panOnScrollSpeed:F,panOnScrollMode:Y,panOnDrag:A,defaultViewport:C,translateExtent:S,minZoom:O,maxZoom:j,onSelectionContextMenu:f,preventScrolling:P,noDragClassName:mn,noWheelClassName:pn,noPanClassName:Lt,disableKeyboardA11y:zt,onViewportChange:$t,isControlledViewport:!!wt,children:a.jsxs(Fy,{children:[a.jsx(Vy,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:o,onReconnect:ye,onReconnectStart:Xe,onReconnectEnd:ct,onlyRenderVisibleElements:_,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:re,defaultMarkerColor:M,noPanClassName:Lt,disableKeyboardA11y:zt,rfId:gn}),a.jsx(Zy,{style:g,type:x,component:w,containerStyle:y}),a.jsx("div",{className:"react-flow__edgelabel-renderer"}),a.jsx(Ny,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:i,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:d,nodeClickDistance:te,onlyRenderVisibleElements:_,noPanClassName:Lt,noDragClassName:mn,disableKeyboardA11y:zt,nodeExtent:Sr,rfId:gn}),a.jsx("div",{className:"react-flow__viewport-portal"})]})})}ru.displayName="GraphView";const Jy=z.memo(ru),Oa=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:o,fitViewOptions:l,minZoom:c=.5,maxZoom:u=2,nodeOrigin:d,nodeExtent:f}={})=>{const h=new Map,m=new Map,x=new Map,g=new Map,w=s??t??[],y=n??e??[],v=d??[0,0],p=f??Kt;wc(x,g,w);const b=Xs(y,h,m,{nodeOrigin:v,nodeExtent:p,elevateNodesOnSelect:!1});let I=[0,0,1];if(o&&r&&i){const E=un(h,{filter:T=>!!((T.width||T.initialWidth)&&(T.height||T.initialHeight))}),{x:k,y:N,zoom:_}=pr(E,r,i,c,u,(l==null?void 0:l.padding)??.1);I=[k,N,_]}return{rfId:"1",width:r??0,height:i??0,transform:I,nodes:y,nodesInitialized:b,nodeLookup:h,parentLookup:m,edges:w,edgeLookup:g,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:c,maxZoom:u,translateExtent:Kt,nodeExtent:p,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:kt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:v,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:o??!1,fitViewOptions:l,fitViewResolver:null,connection:{...ec},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:yx,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Jl}},ew=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:o,fitViewOptions:l,minZoom:c,maxZoom:u,nodeOrigin:d,nodeExtent:f})=>g0((h,m)=>{async function x(){const{nodeLookup:g,panZoom:w,fitViewOptions:y,fitViewResolver:v,width:p,height:b,minZoom:I,maxZoom:E}=m();w&&(await gx({nodes:g,width:p,height:b,panZoom:w,minZoom:I,maxZoom:E},y),v==null||v.resolve(!0),h({fitViewResolver:null}))}return{...Oa({nodes:e,edges:t,width:r,height:i,fitView:o,fitViewOptions:l,minZoom:c,maxZoom:u,nodeOrigin:d,nodeExtent:f,defaultNodes:n,defaultEdges:s}),setNodes:g=>{const{nodeLookup:w,parentLookup:y,nodeOrigin:v,elevateNodesOnSelect:p,fitViewQueued:b}=m(),I=Xs(g,w,y,{nodeOrigin:v,nodeExtent:f,elevateNodesOnSelect:p,checkEquality:!0});b&&I?(x(),h({nodes:g,nodesInitialized:I,fitViewQueued:!1,fitViewOptions:void 0})):h({nodes:g,nodesInitialized:I})},setEdges:g=>{const{connectionLookup:w,edgeLookup:y}=m();wc(w,y,g),h({edges:g})},setDefaultNodesAndEdges:(g,w)=>{if(g){const{setNodes:y}=m();y(g),h({hasDefaultNodes:!0})}if(w){const{setEdges:y}=m();y(w),h({hasDefaultEdges:!0})}},updateNodeInternals:g=>{const{triggerNodeChanges:w,nodeLookup:y,parentLookup:v,domNode:p,nodeOrigin:b,nodeExtent:I,debug:E,fitViewQueued:k}=m(),{changes:N,updatedInternals:_}=Vx(g,y,v,p,b,I);_&&(Lx(y,v,{nodeOrigin:b,nodeExtent:I}),k?(x(),h({fitViewQueued:!1,fitViewOptions:void 0})):h({}),(N==null?void 0:N.length)>0&&(E&&console.log("React Flow: trigger node changes",N),w==null||w(N)))},updateNodePositions:(g,w=!1)=>{const y=[],v=[],{nodeLookup:p,triggerNodeChanges:b}=m();for(const[I,E]of g){const k=p.get(I),N=!!(k!=null&&k.expandParent&&(k!=null&&k.parentId)&&(E!=null&&E.position)),_={id:I,type:"position",position:N?{x:Math.max(0,E.position.x),y:Math.max(0,E.position.y)}:E.position,dragging:w};N&&k.parentId&&y.push({id:I,parentId:k.parentId,rect:{...E.internals.positionAbsolute,width:E.measured.width??0,height:E.measured.height??0}}),v.push(_)}if(y.length>0){const{parentLookup:I,nodeOrigin:E}=m(),k=Eo(y,p,I,E);v.push(...k)}b(v)},triggerNodeChanges:g=>{const{onNodesChange:w,setNodes:y,nodes:v,hasDefaultNodes:p,debug:b}=m();if(g!=null&&g.length){if(p){const I=z0(g,v);y(I)}b&&console.log("React Flow: trigger node changes",g),w==null||w(g)}},triggerEdgeChanges:g=>{const{onEdgesChange:w,setEdges:y,edges:v,hasDefaultEdges:p,debug:b}=m();if(g!=null&&g.length){if(p){const I=$0(g,v);y(I)}b&&console.log("React Flow: trigger edge changes",g),w==null||w(g)}},addSelectedNodes:g=>{const{multiSelectionActive:w,edgeLookup:y,nodeLookup:v,triggerNodeChanges:p,triggerEdgeChanges:b}=m();if(w){const I=g.map(E=>ut(E,!0));p(I);return}p(jt(v,new Set([...g]),!0)),b(jt(y))},addSelectedEdges:g=>{const{multiSelectionActive:w,edgeLookup:y,nodeLookup:v,triggerNodeChanges:p,triggerEdgeChanges:b}=m();if(w){const I=g.map(E=>ut(E,!0));b(I);return}b(jt(y,new Set([...g]))),p(jt(v,new Set,!0))},unselectNodesAndEdges:({nodes:g,edges:w}={})=>{const{edges:y,nodes:v,nodeLookup:p,triggerNodeChanges:b,triggerEdgeChanges:I}=m(),E=g||v,k=w||y,N=E.map(T=>{const C=p.get(T.id);return C&&(C.selected=!1),ut(T.id,!1)}),_=k.map(T=>ut(T.id,!1));b(N),I(_)},setMinZoom:g=>{const{panZoom:w,maxZoom:y}=m();w==null||w.setScaleExtent([g,y]),h({minZoom:g})},setMaxZoom:g=>{const{panZoom:w,minZoom:y}=m();w==null||w.setScaleExtent([y,g]),h({maxZoom:g})},setTranslateExtent:g=>{var w;(w=m().panZoom)==null||w.setTranslateExtent(g),h({translateExtent:g})},resetSelectedElements:()=>{const{edges:g,nodes:w,triggerNodeChanges:y,triggerEdgeChanges:v,elementsSelectable:p}=m();if(!p)return;const b=w.reduce((E,k)=>k.selected?[...E,ut(k.id,!1)]:E,[]),I=g.reduce((E,k)=>k.selected?[...E,ut(k.id,!1)]:E,[]);y(b),v(I)},setNodeExtent:g=>{const{nodes:w,nodeLookup:y,parentLookup:v,nodeOrigin:p,elevateNodesOnSelect:b,nodeExtent:I}=m();g[0][0]===I[0][0]&&g[0][1]===I[0][1]&&g[1][0]===I[1][0]&&g[1][1]===I[1][1]||(Xs(w,y,v,{nodeOrigin:p,nodeExtent:g,elevateNodesOnSelect:b,checkEquality:!1}),h({nodeExtent:g}))},panBy:g=>{const{transform:w,width:y,height:v,panZoom:p,translateExtent:b}=m();return Bx({delta:g,panZoom:p,transform:w,translateExtent:b,width:y,height:v})},setCenter:async(g,w,y)=>{const{width:v,height:p,maxZoom:b,panZoom:I}=m();if(!I)return Promise.resolve(!1);const E=typeof(y==null?void 0:y.zoom)<"u"?y.zoom:b;return await I.setViewport({x:v/2-g*E,y:p/2-w*E,zoom:E},{duration:y==null?void 0:y.duration,ease:y==null?void 0:y.ease,interpolate:y==null?void 0:y.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{h({connection:{...ec}})},updateConnection:g=>{h({connection:g})},reset:()=>h({...Oa()})}},Object.is);function su({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:r,initialHeight:i,initialMinZoom:o,initialMaxZoom:l,initialFitViewOptions:c,fitView:u,nodeOrigin:d,nodeExtent:f,children:h}){const[m]=z.useState(()=>ew({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:u,minZoom:o,maxZoom:l,fitViewOptions:c,nodeOrigin:d,nodeExtent:f}));return a.jsx(x0,{value:m,children:a.jsx(F0,{children:h})})}function tw({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:r,width:i,height:o,fitView:l,fitViewOptions:c,minZoom:u,maxZoom:d,nodeOrigin:f,nodeExtent:h}){return z.useContext(xr)?a.jsx(a.Fragment,{children:e}):a.jsx(su,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:r,initialWidth:i,initialHeight:o,fitView:l,initialFitViewOptions:c,initialMinZoom:u,initialMaxZoom:d,nodeOrigin:f,nodeExtent:h,children:e})}const nw={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function rw({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:r,nodeTypes:i,edgeTypes:o,onNodeClick:l,onEdgeClick:c,onInit:u,onMove:d,onMoveStart:f,onMoveEnd:h,onConnect:m,onConnectStart:x,onConnectEnd:g,onClickConnectStart:w,onClickConnectEnd:y,onNodeMouseEnter:v,onNodeMouseMove:p,onNodeMouseLeave:b,onNodeContextMenu:I,onNodeDoubleClick:E,onNodeDragStart:k,onNodeDrag:N,onNodeDragStop:_,onNodesDelete:T,onEdgesDelete:C,onDelete:S,onSelectionChange:O,onSelectionDragStart:j,onSelectionDrag:P,onSelectionDragStop:M,onSelectionContextMenu:V,onSelectionStart:L,onSelectionEnd:D,onBeforeDelete:F,connectionMode:Y,connectionLineType:G=Ze.Bezier,connectionLineStyle:A,connectionLineComponent:R,connectionLineContainerStyle:B,deleteKeyCode:H="Backspace",selectionKeyCode:W="Shift",selectionOnDrag:q=!1,selectionMode:X=Qt.Full,panActivationKeyCode:ee="Space",multiSelectionKeyCode:te=en()?"Meta":"Control",zoomActivationKeyCode:Q=en()?"Meta":"Control",snapToGrid:Z,snapGrid:ne,onlyRenderVisibleElements:oe=!1,selectNodesOnDrag:re,nodesDraggable:ye,autoPanOnNodeFocus:Xe,nodesConnectable:ct,nodesFocusable:mn,nodeOrigin:pn=Tc,edgesFocusable:Lt,edgesReconnectable:zt,elementsSelectable:Sr=!0,defaultViewport:gn=A0,minZoom:wt=.5,maxZoom:$t=2,translateExtent:Mo=Kt,preventScrolling:Iu=!0,nodeExtent:Cr,defaultMarkerColor:Su="#b1b1b7",zoomOnScroll:Cu=!0,zoomOnPinch:ku=!0,panOnScroll:Au=!1,panOnScrollSpeed:Mu=.5,panOnScrollMode:Tu=mt.Free,zoomOnDoubleClick:Pu=!0,panOnDrag:Du=!0,onPaneClick:Ru,onPaneMouseEnter:Lu,onPaneMouseMove:zu,onPaneMouseLeave:$u,onPaneScroll:Ou,onPaneContextMenu:Vu,paneClickDistance:Bu=1,nodeClickDistance:Fu=0,children:Hu,onReconnect:qu,onReconnectStart:Gu,onReconnectEnd:Yu,onEdgeContextMenu:Wu,onEdgeDoubleClick:Xu,onEdgeMouseEnter:Uu,onEdgeMouseMove:Zu,onEdgeMouseLeave:Ku,reconnectRadius:Qu=10,onNodesChange:Ju,onEdgesChange:ed,noDragClassName:td="nodrag",noWheelClassName:nd="nowheel",noPanClassName:To="nopan",fitView:Po,fitViewOptions:Do,connectOnClick:rd,attributionPosition:sd,proOptions:od,defaultEdgeOptions:id,elevateNodesOnSelect:ad,elevateEdgesOnSelect:ld,disableKeyboardA11y:Ro=!1,autoPanOnConnect:cd,autoPanOnNodeDrag:ud,autoPanSpeed:dd,connectionRadius:fd,isValidConnection:hd,onError:md,style:pd,id:Lo,nodeDragThreshold:gd,connectionDragThreshold:xd,viewport:yd,onViewportChange:wd,width:bd,height:vd,colorMode:Nd="light",debug:jd,onScroll:xn,ariaLabelConfig:Ed,..._d},Id){const kr=Lo||"1",Sd=D0(Nd),Cd=z.useCallback(zo=>{zo.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),xn==null||xn(zo)},[xn]);return a.jsx("div",{"data-testid":"rf__wrapper",..._d,onScroll:Cd,style:{...pd,...nw},ref:Id,className:pe(["react-flow",r,Sd]),id:Lo,role:"application",children:a.jsxs(tw,{nodes:e,edges:t,width:bd,height:vd,fitView:Po,fitViewOptions:Do,minZoom:wt,maxZoom:$t,nodeOrigin:pn,nodeExtent:Cr,children:[a.jsx(Jy,{onInit:u,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:v,onNodeMouseMove:p,onNodeMouseLeave:b,onNodeContextMenu:I,onNodeDoubleClick:E,nodeTypes:i,edgeTypes:o,connectionLineType:G,connectionLineStyle:A,connectionLineComponent:R,connectionLineContainerStyle:B,selectionKeyCode:W,selectionOnDrag:q,selectionMode:X,deleteKeyCode:H,multiSelectionKeyCode:te,panActivationKeyCode:ee,zoomActivationKeyCode:Q,onlyRenderVisibleElements:oe,defaultViewport:gn,translateExtent:Mo,minZoom:wt,maxZoom:$t,preventScrolling:Iu,zoomOnScroll:Cu,zoomOnPinch:ku,zoomOnDoubleClick:Pu,panOnScroll:Au,panOnScrollSpeed:Mu,panOnScrollMode:Tu,panOnDrag:Du,onPaneClick:Ru,onPaneMouseEnter:Lu,onPaneMouseMove:zu,onPaneMouseLeave:$u,onPaneScroll:Ou,onPaneContextMenu:Vu,paneClickDistance:Bu,nodeClickDistance:Fu,onSelectionContextMenu:V,onSelectionStart:L,onSelectionEnd:D,onReconnect:qu,onReconnectStart:Gu,onReconnectEnd:Yu,onEdgeContextMenu:Wu,onEdgeDoubleClick:Xu,onEdgeMouseEnter:Uu,onEdgeMouseMove:Zu,onEdgeMouseLeave:Ku,reconnectRadius:Qu,defaultMarkerColor:Su,noDragClassName:td,noWheelClassName:nd,noPanClassName:To,rfId:kr,disableKeyboardA11y:Ro,nodeExtent:Cr,viewport:yd,onViewportChange:wd}),a.jsx(P0,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:m,onConnectStart:x,onConnectEnd:g,onClickConnectStart:w,onClickConnectEnd:y,nodesDraggable:ye,autoPanOnNodeFocus:Xe,nodesConnectable:ct,nodesFocusable:mn,edgesFocusable:Lt,edgesReconnectable:zt,elementsSelectable:Sr,elevateNodesOnSelect:ad,elevateEdgesOnSelect:ld,minZoom:wt,maxZoom:$t,nodeExtent:Cr,onNodesChange:Ju,onEdgesChange:ed,snapToGrid:Z,snapGrid:ne,connectionMode:Y,translateExtent:Mo,connectOnClick:rd,defaultEdgeOptions:id,fitView:Po,fitViewOptions:Do,onNodesDelete:T,onEdgesDelete:C,onDelete:S,onNodeDragStart:k,onNodeDrag:N,onNodeDragStop:_,onSelectionDrag:P,onSelectionDragStart:j,onSelectionDragStop:M,onMove:d,onMoveStart:f,onMoveEnd:h,noPanClassName:To,nodeOrigin:pn,rfId:kr,autoPanOnConnect:cd,autoPanOnNodeDrag:ud,autoPanSpeed:dd,onError:md,connectionRadius:fd,isValidConnection:hd,selectNodesOnDrag:re,nodeDragThreshold:gd,connectionDragThreshold:xd,onBeforeDelete:F,debug:jd,ariaLabelConfig:Ed}),a.jsx(k0,{onSelectionChange:O}),Hu,a.jsx(E0,{proOptions:od,position:sd}),a.jsx(j0,{rfId:kr,disableKeyboardA11y:Ro})]})})}var sw=Dc(rw);function ow({dimensions:e,lineWidth:t,variant:n,className:s}){return a.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:pe(["react-flow__background-pattern",n,s])})}function iw({radius:e,className:t}){return a.jsx("circle",{cx:e,cy:e,r:e,className:pe(["react-flow__background-pattern","dots",t])})}var ot;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ot||(ot={}));const aw={[ot.Dots]:1,[ot.Lines]:1,[ot.Cross]:6},lw=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ou({id:e,variant:t=ot.Dots,gap:n=20,size:s,lineWidth:r=1,offset:i=0,color:o,bgColor:l,style:c,className:u,patternClassName:d}){const f=z.useRef(null),{transform:h,patternId:m}=se(lw,de),x=s||aw[t],g=t===ot.Dots,w=t===ot.Cross,y=Array.isArray(n)?n:[n,n],v=[y[0]*h[2]||1,y[1]*h[2]||1],p=x*h[2],b=Array.isArray(i)?i:[i,i],I=w?[p,p]:v,E=[b[0]*h[2]||1+I[0]/2,b[1]*h[2]||1+I[1]/2],k=`${m}${e||""}`;return a.jsxs("svg",{className:pe(["react-flow__background",u]),style:{...c,...br,"--xy-background-color-props":l,"--xy-background-pattern-color-props":o},ref:f,"data-testid":"rf__background",children:[a.jsx("pattern",{id:k,x:h[0]%v[0],y:h[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:g?a.jsx(iw,{radius:p/2,className:d}):a.jsx(ow,{dimensions:I,lineWidth:r,variant:t,className:d})}),a.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}ou.displayName="Background";const cw=z.memo(ou);function uw(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:a.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function dw(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:a.jsx("path",{d:"M0 0h32v4.2H0z"})})}function fw(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:a.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function hw(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:a.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function mw(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:a.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Cn({children:e,className:t,...n}){return a.jsx("button",{type:"button",className:pe(["react-flow__controls-button",t]),...n,children:e})}const pw=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function iu({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:o,onFitView:l,onInteractiveChange:c,className:u,children:d,position:f="bottom-left",orientation:h="vertical","aria-label":m}){const x=ue(),{isInteractive:g,minZoomReached:w,maxZoomReached:y,ariaLabelConfig:v}=se(pw,de),{zoomIn:p,zoomOut:b,fitView:I}=wr(),E=()=>{p(),i==null||i()},k=()=>{b(),o==null||o()},N=()=>{I(r),l==null||l()},_=()=>{x.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),c==null||c(!g)},T=h==="horizontal"?"horizontal":"vertical";return a.jsxs(yr,{className:pe(["react-flow__controls",T,u]),position:f,style:e,"data-testid":"rf__controls","aria-label":m??v["controls.ariaLabel"],children:[t&&a.jsxs(a.Fragment,{children:[a.jsx(Cn,{onClick:E,className:"react-flow__controls-zoomin",title:v["controls.zoomIn.ariaLabel"],"aria-label":v["controls.zoomIn.ariaLabel"],disabled:y,children:a.jsx(uw,{})}),a.jsx(Cn,{onClick:k,className:"react-flow__controls-zoomout",title:v["controls.zoomOut.ariaLabel"],"aria-label":v["controls.zoomOut.ariaLabel"],disabled:w,children:a.jsx(dw,{})})]}),n&&a.jsx(Cn,{className:"react-flow__controls-fitview",onClick:N,title:v["controls.fitView.ariaLabel"],"aria-label":v["controls.fitView.ariaLabel"],children:a.jsx(fw,{})}),s&&a.jsx(Cn,{className:"react-flow__controls-interactive",onClick:_,title:v["controls.interactive.ariaLabel"],"aria-label":v["controls.interactive.ariaLabel"],children:g?a.jsx(mw,{}):a.jsx(hw,{})}),d]})}iu.displayName="Controls";z.memo(iu);function gw({id:e,x:t,y:n,width:s,height:r,style:i,color:o,strokeColor:l,strokeWidth:c,className:u,borderRadius:d,shapeRendering:f,selected:h,onClick:m}){const{background:x,backgroundColor:g}=i||{},w=o||x||g;return a.jsx("rect",{className:pe(["react-flow__minimap-node",{selected:h},u]),x:t,y:n,rx:d,ry:d,width:s,height:r,style:{fill:w,stroke:l,strokeWidth:c},shapeRendering:f,onClick:m?y=>m(y,e):void 0})}const xw=z.memo(gw),yw=e=>e.nodes.map(t=>t.id),Ps=e=>e instanceof Function?e:()=>e;function ww({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r,nodeComponent:i=xw,onClick:o}){const l=se(yw,de),c=Ps(t),u=Ps(e),d=Ps(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return a.jsx(a.Fragment,{children:l.map(h=>a.jsx(vw,{id:h,nodeColorFunc:c,nodeStrokeColorFunc:u,nodeClassNameFunc:d,nodeBorderRadius:s,nodeStrokeWidth:r,NodeComponent:i,onClick:o,shapeRendering:f},h))})}function bw({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:r,nodeStrokeWidth:i,shapeRendering:o,NodeComponent:l,onClick:c}){const{node:u,x:d,y:f,width:h,height:m}=se(x=>{const{internals:g}=x.nodeLookup.get(e),w=g.userNode,{x:y,y:v}=g.positionAbsolute,{width:p,height:b}=et(w);return{node:w,x:y,y:v,width:p,height:b}},de);return!u||u.hidden||!lc(u)?null:a.jsx(l,{x:d,y:f,width:h,height:m,style:u.style,selected:!!u.selected,className:s(u),color:t(u),borderRadius:r,strokeColor:n(u),strokeWidth:i,shapeRendering:o,onClick:c,id:u.id})}const vw=z.memo(bw);var Nw=z.memo(ww);const jw=200,Ew=150,_w=e=>!e.hidden,Iw=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ac(un(e.nodeLookup,{filter:_w}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Sw="react-flow__minimap-desc";function au({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:o,nodeComponent:l,bgColor:c,maskColor:u,maskStrokeColor:d,maskStrokeWidth:f,position:h="bottom-right",onClick:m,onNodeClick:x,pannable:g=!1,zoomable:w=!1,ariaLabel:y,inversePan:v,zoomStep:p=1,offsetScale:b=5}){const I=ue(),E=z.useRef(null),{boundingRect:k,viewBB:N,rfId:_,panZoom:T,translateExtent:C,flowWidth:S,flowHeight:O,ariaLabelConfig:j}=se(Iw,de),P=(e==null?void 0:e.width)??jw,M=(e==null?void 0:e.height)??Ew,V=k.width/P,L=k.height/M,D=Math.max(V,L),F=D*P,Y=D*M,G=b*D,A=k.x-(F-k.width)/2-G,R=k.y-(Y-k.height)/2-G,B=F+G*2,H=Y+G*2,W=`${Sw}-${_}`,q=z.useRef(0),X=z.useRef();q.current=D,z.useEffect(()=>{if(E.current&&T)return X.current=Zx({domNode:E.current,panZoom:T,getTransform:()=>I.getState().transform,getViewScale:()=>q.current}),()=>{var Z;(Z=X.current)==null||Z.destroy()}},[T]),z.useEffect(()=>{var Z;(Z=X.current)==null||Z.update({translateExtent:C,width:S,height:O,inversePan:v,pannable:g,zoomStep:p,zoomable:w})},[g,w,v,p,C,S,O]);const ee=m?Z=>{var re;const[ne,oe]=((re=X.current)==null?void 0:re.pointer(Z))||[0,0];m(Z,{x:ne,y:oe})}:void 0,te=x?z.useCallback((Z,ne)=>{const oe=I.getState().nodeLookup.get(ne).internals.userNode;x(Z,oe)},[]):void 0,Q=y??j["minimap.ariaLabel"];return a.jsx(yr,{position:h,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*D:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof o=="number"?o:void 0},className:pe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:a.jsxs("svg",{width:P,height:M,viewBox:`${A} ${R} ${B} ${H}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":W,ref:E,onClick:ee,children:[Q&&a.jsx("title",{id:W,children:Q}),a.jsx(Nw,{onClick:te,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:o,nodeComponent:l}),a.jsx("path",{className:"react-flow__minimap-mask",d:`M${A-G},${R-G}h${B+G*2}v${H+G*2}h${-B-G*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}au.displayName="MiniMap";const Cw=z.memo(au),kw=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Aw={[Pt.Line]:"right",[Pt.Handle]:"bottom-right"};function Mw({nodeId:e,position:t,variant:n=Pt.Handle,className:s,style:r=void 0,children:i,color:o,minWidth:l=10,minHeight:c=10,maxWidth:u=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:h,autoScale:m=!0,shouldResize:x,onResizeStart:g,onResize:w,onResizeEnd:y}){const v=$c(),p=typeof e=="string"?e:v,b=ue(),I=z.useRef(null),E=n===Pt.Handle,k=se(z.useCallback(kw(E&&m),[E,m]),de),N=z.useRef(null),_=t??Aw[n];z.useEffect(()=>{if(!(!I.current||!p))return N.current||(N.current=u0({domNode:I.current,nodeId:p,getStoreItems:()=>{const{nodeLookup:C,transform:S,snapGrid:O,snapToGrid:j,nodeOrigin:P,domNode:M}=b.getState();return{nodeLookup:C,transform:S,snapGrid:O,snapToGrid:j,nodeOrigin:P,paneDomNode:M}},onChange:(C,S)=>{const{triggerNodeChanges:O,nodeLookup:j,parentLookup:P,nodeOrigin:M}=b.getState(),V=[],L={x:C.x,y:C.y},D=j.get(p);if(D&&D.expandParent&&D.parentId){const F=D.origin??M,Y=C.width??D.measured.width??0,G=C.height??D.measured.height??0,A={id:D.id,parentId:D.parentId,rect:{width:Y,height:G,...cc({x:C.x??D.position.x,y:C.y??D.position.y},{width:Y,height:G},D.parentId,j,F)}},R=Eo([A],j,P,M);V.push(...R),L.x=C.x?Math.max(F[0]*Y,C.x):void 0,L.y=C.y?Math.max(F[1]*G,C.y):void 0}if(L.x!==void 0&&L.y!==void 0){const F={id:p,type:"position",position:{...L}};V.push(F)}if(C.width!==void 0&&C.height!==void 0){const Y={id:p,type:"dimensions",resizing:!0,setAttributes:h?h==="horizontal"?"width":"height":!0,dimensions:{width:C.width,height:C.height}};V.push(Y)}for(const F of S){const Y={...F,type:"position"};V.push(Y)}O(V)},onEnd:({width:C,height:S})=>{const O={id:p,type:"dimensions",resizing:!1,dimensions:{width:C,height:S}};b.getState().triggerNodeChanges([O])}})),N.current.update({controlPosition:_,boundaries:{minWidth:l,minHeight:c,maxWidth:u,maxHeight:d},keepAspectRatio:f,resizeDirection:h,onResizeStart:g,onResize:w,onResizeEnd:y,shouldResize:x}),()=>{var C;(C=N.current)==null||C.destroy()}},[_,l,c,u,d,f,g,w,y,x]);const T=_.split("-");return a.jsx("div",{className:pe(["react-flow__resize-control","nodrag",...T,n,s]),ref:I,style:{...r,scale:k,...o&&{[E?"backgroundColor":"borderColor"]:o}},children:i})}z.memo(Mw);const Tw="start";function Va(e){let t=[Rw()];const n=[];return e.forEach(s=>{if(s.parentId||(s.parentId=t[0].id),!e.find(o=>o.parentId===s.id)){const o=Dw(s.id);t.push(o),n.push(Ba(o))}const i=lu(s);t.push(i),i.data.parentId&&n.push(Ba(i))}),t=Ph(t,n),{nodes:t,edges:n}}function Pw(e){return e.map(t=>{const{parentId:n,flowId:s,...r}=t.data??{};return{...t,data:r}})}function lu({id:e,type:t,parentId:n,data:s}){const r=s?{...s}:{};return r.parentId=n,r.flowId=e,{id:e,data:r,...cu(t)}}function Ba(e){return{id:`${e.data.parentId}-${e.id}`,source:e.data.parentId,target:e.id,selectable:!1,type:Ze.SmoothStep,hidden:e.type===K.placeholder}}function Dw(e){return lu({id:nr(),parentId:e,data:{},type:K.placeholder})}function Rw(){return{...cu(K.start),id:Tw,data:{name:"Start",parentId:null,flowId:"start"}}}function cu(e){return{type:e,draggable:!1,position:{x:0,y:0},width:ce[e].size.width,height:ce[e].size.height}}function Lw({targetNodes:e,allNodes:t,canvasSize:n,zoom:s,nodeIsSelected:r,previewIsVisible:i}){const o=new Map(t.map(u=>[u.id,u])),l=rc(e,{nodeLookup:o});let c=vt;return r&&(c+=Ls+vt-24,i&&(c-=Th+16)),pr(l,n.width,n.height,s,s,{top:`${vt}px`,left:`${vt}px`,bottom:`${vt}px`,right:`${c}px`})}let Ks;const zw=e=>{Ks=e},$w=({nodes:e=[]},t)=>{const n=Va(e);return Rd((s,r)=>({flowIntent:t,setFlowIntent:i=>{i!==r().flowIntent&&s({flowIntent:i,isDirty:!0})},isDirty:!1,setIsDirty:i=>{s({isDirty:i})},previewVisible:!1,setPreviewVisible:i=>{s({previewVisible:i})},getState:()=>r(),nodes:n.nodes,edges:n.edges,storedNodes:e,zoom:1,setZoom:i=>{const o=$o(i,Hn,qn);return s({zoom:$o(i,Hn,qn)}),o},incrementZoom:()=>{const i=r().zoom+.2;return r().setZoom(i),i},decrementZoom:()=>{const i=r().zoom-.2;return r().setZoom(i),i},canvasSize:null,setCanvasSize:i=>{const o=r().canvasSize;((o==null?void 0:o.width)!==i.width||(o==null?void 0:o.height)!==i.height)&&(s({canvasSize:i}),o||r().panToNode(r().nodes[0],{initial:!0}))},selectedNodeId:null,selectedChildId:null,setSelectedNodeId:(i,o)=>{if(s({selectedNodeId:i,selectedChildId:o??null}),i){const l=r().nodes.find(c=>c.id===i);l&&r().panToNode(l)}},hoveredNodeId:null,setHoveredNodeId:i=>{s({hoveredNodeId:i})},setStoredNodes:(i,o)=>{const{nodes:l,edges:c}=Va(i);let u=o!=null&&o.selectPannedNode?o.panToNode:r().selectedNodeId;if(u&&!l.find(d=>d.id===u)&&(u=null),s({storedNodes:i,nodes:l,edges:c,selectedNodeId:u,isDirty:!0}),o!=null&&o.panToNode){const d=l.find(f=>f.id===o.panToNode);d&&r().panToNode(d)}},removeNode:i=>{const o=Gf(r().storedNodes,i);o&&r().setStoredNodes(o.allNodes,{panToNode:o.parentId})},removeNodeAndChildren:i=>{const o=Yf(r().storedNodes,i);o&&r().setStoredNodes(o.allNodes,{panToNode:o.parentId})},getPayloadForSaving:()=>({intent:r().flowIntent,config:{nodes:Pw(r().storedNodes)}}),panToNode:(i,o={initial:!1})=>{const{canvasSize:l}=r();if(!Ks||!l)return;(i.type===K.buttonsItem||i.type===K.branchesItem)&&(i=r().nodes.find(u=>u.id===i.data.parentId));const c=Lw({targetNodes:[i],allNodes:r().nodes,canvasSize:l,zoom:r().zoom,nodeIsSelected:!!r().selectedNodeId,previewIsVisible:r().previewVisible});o.initial&&(c.y=vt),Ks.setViewport(c,{duration:o.initial?0:500})}}))},uu=z.createContext(null);function Ow({initialValue:e,children:t,intent:n}){const[s]=z.useState(()=>$w(structuredClone(e),n));return a.jsx(uu.Provider,{value:s,children:t})}function J(e,t){const n=z.useContext(uu);return uf(n,e,t)}function $n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,r;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!$n(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!$n(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[s]))return!1;for(s=n;s--!==0;){var i=r[s];if(!(i==="_owner"&&e.$$typeof)&&!$n(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}const Io="node-editor-form";function be({children:e,node:t,form:n,onSubmit:s}){const r=J(l=>l.getState),i=J(l=>l.setStoredNodes),o=J(l=>l.setSelectedNodeId);return a.jsx(rr,{className:"flex h-full flex-col",id:Io,form:n,onSubmit:l=>{if(!$n(n.formState.defaultValues,l))if(s)s(l);else{const c=lo(r().storedNodes,t.id,l);i(c)}o(null)},children:e})}function Ee({className:e}){const{trans:t}=je();return a.jsx(sn,{name:"name",label:a.jsx($,{message:"Step name"}),descriptionPosition:"top",className:e,placeholder:t({message:"Optional"})})}function Vw({node:e}){const t=xe({defaultValues:{name:e.data.name??"",conversationTags:e.data.conversationTags??[],userTags:e.data.userTags??[]}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(Fa,{name:"conversationTags",label:a.jsx($,{message:"Add tags to conversation"}),className:"mb-24"}),a.jsx(Fa,{name:"userTags",label:a.jsx($,{message:"Add tags to user"})})]})})}function Fa({name:e,label:t,className:n}){const{trans:s}=je(),[r,i]=z.useState(""),{data:o,isFetching:l}=ff({query:r,perPage:10});return a.jsx(hf,{name:e,label:t,isAsync:!0,isLoading:l,inputValue:r,onInputValueChange:i,valueKey:"name",placeholder:s(ae("Enter tag name...")),className:n,allowCustomValue:!1,suggestions:o==null?void 0:o.pagination.data,children:o==null?void 0:o.pagination.data.map(c=>a.jsx(le,{value:c.name,textLabel:c.name,capitalizeFirst:!0,children:c.name},c.id))})}function Bw(){return a.jsxs("div",{className:"mb-24 mt-12 grid grid-cols-4 gap-10 empty:hidden",children:[a.jsx(Fw,{}),a.jsx(Hw,{})]})}function Fw(){var o;const{flowId:e}=yt(["flowId"]),t=$e(),s=((o=Ae(ke.flows.indexAttachments(e)).data)==null?void 0:o.attachments)??[],r=Ne({name:"attachmentIds"})??[],i=l=>{const c=t.getValues("attachmentIds");t.setValue("attachmentIds",c.filter(u=>u!==l))};return a.jsx(z.Fragment,{children:r.map(l=>{const c=s.find(u=>u.id===l);return a.jsx(du,{thumbnail:c?a.jsx(mf,{file:c,className:"rounded-panel"}):a.jsx(rf,{}),name:(c==null?void 0:c.name)??"Unknown",onRemove:()=>c?i(c.id):void 0},l)})})}function Hw(){const e=Et(r=>r.abortUpload),t=Et(r=>r.removeUpload),n=J(r=>r.selectedNodeId),s=Et(rl(r=>[...r.fileUploads.values()].filter(i=>{var o;return((o=i.options.metadata)==null?void 0:o.nodeId)===n}).map(i=>i.file)));return a.jsx(z.Fragment,{children:s.map(r=>a.jsx(du,{thumbnail:a.jsx(qw,{file:r}),name:r.name,onRemove:()=>{e(r.id),t(r.id)}},r.id))})}function qw({file:e}){const t=Et(o=>o.fileUploads.get(e.id)),n=(t==null?void 0:t.percentage)||0,s=t==null?void 0:t.status,r=t==null?void 0:t.errorMessage;let i;if(s==="failed"){const o=r||ae("This file could not be uploaded");i=a.jsx(ft,{variant:"danger",label:a.jsx(zd,{value:o}),children:a.jsx(Ld,{className:"text-danger",size:"md"})})}else s==="aborted"?i=a.jsx(Xa,{className:"text-warning",size:"md"}):s==="completed"?i=a.jsx($d,{size:"md",className:"text-positive"}):i=a.jsx(on,{"aria-label":"Upload progress",size:"sm",value:n,isIndeterminate:n<1||n>99});return a.jsx("div",{className:"flex flex-auto items-center justify-center",children:i})}function du({thumbnail:e,name:t,onRemove:n}){return a.jsxs("div",{className:"relative flex aspect-square min-h-0 flex-col rounded-panel border px-6 pb-4 pt-6",children:[a.jsx("div",{className:"m-4 flex min-h-0 flex-auto items-center justify-center overflow-hidden",children:e}),a.jsx("div",{className:"mt-6 flex-shrink-0 overflow-hidden overflow-ellipsis whitespace-nowrap text-center text-xs",children:t}),a.jsx(Ie,{className:"absolute -right-8 -top-8",variant:"flat",radius:"rounded-full",color:"chip",size:"2xs",onClick:()=>n(),children:a.jsx(Qs,{})})]})}const at="rgb(255, 255, 255, 0.87)",So="rgb(0, 0, 0, 0.87)",Gw={bg:"#62748e",fg:at},Yw={bg:"#62748e",fg:So},rt={bg:"#7ccf00",fg:at},st={bg:"#7ccf00",fg:So},kn={bg:"#615fff",fg:at},An={bg:"#615fff",fg:at},Ha={bg:"#2b7fff",fg:at},qa={bg:"#2b7fff",fg:at},Mn={bg:"#ff6900",fg:at},Tn={bg:"#ff6900",fg:So},fu={bg:"transparent",fg:at},hu={start:Gw,message:rt,buttons:rt,dynamicButtons:rt,buttonsItem:rt,articles:rt,cards:rt,dynamicCards:rt,collectDetails:rt,tool:kn,toolResult:kn,setAttribute:kn,addTags:kn,branches:Ha,branchesItem:Ha,transfer:Mn,closeConversation:Mn,goToStep:Mn,goToFlow:Mn,placeholder:fu},mu={start:Yw,message:st,buttons:st,buttonsItem:st,dynamicButtons:st,articles:st,cards:st,dynamicCards:st,collectDetails:st,tool:An,toolResult:An,setAttribute:An,addTags:An,branches:qa,branchesItem:qa,transfer:Tn,closeConversation:Tn,goToStep:Tn,goToFlow:Tn,placeholder:fu};function Co(){const t=Ua()?mu:hu,n={};for(const s in t)n[`--node-color-${s}-bg`]=t[s].bg,n[`--node-color-${s}-fg`]=t[s].fg;return n}function hn(e){return z.useMemo(()=>({backgroundColor:`var(--node-color-${e}-bg)`,color:`var(--node-color-${e}-fg)`}),[e])}const Ww=[ce.placeholder.type,ce.goToStep.type];function Xw({node:e}){const t=xe({defaultValues:e.data});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(pu,{currentNode:e,name:"targetNodeId"})]})})}function pu({currentNode:e,name:t,size:n}){const{trans:s}=je(),r=J(i=>i.nodes);return a.jsx(qe,{name:t,size:n,label:a.jsx($,{message:"Target step"}),placeholder:s({message:"Choose target step"}),showSearchField:!0,searchPlaceholder:s({message:"Find a step"}),required:!0,children:r.map(i=>i.id===e.id||i.id===e.data.parentId||Ww.includes(i.type)?null:a.jsx(le,{value:i.id,startIcon:a.jsx(Uw,{config:ce[i.type]}),children:i.data.name?i.data.name:a.jsx($,{...ce[i.type].displayName})},i.id))})}function Uw({config:e}){const t=e.icon,n=Co();return a.jsx("div",{style:{backgroundColor:n[`--node-color-${e.type}-bg`],color:n[`--node-color-${e.type}-fg`]},className:"mr-4 flex h-24 w-24 items-center justify-center rounded-button text-on-primary",children:a.jsx(t,{size:"xs"})})}function Rt({children:e}){const[t,n]=z.Children.toArray(e);return a.jsxs("div",{children:[t?a.jsx("div",{className:"text-sm",children:t}):null,n?a.jsx("div",{className:"mb-14 text-xs text-muted",children:n}):null]})}const ko=[{name:"",value:"",type:Vn.AiAgentSession}];function Zw({node:e}){const t=xe({defaultValues:{name:e.data.name??"",attributes:e.data.attributes??ko}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsxs(Rt,{children:[a.jsx($,{message:"Attributes"}),a.jsx($,{message:"Set a value for one or more attributes."})]}),a.jsx(gu,{name:"attributes"})]})})}function gu({name:e,allowVariablesInValue:t}){const n=$e();e=e;const{fields:s,append:r,remove:i,update:o}=Je({name:e});return a.jsxs("div",{children:[s.map((l,c)=>a.jsx(Kw,{name:e,index:c,attributes:s,onUpdate:u=>o(c,{...n.getValues(`${e}.${c}`),...u}),onRemove:()=>i(c),allowVariablesInValue:t},l.id)),a.jsx(ie,{color:"primary",size:"xs",className:"-ml-10",startIcon:a.jsx(Oe,{}),onClick:()=>{r({...ko[0]})},disabled:s.length>=10,children:a.jsx($,{message:"Add another attribute"})})]})}function Kw({index:e,attributes:t,onUpdate:n,onRemove:s,name:r,allowVariablesInValue:i}){return a.jsx("div",{className:ge("group relative mb-16",t.length-1!==e&&"border-b border-b-divider-lighter pb-16"),children:a.jsxs("div",{children:[a.jsx(Qw,{name:r,index:e,onSelected:o=>n(o)}),a.jsx(Jw,{index:e,name:r,allowVariables:i}),t.length>1&&a.jsx("div",{className:"text-right",children:a.jsx(ie,{size:"2xs",variant:"outline",className:"mt-12",onClick:()=>s(),children:a.jsx($,{message:"Remove"})})})]})})}function Qw({onSelected:e,index:t,name:n}){const{getItem:s}=it(),r=`${n}.${t}`,i=Ne({name:r}),o=i?s(i):null,{input:l}=Od({inputDisplay:"flex items-center justify-between"}),c=(o==null?void 0:o.displayName)||(i==null?void 0:i.name);return a.jsxs("div",{className:"mb-12 flex items-center",children:[a.jsx("div",{className:"mr-16 min-w-24 text-sm font-semibold",children:a.jsx($,{message:"Set"})}),a.jsx(sl,{value:i,onChange:u=>e(u),onAddNewAttribute:u=>e(u),className:"w-full",children:a.jsxs("button",{type:"button",className:l,children:[c?a.jsx(Js,{size:"sm",adornment:a.jsx(el,{}),fontWeight:"font-medium",children:c}):a.jsx("span",{className:"font-normal text-main/40",children:a.jsx($,{message:"Choose attribute"})}),a.jsx(Ja,{size:"sm"})]})})]})}function Jw({index:e,name:t,allowVariables:n}){var c,u;const{getItem:s}=it(),r=Ne({name:`${t}.${e}`}),{setValue:i}=$e(),o=s(r);if(n)return a.jsx(Le,{required:!0,multiline:!1,name:`${t}.${e}.value`,labelDisplay:"block min-w-24 font-semibold",labelPosition:"side",label:a.jsx($,{message:"To"}),hideEmojiPicker:!0});const l=o==null?void 0:o.name;return o&&il.includes(l)?a.jsx(al,{labelDisplay:"block min-w-24 font-semibold",label:a.jsx($,{message:"To"}),labelPosition:"side",type:l,value:r.value,onChange:d=>i(`${t}.${e}.value`,d)}):o!=null&&o.attribute?a.jsx(ol,{labelDisplay:"block min-w-24 font-semibold",label:a.jsx($,{message:"To"}),labelPosition:"side",inputName:`${t}.${e}.value`,attribute:o.attribute,preferSelects:!0}):a.jsx(sn,{name:`${t}.${e}.value`,labelDisplay:"block min-w-24 font-semibold",label:a.jsx($,{message:"To"}),labelPosition:"side",required:!0,type:((c=o==null?void 0:o.inputConfig)==null?void 0:c.type)??"text",description:(u=o==null?void 0:o.inputConfig)==null?void 0:u.description})}function Nr({pathPrefix:e,size:t,nameLabel:n}){const s=`${e}`,{setValue:r,getValues:i}=$e();return a.jsxs(a.Fragment,{children:[a.jsx(Le,{size:t,name:`${e}.name`,label:n??a.jsx($,{message:"Name"}),className:t==="sm"?"mb-20":"mb-24",hideEmojiPicker:!0,required:!0}),a.jsxs(qe,{selectionMode:"single",size:t,name:`${e}.actionType`,label:a.jsx($,{message:"Action type"}),className:t==="sm"?"mb-20":"mb-24",required:!0,onSelectionChange:o=>{const l=o,c={...i(s),attributes:l==="setAttributes"?ko:[]};r(s,c,{shouldDirty:!0})},children:[a.jsx(le,{value:"openUrl",children:a.jsx($,{message:"Open URL"})}),a.jsx(le,{value:"copyToClipboard",children:a.jsx($,{message:"Copy to clipboard"})}),a.jsx(le,{value:"sendMessage",children:a.jsx($,{message:"Send message"})}),a.jsx(le,{value:"setAttributes",children:a.jsx($,{message:"Set attributes"})}),a.jsx(le,{value:"openEmbed",children:a.jsx($,{message:"Open embed"})}),a.jsx(le,{value:"goToNode",children:a.jsx($,{message:"Go to node"})})]}),a.jsx(eb,{pathPrefix:e,size:t})]})}function eb({pathPrefix:e,size:t}){const n=J(rl(r=>r.nodes.find(i=>i.id===r.selectedNodeId))),s=Ne({name:`${e}.actionType`});return s?s==="goToNode"?n?a.jsx(pu,{size:t,currentNode:n,name:`${e}.actionValue`}):null:s==="setAttributes"?a.jsxs("div",{children:[a.jsx(Le,{size:t,name:`${e}.actionValue`,label:a.jsx($,{message:"Message"}),hideEmojiPicker:!0,className:"pb-16"}),a.jsx("div",{className:"my-6 text-sm",children:a.jsx($,{message:"Attributes"})}),a.jsx(gu,{name:`${e}.attributes`,allowVariablesInValue:!0})]}):a.jsx(Le,{size:t,name:`${e}.actionValue`,label:a.jsx(tb,{actionType:s}),required:!0,hideEmojiPicker:!0,className:"pb-16"}):null}function tb({actionType:e}){switch(e){case"openUrl":case"openEmbed":return a.jsx($,{message:"URL"});case"copyToClipboard":return a.jsx($,{message:"Text to copy"});case"sendMessage":return a.jsx($,{message:"Message"})}}function lt({className:e,placeholder:t,required:n=!0,showButtonsEditor:s}){return a.jsxs("div",{className:e,children:[a.jsxs(Le,{size:"lg",name:"message",label:a.jsx($,{message:"AI agent message"}),required:n,placeholder:t,multiline:!0,children:[a.jsx(nb,{size:"2xs"}),a.jsx(rb,{size:"2xs"})]}),s&&a.jsx(sb,{}),a.jsx(Bw,{})]})}function nb({size:e}){const t=xu(eo.conversationImages);return a.jsx(ft,{label:a.jsx($,{message:"Add image"}),children:a.jsx(Ie,{size:e,iconSize:"sm",onClick:()=>t(),children:a.jsx(gf,{})})})}function rb({size:e}){const t=xu(eo.conversationAttachments);return a.jsx(ft,{label:a.jsx($,{message:"Add file"}),children:a.jsx(Ie,{size:e,iconSize:"sm",onClick:()=>t(),children:a.jsx(xf,{})})})}function xu(e){const{flowId:t}=yt(["flowId"]),n=Et(o=>o.uploadMultiple),s=Et(o=>o.removeUpload),{setValue:r,getValues:i}=$e();return async()=>{const o=df({uploadType:e}),l=await yf({types:o==null?void 0:o.allowedFileTypes,multiple:!0});n(l,{uploadType:e,showToastOnRestrictionFail:!0,restrictions:o,onSuccess:async(c,u)=>{s(u.id),Za.setQueriesData(ke.flows.indexAttachments(t),d=>({attachments:[...(d==null?void 0:d.attachments)??[],c]})),r("attachmentIds",[...i("attachmentIds"),c.id])}})}}function sb(){const{fields:e,append:t,update:n,remove:s}=Je({name:"buttons"});return a.jsxs("div",{className:"mt-10 flex flex-wrap items-center gap-6",children:[e.map((r,i)=>a.jsxs(Yt,{type:"popover",placement:"left",onClose:o=>{o&&n(i,o)},children:[a.jsx(ie,{size:"xs",variant:"outline",children:r.name}),a.jsx(Ga,{button:r,onRemove:()=>s(i)})]},r.id)),a.jsxs(Yt,{type:"popover",placement:"left",onClose:r=>{r&&t(r)},children:[a.jsx(ie,{size:"xs",color:"primary",startIcon:a.jsx(Oe,{}),children:a.jsx($,{message:"Add button"})}),a.jsx(Ga,{})]})]})}function Ga({button:e,onRemove:t}){const{close:n,formId:s}=sr(),r=xe({defaultValues:{actionType:"openUrl",...e}});return a.jsxs(to,{children:[a.jsx(no,{children:e?a.jsx($,{message:"Update button"}):a.jsx($,{message:"Add button"})}),a.jsx(ro,{children:a.jsx(rr,{id:s,form:r,onSubmit:i=>n(i),children:a.jsx(Nr,{pathPrefix:"",size:"md"})})}),a.jsxs(so,{startAction:t?a.jsx(ie,{color:"danger",onClick:()=>t(),children:a.jsx($,{message:"Remove"})}):null,children:[a.jsx(ie,{onClick:()=>n(),children:a.jsx($,{message:"Cancel"})}),a.jsx(ie,{form:s,type:"submit",variant:"flat",color:"primary",children:e?a.jsx($,{message:"Update"}):a.jsx($,{message:"Add"})})]})]})}function ob({node:e}){const{trans:t}=je(),n=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}}),s=r=>{const i=n.getValues("articleIds")??[];i.includes(r)||n.setValue("articleIds",[...i,r])};return a.jsx(be,{node:e,form:n,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(lt,{className:"mb-24",placeholder:t(ae("Optional")),required:!1}),a.jsxs(Rt,{children:[a.jsx($,{message:"Articles"}),a.jsx($,{message:"Show up to 6 articles to customers"})]}),a.jsx(ib,{onSelected:r=>s(r)}),a.jsx(ab,{})]})})}function ib({onSelected:e}){const{trans:t}=je(),[n,s]=z.useState(""),{data:r,isFetching:i}=Ae(wf.articles.index({})),o=(r==null?void 0:r.pagination.data)??[];return a.jsx(bf,{isAsync:!0,isLoading:i,inputValue:n,onInputValueChange:s,placeholder:t(ae("Search by title...")),allowCustomValue:!1,items:o,onSelectionChange:l=>e(l),selectionMode:"single",clearInputOnItemSelection:!0,clearSelectionOnInputClear:!0,blurReferenceOnItemSelection:!0,children:o.map(l=>a.jsx(le,{value:l.id,textLabel:l.title,children:l.title},l.id))})}function ab(){var s;const e=Ne({name:"articleIds"})??[],n=((s=Jd("normalized-models/article",{modelIds:e.join(",")},{enabled:!!e.length}).data)==null?void 0:s.results)??[];return a.jsx("div",{className:"mt-12 space-y-10",children:e.map(r=>{const i=n.find(o=>o.id===r);return i?a.jsx(lb,{articleId:r,articleIds:e,name:i.name},r):null})})}function lb({articleId:e,articleIds:t,name:n}){const{setValue:s}=$e(),r=z.useRef(null),{sortableProps:i,dragHandleRef:o}=ar({item:e,items:t,type:"articlesFlowSortable",ref:r,onSortEnd:(l,c)=>{s("articleIds",vf(t,l,c))},strategy:"liveSort"});return a.jsxs("div",{...i,ref:r,className:"flex items-center gap-8 rounded-panel border px-12 py-8 text-sm",children:[a.jsx(Ie,{ref:o,size:"xs",iconSize:"sm",children:a.jsx(ao,{})}),n,a.jsx(Ie,{size:"xs",iconSize:"sm",className:"ml-auto",children:a.jsx(Qs,{onClick:()=>s("articleIds",t.filter(l=>l!==e))})})]})}function cb({node:e,onEditBranch:t}){const{fields:n,remove:s,move:r,insert:i}=Je({name:"branches"}),o=()=>{const l=n.findIndex(u=>u.isElseBranch),c=ce.branchesItem.createNewStoredNode(e.id,{name:`Branch #${n.length}`})[0].data;i(l,{...c,flowId:nr()}),t(n.length-1)};return z.createElement(On.div,{...oo,key:"branches-list",className:"flex min-h-0 flex-auto flex-col"},a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsxs(Rt,{children:[a.jsx($,{message:"Branches"}),a.jsx($,{message:"Manage branches and the conditions that determine which branch to take."})]}),a.jsx(ie,{color:"primary",className:"-ml-14 mb-6",startIcon:a.jsx(Oe,{}),onClick:()=>o(),disabled:n.length===6,children:a.jsx($,{message:"Add branch"})}),a.jsx("div",{className:"space-y-10",children:n.map((l,c)=>a.jsx(ub,{branch:l,branches:n,onEdit:()=>t(c),onDelete:()=>s(c),onSortEnd:(u,d)=>r(u,d)},l.id))})]}))}function ub({branch:e,branches:t,onEdit:n,onDelete:s,onSortEnd:r}){const i=e.isElseBranch,o=z.useRef(null),{sortableProps:l,dragHandleRef:c}=ar({item:e,items:t,type:"branchesSortable",ref:o,onSortEnd:r,strategy:"liveSort",disabled:i});return a.jsxs("div",{ref:o,className:ge("flex h-46 min-w-full items-center rounded-button border p-4",!i&&"cursor-pointer hover:bg-hover"),...l,onClick:()=>{i||n()},children:[!i&&a.jsx(Ie,{ref:c,size:"sm",onClick:u=>u.stopPropagation(),children:a.jsx(Nf,{className:"text-muted hover:cursor-move"})}),a.jsx("div",{className:ge("min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap px-6 text-sm font-medium",i&&"pl-42"),children:e.name}),!i&&a.jsxs(or,{children:[a.jsx(Ie,{className:"ml-auto",size:"sm",onClick:u=>u.stopPropagation(),children:a.jsx(jf,{})}),a.jsxs(ir,{children:[a.jsx(le,{value:"edit",onSelected:()=>n(),children:a.jsx($,{message:"Edit"})}),a.jsx(le,{value:"delete",onSelected:async()=>{await Vd(db)&&s()},children:a.jsx($,{message:"Delete"})})]})]})]})}function db(){const{close:e}=sr();return a.jsx(Ef,{isDanger:!0,title:a.jsx($,{message:"Delete branch"}),body:a.jsx($,{message:"Are you sure you want to delete this branch?"}),confirm:a.jsx($,{message:"Delete"}),onConfirm:()=>e(!0)})}function yu({condition:e}){const{close:t,formId:n}=sr(),{getItem:s}=it(),r=u=>{u.attribute&&t(u)},i=xe({defaultValues:{attribute:e==null?void 0:e.attribute,operator:(e==null?void 0:e.operator)??Ds.eq,value:(e==null?void 0:e.value)??""}}),o=i.watch("attribute"),l=i.watch("value"),c=u=>{var f;i.setValue("attribute",u);const d=s(u);i.setValue("value",(d==null?void 0:d.defaultValue)??""),i.setValue("operator",((f=d==null?void 0:d.operators)==null?void 0:f[0])??Ds.eq)};return a.jsxs(to,{size:"sm",children:[a.jsx(no,{className:"capitalize",children:e?a.jsx($,{message:"Update condition"}):a.jsx($,{message:"New condition"})}),a.jsx(ro,{children:a.jsxs(rr,{form:i,className:"space-y-20",id:n,onSubmit:u=>{r(u),t()},children:[a.jsx(sl,{required:!0,label:a.jsx($,{message:"Attribute"}),size:"sm",showReadonly:!0,showPageVisitAttributes:!0,value:o,onChange:u=>{c(u)}}),a.jsx(fb,{}),a.jsx(hb,{})]})}),a.jsx(so,{children:a.jsx(ie,{type:"submit",variant:"flat",color:"primary",className:"min-w-full",size:"xs",form:n,disabled:!o||!l,children:e?a.jsx($,{message:"Update"}):a.jsx($,{message:"Add"})})})]})}function fb(){const{getItem:e}=it(),t=Ne({name:"attribute"}),n=e(t),s=(n==null?void 0:n.operators)??Bd;return s.length?a.jsx(qe,{name:"operator",size:"sm",label:a.jsx($,{message:"Operator"}),children:s.map(r=>a.jsx(le,{value:r,capitalizeFirst:!0,children:a.jsx($,{...ll[r]})},r))}):null}function hb(){var l,c;const{getItem:e}=it(),t=Ne({name:"attribute"}),n=Ne({name:"operator"}),s=Ne({name:"value"}),{setValue:r}=$e(),i=e(t);if(n===Ds.notNull||i!=null&&i.operators&&!i.operators.length)return null;const o=i==null?void 0:i.name;return i&&il.includes(o)?a.jsx(al,{type:o,label:a.jsx($,{message:"Value"}),size:"sm",className:"w-full",value:s,onChange:u=>r("value",u)}):i!=null&&i.attribute?a.jsx(ol,{inputTypeAlwaysText:!0,label:a.jsx($,{message:"Value"}),attribute:i.attribute,inputName:"value",size:"sm",preferSelects:!0}):a.jsx(sn,{name:"value",label:a.jsx($,{message:"Value"}),size:"sm",required:!0,type:((l=i==null?void 0:i.inputConfig)==null?void 0:l.type)??"text",description:(c=i==null?void 0:i.inputConfig)==null?void 0:c.description})}const mb=z.memo(({code:e})=>{const{localeCode:t}=Fd(),n=new Intl.DisplayNames([t],{type:"language"});let s;try{s=n.of(e)}catch{}return a.jsx(z.Fragment,{children:s})});function pb({node:e,index:t,onBack:n}){return z.createElement(On.div,{...oo,key:"selected-branch",className:"flex min-h-0 flex-auto flex-col"},a.jsx(Eu,{node:e,title:a.jsx(ie,{startIcon:a.jsx(Sf,{}),color:"primary",onClick:()=>n(),className:"-ml-12",children:a.jsx($,{message:"Back"})}),children:a.jsx(gb,{branchIndex:t})}))}function gb({branchIndex:e}){const{fields:t,append:n,remove:s}=Je({name:`branches.${e}.conditionGroups`});return a.jsxs(a.Fragment,{children:[a.jsx(sn,{name:`branches.${e}.name`,label:a.jsx($,{message:"Name"}),descriptionPosition:"top",className:"mb-24",description:a.jsx($,{message:"This wont be visible to customers, but will help you tell the branches apart."})}),a.jsxs(Rt,{children:[a.jsx($,{message:"Conditions"}),a.jsx($,{message:"Conditions determine which branch is selected."})]}),t.map((r,i)=>a.jsx(xb,{branchIndex:e,groupIndex:i,isLast:i===t.length-1,onRemove:()=>s(i)},r.id)),a.jsx(wu,{className:"mt-12",gap:"gap-6",children:a.jsx(ie,{startIcon:a.jsx(Oe,{}),size:"xs",color:"primary",onClick:()=>{n({conditions:[],matchType:"or"})},children:a.jsx($,{message:"Add condition group"})})})]})}function xb({branchIndex:e,groupIndex:t,isLast:n,onRemove:s}){const r=`branches.${e}.conditionGroups.${t}.conditions`,{fields:i,remove:o,append:l,update:c}=Je({name:r});return a.jsxs("div",{children:[a.jsxs("div",{className:"rounded-panel border p-16",children:[i.map((u,d)=>{const f=d===i.length-1;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-12",children:[a.jsxs(Yt,{type:"popover",placement:"left",onClose:h=>{h&&c(d,h)},children:[a.jsxs("button",{type:"button",className:"inline-flex min-w-0 flex-auto select-none appearance-none items-center justify-start gap-4 whitespace-nowrap rounded-button border bg-transparent px-12 py-[7px] align-middle text-sm font-semibold leading-none no-underline outline-none transition-button duration-200 hover:bg-hover focus-visible:ring",children:[a.jsxs("span",{className:"flex flex-auto flex-wrap items-center gap-4",children:[a.jsx(yb,{attribute:u.attribute}),a.jsx("span",{className:"font-normal",children:a.jsx($,{...ll[u.operator]})}),a.jsx("div",{className:"min-w-0 overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx(wb,{condition:u})})]}),a.jsx(cl,{className:"ml-auto text-muted",size:"sm"})]}),a.jsx(yu,{condition:u})]}),a.jsx(Ie,{variant:"outline",size:"sm",onClick:()=>o(d),children:a.jsx(Bn,{})})]}),f?null:a.jsx(Ya,{name:`branches.${e}.conditionGroups.${t}.matchType`,className:"my-8 -ml-10"})]},d)}),a.jsxs("div",{className:"flex items-center gap-8",children:[a.jsx(bb,{isCompact:i.length>=1,onAdd:u=>{l(u)}}),!i.length&&a.jsx(Ie,{variant:"outline",size:"sm",onClick:()=>s(),children:a.jsx(Bn,{})})]})]}),!n&&a.jsx(wu,{className:"my-16",children:a.jsx(Ya,{name:`branches.${e}.branchMatchType`})})]})}function yb({attribute:e}){const{getItem:t}=it(),n=t(e);return(n==null?void 0:n.displayName)??e.name}function wb({condition:e}){var s;const{getItem:t}=it(),n=t(e.attribute);if((n==null?void 0:n.type)===Vn.User){if(n.name==="country")return a.jsx(If,{code:e.value});if(n.name==="language")return a.jsx(mb,{code:e.value})}return((s=n==null?void 0:n.attribute)==null?void 0:s.format)==="date"?a.jsx(_f,{attribute:{...n.attribute,value:e.value}}):e.value}function Ya({name:e,className:t}){const{setValue:n}=$e(),s=Ne({name:e});return a.jsxs(or,{selectionMode:"single",selectedValue:s,onSelectionChange:r=>{n(e,r)},children:[a.jsx(ie,{size:"xs",color:"primary",endIcon:a.jsx(Hd,{}),className:ge("uppercase",t),children:s==="and"?a.jsx($,{message:"And"}):a.jsx($,{message:"Or"})}),a.jsxs(ir,{children:[a.jsx(le,{value:"and",className:"uppercase",children:a.jsx($,{message:"And"})}),a.jsx(le,{value:"or",className:"uppercase",children:a.jsx($,{message:"Or"})})]})]})}function bb({isCompact:e,onAdd:t}){return a.jsxs(Yt,{type:"popover",placement:"left",onClose:n=>{n&&t(n)},children:[a.jsx(ie,{display:"flex",startIcon:a.jsx(Oe,{}),size:e?"xs":"sm",variant:e?void 0:"outline",color:"primary",className:ge(e?"-ml-10 mt-12":"flex-auto"),children:a.jsx($,{message:"Add condition"})}),a.jsx(yu,{})]})}function wu({children:e,className:t,gap:n="gap-12"}){return a.jsxs("div",{className:ge("flex items-center",n,t),children:[a.jsx("div",{className:"h-1 flex-auto bg-divider"}),e,a.jsx("div",{className:"h-1 flex-auto bg-divider"})]})}function vb({node:e}){const t=J(u=>u.getState),n=J(u=>u.setStoredNodes),[s,r]=z.useState(()=>{const u=t().selectedChildId;return u?t().nodes.filter(f=>f.data.parentId===e.id).findIndex(f=>f.id===u):null}),o=J(u=>u.nodes).filter(u=>u.data.parentId===e.id),l=xe({defaultValues:{name:e.data.name??"",branches:o.map(u=>u.data)}}),c=u=>{let d=t().storedNodes;lo(d,e.id,{name:u.name}),d=d.filter(m=>m.parentId!==e.id);const f=d.findIndex(m=>m.id===e.id),h=u.branches.map(m=>we({id:m.flowId,parentId:e.id,type:K.branchesItem,data:m}));d.splice(f+1,0,...h),n(d)};return a.jsx(be,{node:e,form:l,onSubmit:c,children:s!==null?a.jsx(pb,{node:e,index:s,onBack:()=>r(null)}):a.jsx(cb,{node:e,onEditBranch:r})})}function Nb({node:e}){const t=J(o=>o.getState),s=J(o=>o.nodes).filter(o=>o.data.parentId===e.id),r=xe({defaultValues:{name:e.data.name??"",message:e.data.message??"",attachmentIds:e.data.attachmentIds??[],buttons:s.map(o=>o.data),preventTyping:e.data.preventTyping??!1}}),i=o=>{let l=t().storedNodes;lo(l,e.id,{name:o.name,message:o.message,attachmentIds:o.attachmentIds,preventTyping:o.preventTyping}),l=l.filter(d=>d.parentId!==e.id);const c=l.findIndex(d=>d.id===e.id),u=o.buttons.map(d=>we({id:d.flowId,parentId:e.id,type:K.buttonsItem,data:d}));l.splice(c+1,0,...u),t().setStoredNodes(l)};return a.jsx(be,{form:r,node:e,onSubmit:o=>{i(o)},children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(io,{name:"preventTyping",className:"mb-24",children:a.jsx($,{message:"Prevent customer from typing"})}),a.jsx(lt,{}),a.jsx(jb,{node:e})]})})}function jb({node:e}){const{fields:t,append:n,remove:s,move:r}=Je({name:"buttons"}),i=()=>{const o=ce.buttonsItem.createNewStoredNode(e.id,{name:`Button #${t.length+1}`})[0].data;n({...o,flowId:nr()})};return a.jsxs("div",{className:"mt-24",children:[a.jsxs(Rt,{children:[a.jsx($,{message:"Buttons"}),a.jsx($,{message:"Show up to 10 buttons to customers"})]}),a.jsx("div",{className:"-ml-6 space-y-6",children:t.map((o,l)=>a.jsx(Eb,{button:o,buttons:t,index:l,onRemove:()=>s(l),onSortEnd:(c,u)=>{r(c,u)}},o.id))}),a.jsx(ie,{color:"primary",className:"-ml-10 mt-10",startIcon:a.jsx(Oe,{}),onClick:()=>i(),disabled:t.length===10,children:a.jsx($,{message:"Add another button"})})]})}function Eb({index:e,button:t,buttons:n,onRemove:s,onSortEnd:r}){const i=z.useRef(null),{sortableProps:o,dragHandleRef:l}=ar({item:t,items:n,type:"buttonsFlowSortable",ref:i,onSortEnd:(u,d)=>{r(u,d)},strategy:"liveSort"}),c=J(u=>u.storedNodes);return a.jsxs("div",{ref:i,className:"flex items-center",...o,children:[a.jsx(Ie,{className:"mr-8 text-muted",ref:l,children:a.jsx(ao,{})}),a.jsx(Le,{name:`buttons.${e}.name`,className:"flex-auto",required:!0}),a.jsx(Ie,{className:"ml-8 text-muted",disabled:n.length===1,onClick:()=>{c.some(u=>u.parentId===t.flowId)?Ka.danger(ae("Can't delete a button that has child steps")):s()},children:a.jsx(Bn,{})})]})}function _b({card:e}){const{flowId:t}=yt(["flowId"]),[n,s]=z.useState([]),{formId:r,close:i}=sr(),o=xe({defaultValues:e}),{fields:l,append:c,remove:u}=Je({name:"buttons",control:o.control}),d=()=>{c({name:"Button label",actionType:"openUrl",actionValue:""})};return a.jsxs(to,{children:[a.jsx(no,{children:a.jsx($,{message:"Edit card"})}),a.jsx(ro,{children:a.jsxs(rr,{id:r,form:o,onSubmit:f=>i(f),children:[a.jsx(nl,{children:a.jsx(Cf,{name:"image",label:a.jsx($,{message:"Image"}),className:"mb-24",variant:"input",uploadType:eo.conversationImages,showRemoveButton:!0})}),a.jsx(Le,{name:"title",label:a.jsx($,{message:"Title"}),className:"mb-24",maxLength:80,size:"md"}),a.jsx(Le,{name:"description",label:a.jsx($,{message:"Description"}),className:"mb-24",maxLength:120,size:"md",multiline:!0}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-4",children:a.jsx($,{message:"Buttons"})}),a.jsx(ul,{variant:"outline",expandedValues:n,onExpandedChange:s,children:l.map((f,h)=>a.jsxs(dl,{label:f.name,children:[a.jsx(Nr,{size:"sm",pathPrefix:`buttons.${h}`}),a.jsx("div",{className:"text-right",children:a.jsx(ie,{size:"xs",color:"danger",variant:"outline",onClick:()=>{u(h),s([])},className:"mt-20",children:a.jsx($,{message:"Remove"})})})]},h))}),a.jsx(ie,{size:"sm",color:"primary",className:"-ml-18 mt-6",startIcon:a.jsx(Oe,{}),onClick:()=>d(),children:a.jsx($,{message:"Add button"})})]})]})}),a.jsxs(so,{children:[a.jsx(ie,{size:"sm",variant:"outline",onClick:()=>i(),children:a.jsx($,{message:"Cancel"})}),a.jsx(ie,{size:"sm",variant:"flat",color:"primary",type:"submit",form:r,children:a.jsx($,{message:"Save"})})]})]})}function Ib({node:e}){const{trans:t}=je(),n=z.useRef(null),s=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}}),{fields:r,append:i,remove:o,move:l}=Je({control:s.control,name:"cards"}),c=r.map(u=>u.id);return a.jsx(be,{node:e,form:s,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(lt,{className:"mb-24",placeholder:t(ae("Optional")),required:!1}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{ref:n,className:"compact-scrollbar mb-12 flex snap-x snap-mandatory items-start gap-24 overflow-x-auto",children:r.map((u,d)=>a.jsx(Sb,{node:e,index:d,id:u.id,ids:c,onRemove:()=>o(d),onSortEnd:l},u.id))}),r.length?a.jsx(Cb,{scrollRef:n}):null]}),a.jsx(ie,{className:"-ml-14",size:"sm",color:"primary",startIcon:a.jsx(Oe,{}),disabled:r.length>=6,onClick:()=>{const[u]=ce.cards.createNewStoredNode(e.id);i(u.data.cards[0]);const d=n.current;d&&setTimeout(()=>{d.scrollTo({left:d.scrollWidth,behavior:"smooth"})})},children:a.jsx($,{message:"Add card"})})]})})}function Sb({node:e,index:t,id:n,ids:s,onRemove:r,onSortEnd:i}){const o=z.useRef(null),{sortableProps:l,dragHandleRef:c}=ar({ref:o,item:n,items:s,type:"channelContentItem",strategy:"liveSort",onSortEnd:i}),u=$e(),d=`cards.${t}`,f=Ne({name:d});return a.jsxs("div",{ref:o,...l,className:"group relative w-240 flex-shrink-0 snap-center pt-16",children:[a.jsxs("div",{className:"rounded-panel border shadow-sm",children:[f.image&&a.jsx("img",{src:f.image,alt:"",className:"h-172 w-full rounded-t-panel"}),a.jsxs("div",{className:"px-20 pb-20 pt-16 text-sm",children:[a.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap break-words font-semibold",children:f.title}),a.jsx("div",{className:"mt-8 line-clamp-4 whitespace-pre-wrap break-words",children:f.description})]}),f.buttons.map((h,m)=>a.jsx("div",{children:a.jsx("div",{className:"flex h-44 w-full items-center justify-center overflow-hidden overflow-ellipsis whitespace-nowrap border-t px-20 text-sm font-semibold text-primary",children:a.jsx($,{message:h.name})})},m))]}),a.jsxs("div",{className:"pointer-events-none absolute left-0 right-0 top-0 mx-auto flex w-max items-center gap-6 opacity-0 transition-opacity group-hover:pointer-events-auto group-hover:opacity-100",children:[a.jsx(Gt,{ref:c,children:a.jsx(ao,{size:"sm"})}),a.jsxs(Yt,{type:"popover",triggerRef:o,placement:"left",offset:10,onClose:h=>{h&&u.setValue(`cards.${t}`,h)},children:[a.jsx(Gt,{children:a.jsx(cl,{size:"sm"})}),a.jsx(_b,{card:f})]}),s.length>1&&a.jsx(Gt,{onClick:()=>r(),children:a.jsx(Bn,{size:"sm"})})]})]})}function Cb({scrollRef:e}){const[t,n]=z.useState(!0),[s,r]=z.useState(!1);return z.useEffect(()=>{const i=e.current;if(i){const o=()=>{n(i.scrollLeft===0),r(i.scrollLeft+i.clientWidth===i.scrollWidth)};return i.addEventListener("scroll",o),()=>{i.removeEventListener("scroll",o)}}},[]),a.jsxs("div",{className:"pointer-events-none absolute top-0 flex h-full w-full items-center",children:[a.jsx(Gt,{hidden:t,className:"mr-auto",shadow:"shadow-[0_0_15px_0_rgba(0,0,0,.34)]",onClick:()=>{e.current&&e.current.scrollBy({left:-240,behavior:"smooth"})},children:a.jsx(qd,{})}),a.jsx(Gt,{hidden:s,className:"ml-auto",shadow:"shadow-[0_0_15px_0_rgba(0,0,0,.34)]",onClick:()=>{e.current&&e.current.scrollBy({left:240,behavior:"smooth"})},children:a.jsx(Gd,{})})]})}function Gt({children:e,hidden:t,className:n,shadow:s,...r}){return a.jsx("button",{...r,type:"button",className:ge("flex size-34 items-center justify-center rounded-full border bg outline-none transition-[opacity,color,background-color] hover:bg-primary hover:text-on-primary focus-visible:ring",t?"pointer-events-none opacity-0":"pointer-events-auto",n,s||"shadow-md"),children:e})}function kb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(lt,{})]})})}const Ab=Rs.attributes.normalizedList({for:"agent"});function Mb({node:e}){const t=xe({defaultValues:{name:e.data.name??"",attributeIds:e.data.attributeIds??[]}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(Tb,{})]})})}function Tb(){const{setValue:e}=$e(),t=Ne({name:"attributeIds"});return a.jsxs("div",{children:[a.jsxs(Rt,{children:[a.jsx($,{message:"Details"}),a.jsx($,{message:"Collect details from customers for use later in the flow."})]}),a.jsx(kf,{queryOptions:Ab,selectedAttributeIds:t,onChange:n=>{e("attributeIds",n,{shouldDirty:!0})}})]})}function bu(e,t,n){const s=[];let r=e;for(;r;){const i=n.find(l=>l.id===r);if(!i||(r=i.data.parentId,!r||r==="start"))break;const o=n.find(l=>l.id===r);if(!o)break;o.type===t&&s.push(r)}return s}function vu({node:e,onToolChange:t}){const{trans:n}=je(),s=J(c=>c.nodes),i=z.useMemo(()=>bu(e.id,K.tool,s).map(u=>s.find(d=>d.id===u)).filter(Boolean),[e.id,s]).map(c=>c.data.toolId),{data:o}=Ae(ke.tools.list()),l=(o==null?void 0:o.tools.filter(c=>i.includes(c.id)))??[];return a.jsx(qe,{name:"toolId",className:"mb-24",label:a.jsx($,{message:"Tool response"}),placeholder:n({message:"Select a tool response"}),showSearchField:!0,required:!0,onSelectionChange:t,children:l.map(c=>a.jsx(le,{value:c.id,children:c.name},c.id))})}function Nu({toolId:e,listPath:t,children:n}){const{data:s}=fl(ke.tools.get(e)),r=z.useMemo(()=>t?s.tool.response_schema.properties.filter(i=>i.path.startsWith(t)).map(i=>({name:i.id,displayName:i.path.replace(`${t}.[*].`,"").replace("[root]","items"),type:Vn.AiAgentTool,key:`${Vn.AiAgentTool}.${i.id}`,isReadonly:!0})):[],[s.tool.response_schema.properties,t]);return a.jsx(pf.Provider,{value:r,children:n})}const Wa={name:"",actionType:"sendMessage",actionValue:""};function Pb({node:e}){const{trans:t}=je(),n=xe({defaultValues:{message:e.data.message??"",preventTyping:e.data.preventTyping??!1,name:e.data.name??"",listPath:e.data.listPath??"",propertyPath:e.data.propertyPath??"",toolId:e.data.toolId??"",button:e.data.button??Wa}}),s=n.watch("toolId"),r=()=>{n.setValue("button",Wa)};return a.jsx(be,{node:e,form:n,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(io,{name:"preventTyping",className:"mb-24",children:a.jsx($,{message:"Prevent customer from typing"})}),a.jsx(lt,{className:"mb-24",required:!1,placeholder:t({message:"Optional"})}),a.jsx(vu,{node:e,onToolChange:()=>r()}),s?a.jsx(Db,{toolId:s,onListPathChange:()=>r()}):null]})})}function Db({toolId:e,onListPathChange:t}){const{trans:n}=je(),{data:s}=Ae(ke.tools.get(e)),r=Ne({name:"listPath"});return s?a.jsxs("div",{children:[a.jsx(qe,{className:"mb-24",name:"listPath",label:a.jsx($,{message:"Generate buttons from"}),placeholder:n({message:"Select a list"}),showSearchField:!0,required:!0,description:a.jsx($,{message:"Select a list from tool response to use for showing dynamic buttons"}),onSelectionChange:()=>t(),children:s.tool.response_schema.arrays.map(i=>a.jsx(le,{value:i.path,children:i.name},i.path))}),a.jsx(Nu,{toolId:e,listPath:r,children:a.jsx(Nr,{pathPrefix:"button",nameLabel:a.jsx($,{message:"Button label"})})})]}):a.jsx("div",{className:"mt-24 flex h-full w-full items-center justify-center",children:a.jsx(on,{isIndeterminate:!0})})}const Rb=new RegExp('(<be-variable name="[a-zA-Z0-9_-]+" type="[a-zA-Z0-9_-]+" fallback="(?:[a-zA-Z0-9_-]+)?"></be-variable>)',"gm"),Lb=new RegExp('<be-variable name="([a-zA-Z0-9_-]+)" type="([a-zA-Z0-9_-]+)" fallback="(([a-zA-Z0-9_-]+)?)"></be-variable>');function ju({children:e}){const t=z.useMemo(()=>e.split(Rb).filter(Boolean).map((s,r)=>{if(s.startsWith("<be-variable")){const i=s.match(Lb);if(i)return a.jsx(zb,{name:i[1],type:i[2],fallback:i[3]},r)}return s}),[e]);return a.jsx("div",{children:t})}function zb({name:e,type:t,fallback:n}){const{getItem:s}=it(),r=s({name:e,type:t});return a.jsx("div",{className:"trim-both mx-2 inline-flex min-w-34 items-center justify-center rounded-full border bg-chip px-4 align-middle font-medium leading-[20px]",children:(r==null?void 0:r.displayName)||e})}function $b({node:e}){const{trans:t}=je(),n=xe({defaultValues:{name:e.data.name??"",listPath:e.data.listPath??"",card:e.data.card??{},toolId:e.data.toolId??""}}),s=n.watch("toolId"),r=()=>{n.setValue("card",ce.dynamicCards.createNewStoredNode(e.data.parentId)[0].data.card)};return a.jsx(be,{node:e,form:n,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(io,{name:"preventTyping",className:"mb-24",children:a.jsx($,{message:"Prevent customer from typing"})}),a.jsx(lt,{className:"mb-24",required:!1,placeholder:t({message:"Optional"})}),a.jsx(vu,{node:e,onToolChange:()=>r()}),s?a.jsx(Ob,{toolId:s,node:e,onListPathChange:()=>r()}):null]})})}function Ob({toolId:e,node:t,onListPathChange:n}){const{trans:s}=je(),{data:r}=Ae(ke.tools.get(e)),{setValue:i}=$e(),o=Ne({name:"listPath"});return r?a.jsxs("div",{children:[a.jsx(qe,{className:"mb-24",name:"listPath",label:a.jsx($,{message:"Generate cards from"}),placeholder:s({message:"Select a list"}),showSearchField:!0,required:!0,description:a.jsx($,{message:"Select a list from tool response to use for showing dynamic cards"}),onSelectionChange:()=>n(),children:r.tool.response_schema.arrays.map(l=>a.jsx(le,{value:l.path,children:l.name},l.path))}),a.jsx(Nu,{toolId:e,listPath:o,children:a.jsx(Vb,{})})]}):a.jsx("div",{className:"mt-24 flex h-full w-full items-center justify-center",children:a.jsx(on,{isIndeterminate:!0})})}function Vb(){return a.jsxs("div",{className:"rounded-panel border px-20 py-16",children:[a.jsx(Le,{name:"card.image",label:a.jsx($,{message:"Image"}),hideEmojiPicker:!0,className:"mb-20"}),a.jsx(Le,{name:"card.title",label:a.jsx($,{message:"Title"}),className:"mb-20"}),a.jsx(Le,{name:"card.description",label:a.jsx($,{message:"Description"}),className:"mb-20",multiline:!0}),a.jsx(Bb,{})]})}function Bb(){const[e,t]=z.useState([]),{fields:n,append:s,remove:r}=Je({name:"card.buttons"}),i=()=>{s({name:"Button label",actionType:"openUrl",actionValue:""})};return a.jsxs("div",{className:"mt-20",children:[a.jsx("div",{className:"mb-4 text-sm",children:a.jsx($,{message:"Buttons"})}),a.jsx(ul,{variant:"outline",expandedValues:e,onExpandedChange:t,children:n.map((o,l)=>a.jsxs(dl,{label:a.jsx(Fb,{index:l}),children:[a.jsx(Nr,{size:"sm",pathPrefix:`card.buttons.${l}`}),a.jsx("div",{className:"mt-12 text-right",children:a.jsx(ie,{size:"xs",color:"danger",variant:"outline",onClick:()=>{r(l),t([])},children:a.jsx($,{message:"Remove"})})})]},l))}),a.jsx(ie,{size:"sm",color:"primary",className:"-ml-18 mt-12",startIcon:a.jsx(Oe,{}),onClick:()=>i(),children:a.jsx($,{message:"Add button"})})]})}function Fb({index:e}){const t=`card.buttons.${e}.name`,n=Ne({name:t});return a.jsx(ju,{children:n})}function Hb({node:e}){const{trans:t}=je(),n=xe({defaultValues:e.data}),{data:s}=Ae(ke.flows.list()),{flowId:r}=yt(["flowId"]),i=n.watch("targetFlowId");return a.jsx(be,{node:e,form:n,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(qe,{name:"targetFlowId",label:a.jsx($,{message:"Target flow"}),placeholder:t({message:"Choose target flow"}),showSearchField:!0,searchPlaceholder:t({message:"Find a flow"}),required:!0,children:s==null?void 0:s.flows.map(o=>`${o.id}`==`${r}`?null:a.jsx(le,{value:o.id,children:o.name},o.id))}),a.jsx(ie,{className:"-ml-12 mt-12",color:"primary",startIcon:a.jsx(hl,{}),elementType:Qa,to:`/dashboard/ai-agent/flows/${i}/edit`,target:"_blank",children:a.jsx($,{message:"Edit flow"})})]})})}function qb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(lt,{showButtonsEditor:!0})]})})}function Gb({node:e}){const{trans:t}=je(),n=J(o=>o.flowIntent),s=J(o=>o.setFlowIntent),r=xe({defaultValues:{intent:n??""}}),i=o=>{s(o.intent)};return a.jsx(be,{node:e,form:r,onSubmit:i,children:a.jsx(ve,{node:e,children:a.jsx(sn,{name:"intent",label:a.jsx($,{message:"Customer intent"}),placeholder:t({message:"Optional"}),inputElementType:"textarea",rows:3,description:a.jsx($,{message:"Here you can describe the customer intent. If AI Agent determines that user message matches this intent, this flow will be triggered. If left empty, this flow will only be triggerable manually (for example, by clicking on a button in greeting message)."})})})})}function Yb({node:e}){const{trans:t}=je(),n=xe({defaultValues:{name:e.data.name??"",toolId:e.data.toolId??""}}),{data:s}=Ae(ke.tools.list()),r=n.watch("toolId");return a.jsx(be,{node:e,form:n,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(qe,{name:"toolId",label:a.jsx($,{message:"Tool"}),placeholder:t({message:"Select a tool"}),description:a.jsx($,{message:"Only tools that are set to live will be selectable here."}),showSearchField:!0,required:!0,children:s==null?void 0:s.tools.map(i=>a.jsx(le,{value:i.id,children:i.name},i.id))}),a.jsx(ie,{className:"-ml-12 mb-24 mt-8",color:"primary",startIcon:a.jsx(hl,{}),elementType:Qa,to:`/dashboard/ai-agent/tools/${r}/edit`,target:"_blank",children:a.jsx($,{message:"Edit tool"})}),!!r&&a.jsx(Wb,{toolId:r})]})})}function Wb({toolId:e}){var r;const{data:t}=Ae(ke.tools.get(e));if(!t)return a.jsx("div",{className:"mt-24 flex items-center justify-center",children:a.jsx(on,{isIndeterminate:!0})});const n=t.tool.response_schema.properties.filter(i=>i.attribute).map(i=>i.attribute),s=((r=t.tool.config.apiRequest)==null?void 0:r.attributesUsed)??[];return a.jsxs("div",{children:[s!=null&&s.length?a.jsx(Xb,{requiredAttributes:s}):null,n!=null&&n.length?a.jsx(Ub,{updatedAttributes:n}):null]})}function Xb({requiredAttributes:e}){return a.jsxs("div",{className:"mb-16 rounded-panel border p-12 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsx(Xa,{size:"xs"}),a.jsx($,{message:"Data required for API request:"})]}),a.jsx(ml,{className:"mt-12",size:"sm",radius:"rounded-input",children:e.map(t=>a.jsx(Js,{children:t.name},t.name))})]})}function Ub({updatedAttributes:e}){return a.jsxs("div",{className:"rounded-panel border p-12 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsx(Af,{size:"xs"}),a.jsx($,{message:"Once completed, these attributes will be updated:"})]}),a.jsx(ml,{className:"mt-12",size:"sm",radius:"rounded-input",children:e.map(t=>a.jsx(Js,{children:t.name},t.name))})]})}function Zb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return a.jsx(be,{node:e,form:t,children:a.jsxs(ve,{node:e,children:[a.jsx(Ee,{className:"mb-24"}),a.jsx(lt,{className:"mb-24"}),a.jsx(Kb,{node:e})]})})}function Kb({node:e}){var l,c;const n=(l=Ae(Rs.agents.compact).data)==null?void 0:l.agents,s=Ae(Rs.groups.normalizedList),r=(c=s.data)==null?void 0:c.groups;if(!n||!r)return a.jsx("div",{className:"flex h-[148px] items-center justify-center",children:a.jsx(on,{isIndeterminate:!0,size:"sm"})});const i=e.data.groupId??s.data.defaultGroupId,o=n.filter(u=>u.groups.some(d=>d.id==i));return a.jsxs("div",{children:[a.jsx(qe,{name:"groupId",className:"mb-24",label:a.jsx($,{message:"Group"}),selectionMode:"single",placeholder:"Optional",children:r.map(u=>a.jsx(le,{value:`${u.id}`,startIcon:a.jsx(Vo,{user:u,size:"sm"}),children:u.name},u.id))}),a.jsxs(qe,{name:"agentId",label:a.jsx($,{message:"Agent"}),selectionMode:"single",placeholder:"Optional",children:[a.jsx(le,{value:"",children:a.jsx($,{message:"First available"})}),o.map(u=>a.jsx(le,{value:`${u.id}`,startIcon:a.jsx(Vo,{user:u,size:"sm"}),children:u.name},u.id))]})]})}function Qb(){const e=J(r=>r.selectedNodeId),t=J(r=>r.nodes),n=e?t.find(r=>r.id===e):null,s=()=>{const r=document.getElementById(Io);r&&r.requestSubmit()};return a.jsx(Yd,{initial:!1,mode:"wait",children:n?a.jsxs(z.Fragment,{children:[a.jsx(On.div,{initial:{x:Ls},animate:{x:0},exit:{x:Ls},transition:{type:"tween",duration:.15},className:"fixed right-8 top-8 z-20 h-full max-h-[calc(100%-16px)] w-512 rounded-panel border bg shadow-lg",children:a.jsx(ev,{node:n})},e?"open":"closed"),a.jsx(On.div,{...oo,className:"fixed inset-0 z-10 bg-[rgba(34,48,74,.4)]",onClick:()=>s()},"flow-underlay")]}):null})}function ve({node:e,children:t}){return a.jsx(Eu,{node:e,title:a.jsx(Jb,{node:e}),actions:e.type===K.start?null:a.jsx(tv,{selectedNode:e}),children:t})}function Eu({node:e,title:t,actions:n,children:s}){const r=J(i=>i.setSelectedNodeId);return a.jsxs(z.Fragment,{children:[a.jsxs("div",{className:"flex h-64 flex-shrink-0 items-center border-b px-24",children:[a.jsx("div",{className:"mr-12 text-sm font-semibold text-muted",children:t}),a.jsx(ie,{variant:"outline",type:"button",size:"xs",className:"ml-auto",onClick:()=>r(null),children:a.jsx($,{message:"Cancel"})}),a.jsx(ie,{variant:"flat",color:"primary",type:"submit",size:"xs",form:Io,className:"ml-10 min-w-70",children:a.jsx($,{message:"Save"})})]}),a.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto p-24",children:[n,a.jsx("div",{children:s},e.id)]})]})}function Jb({node:e}){const t=ce[e.type],n=t.icon,s=t.displayName,r=hn(e.type);return a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{style:r,className:"mr-6 flex size-32 items-center justify-center rounded-button",children:a.jsx(n,{size:"xs"})}),a.jsx($,{...s})]})}function ev({node:e}){switch(e.type){case K.start:return a.jsx(Gb,{node:e});case K.message:return a.jsx(qb,{node:e});case K.buttons:return a.jsx(Nb,{node:e});case K.dynamicButtons:return a.jsx(Pb,{node:e});case K.articles:return a.jsx(ob,{node:e});case K.cards:return a.jsx(Ib,{node:e});case K.dynamicCards:return a.jsx($b,{node:e});case K.transfer:return a.jsx(Zb,{node:e});case K.closeConversation:return a.jsx(kb,{node:e});case K.goToStep:return a.jsx(Xw,{node:e});case K.goToFlow:return a.jsx(Hb,{node:e});case K.collectDetails:return a.jsx(Mb,{node:e});case K.tool:return a.jsx(Yb,{node:e});case K.setAttribute:return a.jsx(Zw,{node:e});case K.addTags:return a.jsx(Vw,{node:e});case K.branches:return a.jsx(vb,{node:e})}return null}function tv({selectedNode:e}){const t=J(r=>r.removeNode),n=J(r=>r.removeNodeAndChildren),s=ce[e.type];return a.jsxs(or,{children:[a.jsx(ie,{variant:"outline",endIcon:a.jsx(Ja,{}),className:"mb-24",size:"xs",children:a.jsx($,{message:"Step actions"})}),a.jsxs(ir,{children:[!s.forceDeleteAllChildren&&a.jsx(le,{value:"delete",onSelected:()=>{t(e.id)},children:a.jsx($,{message:"Delete this step"})}),a.jsx(le,{value:"deleteWithChildren",onSelected:()=>{n(e.id)},children:a.jsx($,{message:"Delete this and following steps"})})]})]})}const nv=["start","buttonsItem","branchesItem","toolResult","placeholder"];function jr({nodeId:e}){const{flowDirection:t}=Dt(),n=J(m=>m.getState),s=J(m=>m.setStoredNodes),r=J(m=>m.hoveredNodeId===e),i=J(m=>m.nodes),o=i.find(m=>m.id===e),l=i.find(m=>m.data.parentId===e),c=o?ce[o.type]:null,u=!(c!=null&&c.disallowChildren),d=c==null?void 0:c.isTerminal,f=!l||l.type===K.placeholder;if(!u||d)return null;const h=m=>{const{allNodes:x,newNodes:g}=qf(n().storedNodes,{type:m,parentId:e});s(x,{panToNode:g[0].id,selectPannedNode:!0})};return a.jsx("div",{className:ge("absolute flex justify-center bg-transparent",t==="TB"&&"-bottom-34 left-0 h-34 w-full",t==="LR"&&"-right-34 bottom-0 top-0 my-auto h-24 w-34"),children:a.jsxs(or,{onItemSelected:m=>h(m),children:[a.jsx(ft,{label:a.jsx($,{message:"Add new step"}),children:a.jsx("button",{className:ge(t==="TB"&&"mt-8",t==="LR"&&"ml-8","flex h-28 w-28 items-center justify-center rounded-full border border-primary bg text-primary transition-button hover:bg-primary hover:text-on-primary",!r&&!f&&"opacity-0"),children:a.jsx(Oe,{size:"sm"})})}),a.jsx(ir,{children:Object.entries(ce).map(([m,x])=>{if(nv.includes(m))return null;let g=!1;return!f&&(x.isTerminal||x.disallowChildren)&&(g=!0),x.requiredAnsector&&(o==null?void 0:o.type)!==x.requiredAnsector&&!bu(e,x.requiredAnsector,i).length&&(g=!0),a.jsx(le,{value:m,startIcon:a.jsx(rv,{config:x}),isDisabled:g,children:a.jsx($,{...x.displayName})},m)})})]})})}function rv({config:e}){const t=e.icon,n=Co();return a.jsx("div",{style:{backgroundColor:n[`--node-color-${e.type}-bg`],color:n[`--node-color-${e.type}-fg`]},className:"mr-4 flex h-24 w-24 items-center justify-center rounded-button text-on-primary",children:a.jsx(t,{size:"xs"})})}function Er({radius:e="rounded-full"}){return a.jsx("div",{className:ge("pointer-events-none absolute inset-0 -left-5 -top-5 z-10 h-[calc(100%+10px)] w-[calc(100%+10px)] border-2 border-dashed border-primary",e)})}function Ye({type:e,position:t,size:n="w-8 h-8"}){return a.jsx(rn,{className:ge(n,"pointer-events-none opacity-0"),type:e,position:t})}function _r({children:e,className:t,...n}){return a.jsx("div",{...n,className:ge("before:absolute before:-left-40 before:-top-40 before:-z-10 before:block before:h-[calc(100%+80px)] before:w-[calc(100%+80px)]",t),children:e})}function Be({children:e,label:t,className:n,id:s,type:r,disableSelection:i}){const{flowDirection:o}=Dt(),l=J(f=>f.selectedNodeId===s),c=J(f=>f.setSelectedNodeId),u=ce[r].icon,d=hn(r);return a.jsxs(z.Fragment,{children:[a.jsx(Ye,{type:"target",position:o==="TB"?U.Top:U.Left}),a.jsx(jr,{nodeId:s}),l&&a.jsx(Er,{radius:"rounded-panel"}),a.jsxs(_r,{onClick:()=>{!i&&c(s)},className:ge("flex h-full w-full items-center justify-center gap-12 overflow-hidden rounded-panel border bg p-12",n),children:[a.jsx("div",{className:"flex aspect-square h-full flex-shrink-0 items-center justify-center rounded-panel",style:d,children:a.jsx(u,{size:"md"})}),a.jsxs("div",{className:ge("min-w-0 flex-auto text-[13px] leading-none",!!t&&"-mt-4"),children:[a.jsx("div",{className:ge("overflow-hidden overflow-ellipsis whitespace-nowrap text-sm font-medium",!!t&&"mb-2"),children:e}),!!t&&a.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-muted",children:t})]})]}),a.jsx(Ye,{type:"source",position:o==="TB"?U.Bottom:U.Right})]})}function sv(e){const t=[...e.data.conversationTags??[],...e.data.userTags??[]];return a.jsx(Be,{id:e.id,type:e.type,label:t.length?t.join(", "):e.data.name,children:a.jsx($,{message:"Add tags"})})}function ov({data:e,id:t,type:n}){var s;return a.jsx(Be,{id:t,type:n,label:e.name,children:a.jsx($,{message:"Show articles (:count)",values:{count:((s=e.articleIds)==null?void 0:s.length)||0}})})}function Ao({id:e,type:t,children:n,onClick:s,isSelected:r,useNodeColor:i}){const{flowDirection:o}=Dt(),l=hn(t);return a.jsxs(z.Fragment,{children:[a.jsx(Ye,{type:"target",position:o==="TB"?U.Top:U.Left}),r&&a.jsx(Er,{}),a.jsx(_r,{onClick:()=>s==null?void 0:s(),style:i?l:void 0,className:ge("relative flex h-full w-full items-center justify-center rounded-full px-10",i?"font-bold shadow-sm":"border bg"),children:a.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-sm",children:n})}),a.jsx(Ye,{type:"source",position:o==="TB"?U.Bottom:U.Right}),a.jsx(jr,{nodeId:e})]})}function iv({data:e,type:t,id:n}){const s=J(l=>l.setSelectedNodeId),r=J(l=>l.selectedNodeId),i=e.parentId===r,o=e.name??"";return a.jsx(Ao,{id:n,type:t,isSelected:i,useNodeColor:!0,onClick:()=>{e.parentId&&s(e.parentId,n)},children:o?a.jsx("span",{children:o}):a.jsx($,{message:"Branch name"})})}function av({children:e}){return a.jsx("div",{className:"absolute -top-34 left-1/2 w-max -translate-x-1/2 whitespace-nowrap bg-alt/70 p-8 text-sm font-semibold text-muted",children:e})}function lv({label:e,className:t,id:n,type:s}){const{flowDirection:r}=Dt(),i=J(u=>u.selectedNodeId===n),o=J(u=>u.setSelectedNodeId),l=ce[s].icon,c=hn(s);return a.jsxs(z.Fragment,{children:[a.jsx(Ye,{type:"target",position:r==="TB"?U.Top:U.Left}),a.jsx(jr,{nodeId:n}),i&&a.jsx(Er,{}),e&&a.jsx(av,{children:e}),a.jsxs(_r,{onClick:()=>{o(n)},className:ge("relative isolate flex h-full w-full items-center justify-center shadow-sm",t),style:{color:c.color},children:[a.jsx("div",{className:"absolute size-[calc(100%-12px)] rotate-45 rounded-panel",style:{backgroundColor:c.backgroundColor}}),a.jsx(l,{size:"md",className:"z-10"})]}),a.jsx(Ye,{type:"source",position:r==="TB"?U.Bottom:U.Right})]})}function cv(e){return a.jsx(lv,{id:e.id,type:e.type,label:e.data.name})}function uv({data:e,id:t,type:n}){var s;return a.jsx(Be,{id:t,type:n,label:e.name,children:a.jsx($,{message:"Show cards (:count)",values:{count:((s=e.cards)==null?void 0:s.length)||0}})})}function Ir({children:e,label:t,className:n,id:s,type:r,showChildCount:i}){const{flowDirection:o}=Dt(),l=J(m=>m.selectedNodeId===s),c=J(m=>m.setSelectedNodeId),u=ce[r].icon,f=J(m=>m.nodes).filter(m=>m.data.parentId===s).length,h=hn(r);return a.jsxs(z.Fragment,{children:[a.jsx(Ye,{type:"target",position:o==="TB"?U.Top:U.Left}),a.jsx(jr,{nodeId:s}),l&&a.jsx(Er,{radius:"rounded-panel"}),a.jsxs(_r,{onClick:()=>{c(s)},className:ge("flex h-full w-full flex-col overflow-hidden rounded-panel border bg",n),children:[a.jsx("div",{className:"min-h-0 flex-auto px-10 py-12 text-sm",children:a.jsx("div",{className:"line-clamp-2 break-words",children:e})}),a.jsxs("div",{className:ge("flex h-32 flex-shrink-0 items-center gap-8 border-t"),children:[a.jsx("div",{style:h,className:"flex h-full w-32 items-center justify-center text-on-primary",children:a.jsx(u,{size:"xs"})}),a.jsx("div",{className:"text-xs text-muted",children:t||a.jsx($,{...ce[r].displayName})}),!!f&&i&&a.jsx("div",{className:"ml-auto mr-8",children:a.jsx("div",{style:h,className:"flex h-18 w-18 items-center justify-center rounded-full bg-primary text-xs font-bold text-on-primary",children:f})})]})]}),a.jsx(Ye,{type:"source",position:o==="TB"?U.Bottom:U.Right})]})}function dv({data:e,id:t,type:n}){return a.jsx(Ir,{id:t,type:n,children:e.message?a.jsx("div",{children:e.message}):a.jsx("div",{className:"text-muted",children:a.jsx($,{message:"AI agent message"})})})}function fv(e){return a.jsx(Be,{id:e.id,type:e.type,label:e.data.name,children:a.jsx($,{message:"Dynamic buttons"})})}function hv(e){return a.jsx(Be,{id:e.id,type:e.type,label:e.data.name,children:a.jsx($,{message:"Dynamic cards"})})}function mv({data:e,id:t,type:n}){var i;const s=Ae(ke.flows.list()),r=e.targetFlowId?(i=s.data)==null?void 0:i.flows.find(o=>o.id===e.targetFlowId):null;return a.jsx(Be,{id:t,type:n,label:e.name??(r==null?void 0:r.name),children:a.jsx($,{message:"Go to flow"})})}function pv({data:e,id:t,type:n}){const{trans:s}=je(),r=J(l=>l.nodes);let i=null;const o=e.targetNodeId?r.find(l=>l.id===e.targetNodeId):null;return o&&(i=o.data.name?o.data.name:s(ce[o.type].displayName)),a.jsx(Be,{id:t,type:n,label:e.name??i,children:a.jsx($,{message:"Go to step"})})}function gv(e){const{flowDirection:t}=Dt();return a.jsxs(a.Fragment,{children:[a.jsx(Ye,{type:"target",position:t==="TB"?U.Top:U.Left}),a.jsx(Ye,{type:"source",position:t==="TB"?U.Bottom:U.Right})]})}function xv(e){return a.jsx(Be,{id:e.id,type:e.type,label:e.data.name,children:a.jsx($,{message:"Set attribute"})})}function yv(e){var s;const t=Ae(ke.tools.list()),n=e.data.toolId?(s=t.data)==null?void 0:s.tools.find(r=>r.id===e.data.toolId):null;return a.jsx(Be,{id:e.id,type:e.type,label:n==null?void 0:n.name,children:a.jsx($,{message:"Use tool"})})}function wv({data:e,id:t,type:n}){const s=J(o=>o.setSelectedNodeId),r=J(o=>o.selectedNodeId),i=e.parentId===r;return a.jsx(Ao,{id:t,type:n,isSelected:i,onClick:()=>{e.parentId&&s(e.parentId,t)},children:e.type==="success"?a.jsxs("div",{className:"flex items-center gap-8",children:[a.jsx(Wd,{size:"sm",className:"text-positive"}),a.jsx($,{message:"Success"})]}):a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(Qs,{size:"sm",className:"block text-danger"}),a.jsx($,{message:"Failure"})]})})}function bv({data:e,id:t,type:n}){const s=J(o=>o.setSelectedNodeId),r=J(o=>o.selectedNodeId),i=e.parentId===r;return a.jsx(Ao,{id:t,type:n,isSelected:i,onClick:()=>{e.parentId&&s(e.parentId,t)},children:e.name?a.jsx("span",{children:e.name}):a.jsx("span",{className:"text-muted",children:a.jsx($,{message:"Button label"})})})}function vv({data:e,id:t,type:n}){return a.jsx(Ir,{id:t,type:n,label:a.jsx($,{message:"Buttons"}),showChildCount:!0,children:e.message?a.jsx("div",{children:e.message}):a.jsx("div",{className:"text-muted",children:a.jsx($,{message:"AI agent message"})})})}function Nv(e){return a.jsx(Be,{id:e.id,type:e.type,label:e.data.name,children:a.jsx($,{message:"Ask for details"})})}function jv({data:e,id:t,type:n}){return a.jsx(Ir,{id:t,type:n,label:a.jsx($,{message:"Message"}),children:e.message?a.jsx(ju,{children:e.message}):a.jsx("div",{className:"text-muted",children:a.jsx($,{message:"AI agent message"})})})}function Ev({id:e,type:t}){return a.jsx(Be,{id:e,type:t,label:a.jsx($,{message:"Edit intent"}),children:a.jsx($,{message:"Start point"})})}function _v({data:e,id:t,type:n}){return a.jsx(Ir,{id:t,type:n,children:e.message?a.jsx("div",{children:e.message}):a.jsx("div",{className:"text-muted",children:a.jsx($,{message:"AI agent message"})})})}const Iv={start:Ev,message:jv,buttons:vv,dynamicButtons:fv,buttonsItem:bv,articles:ov,cards:uv,dynamicCards:hv,collectDetails:Nv,tool:yv,toolResult:wv,setAttribute:xv,addTags:sv,branches:cv,branchesItem:iv,goToStep:pv,goToFlow:mv,transfer:_v,closeConversation:dv,placeholder:gv};function Sv(){return a.jsx(z.Fragment,{children:a.jsx(su,{children:a.jsx(Cv,{})})})}function Cv(){const e=Ua(),t=Co(),n=J(d=>d.setHoveredNodeId),s=J(d=>d.removeNodeAndChildren),r=J(d=>d.getState),i=J(d=>d.nodes),o=J(d=>d.edges),l=J(d=>d.setCanvasSize),c=z.useRef(null),u=ue();return z.useEffect(()=>{zw(u.getState().panZoom)},[]),z.useEffect(()=>Xd(c,d=>{l(d)}),[l]),a.jsx(nl,{children:a.jsxs(sw,{nodes:i,edges:o,nodeTypes:Iv,panOnScroll:!0,maxZoom:qn,minZoom:Hn,ref:c,zoomOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,onNodeMouseEnter:(d,f)=>{n(f.id)},onNodeMouseLeave:()=>{n(null)},onKeyDown:d=>{(d.key==="Delete"||d.key==="Backspace")&&r().selectedNodeId&&!Mf()&&(d.preventDefault(),s(r().selectedNodeId))},proOptions:{hideAttribution:!0},className:"rounded-panel border",style:{"--xy-edge-stroke-width":3,"--xy-edge-stroke":e?"rgb(128, 129, 130)":"rgb(216, 220, 222)","--xy-edge-stroke-selected":"var(--xy-edge-stroke)",...t},children:[a.jsx(cw,{bgColor:e?void 0:"rgb(var(--be-bg-alt))"}),a.jsx(kv,{}),a.jsx(Cw,{className:"rounded-panel border",pannable:!0,nodeColor:d=>{const f=d.type;return e?mu[f].bg:hu[f].bg}}),a.jsx(Qb,{})]})})}function kv(){const e=J(c=>c.zoom),t=J(c=>c.incrementZoom),n=J(c=>c.decrementZoom),s=J(c=>c.panToNode),r=J(c=>c.getState),{zoomTo:i}=wr(),o=()=>{i(t())},l=()=>{i(n())};return Ar("window","ctrl+-",()=>l()),Ar("window","ctrl+plus",()=>o()),Ar("window","Home",()=>{s(r().nodes[0])}),a.jsxs("div",{className:"absolute bottom-0 left-0 z-[5] flex flex-col p-10",children:[a.jsx(ft,{label:a.jsx($,{message:"Start point"}),children:a.jsx(Ie,{size:"sm",onClick:()=>{s(r().nodes[0])},children:a.jsx(tl,{})})}),a.jsx(ft,{label:a.jsx($,{message:"Zoom in"}),children:a.jsx(Ie,{size:"sm",onClick:()=>{o()},disabled:e>=qn,children:a.jsx(Oe,{})})}),a.jsx(ft,{label:a.jsx($,{message:"Zoom out"}),children:a.jsx(Ie,{size:"sm",onClick:()=>{l()},disabled:e<=Hn,children:a.jsx(sf,{})})})]})}function kj(){const{flowId:e}=yt(["flowId"]),{data:t}=fl(ke.flows.get(e));return a.jsxs(Ow,{initialValue:t.flow.config,intent:t.flow.intent,children:[a.jsx(Av,{}),a.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel z-[1] flex h-full flex-col",children:[a.jsx(Tv,{flow:t.flow}),a.jsx("div",{className:"flex-auto p-24",children:a.jsx(Sv,{})})]}),a.jsx(Mv,{})]})}function Av(){const e=J(t=>t.isDirty);return a.jsx(Bf,{shouldBlock:e})}function Mv(){const{flowId:e}=yt(["flowId"]),{saveChanges:t,isSaving:n}=_u(),s=J(o=>o.isDirty),r=J(o=>o.previewVisible),i=J(o=>o.setPreviewVisible);return r?a.jsx(Pf,{flowId:e,onClose:()=>i(!1),resetConversationMessage:s?o=>a.jsx($f,{className:"shadow-md",leadingIcon:a.jsx(Ud,{size:"sm"}),title:a.jsx($,{message:"Flow has unsaved changes."}),actions:a.jsx(ie,{size:"xs",color:"white",variant:"flat",className:"min-w-144",disabled:n,onClick:()=>{t.mutate(void 0,{onSuccess:()=>o()})},children:a.jsx($,{message:"Save and reset now"})}),description:a.jsx($,{message:"Save them and reset conversation to test the current version."})}):void 0}):null}function Tv({flow:e}){const{saveChanges:t,isSaving:n}=_u(),s=J(l=>l.isDirty),r=J(l=>l.previewVisible),i=J(l=>l.setPreviewVisible),o=a.jsxs(a.Fragment,{children:[a.jsx(Lf,{size:"xs",variant:"button",link:Rf.pages.flows,children:a.jsx($,{message:"Learn"})}),a.jsx(Df,{onTogglePreview:()=>i(!r),previewIsVisible:r}),a.jsx(ie,{variant:"flat",color:"primary",className:"ml-auto",size:"xs",disabled:n||!s,onClick:()=>t.mutate(),children:a.jsx($,{message:"Save changes"})})]});return a.jsx(zf,{showSidebarToggleButton:!0,rightContent:o,children:a.jsxs(Vf,{size:"xl",children:[a.jsx(Ho,{to:"../flows",children:a.jsx($,{message:"Flows"})}),a.jsx(Ho,{children:e.name})]})})}function _u(){const{flowId:e}=yt(["flowId"]),t=J(o=>o.getPayloadForSaving),n=J(o=>o.setIsDirty),s=["save-flow-changes"],r=Of({mutationKey:s})>0,i=Zd({mutationKey:s,mutationFn:()=>Qd.put(`lc/ai-agent/flows/${e}`,t()),onSuccess:()=>{Za.invalidateQueries({queryKey:ke.flows.invalidateKey}),n(!1),Ka(ae("Flow updated"))},onError:o=>Kd(o)});return{isSaving:r,saveChanges:i}}export{kj as Component};
