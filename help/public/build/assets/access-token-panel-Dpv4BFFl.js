import{i as m,t as d,m as u,k as x,d as k,al as h,r as T,j as e,am as v,an as y,T as a,ap as C,aq as D,B as i,aP as b,F,q as j,aa as N,E as A,s as S,b4 as P,u as w,L as E,p as I,D as L,av as g}from"./client-DtfdVV77.js";import{A as q,a as B}from"./account-settings-sidenav-DNNZzcwO.js";import{L as _}from"./external-link-Cxcw6nc_.js";import{o as M,I as Q,S as z}from"./custom-menu-Dvq-fOnC.js";import{C as H}from"./confirmation-dialog-BzXs9ksK.js";import{u as K}from"./use-clipboard-Jb2pyXiK.js";function O(s){return x.post("access-tokens",s).then(t=>t.data)}function R(s){return m({mutationFn:t=>O(t),onSuccess:()=>{d(u("Token create"))},onError:t=>M(t,s)})}function Y(){const s=k(),{formId:t,close:o}=h(),n=R(s),[r,l]=T.useState(),c=e.jsx(b,{form:s,id:t,onSubmit:p=>{n.mutate(p,{onSuccess:f=>{l(f.plainTextToken),j.invalidateQueries({queryKey:["users"]})}})},children:e.jsx(F,{name:"tokenName",label:e.jsx(a,{message:"Token name"}),required:!0,autoFocus:!0})});return e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(a,{message:"Create new token"})}),e.jsx(C,{children:r?e.jsx(Z,{plainTextToken:r}):c}),e.jsxs(D,{children:[e.jsx(i,{variant:"text",onClick:o,children:e.jsx(a,{message:"Done"})}),!r&&e.jsx(i,{variant:"flat",color:"primary",type:"submit",form:t,disabled:n.isPending,children:e.jsx(a,{message:"Create"})})]})]})}function Z({plainTextToken:s}){const[t,o]=K(s||"",{successDuration:1e3});return e.jsxs(e.Fragment,{children:[e.jsx(N,{readOnly:!0,value:s,autoFocus:!0,onClick:n=>{n.currentTarget.focus(),n.currentTarget.select()},endAppend:e.jsx(i,{variant:"flat",color:"primary",onClick:o,children:t?e.jsx(a,{message:"Copied!"}):e.jsx(a,{message:"Copy"})})}),e.jsxs("div",{className:"mt-14 flex items-center gap-10 text-sm",children:[e.jsx(A,{size:"sm",className:"text-danger"}),e.jsx(a,{message:"Make sure to store the token in a safe place. After this dialog is closed, token will not be viewable anymore."})]})]})}function $({id:s}){return x.delete(`access-tokens/${s}`).then(t=>t.data)}function G(){return m({mutationFn:s=>$(s),onSuccess:()=>{d(u("Token deleted"))},onError:s=>S(s)})}const J=""+new URL("secure-files-B4ZUs63v.svg",import.meta.url).href;function oe({user:s}){const t=s.tokens||[],{hasPermission:o,user:n}=P(),{api:r}=w();return!(r!=null&&r.integrated)||!o("api.access")?null:e.jsx(q,{id:B.Developers,title:e.jsx(a,{message:"API access tokens"}),titleSuffix:e.jsx(E,{className:_,to:"/api-docs",target:"_blank",children:e.jsx(a,{message:"Documentation"})}),actions:s.id===(n==null?void 0:n.id)?e.jsx(V,{}):null,children:t.length?t.map((l,c)=>e.jsx(U,{token:l,isLast:c===t.length-1},l.id)):e.jsx(Q,{className:"py-40",image:e.jsx(z,{src:J}),title:s.id===(n==null?void 0:n.id)?e.jsx(a,{message:"You have no personal access tokens yet"}):e.jsx(a,{message:"User has not created any access tokens yet"})})})}function U({token:s,isLast:t}){return e.jsxs("div",{className:I("flex items-center gap-24",!t&&"mb-12 border-b pb-12"),children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold",children:e.jsx(a,{message:"Name"})}),e.jsx("div",{children:s.name}),e.jsx("div",{className:"mt-10 font-semibold",children:e.jsx(a,{message:"Last used"})}),e.jsx("div",{children:s.last_used_at?e.jsx(L,{date:s.last_used_at}):e.jsx(a,{message:"Never"})})]}),e.jsx(W,{token:s})]})}function V(){return e.jsxs(g,{type:"modal",children:[e.jsx(i,{variant:"flat",color:"primary",children:e.jsx(a,{message:"Create token"})}),e.jsx(Y,{})]})}function W({token:s}){const t=G();return e.jsxs(g,{type:"modal",onClose:o=>{o&&t.mutate({id:s.id},{onSuccess:()=>j.invalidateQueries({queryKey:["users"]})})},children:[e.jsx(i,{size:"xs",variant:"outline",color:"danger",className:"ml-auto flex-shrink-0",children:e.jsx(a,{message:"Delete"})}),e.jsx(H,{isDanger:!0,title:e.jsx(a,{message:"Delete token?"}),body:e.jsx(a,{message:"This token will be deleted immediately and permanently. Once deleted, it can no longer be used to make API requests."}),confirm:e.jsx(a,{message:"Delete"})})]})}export{oe as A};
