import{j as e,p as f,aQ as T,L as D,r as c,aO as P,m as v,A as U,T as n,a_ as B,E as L,cf as A,cg as O,bZ as _,z as E,aj as K,as as R,P as q,al as V,am as H,an as Q,ap as W,aq as $,B as u,aR as b,ac as G,G as J,az as w,q as I,ak as X,av as S,b7 as Z,i as Y,s as ee,t as se,k as te,b3 as ae,aw as ne,ax as ie}from"./client-DtfdVV77.js";import{g as y,A as oe}from"./main-BGmGAxtx.js";import{u as x,r as le,F as re}from"./file-upload-provider-B4w-VsYu.js";import{F as z}from"./file-type-icon-CNIGAaMG.js";import{p as N}from"./pretty-bytes-bO14ePu9.js";import{u as F}from"./shallow-BH2jDtXM.js";import{S as ce}from"./select-D9niWe2H.js";import{U as de,C as me}from"./UploadFile-DLR78p2b.js";import{u as xe}from"./use-droppable-CpvjuNXE.js";import{o as ue}from"./open-upload-window-DE9Q8gNs.js";import{c as pe}from"./index.module-BtHqevI0.js";import{P as ge}from"./PriorityHigh-BG38_UZP.js";import{S as je}from"./Sync-8LVFzqtm.js";import{a as he}from"./knowledge-preview-layout-BaDxG9wp.js";import{u as C}from"./useSuspenseQuery-Bmt2-NKx.js";import{A as fe}from"./Add-B1HfWgJf.js";import{D as ve}from"./Delete-DWP7kvj0.js";import{V as ye}from"./Visibility-BlnkCOzB.js";function we({icon:s,title:t,description:a,children:l,action:o}){return e.jsxs("div",{className:"rounded-panel border p-20",children:[e.jsxs("div",{className:"items-center gap-16 md:flex",children:[e.jsxs("div",{className:"flex items-center gap-12 max-md:mb-20",children:[s,e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold leading-6",children:t}),e.jsx("p",{className:"text-sm text-muted",children:a})]})]}),e.jsx("div",{className:"ml-auto",children:o})]}),e.jsx("div",{className:"mt-8 divide-y empty:hidden",children:l})]})}function k({name:s,icon:t,to:a,description:l,actions:o,scanPending:r,scanFailed:d}){return e.jsxs("div",{className:"flex items-center gap-18 py-16 text-sm",children:[e.jsx("div",{className:f("ml-6 flex size-24 items-center justify-center rounded-full",r?"bg-chip text-primary":d?"bg-danger-lighter text-main":"bg-positive-lighter text-main"),children:r?e.jsx(je,{size:"xs",className:"animate-spin"}):d?e.jsx(ge,{size:"xs"}):e.jsx(T,{size:"xs"})}),e.jsxs(D,{className:f("mr-auto flex flex-1 items-center gap-6 hover:underline",r&&"pointer-events-none"),to:a,children:[c.cloneElement(t,{size:"xs"}),e.jsx("div",{children:s})]}),l&&e.jsx("div",{className:"flex-1 text-muted",children:l}),e.jsx("div",{className:"ml-auto min-w-100 flex-shrink-0",children:o})]})}const De=c.memo(({file:s,className:t,style:a})=>e.jsxs("div",{className:f("flex items-center gap-14",t),style:a,children:[e.jsx("div",{className:"shrink-0 rounded border p-8",children:e.jsx(z,{className:"h-22 w-22",mime:s.mime})}),e.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[e.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:s.name})}),e.jsx(Ne,{file:s})]}),e.jsx("div",{className:"mr-10",children:e.jsx(be,{file:s})})]}),P);function Ne({file:s}){const t=x(F(d=>d.fileUploads.get(s.id))),a=(t==null?void 0:t.bytesUploaded)||0,l=c.useMemo(()=>N(s.size),[s]),o=c.useMemo(()=>N(a),[a]);let r;return(t==null?void 0:t.status)==="completed"?r=e.jsx(n,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?r=e.jsx(n,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?r=e.jsx(n,{message:"Upload failed"}):(t==null?void 0:t.status)==="pending"?r=e.jsx(c.Fragment,{children:l}):r=e.jsx(n,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:o,totalBytes:l}}),e.jsx("div",{className:"text-xs text-muted",children:r})}function be({file:s}){const t=x(F(m=>m.fileUploads.get(s.id))),a=x(m=>m.abortUpload),l=(t==null?void 0:t.percentage)||0,o=t==null?void 0:t.status,r=t==null?void 0:t.errorMessage,[d,g]=c.useState(!1),j=e.jsx(K,{size:"xs",iconSize:"sm",onClick:()=>{a(s.id)},children:e.jsx(R,{})}),h=e.jsx(q,{"aria-label":"Upload progress",size:"w-24 h-24",value:l,isIndeterminate:l===100,trackWidth:3});let i;if(o==="failed"){const m=r||v("This file could not be uploaded");i=e.jsx(p,{children:e.jsx(B,{variant:"danger",label:e.jsx(A,{value:m}),children:e.jsx(L,{className:"text-danger",size:"md"})})})}else o==="aborted"?i=e.jsx(p,{children:e.jsx(O,{className:"text-warning",size:"md"})}):o==="completed"?i=e.jsx(p,{children:e.jsx(_,{size:"md",className:"text-positive"})}):o==="pending"?i=e.jsx(p,{children:j}):i=e.jsx(p,{onPointerEnter:m=>{m.pointerType==="mouse"&&g(!0)},onPointerLeave:m=>{m.pointerType==="mouse"&&g(!1)},children:d?j:h});return e.jsx(U,{children:i})}function p({children:s,...t}){return e.jsx(E.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:s})}function Ie(){const{close:s}=V(),[t,a]=c.useState("en"),l=x(i=>i.uploadMultiple),o=x(i=>i.fileUploads.size>0),r=x(i=>i.startUpload),d=x(i=>i.uploadStarted),g=x(i=>i.pendingUploadsCount>0),j=pe(()=>{I.invalidateQueries({queryKey:y.knowledge.invalidateKey})},1e3,{leading:!0,trailing:!0}),h=i=>{l(i,{uploadType:b.aiDocuments,onSuccess:()=>j(),metadata:{documentLanguage:t}},{startUpload:!1})};return e.jsxs(H,{size:"xl",children:[e.jsx(Q,{showDivider:!0,disableDismissButton:d,children:e.jsx(n,{message:"Upload documents"})}),e.jsx(W,{children:o?e.jsx(Se,{onFilesSelected:i=>h(i)}):e.jsx(ze,{onFilesSelected:i=>h(i)})}),e.jsxs($,{dividerTop:!0,startAction:e.jsx(Fe,{value:t,onChange:a}),children:[e.jsx(u,{onClick:()=>s(),disabled:d,className:"max-md:hidden",children:e.jsx(n,{message:"Close"})}),e.jsx(u,{variant:"flat",color:"primary",disabled:d||!g,onClick:()=>r(),children:e.jsx(n,{message:"Upload"})})]})]})}function Se({onFilesSelected:s}){const t=x(a=>[...a.fileUploads.values()]);return e.jsxs("div",{children:[e.jsx("div",{className:"mb-14 space-y-14",children:t.map(a=>e.jsx(De,{file:a.file},a.file.id))}),e.jsx(u,{variant:"outline",className:"mt-10",size:"xs",onClick:async()=>{const a=await M();s(a)},children:e.jsx(n,{message:"Add more files"})})]})}function ze({onFilesSelected:s}){const t=c.useRef(null),[a,l]=c.useState(!1),{droppableProps:o}=xe({id:"ingestDocuments",ref:t,types:["nativeFile"],onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},onDrop:async r=>{if(r.type==="nativeFile"){const d=await r.getData();s(d)}}});return e.jsxs("div",{className:"items-center gap-24 md:flex",children:[e.jsxs("div",{ref:t,...o,className:f("relative flex min-h-160 flex-1 flex-col items-center justify-center rounded-panel border border-dashed",a&&"border-primary"),children:[e.jsx(u,{startIcon:e.jsx(de,{}),variant:"flat",color:"primary",onClick:async()=>{const r=await M();s(r)},children:e.jsx(n,{message:"Select files"})}),e.jsx("div",{className:"mt-8 text-sm text-muted",children:e.jsx(n,{message:"Or drag and drop here"})})]}),e.jsx("div",{className:"flex-1 max-md:mt-24",children:e.jsxs("ul",{className:"list-inside list-disc leading-6 text-muted",children:[e.jsx("li",{children:e.jsx(n,{message:"Provide files and we'll fetch all the text data inside."})}),e.jsx("li",{children:e.jsx(n,{message:"Only text based formats are supported, including: PDF, Office, PowerPoint, Excel, CSV, JSON, XML"})}),e.jsx("li",{children:e.jsx(n,{message:"Maximum file size is 40MB."})})]})})]})}async function M(){const s=le({uploadType:b.aiDocuments});return await ue({multiple:!0,types:s==null?void 0:s.allowedFileTypes})}function Fe({value:s,onChange:t}){const{trans:a}=G(),l=J();return e.jsx(ce,{required:!0,selectedValue:s,onSelectionChange:o=>t(o),name:"language",selectionMode:"single",showSearchField:!0,placeholder:a(v("Select language")),searchPlaceholder:a(v("Search...")),size:"xs",floatingWidth:"auto",children:l.map(o=>e.jsx(w,{value:o.code,children:o.name},o.code))})}const Ce=c.forwardRef((s,t)=>e.jsxs(X,{...s,ref:t,children:[e.jsx("path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4"}),e.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),e.jsx("path",{d:"M2 15h10"}),e.jsx("path",{d:"m9 18 3-3-3-3"})]}));function Ye(){const{data:s}=C(y.knowledge.index());return e.jsxs(we,{icon:e.jsx(Ce,{size:"md"}),title:e.jsx(D,{to:"../knowledge/documents",className:"hover:underline",children:e.jsx(n,{message:"Documents"})}),description:e.jsx(n,{message:"Import content from documents that are not available publicly"}),action:e.jsxs(S,{type:"modal",children:[e.jsx(u,{startIcon:e.jsx(fe,{}),variant:"outline",size:"xs",children:e.jsx(n,{message:"Upload documents"})}),e.jsx(re,{children:e.jsx(Ie,{})})]}),children:[s==null?void 0:s.documents.items.map(t=>e.jsx(Me,{document:t},t.id)),e.jsx(ke,{})]})}function ke(){const{data:s}=C(y.knowledge.index());if(!(s!=null&&s.documents.more.count))return null;const t="../knowledge/documents";return e.jsx(k,{scanPending:s.documents.more.ingesting,to:t,name:e.jsx(n,{message:"And :count more documents",values:{count:s.documents.more.count}}),icon:e.jsx(me,{size:"sm"}),actions:e.jsx(u,{variant:"outline",size:"xs",className:"min-w-96",elementType:D,to:t,children:e.jsx(n,{message:"View all"})})})}function Me({document:s}){return s.file_entry?e.jsx(k,{name:s.file_entry.name,to:`../knowledge/documents/${s.id}`,icon:e.jsx(z,{type:s.file_entry.type,mime:s.file_entry.mime,color:"text-main"}),scanPending:s.scan_pending,scanFailed:s.scan_failed,description:e.jsx(c.Fragment,{children:s.scan_pending?e.jsx(n,{message:"Scanning..."}):s.scan_failed?e.jsx("span",{className:"text-danger",children:e.jsx(n,{message:"Could not extract content from this document"})}):e.jsx(n,{message:"Imported: :date",values:{date:e.jsx(Z,{date:s.updated_at})}})}),actions:e.jsx(Te,{document:s})}):null}function Te({document:s}){const[t,a]=c.useState(!1),l=ae();return e.jsxs(c.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(u,{variant:"outline",size:"xs",endIcon:e.jsx(oe,{}),children:e.jsx(n,{message:"Manage"})}),e.jsxs(ie,{children:[!(s.scan_failed&&!s.scan_pending)&&e.jsx(w,{value:"view",startIcon:e.jsx(ye,{size:"sm"}),onSelected:()=>{l(`../knowledge/documents/${s.id}`)},children:e.jsx(n,{message:"View content"})}),e.jsx(w,{value:"delete",startIcon:e.jsx(ve,{size:"sm"}),className:"text-danger",onSelected:()=>a(!0),children:e.jsx(n,{message:"Delete document"})})]})]}),t&&e.jsx(S,{type:"modal",isOpen:t,onOpenChange:a,children:e.jsx(Pe,{documentId:s.id})})]})}function Pe({documentId:s}){const t=Ue();return e.jsx(he,{onDelete:()=>t.mutateAsync({documentIds:[s]}),isPending:t.isPending})}function Ue(){return Y({mutationFn:async({documentIds:s})=>te.delete(`lc/ai-agent/documents/${s}`),onSuccess:()=>(se(v("Document deleted")),I.invalidateQueries({queryKey:y.knowledge.invalidateKey})),onError:s=>ee(s)})}export{Ye as D,we as K,k as a,Ue as u};
