import{f as d,j as s,T as a,aG as h,r as f,F as u,aj as _,h as b,a as k,ac as v,i as w,q as y,l as j,t as F,m as S,k as N,b8 as C,d as A,aP as H,X as z,b4 as E,az as D,Q as O}from"./client-DtfdVV77.js";import{a as p,D as $}from"./crupdate-resource-layout-BeHzVG7e.js";import{F as g}from"./radio-DP8xYP6t.js";import{F as R}from"./radio-group-C_T7jNq6.js";import{F as T}from"./checkbox-CS7ILu6P.js";import{D as I}from"./Delete-DWP7kvj0.js";import{o as P}from"./custom-menu-Dvq-fOnC.js";import{U as Q}from"./user-role-section-CUPdKGg7.js";import{F as G}from"./form-chip-field-C7l8nGPv.js";import"./datatable-page-with-header-layout-xcCtlWaX.js";import"./main-BGmGAxtx.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./chip-list-DHXDGW6X.js";function U(){const{watch:e}=d(),t=e("agent_settings.accepts_conversations")==="workingHours";return s.jsxs(p,{label:s.jsx(a,{message:"Status after login"}),children:[s.jsxs(R,{name:"agent_settings.accepts_conversations",orientation:"vertical",size:"sm",children:[s.jsx(g,{value:"yes",children:s.jsx(a,{message:"Accept conversations"})}),s.jsx(g,{value:"no",children:s.jsx(a,{message:"Don't accept conversations"})}),s.jsx(g,{value:"workingHours",children:s.jsx(a,{message:"Based on working hours"})})]}),t&&s.jsx(W,{})]})}function W(){return s.jsxs("div",{className:"mt-14 space-y-10",children:[s.jsx(m,{index:1,label:s.jsx(a,{message:"Monday"})}),s.jsx(m,{index:2,label:s.jsx(a,{message:"Tuesday"})}),s.jsx(m,{index:3,label:s.jsx(a,{message:"Wendesday"})}),s.jsx(m,{index:4,label:s.jsx(a,{message:"Thursday"})}),s.jsx(m,{index:5,label:s.jsx(a,{message:"Friday"})}),s.jsx(m,{index:6,label:s.jsx(a,{message:"Saturday"})}),s.jsx(m,{index:7,label:s.jsx(a,{message:"Sunday"})})]})}function m({index:e,label:t}){const{setValue:n}=d(),o=h({name:`agent_settings.working_hours.${e}.enable`});return s.jsxs("div",{className:"flex h-50 cursor-pointer items-center rounded-panel border px-16",onClick:()=>{o||n(`agent_settings.working_hours.${e}.enable`,!0)},children:[s.jsx(T,{name:`agent_settings.working_hours.${e}.enable`}),s.jsx("div",{className:"ml-8 mr-auto text-sm",children:t}),o?s.jsxs(f.Fragment,{children:[s.jsx(u,{name:`agent_settings.working_hours.${e}.from`,type:"time",size:"xs"}),s.jsx("div",{className:"mx-12",children:s.jsx(a,{message:"to"})}),s.jsx(u,{name:`agent_settings.working_hours.${e}.to`,type:"time",size:"xs"}),s.jsx(_,{className:"ml-12 text-muted",size:"xs",iconSize:"sm",onClick:()=>{n(`agent_settings.working_hours.${e}.enable`,!1,{shouldDirty:!0})},children:s.jsx(I,{})})]}):s.jsx("div",{className:"text-sm text-muted",children:s.jsx(a,{message:"No schedule"})})]})}function q(e){const t=b(),{agentId:n}=k(),{trans:o}=v();return w({mutationFn:r=>B(n,r),onSuccess:async()=>{await y.invalidateQueries({queryKey:j.agents.invalidateKey}),F(o(S("Updated agent"))),t("../../",{relative:"path"})},onError:r=>P(r,e)})}function B(e,t){var r,l,x;const n={};Object.entries(((r=t.agent_settings)==null?void 0:r.working_hours)??{}).forEach(([i,c])=>{c.enable&&(n[i]={from:c.from,to:c.to})});const o={...t,groups:(l=t.groups)==null?void 0:l.map(i=>i.id),roles:(x=t.roles)==null?void 0:x.map(i=>i.id),agent_settings:{...t.agent_settings,working_hours:Object.keys(n).length?n:null}};return N.put(`helpdesk/agents/${e}`,o).then(i=>i.data)}function ls(){const e=C(),t=A({defaultValues:{name:e.name??"",image:e.image??"",agent_settings:{assignment_limit:e.agent_settings.assignment_limit,accepts_conversations:e.agent_settings.accepts_conversations??"no",working_hours:K(e)},groups:e.groups,roles:e.roles}}),n=q(t);return s.jsxs(H,{onSubmit:o=>{n.mutate(o)},onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx(u,{name:"name",label:s.jsx(a,{message:"Name"}),className:"mb-24"}),s.jsx(u,{name:"agent_settings.assignment_limit",label:s.jsx(a,{message:"Assignment limit"}),type:"number",description:s.jsx(a,{message:"How many conversations agent can handle at the same time."})}),s.jsx(L,{}),s.jsx(Q,{endpoint:"helpdesk/normalized-models/roles"}),s.jsx(U,{}),s.jsx($,{isLoading:n.isPending})]})}function L(){const{data:e}=z(j.groups.normalizedList),{hasPermission:t}=E();return s.jsx(p,{label:s.jsx(a,{message:"Groups"}),margin:"my-44",children:s.jsx(G,{className:"mb-30",name:"groups",suggestions:e==null?void 0:e.groups,alwaysShowAvatar:!0,readOnly:!t("users.update"),children:n=>s.jsx(D,{value:n.id,startIcon:s.jsx(O,{label:n.name}),children:n.name},n.id)})})}function K(e){var n,o;const t={};for(let r=1;r<=7;r++){const l=!!((n=e.agent_settings.working_hours)!=null&&n[r]);t[r]=((o=e.agent_settings.working_hours)==null?void 0:o[r])??{from:"09:00",to:"17:00"},t[r].enable=l}return t}export{ls as Component};
