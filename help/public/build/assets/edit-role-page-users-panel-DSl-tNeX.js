import{al as P,r as h,ac as R,j as e,am as A,an as N,T as t,ap as k,aa as q,m as j,ab as F,aq as Q,B as g,p as E,Q as K,i as b,s as S,t as D,k as I,av as C,q as T,o as M,D as z}from"./client-DtfdVV77.js";import{k as V,c as f,R as L}from"./main-BGmGAxtx.js";import{G as $}from"./global-loading-progress-DVC8NxPo.js";import{a as B}from"./name-with-avatar-D8NZSkGp.js";import{D as H}from"./data-table-header-CdCZHch7.js";import{D as G}from"./data-table-pagination-footer-B4yyc06A.js";import{u as _}from"./use-datatable-search-params-dzq5X78n.js";import{D as U}from"./data-table-emty-state-message-DsPxSC6g.js";import{c as W}from"./datatable-page-with-header-layout-xcCtlWaX.js";import{D as J}from"./paginated-resources-DUi9UwyN.js";import{u as O}from"./use-datatable-query-v3pOHYke.js";import{u as X}from"./use-required-params-BhaT_-q3.js";import{T as Y}from"./table-CynOKbaN.js";import{I as Z,S as ee}from"./custom-menu-Dvq-fOnC.js";import{t as v}from"./team-DYmDDGxN.js";import{u as se}from"./useSuspenseQuery-Bmt2-NKx.js";import{C as re}from"./confirmation-dialog-BzXs9ksK.js";import"./skeleton-D178v0-U.js";import"./FilterAlt-CRhKT7zD.js";import"./select-filter-panel-hjhYEdoY.js";import"./form-chip-field-C7l8nGPv.js";import"./chip-list-DHXDGW6X.js";import"./filter-operator-names-BbrFb9i0.js";import"./select-D9niWe2H.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./normalized-model-field-D3Ui05eZ.js";import"./Edit-BaEHOLuK.js";import"./accordion-Dmxnze9z.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-CS7ILu6P.js";import"./CheckBoxOutlineBlank-DU0ZdwTb.js";import"./use-toggle-dashboard-left-sidebar-DxaOS7gK.js";import"./toggle-left-sidebar-icon-j-5uTef5.js";import"./ArrowDownward-DHtsWMyK.js";import"./useEffectEvent-Offmqu_S.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./useGlobalListeners-BGMP113F.js";function ae({multiple:s=!1,endpoint:r="normalized-models/user"}){var y;const{close:a}=P(),[o,p]=h.useState(""),{trans:m}=R(),c=V(r,{query:o,perPage:14}),u=((y=c.data)==null?void 0:y.results)||[],[i,n]=h.useState([]),w=e.jsx(Z,{className:"pt-20",size:"sm",title:e.jsx(t,{message:"No matching users"}),description:e.jsx(t,{message:"Try another search query"}),image:e.jsx(ee,{src:v})});return e.jsxs(A,{size:"lg",children:[e.jsx(N,{children:s?e.jsx(t,{message:"Select users"}):e.jsx(t,{message:"Select a user"})}),e.jsxs(k,{children:[e.jsx(q,{autoFocus:!0,size:"sm",className:"mb-20",startAdornment:e.jsx(F,{}),placeholder:m(j("Search for user by name or email")),value:o,onChange:d=>{p(d.target.value)}}),!c.isLoading&&!u.length&&w,e.jsx("div",{className:"grid grid-cols-2 gap-x-10",children:u.map(d=>e.jsx(te,{isSelected:!!i.find(l=>l.id===d.id),user:d,onSelected:l=>{s?i.find(x=>x.id===l.id)?n(i.filter(x=>x.id!==l.id)):n([...i,l]):a(l)}},d.id))})]}),s&&e.jsxs(Q,{children:[e.jsx(g,{onClick:()=>a(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>a(i),disabled:!i.length,children:e.jsx(t,{message:"Select"})})]})]})}function te({user:s,onSelected:r,isSelected:a}){return e.jsxs("div",{className:E("flex items-center gap-10 rounded-panel border-1 p-10 outline-none ring-offset-4 focus-visible:ring",a?"border-primary bg-primary/5 hover:bg-primary/10":"border-transparent hover:bg-hover"),role:"button",tabIndex:0,onClick:()=>{r(s)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),r(s))},children:[e.jsx(K,{src:s.image,label:s.name??"Visitor",circle:!0}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.name??e.jsx(t,{message:"Visitor"})}),e.jsx("div",{className:"overflow-hidden text-ellipsis text-muted",children:s.description})]})]},s.id)}function oe(s){return b({mutationFn:({userIds:r})=>ie({userIds:r,roleId:s.id}),onSuccess:(r,a)=>{D(j("Assigned [one 1 user|other :count users] to :role",{values:{count:a.userIds.length,role:s.name}}))},onError:r=>S(r)})}function ie({roleId:s,userIds:r}){return I.post(`roles/${s}/add-users`,{userIds:r}).then(a=>a.data)}function ne(s){return b({mutationFn:({userIds:r})=>le({userIds:r,roleId:s.id}),onSuccess:(r,a)=>{D(j("Removed [one 1 user|other :count users] from “{role}“",{values:{count:a.userIds.length,role:s.name}}))},onError:r=>S(r)})}function le({roleId:s,userIds:r}){return I.post(`roles/${s}/remove-users`,{userIds:r}).then(a=>a.data)}const me=[{key:"email",allowsSorting:!0,sortingKey:"email",visibleInMode:"all",header:()=>e.jsx(t,{message:"User"}),body:s=>e.jsx(B,{image:s.image,label:s.name??e.jsx(t,{message:"Visitor"}),description:s.email,alwaysShowAvatar:!0,avatarLabel:"Visitor"})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(t,{message:"Assigned at"}),body:s=>e.jsx(z,{date:s.created_at})}];function Oe(){const{roleId:s}=X(["roleId"]),r=se(f.roles.get(s));return r.data.role.guests||r.data.role.type==="workspace"?e.jsx("div",{className:"pb-10 pt-30",children:e.jsx(U,{image:v,title:e.jsx(t,{message:"Users can't be assigned to this role"})})}):e.jsx(de,{role:r.data.role})}function de({role:s}){const[r,a]=h.useState([]),{searchParams:o,sortDescriptor:p,mergeIntoSearchParams:m,setSearchQuery:c,isFiltering:u}=_(L),i=O({...f.users.index({...o,roleId:`${s.id}`}),placeholderData:M});return e.jsxs("div",{children:[e.jsx($,{query:i}),e.jsx(H,{searchValue:o.query,onSearchChange:c,actions:e.jsx(ce,{role:s}),selectedItems:r,selectedActions:e.jsx(ue,{role:s,selectedIds:r})}),e.jsxs(W,{children:[e.jsx(Y,{columns:me,data:i.items,sortDescriptor:p,onSortChange:m,enableSelection:!0,selectedRows:r,onSelectionChange:n=>a(n)}),i.isEmpty?e.jsx(U,{image:v,isFiltering:u,title:e.jsx(t,{message:"No users have been assigned to this role yet"}),filteringTitle:e.jsx(t,{message:"No matching users"})}):null,e.jsx(G,{query:i,onPageChange:n=>m({page:n}),onPerPageChange:n=>m({perPage:n})})]})]})}function ce({role:s}){const r=oe(s);return e.jsxs(C,{type:"modal",onClose:a=>{a&&r.mutate({userIds:[a.id]},{onSuccess:()=>{T.invalidateQueries({queryKey:J("users",{roleId:`${s.id}`})})}})},children:[e.jsx(g,{variant:"flat",color:"primary",disabled:r.isPending,children:e.jsx(t,{message:"Assign user"})}),e.jsx(ae,{})]})}function ue({role:s,selectedIds:r}){const a=ne(s);return e.jsxs(C,{type:"modal",onClose:o=>{o&&a.mutate({userIds:r},{onSuccess:()=>{T.invalidateQueries({queryKey:f.users.invalidateKey})}})},children:[e.jsx(g,{variant:"flat",color:"danger",disabled:a.isPending,children:e.jsx(t,{message:"Remove users"})}),e.jsx(re,{title:e.jsx(t,{message:"Remove users from role?"}),body:e.jsx(t,{message:"This will permanently remove the users from this role."}),confirm:e.jsx(t,{message:"Remove"}),isDanger:!0})]})}export{Oe as Component,ue as RemoveUsersAction};
