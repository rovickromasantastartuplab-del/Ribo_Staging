import{j as r,p as d,B as I,T as z,ac as T,aj as C,r as R,as as S}from"./client-DtfdVV77.js";import{c as k}from"./css-props-from-bg-config-CgypBlFP.js";import{a as _}from"./use-compact-agents-BbfR0BTv.js";import{a as B}from"./agent-avatar-zWPNofnN.js";import{S as E}from"./Send-BbKd9OAw.js";const M="[&_h1]:text-lg [&_h1]:font-bold [&_h2]:font-semibold [&_h3]:font-medium [&_p:not(:has(br))]:mb-12";function A({item:e}){return r.jsx("div",{className:d("px-14",M),dangerouslySetInnerHTML:{__html:e.value.text}})}function U(e){const s=[],a=[],n=[];return e.forEach(t=>{t.name==="messageInput"?a.push(t):s.push(t)}),[...n,...s,...a]}function F({index:e,item:s}){const{agents:a}=_(),n=s.value.agentId,t=a.find(l=>l.id===n)??a[0];return t?r.jsxs("div",{className:d("flex items-center gap-10 px-14",e===0&&"pb-4 pt-14"),children:[r.jsx(B,{user:t,size:"sm"}),r.jsx("div",{className:"text-sm",children:t.name})]}):null}function L({campaign:e,item:s,onAction:a,actionIsPending:n}){return r.jsx("div",{className:"grow",children:r.jsx(I,{variant:s.value.variant||void 0,color:s.value.color??"primary",size:s.value.size??"sm",className:"w-full",disabled:n,onClick:()=>{!a||!s.value.action||!e||a(e,s,s.value.action,s.value.actionValue)},children:r.jsx(z,{message:s.value.label??"Text"})})})}function P({item:e,onAction:s,campaign:a}){return r.jsx("iframe",{src:e.value.url,className:"w-full border-none bg-none p-0",sandbox:"allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-storage-access-by-user-activation"})}function q({item:e,onAction:s,campaign:a}){const n=e.value.destinationUrl&&s;return r.jsx("img",{src:e.value.url,alt:"",style:{aspectRatio:e.value.width&&e.value.height?e.value.width/e.value.height:void 0},className:d(e.value.size==="stretch"&&"w-full object-cover",e.value.size==="original"&&"auto w-max object-contain",n&&"cursor-pointer",D(e)),onClick:n&&a&&s?()=>s(a,e,"openUrl",e.value.destinationUrl):void 0})}function D(e){switch(e.value.radius){case"none":return"rounded-none";case"sm":return"rounded-sm";case"md":return"rounded-md";case"circle":return"rounded-full"}}function N({campaign:e,item:s,onAction:a,actionIsPending:n}){const{trans:t}=T();return r.jsxs("form",{className:"relative isolate h-42",onSubmit:l=>{l.preventDefault(),l.stopPropagation(),e&&a&&a(e,s,"sendMessage",l.currentTarget[0].value)},children:[r.jsx("input",{className:d("block h-full w-full appearance-none rounded-panel border border-transparent bg-transparent px-14 pr-46 text-left text-sm transition-shadow",!n&&"border-primary focus:border-primary/60 focus:outline-none focus:ring focus:ring-primary/focus",n&&"cursor-not-allowed text-disabled"),placeholder:t({message:s.value.placeholder||""})}),r.jsx(C,{className:"absolute right-0 top-0 z-10 mr-6 mt-6 text-muted",size:"xs",iconSize:"sm",type:"submit",children:r.jsx(E,{})})]})}const w=["image","embed","agent"];function O({campaign:e,onAction:s,actionIsPending:a,onClose:n}){var m,f,x,g,h,v,b;const[t,l]=R.useMemo(()=>{let u=null;return[U(e.content).reduce((o,i)=>{if(i.name==="button"){const j=o[o.length-1];Array.isArray(j)?j.push(i):o.push([i])}else{if(i.name==="messageInput")return u=i,o;o.push(i)}return o},[]),u]},[e.content]);if(!t.length)return null;const p={...k((m=e.appearance)==null?void 0:m.bgConfig),fontFamily:(x=(f=e.appearance)==null?void 0:f.fontConfig)==null?void 0:x.family};return(g=e.appearance)!=null&&g.textColor&&(p.color=e.appearance.textColor),r.jsxs("div",{className:"group flex h-full w-full flex-col",children:[n&&r.jsx(C,{color:"chip",variant:"flat",className:"invisible mb-4 ml-auto group-hover:visible",radius:"rounded-full",size:"2xs",iconSize:"xs",equalWidth:!0,onClick:()=>n==null?void 0:n(),children:r.jsx(S,{})}),r.jsx("div",{style:p,className:d("w-full flex-auto space-y-12 overflow-hidden rounded-panel bg-elevated shadow-widget-popup",H((h=e.appearance)==null?void 0:h.textSize),!w.includes((v=t.at(0))==null?void 0:v.name)&&"pt-12",!w.includes((b=t.at(-1))==null?void 0:b.name)&&"pb-12"),children:t.map((u,c)=>Array.isArray(u)?r.jsx("div",{className:"flex flex-wrap items-center justify-center gap-6 px-14",children:u.map(o=>r.jsx(y,{item:o,onAction:s,actionIsPending:a,index:c,campaign:"id"in e?e:void 0},o.id))},c):r.jsx(y,{item:u,onAction:s,actionIsPending:a,index:c,campaign:"id"in e?e:void 0},u.id))}),l&&r.jsx("div",{className:"mt-14 flex-shrink-0 rounded-panel bg shadow-widget-popup",style:p,children:r.jsx(N,{item:l,onAction:s,actionIsPending:a,index:t.length,campaign:"id"in e?e:void 0})})]})}function y(e){const s=e;switch(e.item.name){case"button":return r.jsx(L,{...s});case"text":return r.jsx(A,{...s});case"image":return r.jsx(q,{...s});case"embed":return r.jsx(P,{...s});case"messageInput":return r.jsx(N,{...s});case"agent":return r.jsx(F,{...s})}}function H(e){switch(e??"md"){case"sm":return"text-sm";case"lg":return"text-lg";default:return"text-base"}}export{O as C,M as c,U as s};
