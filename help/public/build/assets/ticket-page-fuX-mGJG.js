import{r as c,q as y,l as g,j as t,x as u,h as b,T as i,b4 as w,i as k,s as C,k as I,t as R,m as S,aR as B,B as N,av as A,aQ as L}from"./client-DtfdVV77.js";import{h as M}from"./custom-menu-Dvq-fOnC.js";import{H as D}from"./hc-search-bar-Bi18-IXo.js";import{C as E,F as P,R as q,a as Q,U as H,I as U}from"./upload-attachments-button-y2TJXF13.js";import{F as K}from"./formatted-message-body-N3ejX0-V.js";import{u as z,L as V,a as _,M as $,b as G}from"./use-conversation-messages-DKpi0rOi.js";import{M as J}from"./reverse-conversation-messages-D589XwPM.js";import{h as f}from"./helpdesk-channel-CQKSbeKg.js";import{e as O}from"./online-status-circle-Nb704kAK.js";import{T as W}from"./ticket-details-CyooeAxc.js";import{R as X}from"./emoji-picker-button-Cm_kBrZ5.js";import Y from"./reply-composer-container-Bpt_j9aL.js";import{F as Z,R as tt}from"./floating-toolbar-CKeOgwrE.js";import{N as et}from"./main-BGmGAxtx.js";import{u as x}from"./use-required-params-BhaT_-q3.js";import{S as st}from"./section-helper-BcMoHesA.js";import{F as ot}from"./file-upload-provider-B4w-VsYu.js";import{u as rt}from"./useSuspenseQuery-Bmt2-NKx.js";import{B as at,a as d}from"./breadcrumb-CaNBY_Ut.js";import{C as it}from"./confirmation-dialog-BzXs9ksK.js";import"./article-link-kVBPNf7I.js";import"./slugify-string-CGmMIJK7.js";import"./article-path-CQn_uF_m.js";import"./category-link-DefoIvjU.js";import"./use-keybind-DRgaCeX0.js";import"./useGlobalListeners-BGMP113F.js";import"./is-ctrl-key-pressed-CaS-AM38.js";import"./combobox-CFh39yI7.js";import"./combobox-end-adornment-CWQ4Xgal.js";import"./image-button-DUyjpM_5.js";import"./image-up-hBoBC5iJ.js";import"./use-active-upload-CGOT7g6R.js";import"./open-upload-window-DE9Q8gNs.js";import"./uploaded-file-DOXWsty7.js";import"./shallow-BH2jDtXM.js";import"./tiptap-editor-context-CeN7pXcf.js";import"./file-preview-dialog-BrkfZ0k6.js";import"./file-thumbnail-DlIWt16b.js";import"./file-type-icon-CNIGAaMG.js";import"./ChevronLeft-IHWIEiah.js";import"./ChevronRight-C5OrfRtB.js";import"./FileDownload-DjsfzW8M.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CFeeP1Iy.js";import"./pretty-bytes-bO14ePu9.js";import"./progress-bar-BMzArYUQ.js";import"./use-upload-attachments-CRLnN22_.js";import"./use-droppable-CpvjuNXE.js";import"./paperclip-1tb_aUIl.js";import"./AlternateEmail-JgjChVK8.js";import"./ViewDay-0YjWc40J.js";import"./message-author-name-Bk8LQSvQ.js";import"./customer-avatar-ul3Z1Bt5.js";import"./attribute-renderer-C6KvryoI.js";import"./ThumbDown-BB-li-Gi.js";import"./ThumbUp-CTCneb2T.js";import"./useInfiniteQuery-CRfa2XSO.js";import"./infiniteQueryObserver-JD1WF4OJ.js";import"./infinite-scroll-sentinel-Dx_uGmDU.js";import"./isScrollable-BSEN4xi5.js";import"./agent-avatar-zWPNofnN.js";import"./use-compact-agents-BbfR0BTv.js";import"./HourglassEmpty-T3VQEBmq.js";import"./conversation-priority-CeA32zhn.js";import"./variable-extension-BUEoymSX.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DZmli5NZ.js";import"./select-D9niWe2H.js";import"./Event-DDJ424UR.js";import"./ToggleOn-DbVFGpQu.js";import"./TextFields-CM1xUWDR.js";import"./Add-B1HfWgJf.js";import"./index-uUjpwT6n.js";import"./with-selector-DPNnjGhI.js";import"./DataObject-3cjjRxnv.js";import"./index-BCY5Ekxi.js";import"./core-l5OAWFa0.js";import"./index-Y7xUBCAo.js";import"./list-buttons-CxLBLRRO.js";import"./FormatListNumbered-BcAdH5KM.js";import"./Link-WHWZ7SV6.js";import"./useEffectEvent-Offmqu_S.js";import"./MoreHoriz-Df3_bV9s.js";function nt({data:e}){var a;const s=z(e.conversation.id),o=((a=s.data)==null?void 0:a.items)??[];return c.useEffect(()=>O().listen({channel:f.name,events:[f.events.conversations.newMessage],type:"presence",callback:m=>{m.conversations.every(n=>n.id===e.conversation.id)&&y.invalidateQueries({queryKey:g.conversations.messages(e.conversation.id).queryKey})}}),[e.conversation.id]),t.jsx(J,{query:s,children:o.map((m,n)=>t.jsx(mt,{message:m,messages:o,index:n},m.id))})}function mt({message:e,messages:s,index:o}){switch(e.type){case"event":case"collectDetailsForm":return t.jsx(_,{message:e,messages:s,index:o,variant:"customer"},e.id);case"submittedFormData":return t.jsx(V,{message:e,messages:s,index:o});case"cards":return null;default:return t.jsx(ct,{message:e,messages:s,index:o})}}function ct({message:e,messages:s,index:o}){var a;return t.jsxs(c.Fragment,{children:[t.jsxs($,{message:e,children:[t.jsx(K,{addParagraphSpacing:e.author==="bot",className:"mr-24 text-sm",children:e.body}),!!((a=e.attachments)!=null&&a.length)&&t.jsx(pt,{attachments:e.attachments})]}),t.jsx(G,{messages:s,index:o})]})}function pt({attachments:e}){return t.jsx(E,{className:"mt-20 w-max",children:e.map((s,o)=>t.jsx(P,{attachments:e,index:o},s.id))})}function _e(){const{conversationId:e}=x(["conversationId"]),s=rt(M.customerConversations.get(e));return t.jsxs("div",{className:"flex h-screen flex-col",children:[t.jsx(et,{menuPosition:"header",className:"customer-ticket-navbar flex-shrink-0",children:t.jsx(D,{})}),t.jsxs("div",{className:"customer-ticket-page-layout container mx-auto flex-auto overflow-y-auto px-12 pb-48 md:gap-x-64 md:px-24",children:[t.jsx(lt,{}),t.jsx(dt,{data:s.data}),t.jsx(ut,{data:s.data}),s.data.conversation.status_category!==u.locked&&t.jsx(ot,{children:t.jsx(xt,{})}),t.jsx(W,{data:s.data,className:"customer-ticket-details w-350 flex-shrink-0 self-start rounded-panel border px-20 py-10 max-lg:hidden"})]})]})}function lt(){const e=b();return t.jsxs(at,{size:"sm",className:"customer-ticket-header mb-34 mt-34 flex-shrink-0 md:mb-48",children:[t.jsx(d,{onSelected:()=>e("/hc"),children:t.jsx(i,{message:"Help center"})}),t.jsx(d,{onSelected:()=>e("/hc/tickets"),children:t.jsx(i,{message:"Tickets"})}),t.jsx(d,{children:t.jsx(i,{message:"Current ticket"})})]})}function dt({data:e}){return t.jsxs("div",{className:"customer-ticket-title mb-44 flex items-center justify-between gap-12",children:[t.jsx("h1",{className:"text-2xl",children:e.conversation.subject}),e.conversation.status_category>u.closed&&t.jsx(ht,{})]})}function ut({data:e}){return t.jsxs("main",{className:"customer-ticket-content compact-scrollbar mb-24 overflow-y-auto pr-12 stable-scrollbar",children:[e.conversation.status_category===u.locked&&t.jsx(st,{className:"mb-44 text-center",color:"danger",title:t.jsx(i,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),t.jsx(nt,{data:e})]})}function xt(){const{hasPermission:e}=w(),{conversationId:s}=x(["conversationId"]),o=!e("files.create"),[a,m]=c.useState(""),[n,p]=c.useState([]),h=c.useRef(null),v=k({mutationFn:()=>I.post(`helpdesk/customer/conversations/${s}/messages`,{body:a,attachments:n==null?void 0:n.map(r=>r.id)}).then(r=>r.data),onSuccess:async()=>{var r;(r=h.current)==null||r.clearContents(),p([]),await y.invalidateQueries({queryKey:g.conversations.invalidateKey}),R(S("Reply submitted"))},onError:r=>C(r)}),j=r=>{p(l=>[...l,r])},F=r=>{p(l=>l.filter(T=>T.id!==r.id))};return t.jsxs("form",{className:"customer-ticket-editor",onSubmit:r=>{r.preventDefault(),v.mutate()},children:[t.jsx("div",{className:"mb-6 text-sm font-semibold",children:t.jsx(i,{message:"Add to conversation"})}),t.jsx(q,{isDisabled:o,onUpload:j,children:t.jsxs(Y,{onChange:m,submitToClosestForm:!0,autoFocus:!1,ref:h,children:[t.jsx(Z,{}),t.jsx(Q,{className:"mb-2 mt-24 px-12",attachments:n,onRemove:F}),t.jsxs(tt,{submitButtons:t.jsx(N,{type:"submit",variant:"flat",color:"primary",size:"xs",disabled:v.isPending||!a.length,className:"mr-4",children:t.jsx(i,{message:"Send reply"})}),children:[t.jsx(X,{}),!o&&t.jsx(H,{onUpload:j}),!o&&t.jsx(U,{uploadType:B.conversationImages})]})]})})]})}function ht(){const{conversationId:e}=x(["conversationId"]),s=k({mutationFn:()=>I.post(`helpdesk/customer/conversations/${e}/mark-as-solved`),onSuccess:()=>{R(S("Ticket marked as solved")),o("/hc/tickets")},onError:a=>C(a)}),o=b();return t.jsxs(A,{type:"modal",children:[t.jsx(N,{size:"xs",variant:"outline",startIcon:t.jsx(L,{}),children:t.jsx(i,{message:"Mark as solved"})}),({close:a})=>t.jsx(it,{onConfirm:()=>{s.mutate(void 0,{onSuccess:()=>a()})},isLoading:s.isPending,title:t.jsx(i,{message:"Mark as solved"}),body:t.jsx(i,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:t.jsx(i,{message:"Confirm"})})]})}export{_e as Component};
