import{r as c,cj as I,j as u,p as D,u as y,m as n,b as R,Q as T,bk as F,bb as k,bl as B,b7 as H,ck as L,D as j,cl as P,T as Y,aO as _}from"./client-DtfdVV77.js";import{I as G}from"./infinite-scroll-sentinel-Dx_uGmDU.js";import{$ as N}from"./isScrollable-BSEN4xi5.js";import{A as Q,a as V}from"./agent-avatar-zWPNofnN.js";import{a as O}from"./customer-avatar-ul3Z1Bt5.js";var U=J;function J(e,t,r){var s=null,l=null,a=function(){s&&(clearTimeout(s),l=null,s=null)},i=function(){var d=l;a(),d&&d()},f=function(){if(!t)return e.apply(this,arguments);var d=this,g=arguments,h=r&&!s;if(a(),l=function(){e.apply(d,g)},s=setTimeout(function(){if(s=null,!h){var m=l;return l=null,m()}},t),h)return l()};return f.cancel=a,f.flush=i,f}function re({children:e,className:t,query:r,messageIds:s}){var w;const l=c.useRef(null),a=c.useRef(null),i=c.useRef(0),f=c.useRef(null),d=c.useRef(!1),g=c.useRef(null),h=s||((w=r==null?void 0:r.data)==null?void 0:w.items.map(o=>o.id).join(",")),m=c.useCallback(({amount:o,force:b}={})=>{a.current&&(d.current&&!b||a.current.scrollTo({top:o??a.current.scrollHeight}))},[]);return c.useEffect(()=>{if(!h)return;const o=h.split(",");if(!g.current){g.current=o;return}const b=g.current.at(-1),p=g.current.length;if(b!==o.at(-1))m({force:!0});else{if(p>=o.length)return;const A=a.current,v=l.current,x=f.current;if(!A||!v||!x)return;const C=v.getBoundingClientRect().height;x!==C&&(m({amount:C-x,force:!0}),f.current=C)}g.current=o},[h]),c.useEffect(()=>{if(!a.current)return;const o=a.current,b=U(()=>{o.scrollTop<i.current&&(d.current=!0),o.scrollTop-(o.scrollHeight-o.clientHeight)>=-10&&(d.current=!1),i.current=o.scrollTop},10),p=()=>{document.visibilityState==="visible"&&m()};o.addEventListener("scroll",b),document.addEventListener("visibilitychange",p);const A=I(l,({height:v})=>{Math.ceil(f.current??0)!==Math.ceil(v)&&(f.current=v,m())});return()=>{o.removeEventListener("scroll",b),document.removeEventListener("visibilitychange",p),A()}},[m]),u.jsxs(c.Fragment,{children:[r?u.jsx(G,{query:r,className:D(r.hasNextPage&&"h-64 py-16"),loaderMarginTop:"m-0"}):null,u.jsx("div",{ref:o=>{o&&(a.current=M(o),l.current=o,a.current&&(i.current=a.current.scrollTop))},className:t,id:"feed-container",children:e})]})}function M(e){return e?N(e)?e:M(e.parentElement):null}function ne({message:e,variant:t}){var a,i;const{lc:r}=y(),s=((a=r==null?void 0:r.timeout)==null?void 0:a.inactive)??10,l=((i=r==null?void 0:r.timeout)==null?void 0:i.archive)??15;if(e.type==="collectDetailsForm")return n("Collect details form shown");if(e.type==="cards")return n("Cards shown");if(e.type!=="event")return null;switch(e.body.name){case"closed.inactivity":return t==="agent"?n("Automatically closed - :minutes min inactivity",{values:{minutes:l}}):n("The chat has been closed due to long user inactivity.");case"closed.byTrigger":return t==="agent"?n("Closed by trigger"):n("Chat was closed by one of our agents");case"closed.byAgent":return t==="agent"?n("Closed by :agent",{values:{agent:e.body.closedBy}}):n(":agent has closed the chat",{values:{agent:e.body.closedBy}});case"closed.byCustomer":return t==="agent"?n("Closed by customer",{values:{customer:e.body.closedBy}}):n("You have closed the conversation",{values:{customer:e.body.closedBy}});case"closed.byAiAgent":return t==="agent"?n("Closed by AI agent"):n("Chat closed");case"customer.enteredEmail":return t==="agent"?n("Customer entered ':email' as email",{values:{email:e.body.email}}):n("You have entered ':email' as email",{values:{email:e.body.email}});case"customer.idle":return t==="agent"?n("Idle - :minutes min inactivity",{values:{minutes:s}}):null;case"customer.leftChat":return t==="agent"?n("Closed - customer left the chat"):n("You have left the chat");case"agent.leftChat":return t==="customer"?e.body.newAgent?n("You have been transferred to: :agent",{values:{agent:e.body.newAgent}}):null:e.body.oldAgent&&e.body.newAgent?n("Chat assigned to :newAgent because :oldAgent left the chat",{values:{newAgent:e.body.newAgent,oldAgent:e.body.oldAgent}}):e.body.oldAgent?n(":agent left the chat",{values:{agent:e.body.oldAgent}}):null;case"agent.changed":return e.body.newAgent?t==="agent"?n("Reassigned to :agent",{values:{agent:e.body.newAgent}}):n(":agent has joined the conversation",{values:{agent:e.body.newAgent}}):n("Conversation reassigned");case"customer.addedToQueue":return t==="agent"?n("Added to queue"):n("Waiting for an agent");case"group.changed":return e.body.newGroup?n("Transfered to :name group",{values:{name:e.body.newGroup}}):n("Group changed");default:return null}}function S(){const e=R(),{chatWidget:t}=y(),r=t==null?void 0:t.logo_dark;return e&&(t!=null&&t.logo_light)?t==null?void 0:t.logo_light:r}function K({className:e,size:t}){const{aiAgent:r}=y(),s=S(),l=(r==null?void 0:r.name)||"AI assistant",a=(r==null?void 0:r.image)||s;return u.jsx(T,{circle:!1,fallback:"initials",label:l,labelForBackground:l,src:a,className:e,size:t})}function X({size:e}){const{branding:t}=y(),r=S();return u.jsx(T,{src:r||(t==null?void 0:t.logo_light_mobile),label:(t==null?void 0:t.site_name)??"Support",fallback:"initials",circle:!1,size:e})}function oe({message:e,size:t,agentWithIndicator:r}){return e.author==="bot"?u.jsx(K,{size:t}):e.author==="user"?e.user?u.jsx(O,{user:e.user,size:t}):null:e.author==="system"?u.jsx(X,{size:t}):e.user?r?u.jsx(Q,{user:e.user,size:t,showAwayIcon:!0}):u.jsx(V,{user:e.user,size:t}):null}const Z={hour:"numeric",minute:"numeric"},E={month:"short",day:"numeric",hour:"numeric",minute:"numeric"},z={...E,year:"numeric"},se=c.memo(({date:e})=>{const t=F(),r=k();if(!e)return null;try{const s=B(e,t);return s.hour===r.hour?u.jsx(H,{date:e,style:"narrow"}):L(s,t)?u.jsx(j,{date:e,options:Z}):P(s,r)?u.jsx(c.Fragment,{children:u.jsx(j,{date:e,options:E})}):u.jsx(c.Fragment,{children:u.jsx(j,{date:e,options:z})})}catch{return u.jsx(Y,{message:"Invalid date"})}},_);function ae(e){const t=[...e.pages].reverse();return{...e,pages:t,pageParams:[...e.pageParams].reverse(),items:t.flatMap(r=>r.pagination.data)||[]}}export{K as A,re as M,se as a,oe as b,S as c,ae as r,ne as u};
