import{j as e,r as p,p as u,av as v,aj as x,as as j,z as c,C as b,T as f,A as w,a_ as F,aR as z}from"./client-DtfdVV77.js";import{I as D}from"./image-button-DUyjpM_5.js";import{F as I}from"./file-preview-dialog-BrkfZ0k6.js";import{F as A}from"./file-type-icon-CNIGAaMG.js";import{F as P}from"./file-thumbnail-DlIWt16b.js";import{F as U}from"./formatted-bytes-CFeeP1Iy.js";import{P as C}from"./progress-bar-BMzArYUQ.js";import{u as d,r as T}from"./file-upload-provider-B4w-VsYu.js";import{u as y}from"./use-upload-attachments-CRLnN22_.js";import{u as N}from"./use-droppable-CpvjuNXE.js";import{P as R}from"./paperclip-1tb_aUIl.js";import{o as S}from"./open-upload-window-DE9Q8gNs.js";function X({uploadType:a}){return e.jsx(D,{size:"xs",iconSize:"sm",uploadType:a})}const k={policy:"conversationFileEntry"};function B({children:a,className:o}){return e.jsx(P.Provider,{value:k,children:e.jsx("div",{className:u("flex flex-wrap items-center gap-8",o),children:a})})}const h=p.forwardRef(({name:a,mime:o,size:r,onRemove:s,progress:n,...t},i)=>e.jsxs("div",{ref:i,className:u("relative flex min-h-30 w-max flex-shrink-0 items-center gap-6 rounded-lg border pl-8 transition-opacity",i&&"cursor-pointer hover:bg-hover",!s&&"pr-8"),...t,children:[e.jsx(A,{mime:o,size:"xs"}),e.jsx("div",{className:"max-w-140 overflow-hidden overflow-ellipsis whitespace-nowrap text-xs font-bold text-muted",children:a}),r?e.jsxs("div",{className:"text-xs text-muted",children:["(",e.jsx(U,{bytes:r}),")"]}):null,s?e.jsx(x,{onClick:l=>{l.preventDefault(),l.stopPropagation(),s()},size:"xs",className:"text-muted",children:e.jsx(j,{})}):null,n?e.jsx(C,{value:n,className:"absolute bottom-0 left-0 w-full",size:"xs"}):null]}));function E({attachments:a,index:o,onRemove:r}){const s=a[o];return e.jsxs(v,{type:"modal",children:[e.jsx(h,{name:s.name,mime:s.mime,size:s.file_size,onRemove:r}),e.jsx(I,{entries:a,defaultActiveIndex:o})]})}function Y({className:a,attachments:o,onRemove:r}){const s=d(t=>t.fileUploads),n=d(t=>t.abortUpload);return!o.length&&!s.size?null:e.jsxs(B,{className:a,children:[o.map((t,i)=>e.jsx(E,{attachments:o,index:i,onRemove:()=>r(t)},t.id)),[...s.entries()].filter(([t,i])=>i.status==="inProgress").map(([t,i])=>e.jsx(h,{size:i.file.size,name:i.file.name,mime:i.file.mime,progress:i.percentage,onRemove:()=>n(t)},t))]})}function Z({isDisabled:a,onUpload:o,children:r}){const s=y({onSuccess:m=>{o(m)}}),[n,t]=p.useState(!1),i=p.useRef(null),{droppableProps:l}=N({id:"reply-composer-drop-target",ref:i,types:["nativeFile"],disabled:a,onDragEnter:()=>t(!0),onDragLeave:()=>t(!1),onDrop:async m=>{m.type==="nativeFile"&&s(await m.getData())}}),g=e.jsx(c.div,{...b,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full rounded-panel border-2 border-dashed border-primary bg-primary-light/30",children:e.jsx(c.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:e.jsx(f,{message:"Drop files to attach them to this reply."})})},"dragTargetMask");return e.jsxs("div",{className:"relative",...l,ref:i,children:[e.jsx(w,{children:n?g:null}),r]})}function $({onUpload:a}){const o=y({onSuccess:r=>{a(r)}});return e.jsx(F,{label:e.jsx(f,{message:"Upload attachments"}),children:e.jsx(x,{size:"xs",iconSize:"sm",onClick:async()=>{const r=T({uploadType:z.conversationAttachments}),s=await S({multiple:!0,types:r==null?void 0:r.allowedFileTypes});s.length&&o(s)},children:e.jsx(R,{})})})}export{B as C,E as F,X as I,Z as R,$ as U,Y as a};
