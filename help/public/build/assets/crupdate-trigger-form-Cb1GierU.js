import{j as e,f as h,be as $,T as j,B as F,p as y,az as g,aj as V,as as O,Q as S,F as b,ac as k,r as B,m as W,ay as H}from"./client-DtfdVV77.js";import{u as L}from"./use-tags-BV0JpuMa.js";import{F as P}from"./form-chip-field-C7l8nGPv.js";import{F as f}from"./select-D9niWe2H.js";import{A as N}from"./Add-B1HfWgJf.js";import{p as Q}from"./permission-selector-CRaW7I2O.js";import{g as q}from"./group-array-by-5IjT7qk6.js";function E({children:s}){return e.jsx("h2",{className:"border-b pb-8 text-sm font-bold",children:s})}function D({config:s}){var n;const{getValues:o}=h(),{fields:a,remove:c,append:t,update:d}=$({name:"actions"}),{getFieldState:m}=h(),r=(n=m("actions").error)==null?void 0:n.message,p=()=>{const l=o("actions"),u=Object.entries(s.actions),i=u.find(_=>!(l!=null&&l.some(A=>A.name===_[0])))??u[0],[x,v]=i;t({name:x,value:C(v,s)})};return e.jsxs("div",{children:[e.jsx(E,{children:e.jsx(j,{message:"Perform these actions"})}),a.map((l,u)=>e.jsx(K,{index:u,config:s,onRemove:i=>c(i),onResetValues:i=>{const x=s.actions[i];d(u,{name:i,value:C(x,s)})},className:u===0?"mt-12":void 0},l.id)),e.jsx(F,{variant:"outline",startIcon:e.jsx(N,{}),onClick:()=>p(),size:"xs",className:"mt-12",children:e.jsx(j,{message:"Add action"})}),r&&e.jsx("p",{className:"mt-12 text-sm text-danger",children:r})]})}function K({index:s,onRemove:o,config:a,className:c,onResetValues:t}){var p;const{watch:d}=h(),m=d(`actions.${s}.name`),r=m?a.actions[m]:null;return e.jsxs("div",{className:y("mb-12 flex gap-12 border-b pb-12",c),children:[e.jsxs("div",{className:"flex-auto space-y-12 md:max-w-400",children:[e.jsx(f,{name:`actions.${s}.name`,selectionMode:"single",onItemSelected:n=>{t(n)},children:Object.entries(a.actions).map(([n,l])=>e.jsx(g,{value:n,children:l.label},n))}),(p=r==null?void 0:r.input_config)==null?void 0:p.inputs.map((n,l)=>e.jsx(G,{actionIndex:s,input:n,config:a},l))]}),e.jsx(V,{color:"danger",onClick:()=>o(s),children:e.jsx(O,{})})]})}function G({input:s,actionIndex:o,config:a}){const c=`actions.${o}.value.${s.name}`;if(s.name==="tags_to_add"||s.name==="tags_to_remove")return e.jsx(J,{name:c});switch(s.type){case"text":case"textarea":return e.jsx(b,{name:c,label:s.display_name,placeholder:s.placeholder,inputElementType:s.type==="textarea"?"textarea":void 0,rows:s.type==="textarea"?3:void 0});case"select":return e.jsx(f,{name:c,selectionMode:"single",children:a.selectOptions[s.select_options].map(t=>e.jsx(g,{description:t.description,value:t.value,capitalizeFirst:!0,startIcon:t.image?e.jsx(S,{src:t.image}):null,children:t.name},t.value))})}}function J({name:s}){const{trans:o}=k(),[a,c]=B.useState(""),{data:t,isFetching:d}=L({query:a,perPage:8,notType:"status"});return e.jsx(P,{name:s,isAsync:!0,isLoading:d,inputValue:a,onInputValueChange:c,valueKey:"id",placeholder:o(W("Enter tag name...")),allowCustomValue:!0,children:t==null?void 0:t.pagination.data.map(m=>e.jsx(g,{value:m.name,textLabel:m.name,capitalizeFirst:!0,children:m.name},m.id))})}function C(s,o){var c;const a={};return(c=s.input_config)==null||c.inputs.forEach(t=>{if(t.type==="select"){const d=Array.isArray(t.select_options)?t.select_options:o.selectOptions[t.select_options];a[t.name]=d[0].value}else a[t.name]=t.default_value??""}),a}function U({config:s}){var n,l,u;const{getValues:o}=h(),{fields:a,remove:c,append:t}=$({name:"conditions"}),{getFieldState:d}=h(),m=(n=d("conditions").error)==null?void 0:n.message,r=q(a,i=>i.match_type,{map:(i,x)=>({...i,index:x})}),p=i=>{const x=o("conditions"),v=Object.entries(s.conditions),_=v.find(R=>!(x!=null&&x.some(z=>z.name===R[0])))??v[0],[A,w]=_;t({name:A,value:M(w,s),operator:w.operators[0],match_type:i})};return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"mb-44",children:[e.jsx(T,{type:"all"}),(l=r.all)==null?void 0:l.map(i=>e.jsx(I,{index:i.index,config:s,onRemove:()=>c(i.index),className:"mt-12"},i.id)),e.jsx(F,{variant:"outline",startIcon:e.jsx(N,{}),onClick:()=>p("all"),size:"xs",className:"mt-12",children:e.jsx(j,{message:"Add condition"})}),m&&e.jsx("p",{className:"mt-12 text-sm text-danger",children:m})]}),e.jsxs("div",{children:[e.jsx(T,{type:"any"}),(u=r.any)==null?void 0:u.map(i=>e.jsx(I,{index:i.index,config:s,onRemove:()=>c(i.index),className:"mt-12"},i.id)),e.jsx(F,{variant:"outline",startIcon:e.jsx(N,{}),onClick:()=>p("any"),size:"xs",className:"mt-12",children:e.jsx(j,{message:"Add condition"})})]})]})}function I({index:s,onRemove:o,config:a,className:c}){const{setValue:t,watch:d}=h(),m=d(`conditions.${s}.name`),r=m?a.conditions[m]:null;if(!r)return null;const p=n=>{t(`conditions.${s}.operator`,n.operators[0]),t(`conditions.${s}.value`,M(n,a))};return e.jsxs("div",{className:y("grid grid-cols-[repeat(auto-fit,minmax(42px,1fr))] gap-12",c),children:[e.jsx(f,{name:`conditions.${s}.name`,selectionMode:"single",minWidth:"min-w-224",onSelectionChange:n=>p(a.conditions[n]),children:Object.entries(a.groupedConditions).map(([n,l])=>e.jsx(H,{label:Q(n),children:Object.entries(l).map(([u,i])=>e.jsx(g,{value:u,children:i.label},u))},n))}),e.jsx(f,{name:`conditions.${s}.operator`,selectionMode:"single",minWidth:"min-w-200",className:y((r==null?void 0:r.operators.length)===1&&"hidden"),onItemSelected:n=>{(n==="changed"||n==="not_changed")&&t(`conditions.${s}.value`,"")},children:r==null?void 0:r.operators.map(n=>{const l=a.operators[n];return e.jsx(g,{value:n,children:l.label},n)})}),e.jsx(X,{index:s,selectedCondition:r,config:a}),e.jsx(V,{color:"danger",onClick:()=>o(s),children:e.jsx(O,{})})]})}function X({index:s,selectedCondition:o,config:a}){var d;const{watch:c}=h(),t=c(`conditions.${s}.operator`);if(((d=o.input_config)==null?void 0:d.type)==="select"){const m=Array.isArray(o.input_config.select_options)?o.input_config.select_options:a.selectOptions[o.input_config.select_options];return e.jsx(f,{name:`conditions.${s}.value`,selectionMode:"single",floatingWidth:"auto",showSearchField:!0,className:y((t==="changed"||t==="not_changed")&&"hidden"),children:m.map(({name:r,value:p,description:n,image:l})=>e.jsx(g,{value:p,description:n,startIcon:l?e.jsx(S,{src:l,circle:!0}):null,children:e.jsx(j,{message:r})},p))})}return e.jsx(b,{name:`conditions.${s}.value`,type:o.input_config.input_type??"text"})}function T({type:s}){return e.jsx(E,{children:e.jsx(j,{message:s==="all"?"Meet <b>all</b> the following conditions":"Meet <b>any</b> of the following conditions",values:{b:o=>e.jsx("span",{className:"mx-4 rounded border bg-alt px-6 py-2 font-bold",children:o})}})})}function M(s,o){return s.input_config.type==="select"?(Array.isArray(s.input_config.select_options)?s.input_config.select_options:o.selectOptions[s.input_config.select_options])[0].value:""}function oe({config:s}){return e.jsxs("div",{children:[e.jsx(b,{name:"name",label:e.jsx(j,{message:"Name"}),className:"mb-24"}),e.jsx(b,{name:"description",label:e.jsx(j,{message:"Description"}),inputElementType:"textarea",rows:3,className:"mb-44"}),e.jsx(U,{config:s}),e.jsx(D,{config:s})]})}export{oe as C};
