import{r as m,j as e,av as F,a_ as h,aj as x,T as i,X as c,m as g,f as j,aG as y,l as u,B as p,F as I,az as f,Q as T,b4 as v,aR as S,ac as A,i as R,q as B,t as D,k as P}from"./client-DtfdVV77.js";import{A as E}from"./variable-extension-BUEoymSX.js";import{A as k}from"./action-menu-dialog-CHnxQQPs.js";import{g as z}from"./article-link-kVBPNf7I.js";import{A as L}from"./article-path-CQn_uF_m.js";import{h as N,o as Q}from"./custom-menu-Dvq-fOnC.js";import{i as w}from"./list-buttons-CxLBLRRO.js";import{u as b}from"./tiptap-editor-context-CeN7pXcf.js";import{L as V}from"./library-icon-h4d3s9Ef.js";import{u as q}from"./use-keybind-DRgaCeX0.js";import{R as U}from"./emoji-picker-button-Cm_kBrZ5.js";import{E as M}from"./enhance-text-with-ai-button-D92qi4Qc.js";import{R as O,U as G,I as K,a as W}from"./upload-attachments-button-y2TJXF13.js";import _ from"./reply-composer-container-Bpt_j9aL.js";import{F as $,R as X}from"./floating-toolbar-CKeOgwrE.js";import{F as H}from"./file-upload-provider-B4w-VsYu.js";import{B as J}from"./button-group-DAgYjIi8.js";import{F as Y}from"./form-chip-field-C7l8nGPv.js";import{F as Z}from"./select-D9niWe2H.js";import{D as ee}from"./DataObject-3cjjRxnv.js";import{G as se,P as te}from"./main-BGmGAxtx.js";import{P as ae}from"./PushPin-DEBAXBqb.js";function re({categoryIds:a}){const s=b(),[n,t]=m.useState(!1);return q("window","ctrl+/",()=>{t(!0)},{allowedInputSelector:".ProseMirror"}),e.jsxs(F,{type:"modal",isOpen:n,onOpenChange:t,underlayTransparent:!0,underlayBlurred:!1,returnFocusToTrigger:!1,onClose:r=>{r&&s&&w(s,{href:z(r),target:"_blank",text:r.title})},children:[e.jsx(h,{label:e.jsx(i,{message:"Insert article (ctrl + /)"}),children:e.jsx(x,{size:"xs",iconSize:"sm",children:e.jsx(V,{})})}),e.jsx(ne,{categoryIds:a})]})}function ne({categoryIds:a}){var r;const[s,n]=m.useState(""),t=c({...N.articles.search({query:s,categoryIds:a}),enabled:!0});return e.jsx(k,{placeholder:g("Search help center..."),query:s,onQueryChange:n,isLoading:t.isLoading,isFetching:t.isFetching,data:((r=t.data)==null?void 0:r.pagination.data)||[],itemData:o=>({title:o.title,description:"path"in o&&o.path&&e.jsx(L,{path:o.path,noLinks:!0})})})}function ke(){var t;const a=j(),s=y({control:a.control,name:"shared"}),n=c(u.groups.normalizedList);return e.jsxs(H,{children:[e.jsxs("div",{className:"mb-24",children:[e.jsxs(J,{size:"xs",value:s,onChange:r=>{a.setValue("shared",r,{shouldDirty:!0})},children:[e.jsx(p,{variant:"outline",startIcon:e.jsx(se,{}),value:!0,children:e.jsx(i,{message:"Shared"})}),e.jsx(p,{variant:"outline",startIcon:e.jsx(te,{}),value:!1,children:e.jsx(i,{message:"Private"})})]}),e.jsx("div",{className:"mt-10 text-xs text-muted",children:e.jsx(i,{message:"Shared replies will be visible to all agents, not just you."})})]}),e.jsx(I,{autoFocus:!0,className:"mb-24",label:e.jsx(i,{message:"Name"}),name:"name"}),e.jsx(Z,{className:"mb-24",selectionMode:"single",name:"groupId",label:e.jsx(i,{message:"Group"}),description:e.jsx(i,{message:"Only agents in this group will see this reply."}),children:(t=n.data)==null?void 0:t.groups.map(r=>e.jsx(f,{value:r.id,startIcon:e.jsx(T,{label:r.name,size:"sm"}),children:r.name},r.id))}),e.jsx(oe,{}),e.jsx(ie,{})]})}function oe(){var d;const{hasPermission:a}=v(),s=!a("files.create"),n=j(),t=(d=n.formState.errors.body)==null?void 0:d.message,r=y({control:n.control,name:"attachments"})||[],o=l=>{n.setValue("attachments",[l,...r],{shouldDirty:!0})};return e.jsxs(m.Fragment,{children:[e.jsx("div",{className:"mb-4 text-sm",children:e.jsx(i,{message:"Reply text"})}),e.jsx(O,{isDisabled:s,onUpload:o,children:e.jsxs(_,{initialContent:n.getValues("body")||"",submitToClosestForm:!0,onChange:l=>{n.setValue("body",l,{shouldDirty:!0})},children:[e.jsx($,{}),e.jsxs(X,{children:[e.jsx(re,{}),e.jsx(U,{}),!s&&e.jsx(G,{onUpload:o}),!s&&e.jsx(K,{uploadType:S.conversationImages}),e.jsx(M,{}),e.jsx(le,{})]})]})}),t&&e.jsx("div",{className:"mt-12 text-xs text-danger",children:t}),e.jsx(W,{attachments:r,onRemove:l=>{n.setValue("attachments",r.filter(C=>C.id!==l.id),{shouldDirty:!0})},className:"mt-12"})]})}function ie(){const{trans:a}=A(),[s,n]=m.useState(""),{data:t,isFetching:r}=c(u.tags.index(s));return e.jsx(Y,{name:"tags",className:"mt-24",label:e.jsx(i,{message:"Tags"}),isAsync:!0,isLoading:r,inputValue:s,onInputValueChange:n,suggestions:t==null?void 0:t.pagination.data,placeholder:a({message:"Type tag name..."}),description:e.jsx(i,{message:"Selected tags will be automatically assigned to conversation."}),children:t==null?void 0:t.pagination.data.map(o=>e.jsx(f,{value:o.id,startIcon:e.jsx(ae,{size:"xs"}),children:o.name},o.id))})}function le(){const a=b();return e.jsx(E,{showReadonly:!0,floatingWidth:"auto",offset:6,onChange:s=>{s&&a&&a.commands.insertContent(`<be-variable name="${s.name}" type="${s.type}"/>`)},children:e.jsx(h,{label:e.jsx(i,{message:"Add attribute"}),children:e.jsx(x,{size:"sm",iconSize:"sm",children:e.jsx(ee,{})})})})}function ze(a){return R({mutationFn:s=>me(s),onSuccess:async()=>{await B.invalidateQueries({queryKey:u.cannedReplies.invalidateKey}),D(g("Saved reply created"))},onError:s=>Q(s,a)})}function me(a){return P.post("helpdesk/canned-replies",ce(a)).then(s=>s.data)}function ce(a){var s,n;return{...a,tags:(s=a.tags)==null?void 0:s.map(t=>t.name),attachments:(n=a.attachments)==null?void 0:n.map(t=>t.id)}}export{re as A,ke as C,ce as p,ze as u};
