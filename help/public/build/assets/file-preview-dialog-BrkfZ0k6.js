import{Y as D,r as l,j as e,p as w,B as L,T as p,ac as b,P as T,k as U,bi as A,aA as R,aj as j,aJ as S,A as z,z as B,C as _,aK as $,as as M,am as K,al as O}from"./client-DtfdVV77.js";import{u as x,a as V}from"./file-thumbnail-DlIWt16b.js";import{C as H}from"./ChevronLeft-IHWIEiah.js";import{C as J}from"./ChevronRight-C5OrfRtB.js";import{F as k}from"./FileDownload-DjsfzW8M.js";import{d as P}from"./download-file-from-url-hJ3EUwXO.js";const N=D.createContext(null);function m({message:s,className:t,allowDownload:a}){const{entries:i,activeIndex:n}=l.useContext(N),d=i[n],o=s||e.jsx(p,{message:"No file preview available"}),{downloadUrl:r}=x(d);return e.jsxs("div",{className:w(t,"w-[calc(100%-40px)] max-w-400 rounded-panel bg-elevated p-40 text-center shadow"),children:[e.jsx("div",{className:"text-lg",children:o}),a&&e.jsx("div",{className:"mt-20 block text-center",children:e.jsx(L,{variant:"flat",color:"primary",onClick:()=>{r&&P(r)},children:e.jsx(p,{message:"Download"})})})]})}function Q(s){const{entry:t,className:a}=s,{previewUrl:i}=x(t),n=l.useRef(null),[d,o]=l.useState(!1);return l.useEffect(()=>{var r;o(!((r=n.current)!=null&&r.canPlayType(t.mime)))},[t]),d||!i?e.jsx(m,{...s}):e.jsx("audio",{className:a,ref:n,controls:!0,controlsList:"nodownload noremoteplayback",autoPlay:!0,children:e.jsx("source",{src:i,type:t.mime,onError:()=>{o(!0)}})})}function W(s){const{entry:t,className:a}=s,{trans:i}=b(),{previewUrl:n}=x(t);return n?e.jsx("img",{className:w(a,"shadow"),src:n,alt:i({message:"Preview for :name",values:{name:t.name}})}):e.jsx(m,{...s})}function Y(s){const{entry:t,className:a}=s,{trans:i}=b(),{previewUrl:n}=x(t);return n?e.jsx("iframe",{title:i({message:"Preview for :name",values:{name:t.name}}),className:w(a,"h-full w-full"),src:`${n}#toolbar=0`}):e.jsx(m,{...s})}const q=5242880;function G(s){const{entry:t,className:a}=s,{trans:i}=b(),[n,d]=l.useState(!1),[o,r]=l.useState(!0),[c,u]=l.useState(!1),[f,h]=l.useState(null),{previewUrl:v}=x(t);return l.useEffect(()=>{t&&(v?t.file_size>=q?(d(!0),r(!1)):X(v).then(g=>{h(g.data)}).catch(()=>{u(!0)}).finally(()=>{r(!1)}):u(!0))},[t,v]),o?e.jsx(T,{isIndeterminate:!0,"aria-label":i({message:"Loading file contents"})}):n?e.jsx(m,{...s,message:e.jsx(p,{message:"This file is too large to preview."})}):c?e.jsx(m,{...s,message:e.jsx(p,{message:"There was an issue previewing this file"})}):e.jsx("pre",{className:w("h-full w-full overflow-y-auto whitespace-pre-wrap break-words rounded-panel bg-elevated p-20 text-sm",a),children:e.jsx("div",{className:"container mx-auto",children:`${f}`})})}function X(s){return U.get(s,{responseType:"text",withCredentials:!1,headers:{Accept:"text/plain"}})}function Z(s){const{entry:t,className:a}=s,{previewUrl:i}=x(t),n=l.useRef(null),[d,o]=l.useState(!1);return l.useEffect(()=>{var r;o(!((r=n.current)!=null&&r.canPlayType(t.mime)))},[t]),d||!i?e.jsx(m,{...s}):e.jsx("video",{className:a,ref:n,controls:!0,controlsList:"nodownload noremoteplayback",playsInline:!0,autoPlay:!0,children:e.jsx("source",{src:i,type:t.mime,onError:()=>{o(!0)}})})}function y(s){const{entry:t,className:a}=s,{trans:i}=b(),n=l.useRef(null),[d,o]=l.useState(!1),r=l.useRef(null),[c,u]=l.useState(!1),{previewUrl:f}=x(t);return l.useEffect(()=>{f?t.file_size&&t.file_size>25e6?o(!0):n.current&&(n.current.onload=()=>{clearTimeout(r.current),u(!1)},ee(f,t).then(h=>{n.current&&(n.current.src=h)}),r.current=setTimeout(()=>{o(!0)},5e3)):o(!0)},[t,f]),d?e.jsx(m,{...s}):e.jsxs("div",{className:w(a,"h-full w-full"),children:[c&&e.jsx(T,{}),e.jsx("iframe",{ref:n,title:i({message:"Preview for :name",values:{name:t.name}}),className:w("h-full w-full",c&&"hidden")})]})}async function ee(s,t){const a=new URL(s);if(!a.searchParams.has("shareable_link")){const{data:i}=await U.post(`file-entries/${t.id}/add-preview-token`);a.searchParams.append("preview_token",i.preview_token)}return se(a)}function se(s){return`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(s.toString())}`}const E={text:G,video:Z,audio:Q,image:W,pdf:Y,spreadsheet:y,powerPoint:y,word:y,"text/rtf":m};function te(s){const t=s==null?void 0:s.mime,a=s==null?void 0:s.type;return E[t]||E[a]||m}function ne({entries:s,onClose:t,showHeader:a=!0,className:i,headerActionsLeft:n,allowDownload:d=!0,...o}){const r=A("(max-width: 1024px)"),[c,u]=R(o.activeIndex,o.defaultActiveIndex||0,o.onActiveIndexChange),f=s[c],h=l.useMemo(()=>({entries:s,activeIndex:c}),[s,c]),v=te(f);if(!f)return t==null||t(),null;const g=s.length-1>c,I=()=>{u(c+1)},C=c>0,F=()=>{u(c-1)};return e.jsxs(N.Provider,{value:h,children:[a&&e.jsx(ae,{actionsLeft:n,isMobile:r,onClose:t,onNext:g?I:void 0,onPrevious:C?F:void 0,allowDownload:d}),e.jsxs("div",{className:w("relative flex-auto overflow-hidden",i),children:[r&&e.jsx(j,{size:"lg",className:"absolute left-0 top-1/2 z-10 -translate-y-1/2 transform text-muted",disabled:!C,onClick:F,children:e.jsx(S,{})}),e.jsx(z,{initial:!1,children:e.jsx(B.div,{className:"absolute inset-0 flex items-center justify-center",..._,children:e.jsx(v,{className:"max-h-[calc(100%-30px)]",entry:f,allowDownload:d})},f.id)}),r&&e.jsx(j,{size:"lg",className:"absolute right-0 top-1/2 z-10 -translate-y-1/2 transform text-muted",disabled:!g,onClick:I,children:e.jsx($,{})})]})]})}function ae({onNext:s,onPrevious:t,onClose:a,isMobile:i,actionsLeft:n,allowDownload:d}){const{entries:o,activeIndex:r}=l.useContext(N),c=o[r],{downloadUrl:u}=x(c),v=i?e.jsx(j,{onClick:()=>{u&&P(u)},children:e.jsx(k,{})}):e.jsx(L,{startIcon:e.jsx(k,{}),variant:"text",onClick:()=>{u&&P(u)},children:e.jsx(p,{message:"Download"})});return e.jsxs("div",{className:"flex min-h-50 flex-shrink-0 items-center justify-between gap-20 border-b bg-elevated px-10 text-sm text-muted",children:[e.jsxs("div",{className:"flex w-1/3 items-center justify-start gap-4",children:[n,d?v:void 0]}),e.jsxs("div",{className:"flex w-1/3 flex-nowrap items-center justify-center gap-10 text-main",children:[e.jsx(V,{file:c,iconClassName:"w-16 h-16",showImage:!1}),e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:c.name})]}),e.jsxs("div",{className:"flex w-1/3 items-center justify-end gap-10 whitespace-nowrap",children:[!i&&e.jsxs(l.Fragment,{children:[e.jsx(j,{disabled:!t,onClick:t,children:e.jsx(H,{})}),e.jsx("div",{children:r+1}),e.jsx("div",{children:"/"}),e.jsx("div",{children:o.length}),e.jsx(j,{disabled:!s,onClick:s,children:e.jsx(J,{})}),e.jsx("div",{className:"mx-20 h-24 w-1 bg-divider"})]}),e.jsx(j,{radius:"rounded-none",onClick:a,children:e.jsx(M,{})})]})]})}function fe(s){return e.jsx(K,{size:"fullscreenTakeover",background:"bg-alt",className:"flex flex-col",children:e.jsx(ie,{...s})})}function ie(s){const{close:t}=O();return e.jsx(ne,{onClose:t,...s})}export{fe as F,ne as a};
