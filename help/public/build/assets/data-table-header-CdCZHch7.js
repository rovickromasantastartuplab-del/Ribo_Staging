import{aL as B,r as x,al as b,j as t,am as A,an as D,T as y,ap as I,B as k,d as P,aP as S,p as N,b1 as h,g as T,av as w,aj as E,A as z,ac as M,aa as H,ab as K,m as O}from"./client-DtfdVV77.js";import{F as R}from"./FilterAlt-CRhKT7zD.js";import{b as U,a as L,e as W,c as J,d as Q}from"./select-filter-panel-hjhYEdoY.js";import{A as q,a as G}from"./accordion-Dmxnze9z.js";import{C as X}from"./checkbox-CS7ILu6P.js";const g="filters";function Y(e){if(!e)return[];let n=[];try{n=JSON.parse(atob(decodeURIComponent(e))),n.map(a=>(a.valueKey!=null&&(a.value=a.valueKey),a))}catch{}return n}function Z(e,n){return!e||(e=n?e.filter(a=>a.value!=="").map(a=>_(a,n)):e,e=e.filter(a=>!a.isInactive),!e.length)?"":encodeURIComponent(btoa(JSON.stringify(e)))}function _(e,n){var d;const a=n.find(r=>r.key===e.key);if((a==null?void 0:a.control.type)==="select"){const r=(a.control.options||[]).find(i=>i.key===e.value);if(r)return{...e,value:r.value,valueKey:r.key}}return(d=a==null?void 0:a.extraFilters)!=null&&d.length&&(e.extraFilters=a.extraFilters),e}function v(e,n){const[a,d]=B(),r=a.get(g),i=x.useMemo(()=>{if(!e)return[];const o=Y(r);return(n||[]).forEach(l=>{if(!o.find(s=>s.key===l)){const s=e.find(p=>p.key===l);o.push({key:l,value:s.control.defaultValue,operator:s.defaultOperator,isInactive:!0})}}),o.sort((l,s)=>e.findIndex(p=>p.key===l.key)-e.findIndex(p=>p.key===s.key)),o},[r,n,e]),u=x.useCallback(o=>{const l=[...i];return o.forEach(s=>{const p=typeof s=="object"?s.key:s,F=l.findIndex(C=>C.key===p);F>-1&&l.splice(F,1)}),l},[i]),m=x.useCallback(o=>{const l=Z(o,e);l?d(s=>(s.delete("page"),s.delete("perPage"),s.set(g,l),s),{replace:!0}):(a.delete(g),d(a,{replace:!0}))},[e,a,d]),j=x.useCallback(o=>{const s=[...u(o),...o];m(s)},[u,m]),c=x.useCallback(o=>m(u([o])),[u,m]);return{add:j,remove:c,replaceAll:m,decodedFilters:i,encodedFilters:r}}function $({filter:e}){return null}function V({filters:e}){const{decodedFilters:n}=v(e),{formId:a}=b(),[d,r]=x.useState(()=>n.map(m=>m.key)),i=t.jsx(k,{size:"xs",variant:"outline",className:"mr-auto",onClick:()=>{r([])},children:t.jsx(y,{message:"Clear"})}),u=t.jsx(k,{size:"xs",variant:"flat",color:"primary",className:"ml-auto",type:"submit",form:a,children:t.jsx(y,{message:"Apply"})});return t.jsxs(A,{className:"min-w-[300px]",maxWidth:"max-w-400",size:"auto",children:[t.jsx(D,{padding:"px-14 py-10",leftAdornment:i,rightAdornment:u,children:t.jsx(y,{message:"Filter"})}),t.jsx(I,{padding:"p-0",children:t.jsx(ee,{filters:e,expandedFilters:d,setExpandedFilters:r})})]})}function ee({filters:e,expandedFilters:n,setExpandedFilters:a}){const{decodedFilters:d,replaceAll:r}=v(e),i={};e.forEach(c=>{const o=d.find(l=>l.key===c.key);i[c.key]=(o==null?void 0:o.value)!==void 0?o:{value:c.control.defaultValue,operator:c.defaultOperator}});const u=P({defaultValues:i}),{formId:m,close:j}=b();return t.jsx(S,{form:u,id:m,onSubmit:c=>{const o=Object.entries(c).filter(([l,s])=>n.includes(l)&&s!==void 0).map(([l,s])=>({key:l,...s}));r(o),j()},children:t.jsx(q,{size:"md",mode:"multiple",expandedValues:n,onExpandedChange:a,children:e.map(c=>t.jsxs(G,{startIcon:t.jsx(X,{checked:n.includes(c.key)}),value:c.key,label:t.jsx(y,{...c.label}),bodyClassName:"max-h-288 overflow-y-auto compact-scrollbar",children:[c.description&&t.jsx("div",{className:N("text-xs text-muted",c.control.type!==h.BooleanToggle&&"mb-14"),children:t.jsx(y,{...c.description})}),t.jsx(te,{filter:c})]},c.key))})})}function te({filter:e}){switch(e.control.type){case h.Select:return t.jsx(Q,{filter:e});case h.ChipField:return t.jsx(J,{filter:e});case h.DateRangePicker:return t.jsx(W,{filter:e});case h.SelectModel:return t.jsx(L,{filter:e});case h.Input:return t.jsx(U,{filter:e});case h.BooleanToggle:return t.jsx($,{filter:e});case"custom":const n=e.control.panel;return t.jsx(n,{filter:e});default:return null}}function ae({filters:e,icon:n=t.jsx(R,{}),color:a="primary",variant:d="outline",size:r="sm",disabled:i,className:u}){const m=T(),j=t.jsx(k,{variant:d,color:a,startIcon:n,disabled:i,size:r,className:u,children:t.jsx(y,{message:"Filter"})}),c=t.jsx(E,{color:a,size:"sm",variant:d,disabled:i,className:u,children:n});return t.jsxs(w,{type:"popover",children:[m?c:j,t.jsx(V,{filters:e})]})}function ie(e){var n;return t.jsx(z,{initial:!1,mode:"wait",children:(n=e.selectedItems)!=null&&n.length?x.createElement(se,{...e,key:"selected"}):x.createElement(ne,{...e,key:"default"})})}function ne({searchPlaceholder:e=O("Type to search..."),searchValue:n,onSearchChange:a,actions:d,filters:r,filtersLoading:i}){const{trans:u}=M();return t.jsxs(f,{children:[t.jsx(H,{size:"sm",className:"mr-auto min-w-180 max-w-440 flex-auto",inputWrapperClassName:"mr-24 md:mr-0",placeholder:u(e),startAdornment:t.jsx(K,{size:"sm"}),value:n,onChange:m=>{a(m.target.value)}}),r&&t.jsx(ae,{filters:r,disabled:i}),d]})}function se({selectedActions:e,selectedItems:n}){return t.jsxs(f,{"data-testid":"datatable-selected-header",children:[t.jsx("div",{className:"mr-auto font-medium",children:t.jsx(y,{message:"[one 1 item|other :count items] selected",values:{count:(n==null?void 0:n.length)||1}})}),e]})}function f({children:e,...n}){return t.jsx("div",{className:"hidden-scrollbar relative mb-24 flex h-42 flex-shrink-0 items-center gap-8 overflow-x-auto md:gap-12",...n,children:e})}export{ie as D,v as u};
