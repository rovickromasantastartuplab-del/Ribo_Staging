import{r as m,j as l}from"./ui-C-VW1P-5.js";import{P as Y}from"./page-template-CDM26U5Q.js";import{u as Z,K as ee,h as te,P as re,S as n,t as s}from"./app-BQKKzqf3.js";import{C as se}from"./CrudTable-DuIO85h3.js";import{C as ae}from"./CrudFormModal-BgN_j_X-.js";import{C as le}from"./CrudDeleteModal-Bjo4FQXD.js";import{P as oe}from"./pagination-mhOv5uX0.js";import{S as ie}from"./search-and-filter-bar-CB2HkcPS.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./dollar-sign-BO1aYhXH.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./package-BHhWwbAI.js";import"./calendar-BZ7v_rN9.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./table-Cm3ifs76.js";import"./activity-BlqoVjjD.js";import"./unlink-CIrE65Ci.js";import"./archive-Clb3Wsap.js";import"./arrow-left-CYc20UlY.js";import"./arrow-right-B7V9NE53.js";import"./circle-help-DoNFXKiW.js";import"./lock-open-CBxZhRNn.js";import"./award-ClOH67b_.js";import"./wallet-G_F5INNy.js";import"./key-D9NdYYsw.js";import"./webhook-DRgOw1J7.js";import"./store-W0ENpN1D.js";import"./building-DYqVTalU.js";import"./camera-Cy0DV6zN.js";import"./chart-column-DLMw04GC.js";import"./chart-pie-C3AvH4oN.js";import"./chevron-left-Cy-TANhf.js";import"./circle-alert-Ba7f7jIF.js";import"./circle-check-big-ClvvRvVa.js";import"./circle-BMwBABJJ.js";import"./clock-DRJ3azky.js";import"./code-DoOxvyWM.js";import"./grid-3x3-B93v7dH2.js";import"./download-CUJ4p28I.js";import"./ellipsis-BsqioQZd.js";import"./external-link-nVhYE8Jw.js";import"./eye-off-Dy-fpfrJ.js";import"./eye-DxUCHEvv.js";import"./instagram-Dy7YsGuh.js";import"./file-2l6WoCvh.js";import"./folder-open-Berbn4mP.js";import"./grip-vertical-hmSrLZiM.js";import"./hard-drive-CBRsIzd1.js";import"./heart-CUqaTJ0A.js";import"./indian-rupee-D8_RKA6E.js";import"./info-ZEKNfV81.js";import"./lightbulb-B6cGkit3.js";import"./link-2-ZacHXNCA.js";import"./twitter-DwqeIVgg.js";import"./list-D15qstQa.js";import"./lock-DLCREvz4.js";import"./map-pin-BDUdmeW2.js";import"./menu-DkHdB524.js";import"./message-square-DJa7rgfT.js";import"./monitor-BaCWvDIc.js";import"./percent-Ca67PI5w.js";import"./play-BIO6trhV.js";import"./power-ph8Hxezk.js";import"./printer-CMSe0GyN.js";import"./wifi-D3ejDzoN.js";import"./quote-D-eoVvuu.js";import"./send-Ci4mpdkr.js";import"./server-VPjmlBKw.js";import"./shield-DgdOjZQK.js";import"./shopping-cart-BQ16UXZH.js";import"./square-check-big-BV0umpWv.js";import"./square-pen-DbvvCy40.js";import"./star-D7bZLLWj.js";import"./tag-Cr3RI_n7.js";import"./target-BI71-IGe.js";import"./triangle-alert-DtTk7Xcn.js";import"./truck--5x8h15q.js";import"./type-CuVOkJfB.js";import"./user-plus-BGAma7su.js";import"./weight-Ch9O_shw.js";import"./zap-CYBGuK61.js";import"./radio-group-CSjni1r3.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";function ar(){var k,E,M;const{t:e}=Z(),{auth:g,calls:a,users:v=[],filters:i={},settings:S={}}=ee().props,_=(g==null?void 0:g.permissions)||[],x=((k=g==null?void 0:g.user)==null?void 0:k.type)==="company",q=(S==null?void 0:S.googleCalendarEnabled)==="1",[b,C]=m.useState(i.search||""),[d,w]=m.useState(i.status||"all"),[p,j]=m.useState(i.assigned_to||"all"),[D,P]=m.useState(!1),[R,h]=m.useState(!1),[H,y]=m.useState(!1),[c,T]=m.useState(null),[f,A]=m.useState("create"),L=()=>b!==""||d!=="all"||p!=="all",U=()=>(b?1:0)+(d!=="all"?1:0)+(p!=="all"?1:0),V=t=>{t.preventDefault(),F()},F=()=>{n.get(route("calls.index"),{page:1,search:b||void 0,status:d!=="all"?d:void 0,assigned_to:p!=="all"?p:void 0,per_page:i.per_page},{preserveState:!0,preserveScroll:!0})},$=t=>{const r=i.sort_field===t&&i.sort_direction==="desc"?"asc":"desc";n.get(route("calls.index"),{sort_field:t,sort_direction:r,page:1,search:b||void 0,status:d!=="all"?d:void 0,assigned_to:p!=="all"?p:void 0,per_page:i.per_page},{preserveState:!0,preserveScroll:!0})},I=(t,r)=>{switch(T(r),t){case"view":n.get(route("calls.show",r.id));break;case"edit":A("edit"),h(!0);break;case"delete":y(!0);break;case"toggle-status":K(r);break}},G=()=>{T(null),A("create"),h(!0)},z=t=>{t.attendees&&Array.isArray(t.attendees)&&(t.attendees=t.attendees.filter(r=>r.type&&r.id&&r.id!=="")),t.parent_id&&(t.parent_id=String(t.parent_id)),t.assigned_to&&(t.assigned_to=String(t.assigned_to)),f==="create"?(s.loading(e("Creating call...")),n.post(route("calls.store"),t,{onSuccess:r=>{h(!1),s.dismiss(),r.props.flash.success&&s.success(e(r.props.flash.success))},onError:r=>{s.dismiss(),s.error(e("Failed to create call: {{errors}}",{errors:Object.values(r).join(", ")}))}})):f==="edit"&&(s.loading(e("Updating call...")),n.put(route("calls.update",c.id),t,{onSuccess:r=>{h(!1),s.dismiss(),r.props.flash.success?s.success(e(r.props.flash.success)):r.props.flash.error&&s.error(e(r.props.flash.error))},onError:r=>{s.dismiss(),s.error(e("Failed to update call: {{errors}}",{errors:Object.values(r).join(", ")}))}}))},B=()=>{s.loading(e("Deleting call...")),n.delete(route("calls.destroy",c.id),{onSuccess:t=>{y(!1),s.dismiss(),t.props.flash.success?s.success(e(t.props.flash.success)):t.props.flash.error&&s.error(e(t.props.flash.error))},onError:t=>{s.dismiss(),s.error(e("Failed to delete call: {{errors}}",{errors:Object.values(t).join(", ")}))}})},K=t=>{const r=t.status==="planned"?"held":"planned";s.loading(`${e(r==="held"?"Marking as held":"Marking as planned")} call...`),n.put(route("calls.toggle-status",t.id),{},{onSuccess:o=>{s.dismiss(),o.props.flash.success&&s.success(e(o.props.flash.success))},onError:o=>{s.dismiss(),s.error(e("Failed to update call status: {{errors}}",{errors:Object.values(o).join(", ")}))}})},J=()=>{C(""),w("all"),j("all"),P(!1),n.get(route("calls.index"),{page:1,per_page:i.per_page},{preserveState:!0,preserveScroll:!0})},N=[];te(_,"create-calls")&&N.push({label:e("Add Call"),icon:l.jsx(re,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>G()});const Q=[{title:e("Dashboard"),href:route("dashboard")},{title:e("Calls")}],W=[{key:"title",label:e("Title"),sortable:!0,render:t=>l.jsx("div",{className:"font-medium",children:t})},{key:"start_date",label:e("Date & Time"),sortable:!0,render:(t,r)=>{var o,u,O;return l.jsxs("div",{children:[l.jsx("div",{className:"font-medium",children:((o=window.appSettings)==null?void 0:o.formatDateTime(t,!1))||new Date(t).toLocaleDateString()}),l.jsxs("div",{className:"text-sm text-muted-foreground",children:[((u=window.appSettings)==null?void 0:u.formatTime(r.start_time))||r.start_time," - ",((O=window.appSettings)==null?void 0:O.formatTime(r.end_time))||r.end_time]})]})}},{key:"parent_module",label:e("Related To"),render:(t,r)=>t?l.jsx("span",{className:"inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700",children:t.charAt(0).toUpperCase()+t.slice(1)}):"-"},{key:"status",label:e("Status"),render:t=>{const r=u=>{switch(u){case"planned":return"bg-blue-50 text-blue-700 ring-blue-600/20";case"held":return"bg-green-50 text-green-700 ring-green-600/20";case"not_held":return"bg-red-50 text-red-700 ring-red-600/20";default:return"bg-gray-50 text-gray-700 ring-gray-600/20"}},o=u=>{switch(u){case"planned":return e("Planned");case"held":return e("Held");case"not_held":return e("Not Held");default:return u}};return l.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${r(t)}`,children:o(t)})}},{key:"assigned_user",label:e("Assigned To"),render:t=>(t==null?void 0:t.name)||e("Unassigned")},{key:"created_at",label:e("Created At"),sortable:!0,render:t=>{var r;return((r=window.appSettings)==null?void 0:r.formatDateTime(t,!1))||new Date(t).toLocaleDateString()}}],X=[{label:e("View"),icon:"Eye",action:"view",className:"text-blue-500",requiredPermission:"view-calls"},{label:e("Edit"),icon:"Edit",action:"edit",className:"text-amber-500",requiredPermission:"edit-calls"},{label:e("Toggle Status"),icon:"Lock",action:"toggle-status",className:"text-amber-500",requiredPermission:"toggle-status-calls"},{label:e("Delete"),icon:"Trash2",action:"delete",className:"text-red-500",requiredPermission:"delete-calls"}];return l.jsxs(Y,{title:e("Calls"),url:"/calls",actions:N,breadcrumbs:Q,noPadding:!0,children:[l.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:l.jsx(ie,{searchTerm:b,onSearchChange:C,onSearch:V,filters:[{name:"status",label:e("Status"),type:"select",value:d,onChange:w,options:[{value:"all",label:e("All Status")},{value:"planned",label:e("Planned")},{value:"held",label:e("Held")},{value:"not_held",label:e("Not Held")}]},...x?[{name:"assigned_to",label:e("Assigned To"),type:"select",value:p,onChange:j,options:[{value:"all",label:e("All Users")},{value:"unassigned",label:e("Unassigned")},...v.map(t=>({value:t.id.toString(),label:t.name}))]}]:[]],showFilters:D,setShowFilters:P,hasActiveFilters:L,activeFilterCount:U,onResetFilters:J,onApplyFilters:F,currentPerPage:((E=i.per_page)==null?void 0:E.toString())||"10",onPerPageChange:t=>{n.get(route("calls.index"),{page:1,per_page:parseInt(t),search:b||void 0,status:d!=="all"?d:void 0,assigned_to:p!=="all"?p:void 0},{preserveState:!0,preserveScroll:!0})}})}),l.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[l.jsx(se,{columns:W,actions:X,data:(a==null?void 0:a.data)||[],from:(a==null?void 0:a.from)||1,onAction:I,sortField:i.sort_field,sortDirection:i.sort_direction,onSort:$,permissions:_,entityPermissions:{view:"view-calls",create:"create-calls",edit:"edit-calls",delete:"delete-calls"}}),l.jsx(oe,{from:(a==null?void 0:a.from)||0,to:(a==null?void 0:a.to)||0,total:(a==null?void 0:a.total)||0,links:a==null?void 0:a.links,entityName:e("calls"),onPageChange:t=>n.get(t)})]}),l.jsx(ae,{isOpen:R,onClose:()=>h(!1),onSubmit:z,formConfig:{fields:[{name:"title",label:e("Call Title"),type:"text",required:!0},{name:"description",label:e("Description"),type:"textarea"},{name:"start_date",label:e("Start Date"),type:"date",required:!0},{name:"end_date",label:e("End Date"),type:"date",required:!0},{name:"start_time",label:e("Start Time"),type:"time",required:!0},{name:"end_time",label:e("End Time"),type:"time",required:!0},{name:"parent_module",label:e("Related To"),type:"select",options:[{value:"lead",label:e("Lead")},{value:"account",label:e("Account")},{value:"contact",label:e("Contact")},{value:"opportunity",label:e("Opportunity")},{value:"case",label:e("Case")},{value:"project",label:e("Project")}]},{name:"parent_id",label:e("Select Record"),type:"select",options:[],placeholder:e("Select Record"),conditional:(t,r)=>{const o=r.parent_module;return o&&o!=="none"}},{name:"attendees",label:e("Attendees"),type:"array",fields:[{name:"type",label:e("Type"),type:"select",options:[{value:"user",label:e("User")},{value:"contact",label:e("Contact")},{value:"lead",label:e("Lead")}]},{name:"id",label:e("Select Person"),type:"select",options:[]}]},...x?[{name:"assigned_to",label:e("Assign To"),type:"select",options:[...v.map(t=>({value:t.id,label:`${t.name} (${t.email})`}))]}]:[],{name:"status",label:e("Status"),type:"select",options:[{value:"planned",label:e("Planned")},{value:"held",label:e("Held")},{value:"not_held",label:e("Not Held")}],defaultValue:"planned"},...q?[{name:"sync_with_google_calendar",label:e("Sync with Google Calendar"),type:"switch",defaultValue:!1,conditional:t=>t==="create"}]:[]],modalSize:"xl"},initialData:c?{...c,attendees:((M=c.attendees)==null?void 0:M.map(t=>({type:t.attendee_type,id:t.attendee_id})))||[]}:{},title:e(f==="create"?"Add New Call":f==="edit"?"Edit Call":"View Call"),mode:f}),l.jsx(le,{isOpen:H,onClose:()=>y(!1),onConfirm:B,itemName:(c==null?void 0:c.title)||"",entityName:e("call")})]})}export{ar as default};
