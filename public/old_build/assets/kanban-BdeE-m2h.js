import{r as n,j as e}from"./ui-C-VW1P-5.js";import{P as le,B as ie}from"./page-template-CDM26U5Q.js";import{u as oe,K as ne,S as d,h as g,P as de,C as ce,T as ue,t as a}from"./app-BQKKzqf3.js";import{D as me,a as pe,b as be,c as P,d as ge}from"./language-switcher-BX314FqS.js";import{u as he}from"./use-initials-C9WE3Vip.js";import{C as xe}from"./CrudFormModal-BgN_j_X-.js";import{C as fe}from"./CrudDeleteModal-Bjo4FQXD.js";import{S as je}from"./search-and-filter-bar-CB2HkcPS.js";import{A as ye}from"./arrow-left-CYc20UlY.js";import{E as ve}from"./ellipsis-BsqioQZd.js";import{E as we}from"./eye-DxUCHEvv.js";import{S as ke}from"./square-pen-DbvvCy40.js";import{C as Ne}from"./calendar-BZ7v_rN9.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./settings-G3vQs6CU.js";import"./dollar-sign-BO1aYhXH.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./package-BHhWwbAI.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./radio-group-CSjni1r3.js";import"./circle-BMwBABJJ.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";import"./grid-3x3-B93v7dH2.js";import"./list-D15qstQa.js";function bs(){var K,V,U;const{t:s}=oe(),{auth:x,project:f,kanbanData:k,statuses:N,users:B=[]}=ne().props,p=(x==null?void 0:x.permissions)||[],H=((K=x==null?void 0:x.user)==null?void 0:K.type)==="company",[R,v]=n.useState(!1),[q,D]=n.useState(!1),[c,F]=n.useState(null),[h,E]=n.useState("create"),[S,z]=n.useState(""),[b,L]=n.useState(""),[j,M]=n.useState("all"),[y,A]=n.useState("all"),[W,O]=n.useState(!1),[$,I]=n.useState(k),[T,G]=n.useState(k),J=he(),C=(r,o)=>{switch(F(o),r){case"view":d.get(route("project-tasks.show",o.id));break;case"edit":E("edit"),v(!0);break;case"delete":D(!0);break}},Q=r=>{F(null),E("create"),z(r),v(!0)},X=r=>{r.preventDefault(),_()},_=()=>{let r={...T};Object.keys(r).forEach(o=>{const l=r[o];let t=l.tasks||[];b&&(t=t.filter(i=>{var u,m,w;return i.title.toLowerCase().includes(b.toLowerCase())||((u=i.description)==null?void 0:u.toLowerCase().includes(b.toLowerCase()))||((w=(m=i.assigned_user)==null?void 0:m.name)==null?void 0:w.toLowerCase().includes(b.toLowerCase()))})),j!=="all"&&(t=t.filter(i=>i.task_status_id===j)),y!=="all"&&(t=t.filter(i=>i.priority===y)),r[o]={...l,tasks:t}}),I(r)},Y=()=>{L(""),M("all"),A("all"),O(!1),I(T)},Z=()=>b!==""||j!=="all"||y!=="all",ee=()=>(b?1:0)+(j!=="all"?1:0)+(y!=="all"?1:0);n.useEffect(()=>{G(k),_()},[k]),n.useEffect(()=>{_()},[b,j,y,T]);const se=r=>{if(h==="create"){a.loading(s("Creating task..."));const o={...r,project_id:f.id,task_status_id:S?parseInt(S):r.task_status_id?parseInt(r.task_status_id):null};d.post(route("project-tasks.store"),o,{onSuccess:l=>{v(!1),a.dismiss(),l.props.flash.success&&a.success(s(l.props.flash.success)),d.reload()},onError:l=>{a.dismiss(),typeof l=="string"?a.error(l):a.error(`Failed to create task: ${Object.values(l).join(", ")}`)}})}else if(h==="edit"){if(!g(p,"edit-project-tasks")){a.error(s("Permission denied."));return}a.loading(s("Updating task..."));const o={...r,task_status_id:r.task_status_id?parseInt(r.task_status_id):null};d.put(route("project-tasks.update",c.id),o,{onSuccess:l=>{v(!1),a.dismiss(),l.props.flash.success&&a.success(s(l.props.flash.success)),d.reload()},onError:l=>{a.dismiss(),typeof l=="string"?a.error(l):a.error(`Failed to update task: ${Object.values(l).join(", ")}`)}})}},te=()=>{a.loading(s("Deleting task...")),d.delete(route("project-tasks.destroy",c.id),{onSuccess:r=>{D(!1),a.dismiss(),r.props.flash.success&&a.success(s(r.props.flash.success)),d.reload()},onError:r=>{a.dismiss(),typeof r=="string"?a.error(r):a.error(`Failed to delete task: ${Object.values(r).join(", ")}`)}})},re=[{label:s("Back to Project"),icon:e.jsx(ye,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>d.get(route("projects.show",f.id))}],ae=[{title:s("Dashboard"),href:route("dashboard")},{title:s("Projects"),href:route("projects.index")},{title:f.name,href:route("projects.show",f.id)},{title:s("Kanban View")}];return e.jsxs(le,{title:`${f.name} - ${s("Kanban View")}`,url:`/projects/${f.id}/kanban`,actions:re,breadcrumbs:ae,noPadding:!0,className:"overflow-hidden",children:[e.jsx("style",{children:`
        .kanban-scroll::-webkit-scrollbar {
          height: 8px;
        }
        .kanban-scroll::-webkit-scrollbar-track {
          background: #f1f5f9;
          border-radius: 4px;
        }
        .kanban-scroll::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 4px;
        }
        .kanban-scroll::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
        .column-scroll::-webkit-scrollbar {
          width: 6px;
        }
        .column-scroll::-webkit-scrollbar-track {
          background: #f8fafc;
          border-radius: 3px;
        }
        .column-scroll::-webkit-scrollbar-thumb {
          background: #e2e8f0;
          border-radius: 3px;
        }
        .column-scroll::-webkit-scrollbar-thumb:hover {
          background: #cbd5e1;
        }
      `}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:e.jsx(je,{searchTerm:b,onSearchChange:L,onSearch:X,filters:[{name:"status",label:s("Status"),type:"select",value:j,onChange:M,options:[{value:"all",label:s("All Status")},...N.map(r=>({value:r.id,label:r.name}))]},{name:"priority",label:s("Priority"),type:"select",value:y,onChange:A,options:[{value:"all",label:s("All Priority")},{value:"low",label:s("Low")},{value:"medium",label:s("Medium")},{value:"high",label:s("High")},{value:"urgent",label:s("Urgent")}]}],showFilters:W,setShowFilters:O,hasActiveFilters:Z,activeFilterCount:ee,onResetFilters:Y,onApplyFilters:_,hidePerPage:!0,hideViewToggle:!0})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg overflow-hidden",children:e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 kanban-scroll",style:{height:"calc(100vh - 250px)",width:"100%"},children:N.map(r=>{var l;const o=((l=Object.values($).find(t=>{var i;return((i=t.status)==null?void 0:i.id)===r.id}))==null?void 0:l.tasks)||[];return e.jsx("div",{className:"flex-shrink-0",style:{minWidth:"calc(20% - 16px)",width:"calc(20% - 16px)"},onDrop:t=>{t.preventDefault(),t.currentTarget.classList.remove("bg-blue-50");const i=t.dataTransfer.getData("taskId");if(i){if(!g(p,"edit-project-tasks")){a.error(s("Permission denied."));return}a.loading("Updating task status..."),Object.values($).flatMap(m=>m.tasks).find(m=>m.id.toString()===i)&&d.put(route("project-tasks.update-status",i),{task_status_id:r.id},{preserveState:!0,preserveScroll:!0,onSuccess:m=>{var w;a.dismiss(),(w=m.props.flash)!=null&&w.success&&a.success(s(m.props.flash.success)),d.reload()},onError:()=>{a.dismiss(),a.error("Failed to update task status")}})}},onDragOver:t=>{t.preventDefault(),t.currentTarget.classList.add("bg-blue-50")},onDragLeave:t=>{t.currentTarget.classList.remove("bg-blue-50")},children:e.jsxs("div",{className:"bg-gray-100 rounded-lg h-full flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("h3",{className:"font-semibold text-sm text-gray-700",children:r.name})]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-200 px-2 py-1 rounded-full",children:o.length})]}),g(p,"create-project-tasks")&&e.jsxs("button",{onClick:()=>Q(r.id),className:"w-full text-xs text-gray-600 hover:text-blue-600 hover:bg-blue-50 py-2 px-3 rounded-md border border-dashed border-gray-300 hover:border-blue-300 transition-all duration-200 flex items-center justify-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),s("Add Task")]})]}),e.jsxs("div",{className:"p-2 space-y-2 overflow-y-auto flex-1 column-scroll",style:{maxHeight:"calc(100vh - 320px)"},children:[o.map(t=>{var i;return e.jsx("div",{draggable:g(p,"edit-project-tasks"),onDragStart:u=>{if(!g(p,"edit-project-tasks")){u.preventDefault();return}u.dataTransfer.setData("taskId",t.id.toString()),u.currentTarget.classList.add("opacity-50","scale-95")},onDragEnd:u=>{u.currentTarget.classList.remove("opacity-50","scale-95")},className:`transition-all duration-200 ${g(p,"edit-project-tasks")?"cursor-move":"cursor-default"}`,children:e.jsx(ce,{className:"bg-white border-l-4 border-t border-r border-b border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 group",style:{borderLeftColor:r.color},children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 cursor-pointer hover:text-blue-600 flex-1 pr-2",onClick:()=>C("view",t),children:t.title}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs(me,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",children:e.jsx(ve,{className:"h-4 w-4"})})}),e.jsxs(be,{align:"end",className:"w-40",children:[e.jsxs(P,{onClick:()=>C("view",t),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),s("View")]}),g(p,"edit-project-tasks")&&e.jsxs(P,{onClick:()=>C("edit",t),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),s("Edit")]}),g(p,"delete-project-tasks")&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsxs(P,{onClick:()=>C("delete",t),className:"text-red-600",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),s("Delete")]})]})]})]})})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[t.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${t.progress>=100?"bg-green-500":t.progress>=75?"bg-blue-500":t.progress>=50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${t.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ${t.priority==="urgent"?"bg-red-50 text-red-700 ring-1 ring-inset ring-red-600/20":t.priority==="high"?"bg-orange-50 text-orange-700 ring-1 ring-inset ring-orange-600/20":t.priority==="medium"?"bg-blue-50 text-blue-700 ring-1 ring-inset ring-blue-600/20":"bg-gray-50 text-gray-700 ring-1 ring-inset ring-gray-600/20"}`,children:t.priority}),t.assigned_user&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-500 rounded-full text-white text-xs flex items-center justify-center",children:J(t.assigned_user.name)}),e.jsx("span",{className:"text-gray-600 max-w-16 truncate",children:t.assigned_user.name})]})]}),t.due_date&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-500",children:[e.jsx(Ne,{className:"h-3 w-3"}),e.jsxs("span",{children:["Due: ",((i=window.appSettings)==null?void 0:i.formatDateTime(t.due_date,!1))||new Date(t.due_date).toLocaleDateString()]})]})]})})},t.id)}),o.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(ie,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:s("No tasks")})]})]})]})},r.id)})})})}),e.jsx(xe,{isOpen:R,onClose:()=>v(!1),onSubmit:se,formConfig:{fields:[{name:"title",label:s("Task Title"),type:"text",required:!0},{name:"description",label:s("Description"),type:"textarea"},{name:"start_date",label:s("Start Date"),type:"date"},{name:"due_date",label:s("Due Date"),type:"date"},{name:"priority",label:s("Priority"),type:"select",options:[{value:"low",label:s("Low")},{value:"medium",label:s("Medium")},{value:"high",label:s("High")},{value:"urgent",label:s("Urgent")}],defaultValue:"medium"},{name:"task_status_id",label:s("Status"),type:"select",options:N.map(r=>({value:r.id,label:r.name})),defaultValue:h==="create"?S||((V=N[0])==null?void 0:V.id):void 0,hidden:h==="create"&&S},{name:"estimated_hours",label:s("Estimated Hours"),type:"number",step:"0.5"},{name:"progress",label:s("Progress (%)"),type:"number",min:"0",max:"100",defaultValue:"0"},...H?[{name:"assigned_to",label:s("Assign To"),type:"select",options:[{value:null,label:s("Unassigned")},...B.map(r=>({value:r.id,label:`${r.name} (${r.email})`}))]}]:[]],modalSize:"lg"},initialData:c?{...c,assigned_to:((U=c.assigned_user)==null?void 0:U.id)||null,task_status_id:c.task_status_id}:null,title:s(h==="create"?"Add New Task":h==="edit"?"Edit Task":"View Task"),mode:h}),e.jsx(fe,{isOpen:q,onClose:()=>D(!1),onConfirm:te,itemName:(c==null?void 0:c.title)||"",entityName:"task"})]})}export{bs as default};
