import{r as y,j as e,H as U,I as q,J as H,K as J,L as X,M as B,N as G,Q as K}from"./ui-C-VW1P-5.js";import{u as M,K as O,e as $,C as z,B as x,X as A,f as V,t as N,g as S,D as W,l as Q,n as Y,o as Z,L as T,I as E,y as ee,ad as te,P as se,i as R,ae,S as I,af as _}from"./app-BQKKzqf3.js";import{S as oe}from"./switch-T0u5R7d_.js";import{R as P}from"./react-country-flag.esm-B_SRkH7q.js";import{R as ne}from"./refresh-cw-BnxOCyDc.js";import{G as re}from"./globe-BSt65iB3.js";import{S as ie}from"./settings-G3vQs6CU.js";function Ce(){const{t:a}=M(),{props:i}=O(),[c,s]=y.useState(!1),[f,p]=y.useState(!1),[l,u]=y.useState(!1),{themeColor:j,customColor:m}=$(),g=j==="custom"?m:V[j],n=i.globalSettings||{},d={cookieTitle:n.cookieTitle||"Cookie Consent",cookieDescription:n.cookieDescription||"We use cookies to enhance your browsing experience and provide personalized content.",strictlyCookieTitle:n.strictlyCookieTitle||"Strictly Necessary Cookies",strictlyCookieDescription:n.strictlyCookieDescription||"These cookies are essential for the website to function properly.",contactUsDescription:n.contactUsDescription||"If you have any questions about our cookie policy, please contact us.",contactUsUrl:n.contactUsUrl||"#"};y.useEffect(()=>{var w;const t=n.enableLogging==="1"||n.enableLogging===1||n.enableLogging===!0,h=n.is_demo==="1"||n.is_demo===1||n.is_demo===!0,o=window.location.pathname.includes("/dashboard"),r=(w=i.auth)==null?void 0:w.user;t&&(h&&!o||(h?(r==null?void 0:r.type)==="company"&&o&&(localStorage.getItem("cookie-consent")||s(!0)):localStorage.getItem("cookie-consent")||s(!0)))},[]);const D=async()=>{try{const t=new AbortController,h=setTimeout(()=>t.abort(),5e3),o=await fetch("https://ipapi.co/json/",{signal:t.signal,headers:{Accept:"application/json"}});if(clearTimeout(h),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();return{ip:r.ip||"unknown",country:r.country_name||"unknown",city:r.city||"unknown",region:r.region||"unknown",...r}}catch(t){return console.warn("Failed to get location data:",t.message),{ip:"unknown",country:"unknown",city:"unknown",region:"unknown",error:t.message||"Location fetch failed"}}},b=async(t,h)=>{var o;try{const r=await D(),w={...h,timestamp:new Date().toISOString(),consentType:t,userAgent:navigator.userAgent||"unknown",language:navigator.language||"unknown",url:window.location.href,...r};localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()}));const k=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content");if(!k){console.warn("CSRF token not found, skipping backend storage");return}const L=await fetch(route("cookie.consent.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k,Accept:"application/json"},body:JSON.stringify(w)});if(!L.ok)throw new Error(`HTTP error! status: ${L.status}`);if(!(await L.json()).success)throw new Error("Server returned error")}catch(r){console.warn("Failed to save cookie consent to backend:",r)}},v=async()=>{if(!l){u(!0);try{await b("accept_all",{necessary:!0,analytics:!0,marketing:!0}),s(!1)}catch{N.error(a("Failed to save cookie preferences"))}finally{u(!1)}}},C=async()=>{if(l)return;u(!0),await b("necessary_only",{necessary:!0,analytics:!1,marketing:!1}),s(!1),u(!1)};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 max-w-md w-full",children:e.jsxs(z,{className:"p-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:d.cookieTitle}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"h-6 w-6 p-0",children:e.jsx(A,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:d.cookieDescription}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:v,size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:g},disabled:l,children:a(l?"Saving...":"Accept All")}),e.jsx(x,{onClick:C,variant:"outline",size:"sm",className:"flex-1",style:{borderColor:g,color:g},disabled:l,children:a(l?"Saving...":"Necessary Only")})]}),e.jsx(x,{onClick:()=>p(!0),variant:"ghost",size:"sm",className:"text-sm underline",children:a("Let me choose")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[d.contactUsDescription," ",e.jsx("a",{href:d.contactUsUrl,className:"underline",children:a("Contact us")})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:e.jsx(z,{className:"w-full max-w-md max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:d.cookieTitle}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>p(!1),className:"h-6 w-6 p-0",children:e.jsx(A,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:d.strictlyCookieTitle}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d.strictlyCookieDescription})]}),e.jsx(oe,{checked:!0,disabled:!0})]})}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(x,{onClick:async()=>{await C(),p(!1)},variant:"outline",size:"sm",className:"flex-1",style:{borderColor:g,color:g},disabled:l,children:a(l?"Saving...":"Save Preferences")}),e.jsx(x,{onClick:async()=>{await v(),p(!1)},size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:g},disabled:l,children:a(l?"Saving...":"Accept All")})]})]})})})]}):null}function ce({...a}){return e.jsx(U,{"data-slot":"dropdown-menu",...a})}function le({...a}){return e.jsx(q,{"data-slot":"dropdown-menu-trigger",...a})}function de({className:a,sideOffset:i=4,...c}){return e.jsx(H,{children:e.jsx(J,{"data-slot":"dropdown-menu-content",sideOffset:i,className:S("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md",a),...c})})}function ue({...a}){return e.jsx(G,{"data-slot":"dropdown-menu-group",...a})}function F({className:a,inset:i,variant:c="default",...s}){return e.jsx(X,{"data-slot":"dropdown-menu-item","data-inset":i,"data-variant":c,className:S("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...s})}function be({className:a,inset:i,...c}){return e.jsx(K,{"data-slot":"dropdown-menu-label","data-inset":i,className:S("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",a),...c})}function me({className:a,...i}){return e.jsx(B,{"data-slot":"dropdown-menu-separator",className:S("bg-border -mx-1 my-1 h-px",a),...i})}function ge({open:a,onOpenChange:i,onSuccess:c}){const{t:s}=M(),[f,p]=y.useState({code:"",name:"",countryCode:""}),[l,u]=y.useState(!1),j=async m=>{var g;m.preventDefault(),u(!0);try{const n=await fetch(route("languages.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content"))||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(f)}),d=await n.json();n.ok&&d.success?(N.success(d.message||s("Language created successfully")),p({code:"",name:"",countryCode:""}),i(!1),c==null||c(),window.location.reload()):(console.error("Create language error:",d.message),N.error(d.error||s(d.message)))}catch(n){console.error("Network error:",n),N.error(s("Failed to create language"))}finally{u(!1)}};return e.jsx(W,{open:a,onOpenChange:i,children:e.jsxs(Q,{className:"sm:max-w-md",children:[e.jsx(Y,{children:e.jsx(Z,{children:s("Create Language")})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"code",children:s("Language Code")}),e.jsx(E,{id:"code",placeholder:s("e.g., fr, de, ja"),value:f.code,onChange:m=>p({...f,code:m.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"name",children:s("Language Name")}),e.jsx(E,{id:"name",placeholder:s("e.g., Français, Deutsch, 日本語"),value:f.name,onChange:m=>p({...f,name:m.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"countryCode",children:s("Country Code")}),e.jsx(E,{id:"countryCode",placeholder:s("e.g., FR, DE, JP"),maxLength:2,value:f.countryCode,onChange:m=>p({...f,countryCode:m.target.value.toUpperCase()}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>i(!1),children:s("Cancel")}),e.jsx(x,{type:"submit",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 animate-spin mr-2"}),s("Creating...")]}):s("Create Language")})]})]})]})})}const ke=()=>{var v,C;const{t:a,i18n:i}=M(),{auth:c,globalSettings:s}=O().props,{updatePosition:f}=ee(),[p,l]=y.useState(!1),[u,j]=y.useState(null),m=(s==null?void 0:s.availableLanguages)||[];y.useEffect(()=>{const t=(m||[]).filter(o=>o.enabled!==!1),h=t.find(o=>o.code===i.language)||t[0];j(h)},[i.language,m]);const g=c==null?void 0:c.user,n=((C=(v=c==null?void 0:c.user)==null?void 0:v.roles)==null?void 0:C.map(t=>t.name))||[],d=g&&te("superadmin",n);n.includes("company");const D=["ar","he"],b=async t=>{const h=m.find(o=>o.code===t);if(h){j(h);try{await i.changeLanguage(t);const o=D.includes(t);let r=o?"right":"left";document.documentElement.dir="ltr",document.documentElement.setAttribute("dir","ltr"),R()?r=o?"right":ae("layoutPosition")||"left":r=o?"right":(s==null?void 0:s.layoutDirection)||"left",f(r),g&&!R()?I.post(route("languages.change"),{language:t},{preserveScroll:!0,onSuccess:()=>{(o||!o&&(s==null?void 0:s.layoutDirection)==="right")&&I.post(route("settings.brand.update"),{settings:{layoutDirection:r}},{preserveScroll:!0,onError:w=>{console.error("Failed to update layout direction:",w)}})},onError:w=>{console.error("Failed to change language:",w)}}):(_("app_language",t),_("layoutDirection",r)),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:t,direction:r}})),window.dispatchEvent(new Event("resize"))}catch(o){console.error("Error changing language:",o)}}};return e.jsxs(ce,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"flex items-center gap-2 rounded-md shadow-sm border bg-white",children:[e.jsx(re,{className:"h-4 w-4"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium hidden md:inline-block",children:u.name}),e.jsx(P,{countryCode:u.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}})]})]})}),e.jsxs(de,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(ue,{children:e.jsx("div",{className:"max-h-48 overflow-y-auto",children:(m||[]).filter(t=>t.enabled!==!1).map(t=>e.jsxs(F,{onClick:()=>b(t.code),className:`flex items-center gap-2 ${(u==null?void 0:u.code)===t.code?"bg-accent":""}`,children:[e.jsx(P,{countryCode:t.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}}),e.jsx("span",{children:t.name})]},t.code))})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs(F,{onClick:()=>l(!0),className:"justify-center text-primary font-semibold cursor-pointer",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),a("Create Language")]}),e.jsx(F,{asChild:!0,className:"justify-center text-primary font-semibold cursor-pointer",children:e.jsxs("a",{href:route("manage-language"),rel:"noopener noreferrer",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),a("Manage Language")]})})]})]}),e.jsx(ge,{open:p,onOpenChange:l,onSuccess:()=>l(!1)})]})};export{Ce as C,ce as D,ke as L,le as a,de as b,F as c,me as d,be as e,ue as f};
