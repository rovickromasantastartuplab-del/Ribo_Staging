import{r as u,j as e}from"./ui-C-VW1P-5.js";import{P as Ie}from"./page-template-CDM26U5Q.js";import{u as Pe,K as Oe,C as h,c as p,F as ze,a as b,b as f,$ as P,B as j,d as xe,S as N,t as c,X as he,T as pe,I as ge,P as Me}from"./app-BQKKzqf3.js";import{T as R,a as H,b as g,c as i,d as q,e as n}from"./table-Cm3ifs76.js";import{C as Ue}from"./CrudFormModal-BgN_j_X-.js";import{C as ue}from"./CrudDeleteModal-Bjo4FQXD.js";import{D as C}from"./dollar-sign-BO1aYhXH.js";import{P as Q}from"./package-BHhWwbAI.js";import{C as G}from"./calendar-BZ7v_rN9.js";import{B as $e}from"./building-DYqVTalU.js";import{U as Ee}from"./user-B-NTs7Zv.js";import{E as Le}from"./eye-off-Dy-fpfrJ.js";import{S as Fe}from"./send-Ci4mpdkr.js";import{S as Be}from"./square-pen-DbvvCy40.js";import{A as Re}from"./arrow-left-CYc20UlY.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./radio-group-CSjni1r3.js";import"./circle-BMwBABJJ.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";function ks(){var se,te,ae,re,le,ne,ie,de,oe,ce,me;const{t:s}=Pe(),{invoice:a,streamItems:y,pendingPayments:T,availableSalesOrders:O,auth:m}=Oe().props,J=((se=m==null?void 0:m.user)==null?void 0:se.type)==="company",[je,z]=u.useState(!1),[K,M]=u.useState("empty"),[U,be]=u.useState(!0),[fe,$]=u.useState(!1),[Ne,E]=u.useState(!1),[ye,ve]=u.useState(null),[D,X]=u.useState(""),[we,L]=u.useState(null),[V,W]=u.useState(""),Y=((te=a.payments)==null?void 0:te.reduce((t,r)=>{const l=parseFloat(r.amount)||0;return r.status==="completed"?t+l:t},0))||0,Se=Math.max(0,(parseFloat(a.total_amount)||0)-Y),_e=t=>{const r=(t==null?void 0:t.sales_order_id)||K;if(!r||r==="empty"){c.error(s("Please select a sales order"));return}c.loading(s("Assigning sales order...")),N.put(route("invoices.add-sales-order",a.id),{sales_order_id:r},{onSuccess:l=>{z(!1),M("empty"),c.dismiss(),l.props.flash.success?c.success(s(l.props.flash.success)):l.props.flash.error&&c.error(s(l.props.flash.error))},onError:l=>{c.dismiss(),typeof l=="string"?c.error(l):c.error(`Failed to assign sales order: ${Object.values(l).join(", ")}`)}})},Ce=[{title:s("Dashboard"),href:route("dashboard")},{title:s("Invoices"),href:route("invoices.index")},{title:a.invoice_number}],Z=t=>{const r={draft:"bg-gray-50 text-gray-600 ring-gray-500/10",sent:"bg-blue-50 text-blue-700 ring-blue-700/10",paid:"bg-green-50 text-green-700 ring-green-600/20",partially_paid:"bg-orange-50 text-orange-800 ring-orange-600/20",overdue:"bg-red-50 text-red-700 ring-red-600/10",cancelled:"bg-yellow-50 text-yellow-800 ring-yellow-600/20"};return e.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${r[t]||r.draft}`,children:t==="partially_paid"?s("Partially Paid"):(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))||s("Draft")})},d=t=>{var r;return((r=window.appSettings)==null?void 0:r.formatCurrency(Number(t||0)))||`$${Number(t||0).toFixed(2)}`},Te=()=>{var o;let t=0,r=0,l=0;return(o=a.products)==null||o.forEach(x=>{const A=Number(x.pivot.total_price)||0,v=Number(x.pivot.discount_amount)||0,w=A-v;t+=w,l+=v,x.tax&&(r+=w*Number(x.tax.rate)/100)}),{subtotal:t,totalTax:r,totalDiscount:l,grandTotal:t+r}},{subtotal:De,totalTax:Ae,totalDiscount:ee,grandTotal:ke}=Te();return e.jsx(Ie,{title:a.invoice_number,breadcrumbs:Ce,actions:[{label:s("Back to Invoices"),icon:e.jsx(Re,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>window.history.back()},...a.sales_order?[]:[{label:s("Assign Sales Order"),icon:e.jsx(Me,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>z(!0)}]],children:e.jsxs("div",{className:"mx-auto space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-bold",children:a.name}),e.jsx("p",{className:"text-base text-gray-600 mt-2 leading-relaxed max-w-3xl",children:a.description||s("No description provided")})]}),e.jsxs("div",{className:"text-right ml-6",children:[Z(a.status),e.jsx("p",{className:"text-sm font-medium text-gray-700 mt-2 font-mono",children:a.invoice_number})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(h,{className:"border-l-4 border-l-green-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Total Amount")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-green-600 leading-none",children:d(a.total_amount)})]}),e.jsx("div",{className:"rounded-full bg-green-100 p-4",children:e.jsx(C,{className:"h-5 w-5 text-green-600"})})]})})}),e.jsx(h,{className:"border-l-4 border-l-blue-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Paid Amount")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-blue-600 leading-none",children:d(Y)})]}),e.jsx("div",{className:"rounded-full bg-blue-100 p-4",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})})]})})}),e.jsx(h,{className:"border-l-4 border-l-red-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Due Amount")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-red-600 leading-none",children:d(Se)})]}),e.jsx("div",{className:"rounded-full bg-red-100 p-4",children:e.jsx(C,{className:"h-5 w-5 text-red-600"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(h,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Products")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-purple-600 leading-none",children:((ae=a.products)==null?void 0:ae.length)||0})]}),e.jsx("div",{className:"rounded-full bg-purple-100 p-4",children:e.jsx(Q,{className:"h-5 w-5 text-purple-600"})})]})})}),e.jsx(h,{className:"border-l-4 border-l-orange-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Invoice Date")}),e.jsx("h3",{className:"mt-2 text-lg font-bold text-orange-600 leading-tight",children:((re=window.appSettings)==null?void 0:re.formatDateTime(a.invoice_date,!1))||new Date(a.invoice_date).toLocaleDateString()})]}),e.jsx("div",{className:"rounded-full bg-orange-100 p-4",children:e.jsx(G,{className:"h-5 w-5 text-orange-600"})})]})})}),e.jsx(h,{className:"border-l-4 border-l-amber-500 hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:s("Due Date")}),e.jsx("h3",{className:"mt-2 text-lg font-bold text-amber-600 leading-tight",children:((le=window.appSettings)==null?void 0:le.formatDateTime(a.due_date,!1))||new Date(a.due_date).toLocaleDateString()})]}),e.jsx("div",{className:"rounded-full bg-amber-100 p-4",children:e.jsx(ze,{className:"h-5 w-5 text-amber-600"})})]})})})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsx(f,{className:"text-lg font-semibold",children:s("Invoice Information")})}),e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Invoice Number")}),e.jsx("p",{className:"text-sm mt-1",children:a.invoice_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Status")}),e.jsx("div",{className:"mt-1",children:Z(a.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Created By")}),e.jsx("p",{className:"text-sm mt-1",children:((ne=a.creator)==null?void 0:ne.name)||s("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Assigned To")}),e.jsx("p",{className:"text-sm mt-1",children:((ie=a.assignedUser)==null?void 0:ie.name)||s("Unassigned")})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Subtotal")}),e.jsx("p",{className:"text-sm mt-1",children:d(a.subtotal)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Discount Amount")}),e.jsxs("p",{className:"text-sm mt-1",children:["-",d(ee)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Created At")}),e.jsx("p",{className:"text-sm mt-1",children:((de=window.appSettings)==null?void 0:de.formatDateTime(a.created_at,!1))||new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Updated At")}),e.jsx("p",{className:"text-sm mt-1",children:((oe=window.appSettings)==null?void 0:oe.formatDateTime(a.updated_at,!1))||new Date(a.updated_at).toLocaleDateString()})]})]})]})})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx($e,{className:"h-5 w-5 mr-3 text-muted-foreground"}),s("Related Data")]})}),e.jsx(p,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.account&&e.jsxs("div",{className:"p-6 bg-green-50 rounded-xl border border-green-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:s("Account")}),e.jsx(P,{href:route("accounts.show",a.account.id),className:"text-base font-medium text-green-700 hover:text-green-900 hover:underline transition-colors",children:a.account.name})]}),a.sales_order&&e.jsxs("div",{className:"p-6 bg-purple-50 rounded-xl border border-purple-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:s("Sales Order")}),e.jsx(P,{href:route("sales-orders.show",a.sales_order.id),className:"text-base font-medium text-purple-700 hover:text-purple-900 hover:underline transition-colors",children:a.sales_order.name})]}),a.quote&&e.jsxs("div",{className:"p-6 bg-orange-50 rounded-xl border border-orange-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:s("Quote")}),e.jsx(P,{href:route("quotes.show",a.quote.id),className:"text-base font-medium text-orange-700 hover:text-orange-900 hover:underline transition-colors",children:a.quote.name})]})]})})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx(Ee,{className:"h-5 w-5 mr-3 text-muted-foreground"}),s("Billing Details")]})}),e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Contact")}),a.contact?e.jsx(P,{href:route("contacts.show",a.contact.id),className:"block text-sm text-blue-600 hover:text-blue-800 hover:underline mt-1 transition-colors",children:a.contact.name}):e.jsx("p",{className:"text-sm mt-1",children:s("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Address")}),e.jsx("p",{className:"text-sm mt-1",children:a.billing_address||s("-")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("City")}),e.jsx("p",{className:"text-sm mt-1",children:a.billing_city||s("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("State")}),e.jsx("p",{className:"text-sm mt-1",children:a.billing_state||s("-")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Postal Code")}),e.jsx("p",{className:"text-sm mt-1",children:a.billing_postal_code||s("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Country")}),e.jsx("p",{className:"text-sm mt-1",children:a.billing_country||s("-")})]})]})]})})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx(Q,{className:"h-5 w-5 mr-3 text-muted-foreground"}),s("Products")]})}),e.jsx(p,{className:"p-0",children:a.products&&a.products.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(g,{className:"bg-gray-100",children:[e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-6 w-1/3",children:s("Product")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Quantity")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Unit Price")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Discount")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Tax")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4 w-1/6",children:s("Total")})]})}),e.jsxs(q,{children:[a.products.map((t,r)=>{const l=Number(t.pivot.total_price)||0,o=Number(t.pivot.discount_amount)||0,x=l-o;return e.jsxs(g,{className:"border-b hover:bg-gray-50",children:[e.jsx(n,{className:"font-semibold text-base text-gray-900 py-4 px-6",children:t.name}),e.jsx(n,{className:"text-right text-base font-medium py-4 px-4",children:t.pivot.quantity}),e.jsx(n,{className:"text-right text-base font-semibold py-4 px-4",children:d(t.pivot.unit_price)}),e.jsx(n,{className:"text-right py-4 px-4",children:t.pivot.discount_type&&t.pivot.discount_type!=="none"&&t.pivot.discount_value>0?e.jsxs("div",{className:"text-base",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:t.pivot.discount_type==="percentage"?`${Number(t.pivot.discount_value)}%`:d(Number(t.pivot.discount_value))}),e.jsxs("div",{className:"text-red-600 font-bold",children:["(-",d(o),")"]})]}):e.jsx("span",{className:"text-gray-500 font-medium",children:s("No Discount")})}),e.jsx(n,{className:"text-right text-base py-4 px-4",children:t.tax?e.jsxs("div",{className:"text-base",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:t.tax.name}),e.jsxs("div",{className:"text-gray-600 font-medium",children:["(",t.tax.rate,"%)"]})]}):e.jsx("span",{className:"text-gray-500 font-medium",children:s("No Tax")})}),e.jsx(n,{className:"text-right font-bold text-base py-4 px-4",children:o>0?e.jsxs("div",{children:[e.jsx("div",{className:"line-through text-gray-400 text-sm font-medium",children:d(l)}),e.jsx("div",{className:"text-green-600 font-semibold",children:d(x)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:d(l)})})]},r)}),e.jsxs(g,{className:"bg-gray-50 border-t-2",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[s("Total Discount"),":"]}),e.jsxs(n,{className:"text-right font-semibold text-base text-red-600 py-3 px-4",children:["-",d(ee)]})]}),e.jsxs(g,{className:"bg-gray-50",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[s("Subtotal"),":"]}),e.jsx(n,{className:"text-right font-semibold text-base py-3 px-4",children:d(De)})]}),e.jsxs(g,{className:"bg-gray-50",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[s("Total Tax"),":"]}),e.jsx(n,{className:"text-right font-semibold text-base py-3 px-4",children:d(Ae)})]}),e.jsxs(g,{className:"bg-green-50 border-t-2",children:[e.jsxs(n,{colSpan:5,className:"text-right font-bold text-lg py-4 px-4",children:[s("Grand Total"),":"]}),e.jsx(n,{className:"text-right py-4 px-4",children:e.jsx("span",{className:"text-green-600 font-bold text-xl",children:d(ke)})})]})]})]})}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(Q,{className:"h-16 w-16 mx-auto mb-6 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:s("No products added to this invoice")})]})})]}),T&&T.length>0&&e.jsxs(h,{className:"shadow-sm border-l-4 border-l-yellow-500",children:[e.jsx(b,{className:"bg-yellow-50 border-b",children:e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx(C,{className:"h-5 w-5 mr-3 text-yellow-600"}),s("Pending Payments")," (",T.length,")"]})}),e.jsx(p,{className:"p-0",children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(g,{className:"bg-gray-100",children:[e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-6",children:s("Date")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Method")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Type")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Amount")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Payment ID")}),e.jsx(i,{className:"text-center text-base font-bold text-gray-900 py-4 px-4",children:s("Actions")})]})}),e.jsx(q,{children:T.map((t,r)=>{var l;return e.jsxs(g,{className:"border-b hover:bg-gray-50",children:[e.jsx(n,{className:"py-4 px-6",children:((l=window.appSettings)==null?void 0:l.formatDateTime(t.created_at,!1))||new Date(t.created_at).toLocaleDateString()}),e.jsx(n,{className:"py-4 px-4 capitalize",children:t.payment_method}),e.jsx(n,{className:"py-4 px-4 capitalize",children:t.payment_type}),e.jsx(n,{className:"text-right py-4 px-4 font-semibold",children:d(t.amount)}),e.jsx(n,{className:"py-4 px-4 font-mono text-sm",children:t.payment_id}),e.jsx(n,{className:"py-4 px-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(j,{size:"sm",variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>{N.post(route("invoice.payments.approve",t.payment_id),{},{preserveScroll:!0,onSuccess:o=>{o.props.flash.success?c.success(s(o.props.flash.success)):c.success(s("Payment approved successfully"))},onError:o=>{typeof o=="string"?c.error(o):c.error(s("Failed to approve payment"))}})},children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),s("Approve")]}),e.jsxs(j,{size:"sm",variant:"destructive",onClick:()=>{const o=prompt(s("Reason for rejection (optional):"));N.post(route("invoice.payments.reject",t.payment_id),{reason:o||""},{preserveScroll:!0,onSuccess:x=>{x.props.flash.success?c.success(s(x.props.flash.success)):c.success(s("Payment rejected successfully"))},onError:x=>{typeof x=="string"?c.error(x):c.error(s("Failed to reject payment"))}})},children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),s("Reject")]})]})})]},r)})})]})})]}),a.payments&&a.payments.length>0&&e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx(C,{className:"h-5 w-5 mr-3 text-muted-foreground"}),s("Payment History")]})}),e.jsx(p,{className:"p-0",children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsxs(g,{className:"bg-gray-100",children:[e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-6",children:s("Date")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Method")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Type")}),e.jsx(i,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:s("Amount")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Status")}),e.jsx(i,{className:"text-base font-bold text-gray-900 py-4 px-4",children:s("Payment ID")})]})}),e.jsx(q,{children:a.payments.map((t,r)=>{var l;return e.jsxs(g,{className:"border-b hover:bg-gray-50",children:[e.jsx(n,{className:"py-4 px-6",children:((l=window.appSettings)==null?void 0:l.formatDateTime(t.processed_at||t.created_at,!1))||new Date(t.processed_at||t.created_at).toLocaleDateString()}),e.jsx(n,{className:"py-4 px-4 capitalize",children:t.payment_method}),e.jsx(n,{className:"py-4 px-4 capitalize",children:t.payment_type}),e.jsx(n,{className:"text-right py-4 px-4 font-semibold",children:d(t.amount)}),e.jsx(n,{className:"py-4 px-4",children:e.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${t.status==="completed"?"bg-green-50 text-green-700 ring-green-600/20":t.status==="pending"?"bg-yellow-50 text-yellow-800 ring-yellow-600/20":"bg-red-50 text-red-700 ring-red-600/10"}`,children:t.status})}),e.jsx(n,{className:"py-4 px-4 font-mono text-sm",children:t.payment_id||s("-")})]},r)})})]})})]}),(a.notes||a.terms)&&e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsx(f,{className:"text-lg font-semibold",children:s("Additional Information")})}),e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Notes")}),e.jsx("p",{className:"text-sm mt-1",children:a.notes})]}),a.terms&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("Terms")}),e.jsx("p",{className:"text-sm mt-1",children:a.terms})]})]})})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f,{className:"flex items-center text-lg font-semibold",children:[e.jsx(G,{className:"h-5 w-5 mr-3 text-muted-foreground"}),s("Activity Stream")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>be(!U),children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),s(U?"Hide":"Show")]}),y&&y.length>0&&J&&e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>E(!0),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),s("Delete Stream")]})]})]})}),U&&e.jsxs(p,{className:"p-0",children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 p-6 pb-6 border-b mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((ce=m==null?void 0:m.user)==null?void 0:ce.avatar)||"/images/avatar/default.png",alt:((me=m==null?void 0:m.user)==null?void 0:me.name)||"User",className:"w-full h-full object-cover",onError:t=>{var l;const r=t.target;r.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((l=m==null?void 0:m.user)==null?void 0:l.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),e.jsx("div",{className:"flex-1",children:e.jsx("form",{onSubmit:t=>{t.preventDefault(),D.trim()&&N.post(route("invoices.comments.store",a.id),{comment:D},{preserveScroll:!0,onSuccess:()=>X("")})},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ge,{placeholder:s("Add a comment..."),value:D,onChange:t=>X(t.target.value),className:"flex-1"}),e.jsx(j,{type:"submit",size:"sm",disabled:!D.trim(),children:e.jsx(Fe,{className:"h-4 w-4"})})]})})})]})}),e.jsx("div",{className:"p-6 pt-0 max-h-96 overflow-y-auto",children:y&&y.length>0?e.jsx("div",{className:"space-y-2",children:y.map((t,r)=>{var o,x,A,v,w;const l=S=>{const k=new Date(S),_=Math.floor((new Date().getTime()-k.getTime())/(1e3*60));if(_<1)return s("Just now");if(_<60)return s("{{count}} {{unit}} ago",{count:_,unit:s(_===1?"minute":"minutes")});const I=Math.floor(_/60);if(I<24)return s("{{count}} {{unit}} ago",{count:I,unit:s(I===1?"hour":"hours")});const B=Math.floor(I/24);return B<7?s("{{count}} {{unit}} ago",{count:B,unit:s(B===1?"day":"days")}):k.toLocaleDateString()};return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((o=t.user)==null?void 0:o.avatar)||"/images/avatar/default.png",alt:((x=t.user)==null?void 0:x.name)||"User",className:"w-full h-full object-cover",onError:S=>{var F;const k=S.target;k.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((F=t.user)==null?void 0:F.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),r<y.length-1&&e.jsx("div",{className:"w-px h-8 bg-gray-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 min-w-0 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:((A=t.user)==null?void 0:A.name)||s("System")}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:l(t.created_at)})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",dangerouslySetInnerHTML:{__html:t.title.replace(new RegExp(`^(${((v=t.user)==null?void 0:v.name)||"System"})`,"g"),'<span class="font-bold text-sm">$1</span>')}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center rounded-md px-2 py-1 text-xs font-medium bg-gray-50 text-gray-700 ring-1 ring-inset ring-gray-600/20",children:t.activity_type.charAt(0).toUpperCase()+t.activity_type.slice(1)}),J&&e.jsx(j,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>{ve(t),$(!0)},children:e.jsx(pe,{className:"h-3 w-3"})})]})]}),t.description&&e.jsx("div",{className:"mb-2",children:t.field_changed==="status"||t.field_changed==="invoice_number"||t.field_changed==="assigned_to"||t.description.includes("into")?e.jsx("p",{className:"text-sm text-gray-600",dangerouslySetInnerHTML:{__html:t.description}}):t.activity_type==="comment"?e.jsx("div",{children:we===t.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ge,{value:V,onChange:S=>W(S.target.value),className:"flex-1"}),e.jsx(j,{size:"sm",onClick:()=>{N.put(route("invoices.comments.update-activity",{invoice:a.id,activity:t.id}),{comment:V},{preserveScroll:!0}),L(null)},children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>L(null),children:e.jsx(he,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 flex-1",children:t.description}),t.user_id===((w=m==null?void 0:m.user)==null?void 0:w.id)&&e.jsx(j,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-400 hover:text-gray-600",onClick:()=>{L(t.id),W(t.description)},children:e.jsx(Be,{className:"h-3 w-3"})})]})}):e.jsx("p",{className:"text-sm text-gray-600",children:t.description})})]})]})]},t.id||r)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm",children:s("No activities found")})]})})]})]}),e.jsx(Ue,{isOpen:je,onClose:()=>{z(!1),M("empty")},onSubmit:_e,formConfig:{modalSize:"md",layout:"vertical",fields:[{name:"sales_order_id",label:s("Select Sales Order"),type:"select",required:!0,options:[{value:"empty",label:s("Select Sales Order")},...(O==null?void 0:O.map(t=>({value:t.id.toString(),label:`${t.order_number} - ${t.name}`})))||[]]}]},initialData:{sales_order_id:K||"empty"},title:s("Assign Sales Order to Invoice"),mode:"create",onFieldChange:(t,r)=>{t==="sales_order_id"&&M(r)}}),e.jsx(ue,{isOpen:fe,onClose:()=>$(!1),onConfirm:()=>{N.delete(route("invoices.delete-activity",{invoice:a.id,activity:ye.id}),{preserveScroll:!0}),$(!1)},itemName:s("this activity"),entityName:s("activity")}),e.jsx(ue,{isOpen:Ne,onClose:()=>E(!1),onConfirm:()=>{N.delete(route("invoices.delete-activities",a.id),{preserveScroll:!0}),E(!1)},itemName:s("all activities for {{invoiceName}}",{invoiceName:a.name}),entityName:s("activities")})]})})}export{ks as default};
