import{r as x,j as s}from"./ui-C-VW1P-5.js";import{P as Ke}from"./page-template-CDM26U5Q.js";import{u as ze,K as Xe,h as Q,P as Ge,$ as Qe,S as y,B,L as A,D as He,l as Je,n as We,o as Ye,t as r}from"./app-BQKKzqf3.js";import{a as Ze,C as et}from"./CrudTable-DuIO85h3.js";import{C as be}from"./CrudFormModal-BgN_j_X-.js";import{C as tt}from"./CrudDeleteModal-Bjo4FQXD.js";import{P as st}from"./pagination-mhOv5uX0.js";import{S as at}from"./search-and-filter-bar-CB2HkcPS.js";import{T as he}from"./textarea-BvlD1v8z.js";import{D as it}from"./download-CUJ4p28I.js";import{C as rt}from"./circle-check-big-ClvvRvVa.js";import"./vendor-CxtKjBZA.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./dollar-sign-BO1aYhXH.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./package-BHhWwbAI.js";import"./calendar-BZ7v_rN9.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./table-Cm3ifs76.js";import"./activity-BlqoVjjD.js";import"./unlink-CIrE65Ci.js";import"./archive-Clb3Wsap.js";import"./arrow-left-CYc20UlY.js";import"./arrow-right-B7V9NE53.js";import"./circle-help-DoNFXKiW.js";import"./lock-open-CBxZhRNn.js";import"./award-ClOH67b_.js";import"./wallet-G_F5INNy.js";import"./key-D9NdYYsw.js";import"./webhook-DRgOw1J7.js";import"./store-W0ENpN1D.js";import"./building-DYqVTalU.js";import"./camera-Cy0DV6zN.js";import"./chart-column-DLMw04GC.js";import"./chart-pie-C3AvH4oN.js";import"./chevron-left-Cy-TANhf.js";import"./circle-alert-Ba7f7jIF.js";import"./circle-BMwBABJJ.js";import"./clock-DRJ3azky.js";import"./code-DoOxvyWM.js";import"./grid-3x3-B93v7dH2.js";import"./ellipsis-BsqioQZd.js";import"./external-link-nVhYE8Jw.js";import"./eye-off-Dy-fpfrJ.js";import"./eye-DxUCHEvv.js";import"./instagram-Dy7YsGuh.js";import"./file-2l6WoCvh.js";import"./folder-open-Berbn4mP.js";import"./grip-vertical-hmSrLZiM.js";import"./hard-drive-CBRsIzd1.js";import"./heart-CUqaTJ0A.js";import"./indian-rupee-D8_RKA6E.js";import"./info-ZEKNfV81.js";import"./lightbulb-B6cGkit3.js";import"./link-2-ZacHXNCA.js";import"./twitter-DwqeIVgg.js";import"./list-D15qstQa.js";import"./lock-DLCREvz4.js";import"./map-pin-BDUdmeW2.js";import"./menu-DkHdB524.js";import"./message-square-DJa7rgfT.js";import"./monitor-BaCWvDIc.js";import"./percent-Ca67PI5w.js";import"./play-BIO6trhV.js";import"./power-ph8Hxezk.js";import"./printer-CMSe0GyN.js";import"./wifi-D3ejDzoN.js";import"./quote-D-eoVvuu.js";import"./send-Ci4mpdkr.js";import"./server-VPjmlBKw.js";import"./shield-DgdOjZQK.js";import"./shopping-cart-BQ16UXZH.js";import"./square-check-big-BV0umpWv.js";import"./square-pen-DbvvCy40.js";import"./star-D7bZLLWj.js";import"./tag-Cr3RI_n7.js";import"./target-BI71-IGe.js";import"./triangle-alert-DtTk7Xcn.js";import"./truck--5x8h15q.js";import"./type-CuVOkJfB.js";import"./user-plus-BGAma7su.js";import"./weight-Ch9O_shw.js";import"./zap-CYBGuK61.js";import"./radio-group-CSjni1r3.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";function aa(){var le,ce,de,me,pe,ue,ge,xe,ye,ve;const{t:e}=ze(),{auth:P,invoices:c,accounts:T,contacts:L,salesOrders:U,quotes:V,opportunities:K,products:p,availableSalesOrders:ot,users:H=[],filters:u={},publicUrlBase:O,encryptedInvoiceIds:fe,pendingPayments:J=[]}=Xe().props,E=(P==null?void 0:P.permissions)||[],W=((le=P==null?void 0:P.user)==null?void 0:le.type)==="company",[$,Y]=x.useState(u.search||""),[h,Z]=x.useState(u.status||"all"),[f,ee]=x.useState(u.account_id||"all"),[_,te]=x.useState(u.assigned_to||"all"),[_e,se]=x.useState(!1),[je,D]=x.useState(!1),[Se,z]=x.useState(!1),[n,ae]=x.useState(null),[l,ie]=x.useState("create"),[we,R]=x.useState(!1),[M,Ne]=x.useState(null),[re,oe]=x.useState(""),Ce=()=>$!==""||h!=="all"||f!=="all"||_!=="all",Fe=()=>($?1:0)+(h!=="all"?1:0)+(f!=="all"?1:0)+(_!=="all"?1:0),Pe=t=>{t.preventDefault(),ne()},ne=()=>{y.get(route("invoices.index"),{page:1,search:$||void 0,status:h!=="all"?h:void 0,account_id:f!=="all"?f:void 0,assigned_to:_!=="all"?_:void 0,per_page:u.per_page},{preserveState:!0,preserveScroll:!0})},Te=t=>{const i=u.sort_field===t&&u.sort_direction==="asc"?"desc":"asc";y.get(route("invoices.index"),{sort_field:t,sort_direction:i,page:1,search:$||void 0,status:h!=="all"?h:void 0,account_id:f!=="all"?f:void 0,assigned_to:_!=="all"?_:void 0,per_page:u.per_page},{preserveState:!0,preserveScroll:!0})},$e=(t,i)=>{switch(ae(i),t){case"view":y.get(route("invoices.show",i.id));break;case"edit":ie("edit"),D(!0);break;case"delete":z(!0);break;case"toggle-status":De(i);break;case"copy-link":qe(i);break}},ke=()=>{ae(null),ie("create"),D(!0)},Ae=t=>{if(["sales_order_id","quote_id","opportunity_id","account_id","contact_id","assigned_to"].forEach(a=>{(t[a]===""||t[a]==="null"||t[a]==="none")&&(t[a]=null)}),t.products&&t.products.length>0){let a=0,o=0;t.products.forEach(m=>{const N=parseFloat(m.quantity)||0,C=parseFloat(m.unit_price)||0,j=N*C,b=m.discount_type,d=parseFloat(m.discount_value)||0;let F=0;b&&b!=="none"&&(b==="percentage"?F=j*d/100:b==="fixed"&&(F=Math.min(d,j)));const k=j-F;a+=k;const g=p==null?void 0:p.find(v=>v.id==m.product_id);g!=null&&g.tax&&(o+=k*g.tax.rate/100)}),t.subtotal=a,t.tax_amount=o,t.total_amount=a+o}l==="create"?(r.loading(e("Creating invoice...")),y.post(route("invoices.store"),t,{onSuccess:a=>{D(!1),r.dismiss(),a.props.flash.success?r.success(e(a.props.flash.success)):a.props.flash.error&&r.error(e(a.props.flash.error))},onError:a=>{r.dismiss(),typeof a=="string"?r.error(a):r.error(`Failed to create invoice: ${Object.values(a).join(", ")}`)}})):l==="edit"&&(r.loading(e("Updating invoice...")),y.put(route("invoices.update",n.id),t,{onSuccess:a=>{D(!1),r.dismiss(),a.props.flash.success?r.success(e(a.props.flash.success)):a.props.flash.error&&r.error(e(a.props.flash.error))},onError:a=>{r.dismiss(),typeof a=="string"?r.error(a):r.error(`Failed to update invoice: ${Object.values(a).join(", ")}`)}}))},Oe=()=>{r.loading(e("Deleting invoice...")),y.delete(route("invoices.destroy",n.id),{onSuccess:t=>{z(!1),r.dismiss(),t.props.flash.success?r.success(e(t.props.flash.success)):t.props.flash.error&&r.error(e(t.props.flash.error))},onError:t=>{r.dismiss(),typeof t=="string"?r.error(t):r.error(`Failed to delete invoice: ${Object.values(t).join(", ")}`)}})},De=t=>{const i=t.status==="draft"?"sent":"draft";r.loading(`${e(i==="sent"?"Sending":"Setting to draft")} invoice...`),y.put(route("invoices.toggle-status",t.id),{},{onSuccess:a=>{r.dismiss(),a.props.flash.success?r.success(e(a.props.flash.success)):a.props.flash.error&&r.error(e(a.props.flash.error))},onError:a=>{r.dismiss(),typeof a=="string"?r.error(a):r.error(`Failed to update status: ${Object.values(a).join(", ")}`)}})},qe=t=>{const i=O!=null&&O.endsWith("/")?O.slice(0,-1):O,a=fe[t.id],o=`${i}/invoices/public/${a}`;navigator.clipboard.writeText(o).then(()=>{r.success(e("Invoice link copied to clipboard!"))}).catch(()=>{r.error(e("Failed to copy invoice link"))})},Ie=async t=>{var i;r.loading(e("Approving payment..."));try{const o=await(await fetch(route("invoice-payments.approve",t.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""}})).json();r.dismiss(),o.success?(o.message?r.success(e(o.message)):r.success(e("Payment approved successfully")),y.reload({only:["pendingPayments","invoices"]})):o.message?r.error(e(o.message)):r.error(e("Failed to approve payment"))}catch{r.dismiss(),r.error(e("Failed to approve payment"))}},Ee=t=>{Ne(t),R(!0)},Re=async()=>{var t;r.loading(e("Rejecting payment..."));try{const a=await(await fetch(route("invoice-payments.reject",M.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify({notes:re})})).json();r.dismiss(),a.success?(a.message?r.success(e(a.message)):r.success(e("Payment rejected successfully")),R(!1),oe(""),y.reload({only:["pendingPayments","invoices"]})):a.message?r.error(e(a.message)):r.error(e("Failed to reject payment"))}catch{r.dismiss(),r.error(e("Failed to reject payment"))}},Me=()=>{Y(""),Z("all"),ee("all"),te("all"),se(!1),y.get(route("invoices.index"),{page:1,per_page:u.per_page},{preserveState:!0,preserveScroll:!0})},X=[];Q(E,"export-invoices")&&X.push({label:e("Export"),icon:s.jsx(it,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>{var t,i;return(i=(t=be).handleExport)==null?void 0:i.call(t)}}),Q(E,"create-invoices")&&X.push({label:e("Add Invoice"),icon:s.jsx(Ge,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>ke()});const Be=[{title:e("Dashboard"),href:route("dashboard")},{title:e("Invoices")}],Le=[{key:"invoice_number",label:e("Invoice Number"),sortable:!0,render:(t,i)=>s.jsx(Qe,{href:route("invoices.show",i.id),className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md bg-blue-50 text-blue-700 hover:bg-blue-100 hover:text-blue-800 transition-colors duration-200 border border-blue-200 hover:border-blue-300",children:t})},{key:"name",label:e("Name"),sortable:!0},{key:"account",label:e("Account"),render:t=>(t==null?void 0:t.name)||e("-")},{key:"products",label:e("Products"),render:t=>!t||t.length===0?e("-"):`${t.length} ${t.length>1?e("products"):e("product")}`},{key:"total_amount",label:e("Total Amount"),render:t=>{var i;return((i=window.appSettings)==null?void 0:i.formatCurrency(Number(t||0)))||`$${Number(t||0).toFixed(2)}`}},{key:"status",label:e("Status"),render:t=>{const i={draft:"bg-gray-50 text-gray-700 ring-gray-600/20",sent:"bg-blue-50 text-blue-700 ring-blue-600/20",paid:"bg-green-50 text-green-700 ring-green-600/20",partially_paid:"bg-orange-50 text-orange-700 ring-orange-600/20",overdue:"bg-red-50 text-red-700 ring-red-600/20",cancelled:"bg-yellow-50 text-yellow-700 ring-yellow-600/20"},a=o=>{switch(o){case"draft":return e("Draft");case"sent":return e("Sent");case"paid":return e("Paid");case"partially_paid":return e("Partially Paid");case"overdue":return e("Overdue");case"cancelled":return e("Cancelled");default:return e("Draft")}};return s.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${i[t]||i.draft}`,children:a(t)})}},{key:"due_date",label:e("Due Date"),sortable:!0,render:t=>{var i;return((i=window.appSettings)==null?void 0:i.formatDateTime(t,!1))||new Date(t).toLocaleDateString()}},{key:"assigned_user",label:e("Assigned To"),render:t=>(t==null?void 0:t.name)||e("Unassigned")}],Ue=[{label:e("View"),icon:"Eye",action:"view",className:"text-blue-500",requiredPermission:"view-invoices"},{label:e("Edit"),icon:"Edit",action:"edit",className:"text-amber-500",requiredPermission:"edit-invoices"},{label:e("Toggle Status"),icon:"Lock",action:"toggle-status",className:"text-amber-500",requiredPermission:"toggle-status-invoices"},{label:e("Copy Invoice Link"),icon:"Copy",action:"copy-link",className:"text-purple-500",requiredPermission:"view-invoices"},{label:e("Delete"),icon:"Trash2",action:"delete",className:"text-red-500",requiredPermission:"delete-invoices"}],Ve=[{value:"all",label:e("All Statuses")},{value:"draft",label:e("Draft")},{value:"sent",label:e("Sent")},{value:"paid",label:e("Paid")},{value:"partially_paid",label:e("Partially Paid")},{value:"overdue",label:e("Overdue")},{value:"cancelled",label:e("Cancelled")}];return s.jsxs(Ke,{title:e("Invoices"),url:"/invoices",actions:X,breadcrumbs:Be,noPadding:!0,children:[s.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:s.jsx(at,{searchTerm:$,onSearchChange:Y,onSearch:Pe,filters:[{name:"status",label:e("Status"),type:"select",value:h,onChange:Z,options:Ve},{name:"account_id",label:e("Account"),type:"select",value:f,onChange:ee,options:[{value:"all",label:e("All Accounts")},...(T==null?void 0:T.map(t=>({value:t.id.toString(),label:t.name})))||[]]},...W?[{name:"assigned_to",label:e("Assigned To"),type:"select",value:_,onChange:te,options:[{value:"all",label:e("All Users")},{value:"unassigned",label:e("Unassigned")},...H.map(t=>({value:t.id.toString(),label:t.name}))]}]:[]],showFilters:_e,setShowFilters:se,hasActiveFilters:Ce,activeFilterCount:Fe,onResetFilters:Me,onApplyFilters:ne,currentPerPage:((ce=u.per_page)==null?void 0:ce.toString())||"10",onPerPageChange:t=>{y.get(route("invoices.index"),{page:1,per_page:parseInt(t),search:$||void 0,status:h!=="all"?h:void 0,account_id:f!=="all"?f:void 0,assigned_to:_!=="all"?_:void 0},{preserveState:!0,preserveScroll:!0})}})}),J.length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:e("Pending Invoice Payments")}),s.jsx("div",{className:"space-y-3",children:J.map(t=>{var i,a;return s.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium text-gray-900",children:["Invoice #",t.invoice.invoice_number]}),s.jsxs("p",{className:"text-sm text-gray-500",children:[t.payment_method==="bank"?e("Bank Transfer"):t.payment_method," -",((i=window.appSettings)==null?void 0:i.formatCurrency(Number(t.amount)))||`$${Number(t.amount).toFixed(2)}`," (",t.payment_type,")"]})]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e("Requested"),": ",((a=window.appSettings)==null?void 0:a.formatDateTime(t.created_at,!1))||new Date(t.created_at).toLocaleDateString()]})]})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(B,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>Ie(t),children:[s.jsx(rt,{className:"h-4 w-4 mr-1"}),e("Approve")]}),s.jsxs(B,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>Ee(t),children:[s.jsx(Ze,{className:"h-4 w-4 mr-1"}),e("Reject")]})]})]},t.id)})})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[s.jsx(et,{columns:Le,actions:Ue,data:(c==null?void 0:c.data)||[],from:(c==null?void 0:c.from)||1,onAction:$e,sortField:u.sort_field,sortDirection:u.sort_direction,onSort:Te,permissions:E,entityPermissions:{view:"view-invoices",create:"create-invoices",edit:"edit-invoices",delete:"delete-invoices"}}),s.jsx(st,{from:(c==null?void 0:c.from)||0,to:(c==null?void 0:c.to)||0,total:(c==null?void 0:c.total)||0,links:c==null?void 0:c.links,entityName:e("invoices"),onPageChange:t=>y.get(t)})]}),s.jsx(be,{isOpen:je,onClose:()=>D(!1),onSubmit:Ae,formConfig:{...Q(E,"export-invoices")&&{exportRoute:"invoice.export"},productOptions:p,modalSize:"5xl",layout:"grid",columns:2,fields:[{name:"name",label:e("Name"),type:"text",required:!0,colSpan:2},{name:"description",label:e("Description"),type:"textarea",colSpan:2},{name:l==="view"?"sales_order_name":"sales_order_id",label:e("Sales Order"),type:l==="view"?"text":"select",readOnly:l==="view",options:l==="view"?[]:[...(U==null?void 0:U.map(t=>({value:t.id.toString(),label:`${t.order_number} - ${t.name}`})))||[]]},{name:l==="view"?"quote_name":"quote_id",label:e("Quote"),type:l==="view"?"text":"select",readOnly:l==="view",options:l==="view"?[]:[...(V==null?void 0:V.map(t=>({value:t.id.toString(),label:`${t.quote_number} - ${t.name}`})))||[]]},{name:l==="view"?"opportunity_name":"opportunity_id",label:e("Opportunity"),type:l==="view"?"text":"select",readOnly:l==="view",options:l==="view"?[]:[...(K==null?void 0:K.map(t=>({value:t.id.toString(),label:t.name})))||[]]},{name:l==="view"?"account_name":"account_id",label:e("Account"),type:l==="view"?"text":"select",readOnly:l==="view",options:l==="view"?[]:[...(T==null?void 0:T.map(t=>({value:t.id.toString(),label:t.name})))||[]]},{name:l==="view"?"contact_name":"contact_id",label:e("Contact"),type:l==="view"?"text":"select",readOnly:l==="view",options:l==="view"?[]:[...(L==null?void 0:L.map(t=>({value:t.id.toString(),label:t.name})))||[]]},{name:"invoice_date",label:e("Invoice Date"),type:"date",required:!0,defaultValue:new Date().toISOString().split("T")[0]},{name:"due_date",label:e("Due Date"),type:"date",required:!0},{name:"status",label:e("Status"),type:"select",options:[{value:"draft",label:e("Draft")},{value:"sent",label:e("Sent")},{value:"paid",label:e("Paid")},{value:"partially_paid",label:e("Partially Paid")},{value:"overdue",label:e("Overdue")},{value:"cancelled",label:e("Cancelled")}],defaultValue:"draft"},{name:"products_header",type:"custom",colSpan:2,render:()=>s.jsx("div",{className:"col-span-2 border-t pt-4 mt-4",children:s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:e("Products & Services")})})},{name:"products",label:"",type:"array",colSpan:2,productOptions:p,renderFooter:(t,i)=>{var N,C,j,b;let a=0,o=0,m=0;try{t.forEach(d=>{const F=parseFloat(d.quantity)||0,k=parseFloat(d.unit_price)||0,g=F*k,v=d.discount_type,q=parseFloat(d.discount_value)||0;let S=0;v&&v!=="none"&&(v==="percentage"?S=g*q/100:v==="fixed"&&(S=Math.min(q,g)));const I=g-S;a+=I,m+=S;const w=p==null?void 0:p.find(G=>G.id==d.product_id);w!=null&&w.tax&&(o+=I*w.tax.rate/100)})}catch(d){console.error("Error calculating totals:",d)}return s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"bg-gray-50",children:[s.jsxs("td",{colSpan:4,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[e("Total Discount"),":"]}),s.jsxs("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right text-red-600",children:["-",((N=window.appSettings)==null?void 0:N.formatCurrency(m))||`$${m.toFixed(2)}`]})]}),s.jsxs("tr",{className:"bg-gray-50",children:[s.jsxs("td",{colSpan:4,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[e("Subtotal"),":"]}),s.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((C=window.appSettings)==null?void 0:C.formatCurrency(a))||`$${a.toFixed(2)}`})]}),s.jsxs("tr",{className:"bg-gray-50",children:[s.jsxs("td",{colSpan:4,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[e("Total Tax"),":"]}),s.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((j=window.appSettings)==null?void 0:j.formatCurrency(o))||`$${o.toFixed(2)}`})]}),s.jsxs("tr",{className:"bg-gray-100 font-bold",children:[s.jsxs("td",{colSpan:4,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[e("Grand Total"),":"]}),s.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((b=window.appSettings)==null?void 0:b.formatCurrency(a+o))||`$${(a+o).toFixed(2)}`})]})]})},renderSummary:(t,i)=>{var N,C,j,b;let a=0,o=0,m=0;try{t.forEach(d=>{const F=parseFloat(d.quantity)||0,k=parseFloat(d.unit_price)||0,g=F*k,v=d.discount_type,q=parseFloat(d.discount_value)||0;let S=0;v&&v!=="none"&&(v==="percentage"?S=g*q/100:v==="fixed"&&(S=Math.min(q,g)));const I=g-S;a+=I,m+=S;const w=p==null?void 0:p.find(G=>G.id==d.product_id);w!=null&&w.tax&&(o+=I*w.tax.rate/100)})}catch(d){console.error("Error calculating summary:",d)}return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"font-medium text-gray-700",children:[e("Total Discount"),":"]}),s.jsxs("span",{className:"font-medium text-red-600",children:["-",((N=window.appSettings)==null?void 0:N.formatCurrency(m))||`$${m.toFixed(2)}`]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"font-medium text-gray-700",children:[e("Subtotal"),":"]}),s.jsx("span",{className:"font-medium",children:((C=window.appSettings)==null?void 0:C.formatCurrency(a))||`$${a.toFixed(2)}`})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"font-medium text-gray-700",children:[e("Total Tax"),":"]}),s.jsx("span",{className:"font-medium",children:((j=window.appSettings)==null?void 0:j.formatCurrency(o))||`$${o.toFixed(2)}`})]}),s.jsxs("div",{className:"flex justify-between items-center border-t pt-2",children:[s.jsxs("span",{className:"font-bold text-gray-900",children:[e("Grand Total"),":"]}),s.jsx("span",{className:"font-bold text-lg text-primary",children:((b=window.appSettings)==null?void 0:b.formatCurrency(a+o))||`$${(a+o).toFixed(2)}`})]})]})},fields:[{name:"product_id",label:e("Product"),type:"select",required:!0,options:(p==null?void 0:p.map(t=>{var i;return{value:t.id,label:`${t.name} - ${((i=window.appSettings)==null?void 0:i.formatCurrency(parseFloat(t.price||0)))||`$${parseFloat(t.price||0).toFixed(2)}`}${t.tax?` (Tax: ${t.tax.name} - ${t.tax.rate}%)`:""}`}}))||[]},{name:"quantity",label:e("Quantity"),type:"number",required:!0,min:"1",defaultValue:1},{name:"unit_price",label:e("Unit Price"),type:"number",required:!0,step:"0.01",min:"0"},{name:"discount_type",label:e("Discount Type"),type:"select",options:[{value:"percentage",label:e("Percentage (%)")},{value:"fixed",label:e("Fixed Amount")}]},{name:"discount_value",label:e("Discount Value"),type:"number",step:"0.01",min:"0"}]},{name:"billing_section",type:"custom",colSpan:2,render:(t,i,a)=>s.jsxs("div",{className:"col-span-2 border-t pt-4 mt-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:e("Billing Information")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx(A,{className:"text-sm font-medium",children:e("Billing Address")}),s.jsx(he,{value:i.billing_address||"",onChange:o=>a("billing_address",o.target.value),className:"mt-1"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx(A,{className:"text-sm font-medium",children:e("Billing City")}),s.jsx("input",{type:"text",value:i.billing_city||"",onChange:o=>a("billing_city",o.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),s.jsxs("div",{children:[s.jsx(A,{className:"text-sm font-medium",children:e("Billing State")}),s.jsx("input",{type:"text",value:i.billing_state||"",onChange:o=>a("billing_state",o.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx(A,{className:"text-sm font-medium",children:e("Billing Country")}),s.jsx("input",{type:"text",value:i.billing_country||"",onChange:o=>a("billing_country",o.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),s.jsxs("div",{children:[s.jsx(A,{className:"text-sm font-medium",children:e("Billing Postal Code")}),s.jsx("input",{type:"text",value:i.billing_postal_code||"",onChange:o=>a("billing_postal_code",o.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})]})]})},...W?[{name:l==="view"?"assigned_user_name":"assigned_to",label:e("Assign To"),type:l==="view"?"text":"select",options:l==="view"?[]:[...H.map(t=>({value:t.id.toString(),label:`${t.name} (${t.email})`}))],readOnly:l==="view"}]:[],{name:"notes",label:e("Notes"),type:"textarea",colSpan:2},{name:"terms",label:e("Terms"),type:"textarea",colSpan:2}]},initialData:n?{...n,assigned_user_name:((de=n.assigned_user)==null?void 0:de.name)||e("Unassigned"),sales_order_name:((me=n.sales_order)==null?void 0:me.name)||e("-"),quote_name:((pe=n.quote)==null?void 0:pe.name)||e("-"),opportunity_name:((ue=n.opportunity)==null?void 0:ue.name)||e("-"),account_name:((ge=n.account)==null?void 0:ge.name)||e("-"),contact_name:((xe=n.contact)==null?void 0:xe.name)||e("-"),sales_order_id:n.sales_order_id?n.sales_order_id.toString():"none",quote_id:n.quote_id?n.quote_id.toString():"none",opportunity_id:n.opportunity_id?n.opportunity_id.toString():"none",account_id:n.account_id?n.account_id.toString():"none",contact_id:n.contact_id?n.contact_id.toString():"none",assigned_to:n.assigned_to?n.assigned_to.toString():"none",invoice_date:l==="view"&&n.invoice_date?new Date(n.invoice_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):n.invoice_date,due_date:l==="view"&&n.due_date?new Date(n.due_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):n.due_date,products:((ye=n.products)==null?void 0:ye.map(t=>{var i,a,o,m;return{product_id:t.id,quantity:parseInt(((i=t.pivot)==null?void 0:i.quantity)||1),unit_price:parseFloat(((a=t.pivot)==null?void 0:a.unit_price)||t.price||0),discount_type:((o=t.pivot)==null?void 0:o.discount_type)||"none",discount_value:parseFloat(((m=t.pivot)==null?void 0:m.discount_value)||0)}}))||[]}:null,title:e(l==="create"?"Add New Invoice":l==="edit"?"Edit Invoice":"View Invoice"),mode:l}),s.jsx(tt,{isOpen:Se,onClose:()=>z(!1),onConfirm:Oe,itemName:(n==null?void 0:n.name)||"",entityName:e("invoice")}),s.jsx(He,{open:we,onOpenChange:R,children:s.jsxs(Je,{children:[s.jsx(We,{children:s.jsx(Ye,{children:e("Reject Payment")})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600",children:e("Are you sure you want to reject this payment for Invoice #{{invoiceNumber}}?",{invoiceNumber:(ve=M==null?void 0:M.invoice)==null?void 0:ve.invoice_number})}),s.jsxs("div",{children:[s.jsx(A,{htmlFor:"reject-notes",children:e("Rejection Notes (Optional)")}),s.jsx(he,{id:"reject-notes",value:re,onChange:t=>oe(t.target.value),placeholder:e("Enter reason for rejection..."),className:"mt-1"})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(B,{variant:"outline",onClick:()=>R(!1),children:e("Cancel")}),s.jsx(B,{variant:"destructive",onClick:Re,children:e("Reject Payment")})]})]})]})})]})}export{aa as default};
