import{r as y,j as t}from"./ui-C-VW1P-5.js";import{P as Z}from"./page-template-CDM26U5Q.js";import{u as z,K as ee,S as _,h as te,P as ae,t as v}from"./app-BQKKzqf3.js";import{C as se}from"./CrudFormModal-BgN_j_X-.js";import{S as re}from"./search-and-filter-bar-CB2HkcPS.js";import{A as ie}from"./arrow-left-CYc20UlY.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./dollar-sign-BO1aYhXH.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./package-BHhWwbAI.js";import"./calendar-BZ7v_rN9.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./radio-group-CSjni1r3.js";import"./circle-BMwBABJJ.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";import"./grid-3x3-B93v7dH2.js";import"./list-D15qstQa.js";const P=e=>{switch(e){case"quarter-day":return{totalUnits:96,unitDuration:6*60*60*1e3,startOffset:-24,label:"Quarter"};case"half-day":return{totalUnits:48,unitDuration:12*60*60*1e3,startOffset:-24,label:"Half Day"};case"day":return{totalUnits:60,unitDuration:24*60*60*1e3,startOffset:-15,label:"Day"};case"week":return{totalUnits:26,unitDuration:7*24*60*60*1e3,startOffset:-8,label:"Week"};case"month":return{totalUnits:12,unitDuration:30*24*60*60*1e3,startOffset:-3,label:"Month"};default:return{totalUnits:60,unitDuration:24*60*60*1e3,startOffset:-15,label:"Day"}}},le=(e,l)=>{const n=P(l),x=new Date,c=new Date(x.getTime()+n.startOffset*n.unitDuration),h=e.start_date?new Date(e.start_date):new Date,w=e.due_date?new Date(e.due_date):new Date(Date.now()+7*24*60*60*1e3),j=Math.max(0,(h.getTime()-c.getTime())/n.unitDuration),b=Math.min(n.totalUnits-j,(w.getTime()-Math.max(h.getTime(),c.getTime()))/n.unitDuration),f=j/n.totalUnits*100,u=b/n.totalUnits*100;let r;switch(l){case"quarter-day":case"half-day":r=Math.ceil((w.getTime()-h.getTime())/(1e3*60*60));break;case"week":r=Math.ceil((w.getTime()-h.getTime())/(1e3*60*60*24*7));break;case"month":r=Math.ceil((w.getTime()-h.getTime())/(1e3*60*60*24*30));break;default:r=Math.ceil((w.getTime()-h.getTime())/(1e3*60*60*24))}return{leftPercent:f,widthPercent:u,duration:r,startDate:h,endDate:w,timelineStart:c,totalUnits:n.totalUnits}},q=(e,l,n)=>{const x=P(n),c=new Date(e.getTime()+x.startOffset*x.unitDuration);return(e.getTime()-c.getTime())/x.unitDuration/l*100},ne=({tasks:e,timeScale:l,onTaskClick:n})=>{const{t:x}=z(),c=P(l),h=new Date,w=new Date(h.getTime()+c.startOffset*c.unitDuration),j=Math.max(400,e.length*40+100),b=l==="month"?120:l==="week"?100:38,f=c.totalUnits*b;return t.jsxs("svg",{className:"gantt",height:j,width:f,style:{minWidth:f},children:[t.jsx("rect",{x:"0",y:"0",width:f,height:j,fill:"#f9fafb"}),t.jsx("g",{children:Array.from({length:c.totalUnits+1},(u,r)=>t.jsx("line",{x1:r*b,y1:"0",x2:r*b,y2:j,stroke:"#e5e7eb",strokeWidth:"1"},r))}),t.jsx("g",{children:e.map((u,r)=>t.jsx("line",{x1:"0",y1:60+(r+1)*40,x2:f,y2:60+(r+1)*40,stroke:"#e5e7eb",strokeWidth:"1"},r))}),t.jsx("rect",{x:"0",y:"0",width:f,height:"60",fill:"white",stroke:"#e5e7eb",strokeWidth:"1"}),t.jsx("g",{className:"date",children:Array.from({length:c.totalUnits},(u,r)=>{const s=new Date(w.getTime()+r*c.unitDuration),p=r*b+b/2;let d="",o="";switch(l){case"quarter-day":o=(Math.floor(s.getHours()/6)*6).toString().padStart(2,"0"),s.getHours()===0&&(d=`${s.getDate().toString().padStart(2,"0")} ${s.toLocaleDateString("en",{month:"long"})}`);break;case"half-day":o=s.getHours()<12?"00":"12",s.getHours()===0&&s.getDate()===1?d=`${s.getDate().toString().padStart(2,"0")} ${s.toLocaleDateString("en",{month:"long"})}`:s.getHours()===0&&(d=s.getDate().toString().padStart(2,"0"));break;case"day":o=s.getDate().toString().padStart(2,"0"),s.getDate()===1&&(d=s.toLocaleDateString("en",{month:"long"}));break;case"week":Math.ceil(s.getDate()/7),o=s.getDate().toString().padStart(2,"0"),s.getDate()<=7&&(d=s.toLocaleDateString("en",{month:"long"}));break;case"month":o=s.toLocaleDateString("en",{month:"long"}),s.getMonth()===0&&(d=s.getFullYear().toString());break}return t.jsxs("g",{children:[d&&t.jsx("text",{x:p,y:"20",fontSize:"11",fill:"#374151",textAnchor:"middle",fontWeight:"600",children:d}),t.jsx("text",{x:p,y:"45",fontSize:"12",fill:"#6b7280",textAnchor:"middle",children:o})]},r)})}),t.jsx("line",{x1:q(h,c.totalUnits,l)*f/100,y1:"60",x2:q(h,c.totalUnits,l)*f/100,y2:j,stroke:"#ef4444",strokeWidth:"2"}),t.jsx("g",{className:"bars",children:e.map((u,r)=>{var S;const{leftPercent:s,widthPercent:p}=le(u,l),d=68+r*40,o=s/100*f,k=Math.max(20,p/100*f),D=((S=u.task_status)==null?void 0:S.color)||"#6b7280";return t.jsxs("g",{className:"bar-wrapper cursor-pointer",onClick:()=>n(u),children:[t.jsx("rect",{x:o,y:d,width:k,height:"20",rx:"3",ry:"3",fill:D,style:{cursor:"pointer"}}),u.progress>0&&t.jsx("rect",{x:o,y:d,width:k*u.progress/100,height:"20",rx:"3",ry:"3",fill:"rgba(0,0,0,0.2)"}),t.jsx("text",{x:o+k/2,y:d+14,fontSize:"11",fill:"white",fontWeight:"500",textAnchor:"middle",children:k>60?u.title.substring(0,12):""})]},u.id)})})]})};function Re(){var F,O,$,W,H;const{t:e}=z(),{auth:l,project:n,tasks:x=[],users:c=[]}=ee().props,h=(l==null?void 0:l.permissions)||[],w=((F=l==null?void 0:l.user)==null?void 0:F.type)==="company",[j,b]=y.useState(!1),[f,u]=y.useState(null),[r,s]=y.useState("create"),[p,d]=y.useState(""),[o,k]=y.useState("all"),[D,S]=y.useState("all"),[E,M]=y.useState(!1),[G,U]=y.useState(x),[A,I]=y.useState("day"),[i,T]=y.useState(null),R=()=>{u(null),s("create"),b(!0)},B=a=>{a.preventDefault(),C()},C=()=>{let a=[...x];p&&(a=a.filter(m=>{var g,N,V;return m.title.toLowerCase().includes(p.toLowerCase())||((g=m.description)==null?void 0:g.toLowerCase().includes(p.toLowerCase()))||((V=(N=m.assigned_user)==null?void 0:N.name)==null?void 0:V.toLowerCase().includes(p.toLowerCase()))})),o!=="all"&&(a=a.filter(m=>{var g,N;return((N=(g=m.task_status)==null?void 0:g.id)==null?void 0:N.toString())===o})),D!=="all"&&(a=a.filter(m=>m.priority===D)),U(a)},Q=()=>{d(""),k("all"),S("all"),M(!1),U(x)},K=()=>p!==""||o!=="all"||D!=="all",Y=()=>(p?1:0)+(o!=="all"?1:0)+(D!=="all"?1:0);y.useEffect(()=>{C()},[p,o,D,x]);const J=a=>{if(r==="create"){v.loading(e("Creating task..."));const m={...a,project_id:n.id};_.post(route("project-tasks.store"),m,{onSuccess:g=>{b(!1),v.dismiss(),g.props.flash.success&&v.success(e(g.props.flash.success)),_.reload()},onError:g=>{v.dismiss(),typeof g=="string"?v.error(g):v.error(`Failed to create task: ${Object.values(g).join(", ")}`)}})}},L=[{label:e("Back to Project"),icon:t.jsx(ie,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>_.get(route("projects.show",n.id))}];te(h,"create-project-tasks")&&L.unshift({label:e("Add Task"),icon:t.jsx(ae,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:R});const X=[{title:e("Dashboard"),href:route("dashboard")},{title:e("Projects"),href:route("projects.index")},{title:n.name,href:route("projects.show",n.id)},{title:e("Gantt View")}];return t.jsxs(Z,{title:`${n.name} - ${e("Gantt View")}`,url:`/projects/${n.id}/gantt`,actions:L,breadcrumbs:X,noPadding:!0,children:[t.jsx("style",{children:`
        .gantt-container::-webkit-scrollbar {
          height: 8px;
          width: 8px;
        }
        .gantt-container::-webkit-scrollbar-track {
          background: #f1f5f9;
          border-radius: 4px;
        }
        .gantt-container::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 4px;
        }
        .gantt-container::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
      `}),t.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:t.jsx(re,{searchTerm:p,onSearchChange:d,onSearch:B,filters:[{name:"status",label:e("Status"),type:"select",value:o,onChange:k,options:[{value:"all",label:e("All Status")},...x.reduce((a,m)=>(m.task_status&&!a.find(g=>g.value===m.task_status.id.toString())&&a.push({value:m.task_status.id.toString(),label:m.task_status.name}),a),[])]},{name:"priority",label:e("Priority"),type:"select",value:D,onChange:S,options:[{value:"all",label:e("All Priority")},{value:"low",label:e("Low")},{value:"medium",label:e("Medium")},{value:"high",label:e("High")},{value:"urgent",label:e("Urgent")}]}],showFilters:E,setShowFilters:M,hasActiveFilters:K,activeFilterCount:Y,onResetFilters:Q,onApplyFilters:C,hidePerPage:!0,hideViewToggle:!0})}),t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[t.jsx("div",{className:"border-b border-gray-200 p-4",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h6",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e("Gantt Chart")}),t.jsx("div",{className:"flex gap-1",children:[{value:"quarter-day",label:e("Quarter Day")},{value:"half-day",label:e("Half Day")},{value:"day",label:e("Day")},{value:"week",label:e("Week")},{value:"month",label:e("Month")}].map(a=>t.jsx("button",{onClick:()=>I(a.value),className:`px-3 py-1 text-xs font-medium rounded transition-colors ${A===a.value?"bg-blue-600 text-white":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,children:a.label},a.value))})]})}),t.jsx("div",{className:"gantt-container",style:{overflow:"scroll",width:"calc(100vw - 300px)",height:"calc(100vh - 300px)"},children:t.jsx(ne,{tasks:G,timeScale:A,onTaskClick:T})})]}),t.jsx(se,{isOpen:j,onClose:()=>b(!1),onSubmit:J,formConfig:{fields:[{name:"title",label:e("Task Title"),type:"text",required:!0},{name:"description",label:e("Description"),type:"textarea"},{name:"start_date",label:e("Start Date"),type:"date"},{name:"due_date",label:e("Due Date"),type:"date"},{name:"priority",label:e("Priority"),type:"select",options:[{value:"low",label:e("Low")},{value:"medium",label:e("Medium")},{value:"high",label:e("High")},{value:"urgent",label:e("Urgent")}],defaultValue:"medium"},{name:"status",label:e("Status"),type:"select",options:[{value:"to_do",label:e("To Do")},{value:"in_progress",label:e("In Progress")},{value:"review",label:e("Review")},{value:"done",label:e("Done")}],defaultValue:"to_do"},{name:"estimated_hours",label:e("Estimated Hours"),type:"number",step:"0.5"},{name:"progress",label:e("Progress (%)"),type:"number",min:"0",max:"100",defaultValue:"0"},...w?[{name:"assigned_to",label:e("Assign To"),type:"select",options:[{value:"unassigned",label:e("Unassigned")},...c.map(a=>({value:a.id,label:`${a.name} (${a.email})`}))]}]:[]],modalSize:"lg"},initialData:null,title:e("Add New Task"),mode:r}),i&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>T(null),style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i.title}),t.jsx("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"âœ•"})]}),t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Status"),":"]}),t.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium text-white",style:{backgroundColor:((O=i.task_status)==null?void 0:O.color)||"#6b7280"},children:(($=i.task_status)==null?void 0:$.name)||e("No Status")})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Priority"),":"]}),t.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${i.priority==="urgent"?"bg-red-100 text-red-800":i.priority==="high"?"bg-orange-100 text-orange-800":i.priority==="medium"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:e(i.priority.charAt(0).toUpperCase()+i.priority.slice(1))})]}),i.assigned_user&&t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Assigned To"),":"]}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:i.assigned_user.name})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Progress"),":"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${i.progress||0}%`}})}),t.jsxs("span",{className:"text-gray-900 dark:text-white",children:[i.progress||0,"%"]})]})]}),i.start_date&&t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Start Date"),":"]}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:((W=window.appSettings)==null?void 0:W.formatDateTime(i.start_date,!1))||new Date(i.start_date).toLocaleDateString()})]}),i.due_date&&t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Due Date"),":"]}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:((H=window.appSettings)==null?void 0:H.formatDateTime(i.due_date,!1))||new Date(i.due_date).toLocaleDateString()})]}),i.description&&t.jsxs("div",{children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("Description"),":"]}),t.jsx("p",{className:"text-gray-900 dark:text-white mt-1",children:i.description})]})]})]})})]})}export{Re as default};
