import{r as h,j as e}from"./ui-C-VW1P-5.js";import{P as de}from"./page-template-CDM26U5Q.js";import{u as oe,K as ce,C as m,c as x,a as C,b as T,$ as M,B as p,T as Y,I as Z,S as D,d as me,X as xe}from"./app-BQKKzqf3.js";import{T as he,a as pe,b as g,c as j,d as ue,e as n}from"./table-Cm3ifs76.js";import{C as ee}from"./CrudDeleteModal-Bjo4FQXD.js";import{D as ge}from"./dollar-sign-BO1aYhXH.js";import{P as U}from"./package-BHhWwbAI.js";import{C as z}from"./calendar-BZ7v_rN9.js";import{T as je}from"./truck--5x8h15q.js";import{B as be}from"./building-DYqVTalU.js";import{E as fe}from"./eye-off-Dy-fpfrJ.js";import{S as Ne}from"./send-Ci4mpdkr.js";import{S as ve}from"./square-pen-DbvvCy40.js";import{A as ye}from"./arrow-left-CYc20UlY.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";function is(){var F,G,J,K,Q,X,V,W;const{t}=oe(),{purchaseOrder:a,streamItems:u,auth:l}=ce().props,$=((F=l==null?void 0:l.user)==null?void 0:F.type)==="company",[k,se]=h.useState(!0),[te,A]=h.useState(!1),[ae,O]=h.useState(!1),[re,le]=h.useState(null),[y,B]=h.useState(""),[ne,P]=h.useState(null),[L,H]=h.useState(""),ie=[{title:t("Dashboard"),href:route("dashboard")},{title:t("Purchase Orders"),href:route("purchase-orders.index")},{title:a.order_number}],R=s=>{const r={draft:"bg-gray-50 text-gray-600 ring-gray-500/10",sent:"bg-blue-50 text-blue-700 ring-blue-700/10",confirmed:"bg-green-50 text-green-700 ring-green-600/20",received:"bg-purple-50 text-purple-700 ring-purple-700/10",cancelled:"bg-red-50 text-red-700 ring-red-600/10"};return e.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${r[s]||r.draft}`,children:t((s==null?void 0:s.charAt(0).toUpperCase())+(s==null?void 0:s.slice(1)))||t("Draft")})},i=s=>{var r;return((r=window.appSettings)==null?void 0:r.formatCurrency(Number(s||0)))||`$${Number(s||0).toFixed(2)}`},q=s=>{var r;return s?((r=window.appSettings)==null?void 0:r.formatDateTime(s,!1))||new Date(s).toLocaleDateString():t("-")};return(()=>{var o;let s=0,r=0,d=0;return(o=a.products)==null||o.forEach(c=>{const w=Number(c.pivot.total_price)||0,b=Number(c.pivot.discount_amount)||0,f=w-b;s+=f,d+=b,c.tax&&(r+=f*Number(c.tax.rate)/100)}),{subtotal:s,totalTax:r,totalDiscount:d,grandTotal:s+r}})(),e.jsxs(de,{title:a.order_number,breadcrumbs:ie,actions:[{label:t("Back to Purchase Orders"),icon:e.jsx(ye,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>window.history.back()}],children:[e.jsxs("div",{className:"mx-auto space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-bold",children:a.name}),e.jsx("p",{className:"text-base text-gray-600 mt-2 leading-relaxed max-w-3xl",children:a.description||t("No description provided")})]}),e.jsxs("div",{className:"text-right ml-6",children:[R(a.status),e.jsx("p",{className:"text-sm font-medium text-gray-700 mt-2 font-mono",children:a.order_number})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{className:"border-l-4 border-l-green-500",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Total Amount")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-green-600 leading-none",children:i(a.total_amount)})]}),e.jsx("div",{className:"rounded-full bg-green-100 p-4",children:e.jsx(ge,{className:"h-5 w-5 text-green-600"})})]})})}),e.jsx(m,{className:"border-l-4 border-l-blue-500",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Products")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-blue-600 leading-none",children:((G=a.products)==null?void 0:G.length)||0})]}),e.jsx("div",{className:"rounded-full bg-blue-100 p-4",children:e.jsx(U,{className:"h-5 w-5 text-blue-600"})})]})})}),e.jsx(m,{className:"border-l-4 border-l-orange-500",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Order Date")}),e.jsx("h3",{className:"mt-2 text-lg font-bold text-purple-600 leading-tight",children:((J=window.appSettings)==null?void 0:J.formatDateTime(a.order_date,!1))||new Date(a.order_date).toLocaleDateString()})]}),e.jsx("div",{className:"rounded-full bg-orange-100 p-4",children:e.jsx(z,{className:"h-5 w-5 text-orange-600"})})]})})}),e.jsx(m,{className:"border-l-4 border-l-purple-500",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Expected Delivery")}),e.jsx("h3",{className:"mt-2 text-lg font-bold text-purple-600 leading-tight",children:((K=window.appSettings)==null?void 0:K.formatDateTime(a.expected_delivery_date,!1))||new Date(a.expected_delivery_date).toLocaleDateString()})]}),e.jsx("div",{className:"rounded-full bg-purple-100 p-4",children:e.jsx(je,{className:"h-5 w-5 text-purple-600"})})]})})})]}),e.jsxs(m,{className:"shadow-sm",children:[e.jsx(C,{className:"bg-gray-50 border-b",children:e.jsx(T,{className:"text-lg font-semibold",children:t("Purchase Order Information")})}),e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Order Number")}),e.jsx("p",{className:"text-sm mt-1",children:a.order_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Status")}),e.jsx("div",{className:"mt-1",children:R(a.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Created By")}),e.jsx("p",{className:"text-sm mt-1",children:((Q=a.creator)==null?void 0:Q.name)||t("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Assigned To")}),e.jsx("p",{className:"text-sm mt-1",children:((X=a.assigned_user)==null?void 0:X.name)||t("Unassigned")})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Subtotal")}),e.jsx("p",{className:"text-sm mt-1",children:i(a.subtotal)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Discount Amount")}),e.jsxs("p",{className:"text-sm mt-1",children:["-",i(a.discount_amount)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Created At")}),e.jsx("p",{className:"text-sm mt-1",children:q(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Updated At")}),e.jsx("p",{className:"text-sm mt-1",children:q(a.updated_at)})]})]})]})})]}),e.jsxs(m,{className:"shadow-sm",children:[e.jsx(C,{className:"bg-gray-50 border-b",children:e.jsxs(T,{className:"flex items-center text-lg font-semibold",children:[e.jsx(be,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Related Data")]})}),e.jsx(x,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.account&&e.jsxs("div",{className:"p-6 bg-green-50 rounded-xl border border-green-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:t("Account")}),e.jsx(M,{href:route("accounts.show",a.account.id),className:"text-base font-medium text-green-700 hover:text-green-900 hover:underline transition-colors",children:a.account.name})]}),a.sales_order&&e.jsxs("div",{className:"p-6 bg-purple-50 rounded-xl border border-purple-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:t("Sales Order")}),e.jsx(M,{href:route("sales-orders.show",a.sales_order.id),className:"text-base font-medium text-purple-700 hover:text-purple-900 hover:underline transition-colors",children:a.sales_order.name})]}),a.shipping_provider_type&&e.jsxs("div",{className:"p-6 bg-orange-50 rounded-xl border border-orange-200 hover:shadow-md transition-shadow",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:t("Shipping Provider")}),e.jsx(M,{href:route("shipping-provider-types.show",a.shipping_provider_type.id),className:"text-base font-medium text-orange-700 hover:text-orange-900 hover:underline transition-colors",children:a.shipping_provider_type.name})]})]})})]}),e.jsxs(m,{className:"shadow-sm",children:[e.jsx(C,{className:"bg-gray-50 border-b",children:e.jsxs(T,{className:"flex items-center text-lg font-semibold",children:[e.jsx(U,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Products")]})}),e.jsx(x,{className:"p-0",children:a.products&&a.products.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(he,{children:[e.jsx(pe,{children:e.jsxs(g,{className:"bg-gray-100",children:[e.jsx(j,{className:"text-base font-bold text-gray-900 py-4 px-6 w-1/3",children:t("Product")}),e.jsx(j,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Quantity")}),e.jsx(j,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Unit Price")}),e.jsx(j,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Discount")}),e.jsx(j,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Tax")}),e.jsx(j,{className:"text-right text-base font-bold text-gray-900 py-4 px-4 w-1/6",children:t("Total")})]})}),e.jsxs(ue,{children:[a.products.map((s,r)=>{const d=Number(s.pivot.total_price)||0,o=Number(s.pivot.discount_amount)||0,c=d-o;return e.jsxs(g,{className:"border-b hover:bg-gray-50",children:[e.jsx(n,{className:"font-semibold text-base text-gray-900 py-4 px-6",children:s.name}),e.jsx(n,{className:"text-right text-base font-medium py-4 px-4",children:s.pivot.quantity}),e.jsx(n,{className:"text-right text-base font-semibold py-4 px-4",children:i(s.pivot.unit_price)}),e.jsx(n,{className:"text-right py-4 px-4",children:s.pivot.discount_type&&s.pivot.discount_type!=="none"&&s.pivot.discount_value>0?e.jsxs("div",{className:"text-base",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:s.pivot.discount_type==="percentage"?`${Number(s.pivot.discount_value)}%`:i(Number(s.pivot.discount_value))}),e.jsxs("div",{className:"text-red-600 font-bold",children:["(-",i(o),")"]})]}):e.jsx("span",{className:"text-gray-500 font-medium",children:t("No Discount")})}),e.jsx(n,{className:"text-right text-base py-4 px-4",children:s.tax?e.jsxs("div",{className:"text-base",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:s.tax.name}),e.jsxs("div",{className:"text-gray-600 font-medium",children:["(",s.tax.rate,"%)"]})]}):e.jsx("span",{className:"text-gray-500 font-medium",children:t("No Tax")})}),e.jsx(n,{className:"text-right font-bold text-base py-4 px-4",children:o>0?e.jsxs("div",{children:[e.jsx("div",{className:"line-through text-gray-400 text-sm font-medium",children:i(d)}),e.jsx("div",{className:"text-green-600 font-semibold",children:i(c)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:i(d)})})]},r)}),e.jsxs(g,{className:"bg-gray-50 border-t-2",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[t("Total Discount"),":"]}),e.jsxs(n,{className:"text-right font-semibold text-base text-red-600 py-3 px-4",children:["-",i(a.discount_amount)]})]}),e.jsxs(g,{className:"bg-gray-50",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[t("Subtotal"),":"]}),e.jsx(n,{className:"text-right font-semibold text-base py-3 px-4",children:i(a.subtotal)})]}),e.jsxs(g,{className:"bg-gray-50",children:[e.jsxs(n,{colSpan:5,className:"text-right font-semibold text-base py-3 px-4",children:[t("Total Tax"),":"]}),e.jsx(n,{className:"text-right font-semibold text-base py-3 px-4",children:i(a.tax_amount)})]}),e.jsxs(g,{className:"bg-green-50 border-t-2",children:[e.jsxs(n,{colSpan:5,className:"text-right font-bold text-lg py-4 px-4",children:[t("Grand Total"),":"]}),e.jsx(n,{className:"text-right py-4 px-4",children:e.jsx("span",{className:"text-green-600 font-bold text-xl",children:i(a.total_amount)})})]})]})]})}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(U,{className:"h-16 w-16 mx-auto mb-6 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:t("No products added to this purchase order")})]})})]}),e.jsxs(m,{className:"shadow-sm",children:[e.jsx(C,{className:"bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"flex items-center text-lg font-semibold",children:[e.jsx(z,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Activity Stream")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>se(!k),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),t(k?"Hide":"Show")]}),u&&u.length>0&&$&&e.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>O(!0),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("Delete Stream")]})]})]})}),k&&e.jsxs(x,{className:"p-0",children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 p-6 pb-6 border-b mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((V=l==null?void 0:l.user)==null?void 0:V.avatar)||"/images/avatar/default.png",alt:((W=l==null?void 0:l.user)==null?void 0:W.name)||"User",className:"w-full h-full object-cover",onError:s=>{var d;const r=s.target;r.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((d=l==null?void 0:l.user)==null?void 0:d.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),e.jsx("div",{className:"flex-1",children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),y.trim()&&D.post(route("purchase-orders.comments.store",a.id),{comment:y},{preserveScroll:!0,onSuccess:()=>B("")})},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{placeholder:t("Add a comment..."),value:y,onChange:s=>B(s.target.value),className:"flex-1"}),e.jsx(p,{type:"submit",size:"sm",disabled:!y.trim(),children:e.jsx(Ne,{className:"h-4 w-4"})})]})})})]})}),e.jsx("div",{className:"p-6 pt-0 max-h-96 overflow-y-auto",children:u&&u.length>0?e.jsx("div",{className:"space-y-2",children:u.map((s,r)=>{var o,c,w,b,f;const d=N=>{const _=new Date(N),v=Math.floor((new Date().getTime()-_.getTime())/(1e3*60));if(v<1)return t("Just now");if(v<60)return t("{{count}} {{unit}} ago",{count:v,unit:t(v===1?"minute":"minutes")});const S=Math.floor(v/60);if(S<24)return t("{{count}} {{unit}} ago",{count:S,unit:t(S===1?"hour":"hours")});const E=Math.floor(S/24);return E<7?t("{{count}} {{unit}} ago",{count:E,unit:t(E===1?"day":"days")}):_.toLocaleDateString()};return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((o=s.user)==null?void 0:o.avatar)||"/images/avatar/default.png",alt:((c=s.user)==null?void 0:c.name)||"User",className:"w-full h-full object-cover",onError:N=>{var I;const _=N.target;_.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((I=s.user)==null?void 0:I.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),r<u.length-1&&e.jsx("div",{className:"w-px h-8 bg-gray-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 min-w-0 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:((w=s.user)==null?void 0:w.name)||t("System")}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:d(s.created_at)})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",dangerouslySetInnerHTML:{__html:s.title.replace(new RegExp(`^(${((b=s.user)==null?void 0:b.name)||"System"})`,"g"),'<span class="font-bold text-sm">$1</span>')}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center rounded-md px-2 py-1 text-xs font-medium bg-gray-50 text-gray-700 ring-1 ring-inset ring-gray-600/20",children:t(s.activity_type.charAt(0).toUpperCase()+s.activity_type.slice(1))}),$&&e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>{le(s),A(!0)},children:e.jsx(Y,{className:"h-3 w-3"})})]})]}),s.description&&e.jsx("div",{className:"mb-2",children:s.field_changed==="status"||s.field_changed==="name"||s.field_changed==="assigned_to"||s.description.includes("into")?e.jsx("p",{className:"text-sm text-gray-600",dangerouslySetInnerHTML:{__html:s.description}}):s.activity_type==="comment"?e.jsx("div",{children:ne===s.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{value:L,onChange:N=>H(N.target.value),className:"flex-1"}),e.jsx(p,{size:"sm",onClick:()=>{D.put(route("purchase-orders.comments.update-activity",{purchaseOrder:a.id,activity:s.id}),{comment:L},{preserveScroll:!0}),P(null)},children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>P(null),children:e.jsx(xe,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 flex-1",children:s.description}),s.user_id===((f=l==null?void 0:l.user)==null?void 0:f.id)&&e.jsx(p,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-400 hover:text-gray-600",onClick:()=>{P(s.id),H(s.description)},children:e.jsx(ve,{className:"h-3 w-3"})})]})}):e.jsx("p",{className:"text-sm text-gray-600",children:s.description})})]})]})]},s.id||r)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm",children:t("No activities found")})]})})]})]})]}),e.jsx(ee,{isOpen:te,onClose:()=>A(!1),onConfirm:()=>{D.delete(route("purchase-orders.delete-activity",{purchaseOrder:a.id,activity:re.id}),{preserveScroll:!0}),A(!1)},itemName:t("this activity"),entityName:t("activity")}),e.jsx(ee,{isOpen:ae,onClose:()=>O(!1),onConfirm:()=>{D.delete(route("purchase-orders.delete-activities",a.id),{preserveScroll:!0}),O(!1)},itemName:t("all activities for {{name}}",{name:a.name}),entityName:t("activities")})]})}export{is as default};
