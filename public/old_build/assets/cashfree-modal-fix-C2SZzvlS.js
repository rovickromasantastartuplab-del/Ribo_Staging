import{r as g,j as t}from"./ui-C-VW1P-5.js";import{l as I,E as C,u as w,a as F,C as S}from"./react-stripe.esm-DQmMnBY3.js";import{u as _,t as p,S as q,L as P,I as L,B as E}from"./app-BQKKzqf3.js";import{L as z}from"./loader-circle-DlS76Sc1.js";function D(i={}){const{t:o}=_(),[x,a]=g.useState(!1),u=async(d,e)=>{a(!0);const c={stripe:e.invoiceId?"invoice.stripe.payment":"stripe.payment",paypal:e.invoiceId?"invoice.paypal.payment":"paypal.payment",bank:e.invoiceId?"invoice.bank.payment":"bank.payment",payfast:e.invoiceId?"invoice.payfast.payment":"payfast.payment",tap:e.invoiceId?"invoice.tap.payment":"tap.payment",xendit:e.invoiceId?"invoice.xendit.payment":"xendit.payment",razorpay:"razorpay.payment",mercadopago:"mercadopago.payment",paystack:"paystack.payment",flutterwave:"flutterwave.payment"}[d];if(!c){p.error(o("Invalid payment method")),a(!1);return}const s=f(d,e);q.post(route(c),s,{onSuccess:n=>{var l,m,v;(m=(l=n.props)==null?void 0:l.flash)!=null&&m.success?p.success(o(n.props.flash.success)):p.success(o("Payment successful")),(v=i.onSuccess)==null||v.call(i)},onError:n=>{var m;const l=(n==null?void 0:n.message)||(n==null?void 0:n.error)||o("Payment failed");p.error(l),(m=i.onError)==null||m.call(i,l)},onFinish:()=>{a(!1)}})},y=(d,e)=>{const c={stripe:["payment_method_id","cardholder_name"],paypal:["order_id","payment_id"],bank:["amount"],payfast:["customer_details"],tap:[],xendit:[],razorpay:["payment_id","order_id","signature"],mercadopago:["payment_id","status"],paystack:["payment_id"],flutterwave:["payment_id"]}[d]||[];for(const s of c)if(!e[s])return p.error(o(`${s} is required`)),!1;return!0},f=(d,e)=>e.invoiceId?{invoice_id:e.invoiceId,amount:e.amount,payment_type:e.paymentType,...e}:{plan_id:e.planId,billing_cycle:e.billingCycle,coupon_code:e.couponCode||"",...e};return{processing:x,processPayment:u,validatePaymentData:y,formatPaymentData:f}}const M=({planId:i,couponCode:o,billingCycle:x,invoiceId:a,amount:u,paymentType:y,onSuccess:f,onCancel:d})=>{const{t:e}=_(),r=w(),c=F(),[s,n]=g.useState(""),{processing:l,processPayment:m}=D({onSuccess:f,onError:h=>p.error(h)}),v=async h=>{if(h.preventDefault(),!r||!c||!s.trim()){p.error(e("Please fill in all required fields"));return}const b=c.getElement(S);if(!b)return;const{error:j,paymentMethod:N}=await r.createPaymentMethod({type:"card",card:b,billing_details:{name:s}});if(j){p.error(j.message||e("Payment failed"));return}a&&u&&y?m("stripe",{invoiceId:a,amount:u,paymentType:y,payment_method_id:N.id,cardholder_name:s}):m("stripe",{planId:i,billingCycle:x,couponCode:o,payment_method_id:N.id,cardholder_name:s})},k={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}};return t.jsxs("form",{onSubmit:v,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(P,{htmlFor:"cardholder-name",children:e("Name on card")}),t.jsx(L,{id:"cardholder-name",type:"text",value:s,onChange:h=>n(h.target.value),placeholder:e("Enter cardholder name"),required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(P,{children:e("Card details")}),t.jsx("div",{className:"p-3 border rounded-md",children:t.jsx(S,{options:k})})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(E,{type:"button",variant:"outline",onClick:d,disabled:l,className:"flex-1",children:e("Cancel")}),t.jsx(E,{type:"submit",disabled:!r||l,className:"flex-1",children:l?t.jsxs(t.Fragment,{children:[t.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),e("Processing...")]}):e("Pay Now")})]})]})};function T({planId:i,couponCode:o,billingCycle:x,stripeKey:a,onSuccess:u,onCancel:y,invoiceId:f,amount:d,paymentType:e}){const{t:r}=_(),[c,s]=g.useState(null);return g.useEffect(()=>{a&&a.startsWith("pk_")&&s(I(a))},[a]),a?a.startsWith("pk_")?c?t.jsx(C,{stripe:c,children:t.jsx(M,{planId:i,couponCode:o,billingCycle:x,invoiceId:f,amount:d,paymentType:e,onSuccess:u,onCancel:y})}):t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:r("Loading Stripe...")})}):t.jsxs("div",{className:"p-4 text-center border rounded-md bg-destructive/10",children:[t.jsx("p",{className:"text-sm text-destructive mb-2",children:r("Invalid Stripe configuration")}),t.jsx("p",{className:"text-xs text-muted-foreground",children:r('Stripe publishable key must start with "pk_".')})]}):t.jsxs("div",{className:"p-4 text-center border rounded-md bg-muted/50",children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:r("Stripe not configured")}),t.jsx("p",{className:"text-xs text-muted-foreground",children:r("Please contact the company to configure Stripe payment settings.")})]})}export{T as S,D as u};
