import{r as p,j as e}from"./ui-C-VW1P-5.js";import{P as he}from"./page-template-CDM26U5Q.js";import{u as pe,K as ue,C as o,c as d,F as je,a as u,b as j,$ as g,B as c,T as Y,I as Z,S as _,d as ge,X as fe}from"./app-BQKKzqf3.js";import{T as Ne,a as be,b as w,c as C,d as ve,e as m}from"./table-Cm3ifs76.js";import{C as ee}from"./CrudDeleteModal-Bjo4FQXD.js";import{D as ye}from"./dollar-sign-BO1aYhXH.js";import{P as B}from"./package-BHhWwbAI.js";import{C as H}from"./calendar-BZ7v_rN9.js";import{B as we}from"./building-DYqVTalU.js";import{E as Ce}from"./eye-off-Dy-fpfrJ.js";import{S as Se}from"./send-Ci4mpdkr.js";import{S as ke}from"./square-pen-DbvvCy40.js";import{A as Te}from"./arrow-left-CYc20UlY.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";function ds(){var V,$,q,W,F,Q,G;const{t}=pe(),{opportunity:a,streamItems:f,auth:l,meetings:n}=ue().props,O=((V=l==null?void 0:l.user)==null?void 0:V.type)==="company",[D,se]=p.useState(!0),[te,M]=p.useState(!1),[ae,z]=p.useState(!1),[re,le]=p.useState(null),[S,E]=p.useState(""),[ne,A]=p.useState(null),[P,R]=p.useState(""),ie=[{title:t("Dashboard"),href:route("dashboard")},{title:t("Opportunities"),href:route("opportunities.index")},{title:a.name}],ce=s=>{const r={active:"bg-green-50 text-green-700 ring-green-600/20",inactive:"bg-red-50 text-red-700 ring-red-600/10"};return e.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${r[s]||r.active}`,children:(s==null?void 0:s.charAt(0).toUpperCase())+(s==null?void 0:s.slice(1))||"Active"})},x=s=>{var r;return((r=window.appSettings)==null?void 0:r.formatCurrency(Number(s||0)))||`$${Number(s||0).toFixed(2)}`},k=s=>{var r;return s?((r=window.appSettings)==null?void 0:r.formatDateTime(s,!1))||new Date(s).toLocaleDateString():t("-")},oe=()=>{var i;let s=0,r=0;return(i=a.products)==null||i.forEach(N=>{var v;const b=Number(((v=N.pivot)==null?void 0:v.total_price)||0);s+=b,N.tax&&b>0&&(r+=b*Number(N.tax.rate||0)/100)}),{subtotal:s,totalTax:r,grandTotal:s+r}},{subtotal:de,totalTax:me,grandTotal:xe}=oe();return e.jsxs(he,{title:a.name,breadcrumbs:ie,actions:[{label:t("Back to Opportunities"),icon:e.jsx(Te,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>window.history.back()}],children:[e.jsxs("div",{className:"mx-auto space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 leading-tight",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:a.description||t("No description provided")})]}),e.jsx("div",{className:"text-right ml-6",children:ce(a.status)})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(o,{className:"border-l-4 border-l-green-500",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Amount")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-green-600 leading-none",children:x(a.amount)})]}),e.jsx("div",{className:"rounded-full bg-green-100 p-4",children:e.jsx(ye,{className:"h-5 w-5 text-green-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-blue-500",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Products")}),e.jsx("h3",{className:"mt-2 text-2xl font-bold text-blue-600 leading-none",children:(($=a.products)==null?void 0:$.length)||0})]}),e.jsx("div",{className:"rounded-full bg-blue-100 p-4",children:e.jsx(B,{className:"h-5 w-5 text-blue-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-orange-500",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Close Date")}),e.jsx("h3",{className:"mt-2 text-lg font-bold text-orange-600 leading-tight",children:k(a.close_date)})]}),e.jsx("div",{className:"rounded-full bg-orange-100 p-4",children:e.jsx(H,{className:"h-5 w-5 text-orange-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-purple-500",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:t("Stage")}),e.jsx("div",{className:"mt-2",children:a.opportunity_stage?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.opportunity_stage.color}}),e.jsx("span",{className:"text-lg font-bold text-purple-600",children:a.opportunity_stage.name})]}):e.jsx("span",{className:"text-lg font-bold text-purple-600",children:t("-")})})]}),e.jsx("div",{className:"rounded-full bg-purple-100 p-4",children:e.jsx(je,{className:"h-5 w-5 text-purple-600"})})]})})})]}),e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsx(j,{className:"text-lg font-semibold",children:t("Opportunity Information")})}),e.jsx(d,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Amount")}),e.jsx("p",{className:"text-sm mt-1",children:x(a.amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Stage")}),e.jsx("div",{className:"mt-1",children:a.opportunity_stage?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.opportunity_stage.color}}),e.jsx("span",{children:a.opportunity_stage.name})]}):e.jsx("span",{className:"text-sm",children:t("-")})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Source")}),e.jsx("p",{className:"text-sm mt-1",children:((q=a.opportunity_source)==null?void 0:q.name)||t("-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Assigned To")}),e.jsx("p",{className:"text-sm mt-1",children:((W=a.assigned_user)==null?void 0:W.name)||t("Unassigned")})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Close Date")}),e.jsx("p",{className:"text-sm mt-1",children:k(a.close_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Created At")}),e.jsx("p",{className:"text-sm mt-1",children:k(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:t("Updated At")}),e.jsx("p",{className:"text-sm mt-1",children:k(a.updated_at)})]})]})]})})]}),e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(we,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Related Records")]})}),e.jsxs(d,{className:"space-y-6 p-8",children:[a.account&&e.jsxs("div",{className:"flex items-center justify-between p-6 bg-green-50 rounded-xl border border-green-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:t("Account")}),e.jsx(g,{href:route("accounts.show",a.account.id),className:"text-sm font-medium text-green-700 hover:text-green-900 hover:underline transition-colors",children:a.account.name})]}),e.jsx(g,{href:route("accounts.show",a.account.id),children:e.jsx(c,{variant:"outline",size:"sm",className:"bg-white",children:t("View")})})]}),a.contact&&e.jsxs("div",{className:"flex items-center justify-between p-6 bg-purple-50 rounded-xl border border-purple-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:t("Contact")}),e.jsx(g,{href:route("contacts.show",a.contact.id),className:"text-sm font-medium text-purple-700 hover:text-purple-900 hover:underline transition-colors",children:a.contact.name})]}),e.jsx(g,{href:route("contacts.show",a.contact.id),children:e.jsx(c,{variant:"outline",size:"sm",className:"bg-white",children:t("View")})})]})]})]}),(n==null?void 0:n.length)>0&&e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsx(j,{className:"text-lg font-semibold",children:t("Activities")})}),e.jsx(d,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground",children:[t("Meetings")," (",n.filter(s=>s.type!=="call").length,")"]})]}),e.jsxs("div",{className:"space-y-3",children:[n.filter(s=>s.type!=="call").slice(0,5).map(s=>{var r,i;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"h-4 w-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500",children:((r=window.appSettings)==null?void 0:r.formatDateTime(s.start_date,!1))||new Date(s.start_date).toLocaleDateString()}),e.jsx("p",{className:"text-xs text-gray-500",children:((i=s.assigned_user)==null?void 0:i.name)||t("Unassigned")})]})]}),e.jsx(g,{href:route("meetings.show",s.id),children:e.jsx(c,{variant:"outline",size:"sm",children:t("View")})})]},s.id)}),n.filter(s=>s.type!=="call").length>5&&e.jsx("p",{className:"text-sm text-gray-500 text-center",children:t("+{{count}} more meetings",{count:n.filter(s=>s.type!=="call").length-5})}),n.filter(s=>s.type!=="call").length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:t("No meetings found")})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground",children:[t("Calls")," (",n.filter(s=>s.type==="call").length,")"]})]}),e.jsxs("div",{className:"space-y-3",children:[n.filter(s=>s.type==="call").slice(0,5).map(s=>{var r,i;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"h-4 w-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500",children:((r=window.appSettings)==null?void 0:r.formatDateTime(s.start_date,!1))||new Date(s.start_date).toLocaleDateString()}),e.jsx("p",{className:"text-xs text-gray-500",children:((i=s.assigned_user)==null?void 0:i.name)||t("Unassigned")})]})]}),e.jsx(g,{href:route("meetings.show",s.id),children:e.jsx(c,{variant:"outline",size:"sm",children:t("View")})})]},s.id)}),n.filter(s=>s.type==="call").length>5&&e.jsx("p",{className:"text-sm text-gray-500 text-center",children:t("+{{count}} more calls",{count:n.filter(s=>s.type==="call").length-5})}),n.filter(s=>s.type==="call").length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:t("No calls found")})]})]})]})})]}),e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(B,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Products")]})}),e.jsx(d,{className:"p-0",children:a.products&&a.products.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(Ne,{children:[e.jsx(be,{children:e.jsxs(w,{className:"bg-gray-100",children:[e.jsx(C,{className:"text-base font-bold text-gray-900 py-4 px-6 w-1/3",children:t("Product")}),e.jsx(C,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Quantity")}),e.jsx(C,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Unit Price")}),e.jsx(C,{className:"text-right text-base font-bold text-gray-900 py-4 px-4",children:t("Tax")}),e.jsx(C,{className:"text-right text-base font-bold text-gray-900 py-4 px-4 w-1/6",children:t("Total")})]})}),e.jsxs(ve,{children:[a.products.map((s,r)=>e.jsxs(w,{className:"border-b hover:bg-gray-50",children:[e.jsx(m,{className:"font-semibold text-base text-gray-900 py-4 px-6",children:s.name}),e.jsx(m,{className:"text-right text-base font-medium py-4 px-4",children:s.pivot.quantity}),e.jsx(m,{className:"text-right text-base font-semibold py-4 px-4",children:x(s.pivot.unit_price)}),e.jsx(m,{className:"text-right text-base py-4 px-4",children:s.tax?e.jsxs("div",{className:"text-base",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:s.tax.name}),e.jsxs("div",{className:"text-gray-600 font-medium",children:["(",s.tax.rate,"%)"]})]}):e.jsx("span",{className:"text-gray-500 font-medium",children:t("No Tax")})}),e.jsx(m,{className:"text-right font-semibold text-base py-4 px-4",children:e.jsx("span",{className:"text-green-600",children:x(s.pivot.total_price)})})]},r)),e.jsxs(w,{className:"bg-gray-50",children:[e.jsxs(m,{colSpan:4,className:"text-right font-semibold text-base py-3 px-4",children:[t("Subtotal"),":"]}),e.jsx(m,{className:"text-right font-semibold text-base py-3 px-4",children:x(de)})]}),e.jsxs(w,{className:"bg-gray-50",children:[e.jsxs(m,{colSpan:4,className:"text-right font-semibold text-base py-3 px-4",children:[t("Total Tax"),":"]}),e.jsx(m,{className:"text-right font-semibold text-base py-3 px-4",children:x(me)})]}),e.jsxs(w,{className:"bg-green-50 border-t-2",children:[e.jsxs(m,{colSpan:4,className:"text-right font-bold text-lg py-4 px-4",children:[t("Grand Total"),":"]}),e.jsx(m,{className:"text-right py-4 px-4",children:e.jsx("span",{className:"text-green-600 font-bold text-xl",children:x(xe)})})]})]})]})}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(B,{className:"h-16 w-16 mx-auto mb-6 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:t("No products added to this opportunity")})]})})]}),((F=a.quotes)==null?void 0:F.length)>0&&e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsxs(j,{className:"text-lg font-semibold",children:[t("Related Quotes")," (",a.quotes.length,")"]})}),e.jsx(d,{className:"p-8",children:e.jsx("div",{className:"space-y-6",children:a.quotes.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-6 bg-blue-50 rounded-xl border border-blue-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-bold text-gray-900",children:s.quote_number}),e.jsx("p",{className:"text-base text-gray-700 mt-1",children:s.name})]}),e.jsx(g,{href:route("quotes.show",s.id),children:e.jsx(c,{variant:"outline",size:"sm",className:"bg-white",children:t("View")})})]},s.id))})})]}),e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(H,{className:"h-5 w-5 mr-3 text-muted-foreground"}),t("Activity Stream")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>se(!D),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),t(D?"Hide":"Show")]}),f&&f.length>0&&O&&e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>z(!0),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("Delete Stream")]})]})]})}),D&&e.jsxs(d,{className:"p-0",children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 p-6 pb-6 border-b mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((Q=l==null?void 0:l.user)==null?void 0:Q.avatar)||"/images/avatar/default.png",alt:((G=l==null?void 0:l.user)==null?void 0:G.name)||"User",className:"w-full h-full object-cover",onError:s=>{var i;const r=s.target;r.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((i=l==null?void 0:l.user)==null?void 0:i.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),e.jsx("div",{className:"flex-1",children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),S.trim()&&_.post(route("opportunities.comments.store",a.id),{comment:S},{preserveScroll:!0,onSuccess:()=>E("")})},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{placeholder:t("Add a comment..."),value:S,onChange:s=>E(s.target.value),className:"flex-1"}),e.jsx(c,{type:"submit",size:"sm",disabled:!S.trim(),children:e.jsx(Se,{className:"h-4 w-4"})})]})})})]})}),e.jsx("div",{className:"p-6 pt-0 max-h-96 overflow-y-auto",children:f&&f.length>0?e.jsx("div",{className:"space-y-2",children:f.map((s,r)=>{var N,b,v,J,K;const i=h=>{var X;const L=new Date(h),y=Math.floor((new Date().getTime()-L.getTime())/(1e3*60));if(y<1)return t("Just now");if(y<60)return t("{{count}} {{unit}} ago",{count:y,unit:t(y===1?"minute":"minutes")});const T=Math.floor(y/60);if(T<24)return t("{{count}} {{unit}} ago",{count:T,unit:t(T===1?"hour":"hours")});const U=Math.floor(T/24);return U<7?t("{{count}} {{unit}} ago",{count:U,unit:t(U===1?"day":"days")}):((X=window.appSettings)==null?void 0:X.formatDateTime(h,!1))||new Date(h).toLocaleDateString()};return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:((N=s.user)==null?void 0:N.avatar)||"/images/avatar/default.png",alt:((b=s.user)==null?void 0:b.name)||"User",className:"w-full h-full object-cover",onError:h=>{var I;const L=h.target;L.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(((I=s.user)==null?void 0:I.name)||"User")}&background=e5e7eb&color=374151&size=32`}})}),r<f.length-1&&e.jsx("div",{className:"w-px h-8 bg-gray-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 min-w-0 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:((v=s.user)==null?void 0:v.name)||t("System")}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:i(s.created_at)})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",dangerouslySetInnerHTML:{__html:s.title.replace(new RegExp(`^(${((J=s.user)==null?void 0:J.name)||t("System")})`,"g"),'<span class="font-bold text-base">$1</span>')}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center rounded-md px-2 py-1 text-xs font-medium bg-gray-50 text-gray-700 ring-1 ring-inset ring-gray-600/20",children:s.activity_type.charAt(0).toUpperCase()+s.activity_type.slice(1)}),O&&e.jsx(c,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>{le(s),M(!0)},children:e.jsx(Y,{className:"h-3 w-3"})})]})]}),s.description&&e.jsx("div",{className:"mb-2",children:s.activity_type==="comment"?e.jsx("div",{children:ne===s.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{value:P,onChange:h=>R(h.target.value),className:"flex-1"}),e.jsx(c,{size:"sm",onClick:()=>{_.put(route("opportunities.comments.update-activity",{opportunity:a.id,activity:s.id}),{comment:P},{preserveScroll:!0}),A(null)},children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>A(null),children:e.jsx(fe,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 flex-1",children:s.description}),s.user_id===((K=l==null?void 0:l.user)==null?void 0:K.id)&&e.jsx(c,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-400 hover:text-gray-600",onClick:()=>{A(s.id),R(s.description)},children:e.jsx(ke,{className:"h-3 w-3"})})]})}):s.description.includes("into")?e.jsx("p",{className:"text-sm text-gray-600",dangerouslySetInnerHTML:{__html:s.description}}):e.jsx("p",{className:"text-sm text-gray-600",children:s.description})})]})]})]},s.id||r)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm",children:t("No activities found")})]})})]})]}),a.notes&&e.jsxs(o,{className:"shadow-sm",children:[e.jsx(u,{className:"bg-gray-50 border-b px-8 py-6",children:e.jsx(j,{className:"text-lg font-semibold",children:t("Notes")})}),e.jsx(d,{className:"p-8",children:e.jsx("p",{className:"text-base whitespace-pre-wrap text-gray-700 leading-relaxed",children:a.notes})})]})]}),e.jsx(ee,{isOpen:te,onClose:()=>M(!1),onConfirm:()=>{_.delete(route("opportunities.delete-activity",{opportunity:a.id,activity:re.id}),{preserveScroll:!0}),M(!1)},itemName:t("this activity"),entityName:t("activity")}),e.jsx(ee,{isOpen:ae,onClose:()=>z(!1),onConfirm:()=>{_.delete(route("opportunities.delete-activities",a.id),{preserveScroll:!0}),z(!1)},itemName:t("all activities for {{name}}",{name:a.name}),entityName:t("activities")})]})}export{ds as default};
