import{r as j,j as r}from"./ui-C-VW1P-5.js";import{P as ve}from"./page-template-CDM26U5Q.js";import{u as Se,K as we,h as Fe,P as je,$ as Ne,S as F,t as c}from"./app-BQKKzqf3.js";import{C as Te}from"./CrudTable-DuIO85h3.js";import{C as Ce}from"./CrudFormModal-BgN_j_X-.js";import{C as $e}from"./CrudDeleteModal-Bjo4FQXD.js";import{P as Pe}from"./pagination-mhOv5uX0.js";import{S as Ae}from"./search-and-filter-bar-CB2HkcPS.js";import"./vendor-CxtKjBZA.js";import"./textarea-BvlD1v8z.js";import"./select-ivmaqUw7.js";import"./index-IS-ASe-l.js";import"./chevron-up-5kET5X99.js";import"./react-country-flag.esm-B_SRkH7q.js";import"./language-BbwPiY59.js";import"./loader-circle-DlS76Sc1.js";import"./copy-D-hAzd4M.js";import"./language-switcher-BX314FqS.js";import"./switch-T0u5R7d_.js";import"./refresh-cw-BnxOCyDc.js";import"./globe-BSt65iB3.js";import"./settings-G3vQs6CU.js";import"./chevron-right-C7M1oeKV.js";import"./credit-card-CmRw-oUn.js";import"./dollar-sign-BO1aYhXH.js";import"./mail-DI9tSiFs.js";import"./users-CrY8npWB.js";import"./package-BHhWwbAI.js";import"./calendar-BZ7v_rN9.js";import"./phone-B9JuG5Em.js";import"./trending-up-BUQ_r1Kz.js";import"./user-B-NTs7Zv.js";import"./use-favicon-D-Hpb8YY.js";import"./utils-DCj7OOX3.js";import"./table-Cm3ifs76.js";import"./activity-BlqoVjjD.js";import"./unlink-CIrE65Ci.js";import"./archive-Clb3Wsap.js";import"./arrow-left-CYc20UlY.js";import"./arrow-right-B7V9NE53.js";import"./circle-help-DoNFXKiW.js";import"./lock-open-CBxZhRNn.js";import"./award-ClOH67b_.js";import"./wallet-G_F5INNy.js";import"./key-D9NdYYsw.js";import"./webhook-DRgOw1J7.js";import"./store-W0ENpN1D.js";import"./building-DYqVTalU.js";import"./camera-Cy0DV6zN.js";import"./chart-column-DLMw04GC.js";import"./chart-pie-C3AvH4oN.js";import"./chevron-left-Cy-TANhf.js";import"./circle-alert-Ba7f7jIF.js";import"./circle-check-big-ClvvRvVa.js";import"./circle-BMwBABJJ.js";import"./clock-DRJ3azky.js";import"./code-DoOxvyWM.js";import"./grid-3x3-B93v7dH2.js";import"./download-CUJ4p28I.js";import"./ellipsis-BsqioQZd.js";import"./external-link-nVhYE8Jw.js";import"./eye-off-Dy-fpfrJ.js";import"./eye-DxUCHEvv.js";import"./instagram-Dy7YsGuh.js";import"./file-2l6WoCvh.js";import"./folder-open-Berbn4mP.js";import"./grip-vertical-hmSrLZiM.js";import"./hard-drive-CBRsIzd1.js";import"./heart-CUqaTJ0A.js";import"./indian-rupee-D8_RKA6E.js";import"./info-ZEKNfV81.js";import"./lightbulb-B6cGkit3.js";import"./link-2-ZacHXNCA.js";import"./twitter-DwqeIVgg.js";import"./list-D15qstQa.js";import"./lock-DLCREvz4.js";import"./map-pin-BDUdmeW2.js";import"./menu-DkHdB524.js";import"./message-square-DJa7rgfT.js";import"./monitor-BaCWvDIc.js";import"./percent-Ca67PI5w.js";import"./play-BIO6trhV.js";import"./power-ph8Hxezk.js";import"./printer-CMSe0GyN.js";import"./wifi-D3ejDzoN.js";import"./quote-D-eoVvuu.js";import"./send-Ci4mpdkr.js";import"./server-VPjmlBKw.js";import"./shield-DgdOjZQK.js";import"./shopping-cart-BQ16UXZH.js";import"./square-check-big-BV0umpWv.js";import"./square-pen-DbvvCy40.js";import"./star-D7bZLLWj.js";import"./tag-Cr3RI_n7.js";import"./target-BI71-IGe.js";import"./triangle-alert-DtTk7Xcn.js";import"./truck--5x8h15q.js";import"./type-CuVOkJfB.js";import"./user-plus-BGAma7su.js";import"./weight-Ch9O_shw.js";import"./zap-CYBGuK61.js";import"./radio-group-CSjni1r3.js";import"./checkbox-mSB0gHip.js";import"./scroll-area-vUH8MN0-.js";function Cr(){var X,Y,Z,ee,te,re,se,oe,ae;const{t}=Se(),{auth:T,returnOrders:d,salesOrders:D,accounts:k,contacts:R,products:u,shippingProviderTypes:O,users:V=[],filters:y={}}=we().props,I=(T==null?void 0:T.permissions)||[],U=((X=T==null?void 0:T.user)==null?void 0:X.type)==="company",[C,L]=j.useState(y.search||""),[h,K]=j.useState(y.status||"all"),[v,G]=j.useState(y.assigned_to||"all"),[ie,W]=j.useState(!1),[ne,P]=j.useState(!1),[le,E]=j.useState(!1),[a,z]=j.useState(null),[i,B]=j.useState("create"),de=()=>C!==""||h!=="all"||v!=="all",pe=()=>(C?1:0)+(h!=="all"?1:0)+(v!=="all"?1:0),ce=e=>{e.preventDefault(),Q()},Q=()=>{F.get(route("return-orders.index"),{page:1,search:C||void 0,status:h!=="all"?h:void 0,assigned_to:v!=="all"?v:void 0,per_page:y.per_page},{preserveState:!0,preserveScroll:!0})},me=e=>{const o=y.sort_field===e&&y.sort_direction==="desc"?"asc":"desc";F.get(route("return-orders.index"),{sort_field:e,sort_direction:o,page:1,search:C||void 0,status:h!=="all"?h:void 0,assigned_to:v!=="all"?v:void 0,per_page:y.per_page},{preserveState:!0,preserveScroll:!0})},ue=(e,o)=>{switch(z(o),e){case"view":F.get(route("return-orders.show",o.id));break;case"edit":B("edit"),P(!0);break;case"delete":E(!0);break}},ge=()=>{z(null),B("create"),P(!0)},be=e=>{if(["sales_order_id","account_id","contact_id","shipping_provider_type_id","assigned_to"].forEach(s=>{(e[s]===""||e[s]==="null"||e[s]==="none")&&(e[s]=null)}),e.products&&e.products.length>0){let s=0,n=0;e.products.forEach(p=>{const _=parseFloat(p.quantity)||0,g=parseFloat(p.unit_price)||0,b=_*g,m=p.discount_type,l=parseFloat(p.discount_value)||0;let N=0;m&&m!=="none"&&(m==="percentage"?N=b*l/100:m==="fixed"&&(N=Math.min(l,b)));const $=b-N;s+=$;const x=u==null?void 0:u.find(f=>f.id==p.product_id);x!=null&&x.tax&&(n+=$*x.tax.rate/100)}),e.subtotal=s,e.tax_amount=n,e.total_amount=s+n}i==="create"?(c.loading(t("Creating return order...")),F.post(route("return-orders.store"),e,{onSuccess:s=>{P(!1),c.dismiss(),s.props.flash.success&&c.success(t(s.props.flash.success))},onError:s=>{c.dismiss(),c.error(t("Failed to create: {{errors}}",{errors:Object.values(s).join(", ")}))}})):i==="edit"&&(c.loading(t("Updating return order...")),F.put(route("return-orders.update",a.id),e,{onSuccess:s=>{P(!1),c.dismiss(),s.props.flash.success?c.success(t(s.props.flash.success)):s.props.flash.error&&c.error(t(s.props.flash.error))},onError:s=>{c.dismiss(),c.error(t("Failed to update: {{errors}}",{errors:Object.values(s).join(", ")}))}}))},xe=()=>{c.loading(t("Deleting return order...")),F.delete(route("return-orders.destroy",a.id),{onSuccess:e=>{E(!1),c.dismiss(),e.props.flash.success?c.success(t(e.props.flash.success)):e.props.flash.error&&c.error(t(e.props.flash.error))},onError:e=>{c.dismiss(),c.error(t("Failed to delete: {{errors}}",{errors:Object.values(e).join(", ")}))}})},ye=()=>{L(""),K("all"),G("all"),W(!1),F.get(route("return-orders.index"),{page:1,per_page:y.per_page},{preserveState:!0,preserveScroll:!0})},H=[];Fe(I,"create-return-orders")&&H.push({label:t("Add Return Order"),icon:r.jsx(je,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>ge()});const _e=[{title:t("Dashboard"),href:route("dashboard")},{title:t("Return Orders")}],fe=[{key:"return_number",label:t("Return Number"),sortable:!0,render:(e,o)=>r.jsx(Ne,{href:route("return-orders.show",o.id),className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md bg-blue-50 text-blue-700 hover:bg-blue-100 hover:text-blue-800 transition-colors duration-200 border border-blue-200 hover:border-blue-300",children:e})},{key:"name",label:t("Name"),sortable:!0},{key:"sales_order",label:t("Sales Order"),render:e=>(e==null?void 0:e.order_number)||t("-")},{key:"account",label:t("Account"),render:e=>(e==null?void 0:e.name)||t("-")},{key:"status",label:t("Status"),render:e=>{const o={pending:"bg-yellow-50 text-yellow-700 ring-yellow-600/20",approved:"bg-blue-50 text-blue-700 ring-blue-600/20",shipped:"bg-purple-50 text-purple-700 ring-purple-600/20",received:"bg-green-50 text-green-700 ring-green-600/20",processed:"bg-green-50 text-green-700 ring-green-600/20",cancelled:"bg-red-50 text-red-700 ring-red-600/20"};return r.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${o[e]||o.pending}`,children:t((e==null?void 0:e.charAt(0).toUpperCase())+(e==null?void 0:e.slice(1)))||t("Pending")})}},{key:"reason",label:t("Reason"),render:e=>({defective:t("Defective"),wrong_item:t("Wrong Item"),damaged:t("Damaged"),not_needed:t("Not Needed"),other:t("Other")})[e]||e},{key:"total_amount",label:t("Total Amount"),render:e=>{var o;return((o=window.appSettings)==null?void 0:o.formatCurrency(Number(e||0)))||`$${Number(e||0).toFixed(2)}`}},{key:"return_date",label:t("Return Date"),sortable:!0,render:e=>{var o;return e?((o=window.appSettings)==null?void 0:o.formatDateTime(e,!1))||new Date(e).toLocaleDateString():t("-")}},{key:"assigned_user",label:t("Assigned To"),render:e=>(e==null?void 0:e.name)||t("Unassigned")}],he=[{label:t("View"),icon:"Eye",action:"view",className:"text-blue-500",requiredPermission:"view-return-orders"},{label:t("Edit"),icon:"Edit",action:"edit",className:"text-amber-500",requiredPermission:"edit-return-orders"},{label:t("Delete"),icon:"Trash2",action:"delete",className:"text-red-500",requiredPermission:"delete-return-orders"}],J=[{value:"all",label:t("All Status")},{value:"pending",label:t("Pending")},{value:"approved",label:t("Approved")},{value:"shipped",label:t("Shipped")},{value:"received",label:t("Received")},{value:"processed",label:t("Processed")},{value:"cancelled",label:t("Cancelled")}];return r.jsxs(ve,{title:t("Return Orders"),url:"/return-orders",actions:H,breadcrumbs:_e,noPadding:!0,children:[r.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:r.jsx(Ae,{searchTerm:C,onSearchChange:L,onSearch:ce,filters:[{name:"status",label:t("Status"),type:"select",value:h,onChange:K,options:J},...U?[{name:"assigned_to",label:t("Assigned To"),type:"select",value:v,onChange:G,options:[{value:"all",label:t("All Users")},{value:"unassigned",label:t("Unassigned")},...V.map(e=>({value:e.id.toString(),label:e.name}))]}]:[]],showFilters:ie,setShowFilters:W,hasActiveFilters:de,activeFilterCount:pe,onResetFilters:ye,onApplyFilters:Q,currentPerPage:((Y=y.per_page)==null?void 0:Y.toString())||"10",onPerPageChange:e=>{F.get(route("return-orders.index"),{page:1,per_page:parseInt(e),search:C||void 0,status:h!=="all"?h:void 0,assigned_to:v!=="all"?v:void 0},{preserveState:!0,preserveScroll:!0})}})}),r.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[r.jsx(Te,{columns:fe,actions:he,data:(d==null?void 0:d.data)||[],from:(d==null?void 0:d.from)||1,onAction:ue,sortField:y.sort_field,sortDirection:y.sort_direction,onSort:me,permissions:I,entityPermissions:{view:"view-return-orders",create:"create-return-orders",edit:"edit-return-orders",delete:"delete-return-orders"}}),r.jsx(Pe,{from:(d==null?void 0:d.from)||0,to:(d==null?void 0:d.to)||0,total:(d==null?void 0:d.total)||0,links:d==null?void 0:d.links,entityName:t("return orders"),onPageChange:e=>F.get(e)})]}),r.jsx(Ce,{isOpen:ne,onClose:()=>P(!1),onSubmit:be,formConfig:{modalSize:"4xl",layout:"grid",columns:2,dependencyConfig:{sales_order_id:{endpoint:"/api/return-orders/sales-orders/{id}/details",targetFields:["account_id","contact_id","products"]}},fields:[{name:"name",label:t("Name"),type:"text",required:!0,colSpan:2},{name:"description",label:t("Description"),type:"textarea",colSpan:2},{name:i==="view"?"sales_order_name":"sales_order_id",label:t("Sales Order"),type:i==="view"?"text":"select",required:!0,readOnly:i==="view",options:i==="view"?[]:[...(D==null?void 0:D.map(e=>({value:e.id.toString(),label:`${e.order_number} - ${e.name}`})))||[]]},{name:i==="view"?"account_name":"account_id",label:t("Account"),type:i==="view"?"text":"select",readOnly:i==="view",options:i==="view"?[]:[...(k==null?void 0:k.map(e=>({value:e.id.toString(),label:e.name})))||[]]},{name:i==="view"?"contact_name":"contact_id",label:t("Contact"),type:i==="view"?"text":"select",readOnly:i==="view",options:i==="view"?[]:[...(R==null?void 0:R.map(e=>({value:e.id.toString(),label:e.name})))||[]]},{name:i==="view"?"shipping_provider_name":"shipping_provider_type_id",label:t("Shipping Provider"),type:i==="view"?"text":"select",readOnly:i==="view",options:i==="view"?[]:[...(O==null?void 0:O.map(e=>({value:e.id.toString(),label:e.name})))||[]]},{name:"tracking_number",label:t("Tracking Number"),type:"text"},{name:"status",label:t("Status"),type:"select",options:J.filter(e=>e.value!=="all"),defaultValue:"pending"},{name:"reason",label:t("Return Reason"),type:"select",required:!0,options:[{value:"defective",label:t("Defective")},{value:"wrong_item",label:t("Wrong Item")},{value:"damaged",label:t("Damaged")},{value:"not_needed",label:t("Not Needed")},{value:"other",label:t("Other")}],defaultValue:"other"},{name:"reason_description",label:t("Reason Description"),type:"textarea",colSpan:2},{name:"return_date",label:t("Return Date"),type:"date",required:!0,defaultValue:new Date().toISOString().split("T")[0]},...U?[{name:i==="view"?"assigned_user_name":"assigned_to",label:t("Assign To"),type:i==="view"?"text":"select",options:i==="view"?[]:[...V.map(e=>({value:e.id.toString(),label:`${e.name} (${e.email})`}))],readOnly:i==="view"}]:[],{name:"products_header",type:"custom",colSpan:2,render:()=>r.jsx("div",{className:"col-span-2 border-t pt-4 mt-4",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:t("Products & Services")})})},{name:"products",label:t("Products"),type:"array",colSpan:2,productOptions:u,renderFooter:(e,o)=>{var _,g,b,m;let s=0,n=0,p=0;try{e.forEach(l=>{const N=parseFloat(l.quantity)||0,$=parseFloat(l.unit_price)||0,x=N*$,f=l.discount_type,A=parseFloat(l.discount_value)||0;let S=0;f&&f!=="none"&&(f==="percentage"?S=x*A/100:f==="fixed"&&(S=Math.min(A,x)));const q=x-S;s+=q,p+=S;const w=u==null?void 0:u.find(M=>M.id==l.product_id);w!=null&&w.tax&&(n+=q*w.tax.rate/100)})}catch(l){console.error("Error calculating totals:",l)}return r.jsxs(r.Fragment,{children:[r.jsxs("tr",{className:"bg-gray-50",children:[r.jsxs("td",{colSpan:5,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[t("Total Discount"),":"]}),r.jsxs("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right text-red-600",children:["-",((_=window.appSettings)==null?void 0:_.formatCurrency(p))||`$${p.toFixed(2)}`]})]}),r.jsxs("tr",{className:"bg-gray-50",children:[r.jsxs("td",{colSpan:5,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[t("Subtotal"),":"]}),r.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((g=window.appSettings)==null?void 0:g.formatCurrency(s))||`$${s.toFixed(2)}`})]}),r.jsxs("tr",{className:"bg-gray-50",children:[r.jsxs("td",{colSpan:5,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[t("Total Tax"),":"]}),r.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((b=window.appSettings)==null?void 0:b.formatCurrency(n))||`$${n.toFixed(2)}`})]}),r.jsxs("tr",{className:"bg-gray-100 font-bold",children:[r.jsxs("td",{colSpan:5,className:"border border-gray-200 px-3 py-2 text-sm text-right",children:[t("Grand Total"),":"]}),r.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm text-right",children:((m=window.appSettings)==null?void 0:m.formatCurrency(s+n))||`$${(s+n).toFixed(2)}`})]})]})},renderSummary:(e,o)=>{var _,g,b,m;let s=0,n=0,p=0;try{e.forEach(l=>{const N=parseFloat(l.quantity)||0,$=parseFloat(l.unit_price)||0,x=N*$,f=l.discount_type,A=parseFloat(l.discount_value)||0;let S=0;f&&f!=="none"&&(f==="percentage"?S=x*A/100:f==="fixed"&&(S=Math.min(A,x)));const q=x-S;s+=q,p+=S;const w=u==null?void 0:u.find(M=>M.id==l.product_id);w!=null&&w.tax&&(n+=q*w.tax.rate/100)})}catch(l){console.error("Error calculating summary:",l)}return r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"font-medium text-gray-700",children:[t("Total Discount"),":"]}),r.jsxs("span",{className:"font-medium text-red-600",children:["-",((_=window.appSettings)==null?void 0:_.formatCurrency(p))||`$${p.toFixed(2)}`]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"font-medium text-gray-700",children:[t("Subtotal"),":"]}),r.jsx("span",{className:"font-medium",children:((g=window.appSettings)==null?void 0:g.formatCurrency(s))||`$${s.toFixed(2)}`})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"font-medium text-gray-700",children:[t("Total Tax"),":"]}),r.jsx("span",{className:"font-medium",children:((b=window.appSettings)==null?void 0:b.formatCurrency(n))||`$${n.toFixed(2)}`})]}),r.jsxs("div",{className:"flex justify-between items-center border-t pt-2",children:[r.jsxs("span",{className:"font-bold text-gray-900",children:[t("Grand Total"),":"]}),r.jsx("span",{className:"font-bold text-lg text-primary",children:((m=window.appSettings)==null?void 0:m.formatCurrency(s+n))||`$${(s+n).toFixed(2)}`})]})]})},fields:[{name:"product_id",label:t("Product"),type:"select",required:!0,options:(u==null?void 0:u.map(e=>{var o;return{value:e.id,label:`${e.name} - ${((o=window.appSettings)==null?void 0:o.formatCurrency(parseFloat(e.price||0)))||`$${parseFloat(e.price||0).toFixed(2)}`}${e.tax?` (Tax: ${e.tax.name} - ${e.tax.rate}%)`:""}`}}))||[]},{name:"quantity",label:t("Quantity"),type:"number",required:!0,min:"1",defaultValue:1},{name:"unit_price",label:t("Unit Price"),type:"number",required:!0,step:"0.01",min:"0"},{name:"discount_type",label:t("Discount Type"),type:"select",options:[{value:"percentage",label:t("Percentage (%)")},{value:"fixed",label:t("Fixed Amount")}]},{name:"discount_value",label:t("Discount Value"),type:"number",step:"0.01",min:"0"},{name:"line_total",label:t("Final Total"),type:"calculated",calculate:e=>{var o,s;try{const n=parseFloat(e.quantity)||0,p=parseFloat(e.unit_price)||0,_=n*p,g=e.discount_type,b=parseFloat(e.discount_value)||0;let m=0;g&&g!=="none"&&(g==="percentage"?m=_*b/100:g==="fixed"&&(m=Math.min(b,_)));const l=_-m;return((o=window.appSettings)==null?void 0:o.formatCurrency(l))||`$${l.toFixed(2)}`}catch{return((s=window.appSettings)==null?void 0:s.formatCurrency(0))||"$0.00"}}}]},{name:"notes",label:t("Notes"),type:"textarea",colSpan:2}]},initialData:a?{...a,assigned_user_name:((Z=a.assigned_user)==null?void 0:Z.name)||t("Unassigned"),sales_order_name:((ee=a.sales_order)==null?void 0:ee.name)||t("-"),account_name:((te=a.account)==null?void 0:te.name)||t("-"),contact_name:((re=a.contact)==null?void 0:re.name)||t("-"),shipping_provider_name:((se=a.shipping_provider_type)==null?void 0:se.name)||t("-"),sales_order_id:a.sales_order_id?a.sales_order_id.toString():"",account_id:a.account_id?a.account_id.toString():"",contact_id:a.contact_id?a.contact_id.toString():"",shipping_provider_type_id:a.shipping_provider_type_id?a.shipping_provider_type_id.toString():"",assigned_to:a.assigned_to?a.assigned_to.toString():"",return_date:i==="view"&&a.return_date?((oe=window.appSettings)==null?void 0:oe.formatDateTime(a.return_date,!1))||new Date(a.return_date).toLocaleDateString():a.return_date,products:((ae=a.products)==null?void 0:ae.map(e=>{var o,s,n,p;return{product_id:e.id,quantity:parseInt(((o=e.pivot)==null?void 0:o.quantity)||1),unit_price:parseFloat(((s=e.pivot)==null?void 0:s.unit_price)||e.price||0),discount_type:((n=e.pivot)==null?void 0:n.discount_type)||"none",discount_value:parseFloat(((p=e.pivot)==null?void 0:p.discount_value)||0)}}))||[]}:null,title:t(i==="create"?"Add New Return Order":i==="edit"?"Edit Return Order":"View Return Order"),mode:i}),r.jsx($e,{isOpen:le,onClose:()=>E(!1),onConfirm:xe,itemName:(a==null?void 0:a.name)||"",entityName:t("return order")})]})}export{Cr as default};
