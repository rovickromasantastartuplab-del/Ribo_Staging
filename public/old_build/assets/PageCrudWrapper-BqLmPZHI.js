import{r as j,j as a}from"./ui-C-VW1P-5.js";import{P as me}from"./page-template-CDM26U5Q.js";import{u as fe,K as ue,h as V,P as he,a7 as K,I as ge,B as U,L as R,S as f,t as n}from"./app-BQKKzqf3.js";import{S as L,a as H,b as W,c as q,d as C}from"./select-ivmaqUw7.js";import{P as je}from"./pagination-mhOv5uX0.js";import{C as xe}from"./CrudTable-DuIO85h3.js";import{C as be}from"./CrudFormModal-BgN_j_X-.js";import{C as Se}from"./CrudDeleteModal-Bjo4FQXD.js";import{F as Ce}from"./grid-3x3-B93v7dH2.js";function Ee({config:y,title:G,url:J,buttons:P=[],breadcrumbs:Q}){var I;const{t:c}=fe(),{entity:r,table:F,filters:S=[],form:v,hooks:o}=y,{auth:w,...D}=ue().props,N=(w==null?void 0:w.permissions)||[],b=D[r.name]||{data:[],links:[]},p=D.filters||{},[m,M]=j.useState(p.search||""),[x,$]=j.useState({}),[A,T]=j.useState(!1),[X,h]=j.useState(!1),[Y,O]=j.useState(!1),[g,k]=j.useState(null),[u,_]=j.useState("create");j.useEffect(()=>{const e={};S.forEach(s=>{const l=s.name||s.key;e[l]=p[l]||""}),$(e)},[]);const z=()=>Object.entries(x).some(([e,s])=>s&&s!=="")||m!=="",Z=()=>Object.entries(x).filter(([e,s])=>s&&s!=="").length+(m?1:0),ee=e=>{e.preventDefault(),se()},se=()=>{const e={page:1};m&&(e.search=m),Object.entries(x).forEach(([s,l])=>{l&&l!==""&&(e[s]=l)}),p.per_page&&(e.per_page=p.per_page),f.get(r.endpoint,e,{preserveState:!0,preserveScroll:!0})},re=(e,s)=>{$(d=>({...d,[e]:s}));const l={page:1};m&&(l.search=m);const i={...x,[e]:s};Object.entries(i).forEach(([d,t])=>{t&&t!==""&&(l[d]=t)}),p.per_page&&(l.per_page=p.per_page),f.get(r.endpoint,l,{preserveState:!0,preserveScroll:!0})},ae=e=>{const s=p.sort_field===e&&p.sort_direction==="asc"?"desc":"asc",l={sort_field:e,sort_direction:s,page:1};m&&(l.search=m),Object.entries(x).forEach(([i,d])=>{d&&d!==""&&(l[i]=d)}),p.per_page&&(l.per_page=p.per_page),f.get(r.endpoint,l,{preserveState:!0,preserveScroll:!0})},te=(e,s)=>{switch(k(s),e){case"view":_("view"),h(!0);break;case"edit":_("edit"),h(!0);break;case"delete":O(!0);break}},ie=()=>{k(null),_("create"),h(!0)},ne=e=>{const s={...e};if(r.name==="roles"){if(s.permissions&&Array.isArray(s.permissions)){const d=s.permissions.map(t=>typeof t=="object"&&t!==null&&t.name?t.name:String(t));s.permissions=d}const i={label:s.label,description:s.description||"",permissions:s.permissions||[]};Object.keys(s).forEach(d=>{delete s[d]}),Object.assign(s,i)}else if(s.permissions&&Array.isArray(s.permissions)){const i={};s.permissions.forEach((d,t)=>{i[t]=String(d)}),s.permissions=i}if(r.name==="permissions"&&u==="edit"&&delete s.name,v.fields.some(i=>i.type==="file")){const i=v.fields.filter(t=>t.type==="file").map(t=>t.name),d=new FormData;Object.keys(s).forEach(t=>{if(i.includes(t)&&u==="edit"){s[t]&&typeof s[t]=="object"&&d.append(t,s[t]);return}d.append(t,s[t])}),u==="create"?(n.loading(c("Creating...")),f.post(r.endpoint,d,{onSuccess:t=>{h(!1),n.dismiss(),n.success(c(`${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)} created successfully`)),o!=null&&o.afterCreate&&o.afterCreate(e,t.props[r.name])},onError:t=>{n.dismiss(),n.error(c(`Failed to create ${r.name.slice(0,-1)}: ${Object.values(t).join(", ")}`))}})):u==="edit"&&(n.loading(c("Updating...")),f.post(`${r.endpoint}/${g.id}?_method=PUT`,d,{onSuccess:t=>{h(!1),n.dismiss(),n.success(c(`${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)} updated successfully`)),o!=null&&o.afterUpdate&&o.afterUpdate(e,t.props[r.name])},onError:t=>{n.dismiss(),n.error(c(`Failed to update ${r.name.slice(0,-1)}: ${Object.values(t).join(", ")}`))}}));return}u==="create"?(n.loading(c("Creating...")),f.post(r.endpoint,s,{onSuccess:i=>{h(!1),n.dismiss(),n.success(c(`${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)} created successfully`)),o!=null&&o.afterCreate&&o.afterCreate(e,i.props[r.name])},onError:i=>{n.dismiss(),n.error(c(`Failed to create ${r.name.slice(0,-1)}: ${Object.values(i).join(", ")}`))}})):u==="edit"&&(n.loading(c("Updating...")),f.put(`${r.endpoint}/${g.id}`,s,{onSuccess:i=>{h(!1),n.dismiss(),n.success(c(`${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)} updated successfully`)),o!=null&&o.afterUpdate&&o.afterUpdate(e,i.props[r.name])},onError:i=>{n.dismiss(),n.error(c(`Failed to update ${r.name.slice(0,-1)}: ${Object.values(i).join(", ")}`))}}))},le=()=>{n.loading(c("Deleting...")),f.delete(`${r.endpoint}/${g.id}`,{onSuccess:e=>{var s,l;if(O(!1),n.dismiss(),(s=e.props.flash)!=null&&s.error){n.error(c((l=e.props.flash)==null?void 0:l.error));return}n.success(c(`${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)} deleted successfully`)),o!=null&&o.afterDelete&&o.afterDelete(g.id)},onError:e=>{n.dismiss(),n.error(c(`Failed to delete ${r.name.slice(0,-1)}: ${Object.values(e).join(", ")}`))}})},ce=()=>{const e={};S.forEach(s=>{e[s.key]=s.type==="select"?"all":""}),$(e),M(""),T(!1),f.get(r.endpoint,{page:1,per_page:p.per_page},{preserveState:!0,preserveScroll:!0})},oe=P.every(e=>e.showAddButton!==!1),E=[];P.forEach(e=>{(!e.permission||V(N,e.permission))&&E.push({label:e.label,icon:e.icon,variant:e.variant,onClick:e.onClick})}),oe&&V(N,r.permissions.create)&&E.push({label:`Add New ${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)}`,icon:a.jsx(he,{className:"h-4 w-4"}),variant:"default",onClick:()=>ie()});const B=G||r.name.charAt(0).toUpperCase()+r.name.slice(1),de=[{title:c("Dashboard"),href:route("dashboard")},{title:B}],pe=Q||de;return a.jsxs(me,{title:B,url:J,actions:E,breadcrumbs:pe,noPadding:!0,children:[a.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4",children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("form",{onSubmit:ee,className:"flex gap-2",children:[a.jsxs("div",{className:"relative w-64",children:[a.jsx(K,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(ge,{placeholder:`Search ${r.name}...`,value:m,onChange:e=>M(e.target.value),className:"w-full pl-9"})]}),a.jsxs(U,{type:"submit",size:"sm",children:[a.jsx(K,{className:"h-4 w-4 mr-1.5"}),c("Search")]})]}),S.length>0&&a.jsx("div",{className:"ml-2",children:a.jsxs(U,{variant:"default",size:"sm",className:"h-8 px-2 py-1",onClick:()=>T(!A),children:[a.jsx(Ce,{className:"h-3.5 w-3.5 mr-1.5"}),A?"Hide Filters":"Filters",z()&&a.jsx("span",{className:"ml-1 bg-primary-foreground text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs",children:Z()})]})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(R,{className:"text-xs text-muted-foreground",children:[c("Per Page"),":"]}),a.jsxs(L,{value:((I=p.per_page)==null?void 0:I.toString())||"10",onValueChange:e=>{const s={page:1,per_page:parseInt(e)};m&&(s.search=m),Object.entries(x).forEach(([l,i])=>{i&&i!==""&&(s[l]=i)}),f.get(r.endpoint,s,{preserveState:!0,preserveScroll:!0})},children:[a.jsx(H,{className:"w-16 h-8",children:a.jsx(W,{})}),a.jsxs(q,{children:[a.jsx(C,{value:"10",children:"10"}),a.jsx(C,{value:"25",children:"25"}),a.jsx(C,{value:"50",children:"50"}),a.jsx(C,{value:"100",children:"100"})]})]})]})]}),A&&S.length>0&&a.jsx("div",{className:"w-full mt-3 p-4 bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 rounded-md",children:a.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[S.map(e=>{var l;const s=e.name||e.key;return a.jsxs("div",{className:"space-y-2",children:[a.jsx(R,{children:e.label}),e.type==="select"&&a.jsxs(L,{value:x[s]||"",onValueChange:i=>re(s,i),children:[a.jsx(H,{className:"w-40",children:a.jsx(W,{placeholder:`All ${e.label}`})}),a.jsx(q,{children:(l=e.options)==null?void 0:l.map(i=>a.jsx(C,{value:i.value,children:i.label},i.value))})]})]},s)}),a.jsx(U,{variant:"outline",size:"sm",className:"h-9",onClick:ce,disabled:!z(),children:c("Reset Filters")})]})})]})}),a.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[a.jsx(xe,{columns:F.columns,actions:F.actions,data:b.data,from:b.from||1,onAction:te,sortField:p.sort_field,sortDirection:p.sort_direction,onSort:ae,statusColors:F.statusColors,permissions:N,entityPermissions:r.permissions}),a.jsx(je,{from:b.from||0,to:b.to||0,total:b.total,links:b.links,entityName:r.name,onPageChange:e=>f.get(e)})]}),a.jsx(be,{isOpen:X,onClose:()=>h(!1),onSubmit:ne,formConfig:{...v,modalSize:y.modalSize||v.modalSize},initialData:g,title:u==="create"?`Add New ${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)}`:u==="edit"?`Edit ${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)}`:`View ${r.name.slice(0,-1).charAt(0).toUpperCase()+r.name.slice(0,-1).slice(1)}`,mode:u,description:y.description}),a.jsx(Se,{isOpen:Y,onClose:()=>O(!1),onConfirm:le,itemName:(g==null?void 0:g.name)||"",entityName:r.name.slice(0,-1)})]})}export{Ee as P};
